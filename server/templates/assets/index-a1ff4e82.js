var hne=Object.defineProperty;var pne=(n,r,s)=>r in n?hne(n,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[r]=s;var ri=(n,r,s)=>(pne(n,typeof r!="symbol"?r+"":r,s),s);function fne(n,r){for(var s=0;s<r.length;s++){const c=r[s];if(typeof c!="string"&&!Array.isArray(c)){for(const d in c)if(d!=="default"&&!(d in n)){const p=Object.getOwnPropertyDescriptor(c,d);p&&Object.defineProperty(n,d,p.get?p:{enumerable:!0,get:()=>c[d]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function s(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(d){if(d.ep)return;d.ep=!0;const p=s(d);fetch(d.href,p)}})();var ro=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var GW={exports:{}},lw={},KW={exports:{}},Si={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fv=Symbol.for("react.element"),mne=Symbol.for("react.portal"),gne=Symbol.for("react.fragment"),_ne=Symbol.for("react.strict_mode"),Ene=Symbol.for("react.profiler"),vne=Symbol.for("react.provider"),yne=Symbol.for("react.context"),Sne=Symbol.for("react.forward_ref"),Tne=Symbol.for("react.suspense"),wne=Symbol.for("react.memo"),Cne=Symbol.for("react.lazy"),j5=Symbol.iterator;function bne(n){return n===null||typeof n!="object"?null:(n=j5&&n[j5]||n["@@iterator"],typeof n=="function"?n:null)}var qW={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},YW=Object.assign,$W={};function jg(n,r,s){this.props=n,this.context=r,this.refs=$W,this.updater=s||qW}jg.prototype.isReactComponent={};jg.prototype.setState=function(n,r){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,r,"setState")};jg.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function XW(){}XW.prototype=jg.prototype;function EP(n,r,s){this.props=n,this.context=r,this.refs=$W,this.updater=s||qW}var vP=EP.prototype=new XW;vP.constructor=EP;YW(vP,jg.prototype);vP.isPureReactComponent=!0;var V5=Array.isArray,JW=Object.prototype.hasOwnProperty,yP={current:null},ZW={key:!0,ref:!0,__self:!0,__source:!0};function QW(n,r,s){var c,d={},p=null,g=null;if(r!=null)for(c in r.ref!==void 0&&(g=r.ref),r.key!==void 0&&(p=""+r.key),r)JW.call(r,c)&&!ZW.hasOwnProperty(c)&&(d[c]=r[c]);var y=arguments.length-2;if(y===1)d.children=s;else if(1<y){for(var T=Array(y),R=0;R<y;R++)T[R]=arguments[R+2];d.children=T}if(n&&n.defaultProps)for(c in y=n.defaultProps,y)d[c]===void 0&&(d[c]=y[c]);return{$$typeof:Fv,type:n,key:p,ref:g,props:d,_owner:yP.current}}function Rne(n,r){return{$$typeof:Fv,type:n.type,key:r,ref:n.ref,props:n.props,_owner:n._owner}}function SP(n){return typeof n=="object"&&n!==null&&n.$$typeof===Fv}function Ine(n){var r={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(s){return r[s]})}var F5=/\/+/g;function cA(n,r){return typeof n=="object"&&n!==null&&n.key!=null?Ine(""+n.key):r.toString(36)}function ZS(n,r,s,c,d){var p=typeof n;(p==="undefined"||p==="boolean")&&(n=null);var g=!1;if(n===null)g=!0;else switch(p){case"string":case"number":g=!0;break;case"object":switch(n.$$typeof){case Fv:case mne:g=!0}}if(g)return g=n,d=d(g),n=c===""?"."+cA(g,0):c,V5(d)?(s="",n!=null&&(s=n.replace(F5,"$&/")+"/"),ZS(d,r,s,"",function(R){return R})):d!=null&&(SP(d)&&(d=Rne(d,s+(!d.key||g&&g.key===d.key?"":(""+d.key).replace(F5,"$&/")+"/")+n)),r.push(d)),1;if(g=0,c=c===""?".":c+":",V5(n))for(var y=0;y<n.length;y++){p=n[y];var T=c+cA(p,y);g+=ZS(p,r,s,T,d)}else if(T=bne(n),typeof T=="function")for(n=T.call(n),y=0;!(p=n.next()).done;)p=p.value,T=c+cA(p,y++),g+=ZS(p,r,s,T,d);else if(p==="object")throw r=String(n),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return g}function ES(n,r,s){if(n==null)return n;var c=[],d=0;return ZS(n,c,"","",function(p){return r.call(s,p,d++)}),c}function Ane(n){if(n._status===-1){var r=n._result;r=r(),r.then(function(s){(n._status===0||n._status===-1)&&(n._status=1,n._result=s)},function(s){(n._status===0||n._status===-1)&&(n._status=2,n._result=s)}),n._status===-1&&(n._status=0,n._result=r)}if(n._status===1)return n._result.default;throw n._result}var Yo={current:null},QS={transition:null},One={ReactCurrentDispatcher:Yo,ReactCurrentBatchConfig:QS,ReactCurrentOwner:yP};function ez(){throw Error("act(...) is not supported in production builds of React.")}Si.Children={map:ES,forEach:function(n,r,s){ES(n,function(){r.apply(this,arguments)},s)},count:function(n){var r=0;return ES(n,function(){r++}),r},toArray:function(n){return ES(n,function(r){return r})||[]},only:function(n){if(!SP(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Si.Component=jg;Si.Fragment=gne;Si.Profiler=Ene;Si.PureComponent=EP;Si.StrictMode=_ne;Si.Suspense=Tne;Si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=One;Si.act=ez;Si.cloneElement=function(n,r,s){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var c=YW({},n.props),d=n.key,p=n.ref,g=n._owner;if(r!=null){if(r.ref!==void 0&&(p=r.ref,g=yP.current),r.key!==void 0&&(d=""+r.key),n.type&&n.type.defaultProps)var y=n.type.defaultProps;for(T in r)JW.call(r,T)&&!ZW.hasOwnProperty(T)&&(c[T]=r[T]===void 0&&y!==void 0?y[T]:r[T])}var T=arguments.length-2;if(T===1)c.children=s;else if(1<T){y=Array(T);for(var R=0;R<T;R++)y[R]=arguments[R+2];c.children=y}return{$$typeof:Fv,type:n.type,key:d,ref:p,props:c,_owner:g}};Si.createContext=function(n){return n={$$typeof:yne,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:vne,_context:n},n.Consumer=n};Si.createElement=QW;Si.createFactory=function(n){var r=QW.bind(null,n);return r.type=n,r};Si.createRef=function(){return{current:null}};Si.forwardRef=function(n){return{$$typeof:Sne,render:n}};Si.isValidElement=SP;Si.lazy=function(n){return{$$typeof:Cne,_payload:{_status:-1,_result:n},_init:Ane}};Si.memo=function(n,r){return{$$typeof:wne,type:n,compare:r===void 0?null:r}};Si.startTransition=function(n){var r=QS.transition;QS.transition={};try{n()}finally{QS.transition=r}};Si.unstable_act=ez;Si.useCallback=function(n,r){return Yo.current.useCallback(n,r)};Si.useContext=function(n){return Yo.current.useContext(n)};Si.useDebugValue=function(){};Si.useDeferredValue=function(n){return Yo.current.useDeferredValue(n)};Si.useEffect=function(n,r){return Yo.current.useEffect(n,r)};Si.useId=function(){return Yo.current.useId()};Si.useImperativeHandle=function(n,r,s){return Yo.current.useImperativeHandle(n,r,s)};Si.useInsertionEffect=function(n,r){return Yo.current.useInsertionEffect(n,r)};Si.useLayoutEffect=function(n,r){return Yo.current.useLayoutEffect(n,r)};Si.useMemo=function(n,r){return Yo.current.useMemo(n,r)};Si.useReducer=function(n,r,s){return Yo.current.useReducer(n,r,s)};Si.useRef=function(n){return Yo.current.useRef(n)};Si.useState=function(n){return Yo.current.useState(n)};Si.useSyncExternalStore=function(n,r,s){return Yo.current.useSyncExternalStore(n,r,s)};Si.useTransition=function(){return Yo.current.useTransition()};Si.version="18.3.1";KW.exports=Si;var le=KW.exports;const oo=Vv(le),Pne=fne({__proto__:null,default:oo},[le]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nne=le,xne=Symbol.for("react.element"),Dne=Symbol.for("react.fragment"),kne=Object.prototype.hasOwnProperty,Lne=Nne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Mne={key:!0,ref:!0,__self:!0,__source:!0};function tz(n,r,s){var c,d={},p=null,g=null;s!==void 0&&(p=""+s),r.key!==void 0&&(p=""+r.key),r.ref!==void 0&&(g=r.ref);for(c in r)kne.call(r,c)&&!Mne.hasOwnProperty(c)&&(d[c]=r[c]);if(n&&n.defaultProps)for(c in r=n.defaultProps,r)d[c]===void 0&&(d[c]=r[c]);return{$$typeof:xne,type:n,key:p,ref:g,props:d,_owner:Lne.current}}lw.Fragment=Dne;lw.jsx=tz;lw.jsxs=tz;GW.exports=lw;var O=GW.exports,QA={},iz={exports:{}},qs={},nz={exports:{}},rz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function r(Ue,Je){var Ie=Ue.length;Ue.push(Je);e:for(;0<Ie;){var pt=Ie-1>>>1,St=Ue[pt];if(0<d(St,Je))Ue[pt]=Je,Ue[Ie]=St,Ie=pt;else break e}}function s(Ue){return Ue.length===0?null:Ue[0]}function c(Ue){if(Ue.length===0)return null;var Je=Ue[0],Ie=Ue.pop();if(Ie!==Je){Ue[0]=Ie;e:for(var pt=0,St=Ue.length,yi=St>>>1;pt<yi;){var Ot=2*(pt+1)-1,ge=Ue[Ot],lt=Ot+1,vt=Ue[lt];if(0>d(ge,Ie))lt<St&&0>d(vt,ge)?(Ue[pt]=vt,Ue[lt]=Ie,pt=lt):(Ue[pt]=ge,Ue[Ot]=Ie,pt=Ot);else if(lt<St&&0>d(vt,Ie))Ue[pt]=vt,Ue[lt]=Ie,pt=lt;else break e}}return Je}function d(Ue,Je){var Ie=Ue.sortIndex-Je.sortIndex;return Ie!==0?Ie:Ue.id-Je.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;n.unstable_now=function(){return p.now()}}else{var g=Date,y=g.now();n.unstable_now=function(){return g.now()-y}}var T=[],R=[],N=1,D=null,B=3,q=!1,J=!1,Y=!1,te=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,ee=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(Ue){for(var Je=s(R);Je!==null;){if(Je.callback===null)c(R);else if(Je.startTime<=Ue)c(R),Je.sortIndex=Je.expirationTime,r(T,Je);else break;Je=s(R)}}function pe(Ue){if(Y=!1,re(Ue),!J)if(s(T)!==null)J=!0,yt(ve);else{var Je=s(R);Je!==null&&Lt(pe,Je.startTime-Ue)}}function ve(Ue,Je){J=!1,Y&&(Y=!1,Z(je),je=-1),q=!0;var Ie=B;try{for(re(Je),D=s(T);D!==null&&(!(D.expirationTime>Je)||Ue&&!st());){var pt=D.callback;if(typeof pt=="function"){D.callback=null,B=D.priorityLevel;var St=pt(D.expirationTime<=Je);Je=n.unstable_now(),typeof St=="function"?D.callback=St:D===s(T)&&c(T),re(Je)}else c(T);D=s(T)}if(D!==null)var yi=!0;else{var Ot=s(R);Ot!==null&&Lt(pe,Ot.startTime-Je),yi=!1}return yi}finally{D=null,B=Ie,q=!1}}var Oe=!1,Se=null,je=-1,ot=5,Qe=-1;function st(){return!(n.unstable_now()-Qe<ot)}function ut(){if(Se!==null){var Ue=n.unstable_now();Qe=Ue;var Je=!0;try{Je=Se(!0,Ue)}finally{Je?Ni():(Oe=!1,Se=null)}}else Oe=!1}var Ni;if(typeof ee=="function")Ni=function(){ee(ut)};else if(typeof MessageChannel<"u"){var gt=new MessageChannel,At=gt.port2;gt.port1.onmessage=ut,Ni=function(){At.postMessage(null)}}else Ni=function(){te(ut,0)};function yt(Ue){Se=Ue,Oe||(Oe=!0,Ni())}function Lt(Ue,Je){je=te(function(){Ue(n.unstable_now())},Je)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ue){Ue.callback=null},n.unstable_continueExecution=function(){J||q||(J=!0,yt(ve))},n.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ot=0<Ue?Math.floor(1e3/Ue):5},n.unstable_getCurrentPriorityLevel=function(){return B},n.unstable_getFirstCallbackNode=function(){return s(T)},n.unstable_next=function(Ue){switch(B){case 1:case 2:case 3:var Je=3;break;default:Je=B}var Ie=B;B=Je;try{return Ue()}finally{B=Ie}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ue,Je){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var Ie=B;B=Ue;try{return Je()}finally{B=Ie}},n.unstable_scheduleCallback=function(Ue,Je,Ie){var pt=n.unstable_now();switch(typeof Ie=="object"&&Ie!==null?(Ie=Ie.delay,Ie=typeof Ie=="number"&&0<Ie?pt+Ie:pt):Ie=pt,Ue){case 1:var St=-1;break;case 2:St=250;break;case 5:St=1073741823;break;case 4:St=1e4;break;default:St=5e3}return St=Ie+St,Ue={id:N++,callback:Je,priorityLevel:Ue,startTime:Ie,expirationTime:St,sortIndex:-1},Ie>pt?(Ue.sortIndex=Ie,r(R,Ue),s(T)===null&&Ue===s(R)&&(Y?(Z(je),je=-1):Y=!0,Lt(pe,Ie-pt))):(Ue.sortIndex=St,r(T,Ue),J||q||(J=!0,yt(ve))),Ue},n.unstable_shouldYield=st,n.unstable_wrapCallback=function(Ue){var Je=B;return function(){var Ie=B;B=Je;try{return Ue.apply(this,arguments)}finally{B=Ie}}}})(rz);nz.exports=rz;var Une=nz.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jne=le,Ks=Une;function $e(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,s=1;s<arguments.length;s++)r+="&args[]="+encodeURIComponent(arguments[s]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oz=new Set,uv={};function tf(n,r){yg(n,r),yg(n+"Capture",r)}function yg(n,r){for(uv[n]=r,n=0;n<r.length;n++)oz.add(r[n])}var gd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),eO=Object.prototype.hasOwnProperty,Vne=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,B5={},W5={};function Fne(n){return eO.call(W5,n)?!0:eO.call(B5,n)?!1:Vne.test(n)?W5[n]=!0:(B5[n]=!0,!1)}function Bne(n,r,s,c){if(s!==null&&s.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return c?!1:s!==null?!s.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function Wne(n,r,s,c){if(r===null||typeof r>"u"||Bne(n,r,s,c))return!0;if(c)return!1;if(s!==null)switch(s.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function $o(n,r,s,c,d,p,g){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=c,this.attributeNamespace=d,this.mustUseProperty=s,this.propertyName=n,this.type=r,this.sanitizeURL=p,this.removeEmptyString=g}var co={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){co[n]=new $o(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];co[r]=new $o(r,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){co[n]=new $o(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){co[n]=new $o(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){co[n]=new $o(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){co[n]=new $o(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){co[n]=new $o(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){co[n]=new $o(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){co[n]=new $o(n,5,!1,n.toLowerCase(),null,!1,!1)});var TP=/[\-:]([a-z])/g;function wP(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(TP,wP);co[r]=new $o(r,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(TP,wP);co[r]=new $o(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(TP,wP);co[r]=new $o(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){co[n]=new $o(n,1,!1,n.toLowerCase(),null,!1,!1)});co.xlinkHref=new $o("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){co[n]=new $o(n,1,!1,n.toLowerCase(),null,!0,!0)});function CP(n,r,s,c){var d=co.hasOwnProperty(r)?co[r]:null;(d!==null?d.type!==0:c||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(Wne(r,s,d,c)&&(s=null),c||d===null?Fne(r)&&(s===null?n.removeAttribute(r):n.setAttribute(r,""+s)):d.mustUseProperty?n[d.propertyName]=s===null?d.type===3?!1:"":s:(r=d.attributeName,c=d.attributeNamespace,s===null?n.removeAttribute(r):(d=d.type,s=d===3||d===4&&s===!0?"":""+s,c?n.setAttributeNS(c,r,s):n.setAttribute(r,s))))}var yd=jne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,vS=Symbol.for("react.element"),Zm=Symbol.for("react.portal"),Qm=Symbol.for("react.fragment"),bP=Symbol.for("react.strict_mode"),tO=Symbol.for("react.profiler"),sz=Symbol.for("react.provider"),az=Symbol.for("react.context"),RP=Symbol.for("react.forward_ref"),iO=Symbol.for("react.suspense"),nO=Symbol.for("react.suspense_list"),IP=Symbol.for("react.memo"),Lu=Symbol.for("react.lazy"),cz=Symbol.for("react.offscreen"),z5=Symbol.iterator;function IE(n){return n===null||typeof n!="object"?null:(n=z5&&n[z5]||n["@@iterator"],typeof n=="function"?n:null)}var Jn=Object.assign,lA;function BE(n){if(lA===void 0)try{throw Error()}catch(s){var r=s.stack.trim().match(/\n( *(at )?)/);lA=r&&r[1]||""}return`
`+lA+n}var dA=!1;function uA(n,r){if(!n||dA)return"";dA=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(R){var c=R}Reflect.construct(n,[],r)}else{try{r.call()}catch(R){c=R}n.call(r.prototype)}else{try{throw Error()}catch(R){c=R}n()}}catch(R){if(R&&c&&typeof R.stack=="string"){for(var d=R.stack.split(`
`),p=c.stack.split(`
`),g=d.length-1,y=p.length-1;1<=g&&0<=y&&d[g]!==p[y];)y--;for(;1<=g&&0<=y;g--,y--)if(d[g]!==p[y]){if(g!==1||y!==1)do if(g--,y--,0>y||d[g]!==p[y]){var T=`
`+d[g].replace(" at new "," at ");return n.displayName&&T.includes("<anonymous>")&&(T=T.replace("<anonymous>",n.displayName)),T}while(1<=g&&0<=y);break}}}finally{dA=!1,Error.prepareStackTrace=s}return(n=n?n.displayName||n.name:"")?BE(n):""}function zne(n){switch(n.tag){case 5:return BE(n.type);case 16:return BE("Lazy");case 13:return BE("Suspense");case 19:return BE("SuspenseList");case 0:case 2:case 15:return n=uA(n.type,!1),n;case 11:return n=uA(n.type.render,!1),n;case 1:return n=uA(n.type,!0),n;default:return""}}function rO(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Qm:return"Fragment";case Zm:return"Portal";case tO:return"Profiler";case bP:return"StrictMode";case iO:return"Suspense";case nO:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case az:return(n.displayName||"Context")+".Consumer";case sz:return(n._context.displayName||"Context")+".Provider";case RP:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case IP:return r=n.displayName||null,r!==null?r:rO(n.type)||"Memo";case Lu:r=n._payload,n=n._init;try{return rO(n(r))}catch{}}return null}function Hne(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rO(r);case 8:return r===bP?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function oh(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function lz(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Gne(n){var r=lz(n)?"checked":"value",s=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),c=""+n[r];if(!n.hasOwnProperty(r)&&typeof s<"u"&&typeof s.get=="function"&&typeof s.set=="function"){var d=s.get,p=s.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return d.call(this)},set:function(g){c=""+g,p.call(this,g)}}),Object.defineProperty(n,r,{enumerable:s.enumerable}),{getValue:function(){return c},setValue:function(g){c=""+g},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function yS(n){n._valueTracker||(n._valueTracker=Gne(n))}function dz(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var s=r.getValue(),c="";return n&&(c=lz(n)?n.checked?"true":"false":n.value),n=c,n!==s?(r.setValue(n),!0):!1}function TT(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function oO(n,r){var s=r.checked;return Jn({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:s??n._wrapperState.initialChecked})}function H5(n,r){var s=r.defaultValue==null?"":r.defaultValue,c=r.checked!=null?r.checked:r.defaultChecked;s=oh(r.value!=null?r.value:s),n._wrapperState={initialChecked:c,initialValue:s,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function uz(n,r){r=r.checked,r!=null&&CP(n,"checked",r,!1)}function sO(n,r){uz(n,r);var s=oh(r.value),c=r.type;if(s!=null)c==="number"?(s===0&&n.value===""||n.value!=s)&&(n.value=""+s):n.value!==""+s&&(n.value=""+s);else if(c==="submit"||c==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?aO(n,r.type,s):r.hasOwnProperty("defaultValue")&&aO(n,r.type,oh(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function G5(n,r,s){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var c=r.type;if(!(c!=="submit"&&c!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,s||r===n.value||(n.value=r),n.defaultValue=r}s=n.name,s!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,s!==""&&(n.name=s)}function aO(n,r,s){(r!=="number"||TT(n.ownerDocument)!==n)&&(s==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+s&&(n.defaultValue=""+s))}var WE=Array.isArray;function pg(n,r,s,c){if(n=n.options,r){r={};for(var d=0;d<s.length;d++)r["$"+s[d]]=!0;for(s=0;s<n.length;s++)d=r.hasOwnProperty("$"+n[s].value),n[s].selected!==d&&(n[s].selected=d),d&&c&&(n[s].defaultSelected=!0)}else{for(s=""+oh(s),r=null,d=0;d<n.length;d++){if(n[d].value===s){n[d].selected=!0,c&&(n[d].defaultSelected=!0);return}r!==null||n[d].disabled||(r=n[d])}r!==null&&(r.selected=!0)}}function cO(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error($e(91));return Jn({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function K5(n,r){var s=r.value;if(s==null){if(s=r.children,r=r.defaultValue,s!=null){if(r!=null)throw Error($e(92));if(WE(s)){if(1<s.length)throw Error($e(93));s=s[0]}r=s}r==null&&(r=""),s=r}n._wrapperState={initialValue:oh(s)}}function hz(n,r){var s=oh(r.value),c=oh(r.defaultValue);s!=null&&(s=""+s,s!==n.value&&(n.value=s),r.defaultValue==null&&n.defaultValue!==s&&(n.defaultValue=s)),c!=null&&(n.defaultValue=""+c)}function q5(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function pz(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lO(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?pz(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var SS,fz=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,s,c,d){MSApp.execUnsafeLocalFunction(function(){return n(r,s,c,d)})}:n}(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(SS=SS||document.createElement("div"),SS.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=SS.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function hv(n,r){if(r){var s=n.firstChild;if(s&&s===n.lastChild&&s.nodeType===3){s.nodeValue=r;return}}n.textContent=r}var JE={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Kne=["Webkit","ms","Moz","O"];Object.keys(JE).forEach(function(n){Kne.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),JE[r]=JE[n]})});function mz(n,r,s){return r==null||typeof r=="boolean"||r===""?"":s||typeof r!="number"||r===0||JE.hasOwnProperty(n)&&JE[n]?(""+r).trim():r+"px"}function gz(n,r){n=n.style;for(var s in r)if(r.hasOwnProperty(s)){var c=s.indexOf("--")===0,d=mz(s,r[s],c);s==="float"&&(s="cssFloat"),c?n.setProperty(s,d):n[s]=d}}var qne=Jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function dO(n,r){if(r){if(qne[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error($e(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error($e(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error($e(61))}if(r.style!=null&&typeof r.style!="object")throw Error($e(62))}}function uO(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hO=null;function AP(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var pO=null,fg=null,mg=null;function Y5(n){if(n=zv(n)){if(typeof pO!="function")throw Error($e(280));var r=n.stateNode;r&&(r=fw(r),pO(n.stateNode,n.type,r))}}function _z(n){fg?mg?mg.push(n):mg=[n]:fg=n}function Ez(){if(fg){var n=fg,r=mg;if(mg=fg=null,Y5(n),r)for(n=0;n<r.length;n++)Y5(r[n])}}function vz(n,r){return n(r)}function yz(){}var hA=!1;function Sz(n,r,s){if(hA)return n(r,s);hA=!0;try{return vz(n,r,s)}finally{hA=!1,(fg!==null||mg!==null)&&(yz(),Ez())}}function pv(n,r){var s=n.stateNode;if(s===null)return null;var c=fw(s);if(c===null)return null;s=c[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(n=n.type,c=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!c;break e;default:n=!1}if(n)return null;if(s&&typeof s!="function")throw Error($e(231,r,typeof s));return s}var fO=!1;if(gd)try{var AE={};Object.defineProperty(AE,"passive",{get:function(){fO=!0}}),window.addEventListener("test",AE,AE),window.removeEventListener("test",AE,AE)}catch{fO=!1}function Yne(n,r,s,c,d,p,g,y,T){var R=Array.prototype.slice.call(arguments,3);try{r.apply(s,R)}catch(N){this.onError(N)}}var ZE=!1,wT=null,CT=!1,mO=null,$ne={onError:function(n){ZE=!0,wT=n}};function Xne(n,r,s,c,d,p,g,y,T){ZE=!1,wT=null,Yne.apply($ne,arguments)}function Jne(n,r,s,c,d,p,g,y,T){if(Xne.apply(this,arguments),ZE){if(ZE){var R=wT;ZE=!1,wT=null}else throw Error($e(198));CT||(CT=!0,mO=R)}}function nf(n){var r=n,s=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,r.flags&4098&&(s=r.return),n=r.return;while(n)}return r.tag===3?s:null}function Tz(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function $5(n){if(nf(n)!==n)throw Error($e(188))}function Zne(n){var r=n.alternate;if(!r){if(r=nf(n),r===null)throw Error($e(188));return r!==n?null:n}for(var s=n,c=r;;){var d=s.return;if(d===null)break;var p=d.alternate;if(p===null){if(c=d.return,c!==null){s=c;continue}break}if(d.child===p.child){for(p=d.child;p;){if(p===s)return $5(d),n;if(p===c)return $5(d),r;p=p.sibling}throw Error($e(188))}if(s.return!==c.return)s=d,c=p;else{for(var g=!1,y=d.child;y;){if(y===s){g=!0,s=d,c=p;break}if(y===c){g=!0,c=d,s=p;break}y=y.sibling}if(!g){for(y=p.child;y;){if(y===s){g=!0,s=p,c=d;break}if(y===c){g=!0,c=p,s=d;break}y=y.sibling}if(!g)throw Error($e(189))}}if(s.alternate!==c)throw Error($e(190))}if(s.tag!==3)throw Error($e(188));return s.stateNode.current===s?n:r}function wz(n){return n=Zne(n),n!==null?Cz(n):null}function Cz(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=Cz(n);if(r!==null)return r;n=n.sibling}return null}var bz=Ks.unstable_scheduleCallback,X5=Ks.unstable_cancelCallback,Qne=Ks.unstable_shouldYield,ere=Ks.unstable_requestPaint,fr=Ks.unstable_now,tre=Ks.unstable_getCurrentPriorityLevel,OP=Ks.unstable_ImmediatePriority,Rz=Ks.unstable_UserBlockingPriority,bT=Ks.unstable_NormalPriority,ire=Ks.unstable_LowPriority,Iz=Ks.unstable_IdlePriority,dw=null,vl=null;function nre(n){if(vl&&typeof vl.onCommitFiberRoot=="function")try{vl.onCommitFiberRoot(dw,n,void 0,(n.current.flags&128)===128)}catch{}}var wc=Math.clz32?Math.clz32:sre,rre=Math.log,ore=Math.LN2;function sre(n){return n>>>=0,n===0?32:31-(rre(n)/ore|0)|0}var TS=64,wS=4194304;function zE(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function RT(n,r){var s=n.pendingLanes;if(s===0)return 0;var c=0,d=n.suspendedLanes,p=n.pingedLanes,g=s&268435455;if(g!==0){var y=g&~d;y!==0?c=zE(y):(p&=g,p!==0&&(c=zE(p)))}else g=s&~d,g!==0?c=zE(g):p!==0&&(c=zE(p));if(c===0)return 0;if(r!==0&&r!==c&&!(r&d)&&(d=c&-c,p=r&-r,d>=p||d===16&&(p&4194240)!==0))return r;if(c&4&&(c|=s&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=c;0<r;)s=31-wc(r),d=1<<s,c|=n[s],r&=~d;return c}function are(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cre(n,r){for(var s=n.suspendedLanes,c=n.pingedLanes,d=n.expirationTimes,p=n.pendingLanes;0<p;){var g=31-wc(p),y=1<<g,T=d[g];T===-1?(!(y&s)||y&c)&&(d[g]=are(y,r)):T<=r&&(n.expiredLanes|=y),p&=~y}}function gO(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Az(){var n=TS;return TS<<=1,!(TS&4194240)&&(TS=64),n}function pA(n){for(var r=[],s=0;31>s;s++)r.push(n);return r}function Bv(n,r,s){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-wc(r),n[r]=s}function lre(n,r){var s=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var c=n.eventTimes;for(n=n.expirationTimes;0<s;){var d=31-wc(s),p=1<<d;r[d]=0,c[d]=-1,n[d]=-1,s&=~p}}function PP(n,r){var s=n.entangledLanes|=r;for(n=n.entanglements;s;){var c=31-wc(s),d=1<<c;d&r|n[c]&r&&(n[c]|=r),s&=~d}}var cn=0;function Oz(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Pz,NP,Nz,xz,Dz,_O=!1,CS=[],qu=null,Yu=null,$u=null,fv=new Map,mv=new Map,Uu=[],dre="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function J5(n,r){switch(n){case"focusin":case"focusout":qu=null;break;case"dragenter":case"dragleave":Yu=null;break;case"mouseover":case"mouseout":$u=null;break;case"pointerover":case"pointerout":fv.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":mv.delete(r.pointerId)}}function OE(n,r,s,c,d,p){return n===null||n.nativeEvent!==p?(n={blockedOn:r,domEventName:s,eventSystemFlags:c,nativeEvent:p,targetContainers:[d]},r!==null&&(r=zv(r),r!==null&&NP(r)),n):(n.eventSystemFlags|=c,r=n.targetContainers,d!==null&&r.indexOf(d)===-1&&r.push(d),n)}function ure(n,r,s,c,d){switch(r){case"focusin":return qu=OE(qu,n,r,s,c,d),!0;case"dragenter":return Yu=OE(Yu,n,r,s,c,d),!0;case"mouseover":return $u=OE($u,n,r,s,c,d),!0;case"pointerover":var p=d.pointerId;return fv.set(p,OE(fv.get(p)||null,n,r,s,c,d)),!0;case"gotpointercapture":return p=d.pointerId,mv.set(p,OE(mv.get(p)||null,n,r,s,c,d)),!0}return!1}function kz(n){var r=Vp(n.target);if(r!==null){var s=nf(r);if(s!==null){if(r=s.tag,r===13){if(r=Tz(s),r!==null){n.blockedOn=r,Dz(n.priority,function(){Nz(s)});return}}else if(r===3&&s.stateNode.current.memoizedState.isDehydrated){n.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}n.blockedOn=null}function eT(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var s=EO(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(s===null){s=n.nativeEvent;var c=new s.constructor(s.type,s);hO=c,s.target.dispatchEvent(c),hO=null}else return r=zv(s),r!==null&&NP(r),n.blockedOn=s,!1;r.shift()}return!0}function Z5(n,r,s){eT(n)&&s.delete(r)}function hre(){_O=!1,qu!==null&&eT(qu)&&(qu=null),Yu!==null&&eT(Yu)&&(Yu=null),$u!==null&&eT($u)&&($u=null),fv.forEach(Z5),mv.forEach(Z5)}function PE(n,r){n.blockedOn===r&&(n.blockedOn=null,_O||(_O=!0,Ks.unstable_scheduleCallback(Ks.unstable_NormalPriority,hre)))}function gv(n){function r(d){return PE(d,n)}if(0<CS.length){PE(CS[0],n);for(var s=1;s<CS.length;s++){var c=CS[s];c.blockedOn===n&&(c.blockedOn=null)}}for(qu!==null&&PE(qu,n),Yu!==null&&PE(Yu,n),$u!==null&&PE($u,n),fv.forEach(r),mv.forEach(r),s=0;s<Uu.length;s++)c=Uu[s],c.blockedOn===n&&(c.blockedOn=null);for(;0<Uu.length&&(s=Uu[0],s.blockedOn===null);)kz(s),s.blockedOn===null&&Uu.shift()}var gg=yd.ReactCurrentBatchConfig,IT=!0;function pre(n,r,s,c){var d=cn,p=gg.transition;gg.transition=null;try{cn=1,xP(n,r,s,c)}finally{cn=d,gg.transition=p}}function fre(n,r,s,c){var d=cn,p=gg.transition;gg.transition=null;try{cn=4,xP(n,r,s,c)}finally{cn=d,gg.transition=p}}function xP(n,r,s,c){if(IT){var d=EO(n,r,s,c);if(d===null)wA(n,r,c,AT,s),J5(n,c);else if(ure(d,n,r,s,c))c.stopPropagation();else if(J5(n,c),r&4&&-1<dre.indexOf(n)){for(;d!==null;){var p=zv(d);if(p!==null&&Pz(p),p=EO(n,r,s,c),p===null&&wA(n,r,c,AT,s),p===d)break;d=p}d!==null&&c.stopPropagation()}else wA(n,r,c,null,s)}}var AT=null;function EO(n,r,s,c){if(AT=null,n=AP(c),n=Vp(n),n!==null)if(r=nf(n),r===null)n=null;else if(s=r.tag,s===13){if(n=Tz(r),n!==null)return n;n=null}else if(s===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return AT=n,null}function Lz(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tre()){case OP:return 1;case Rz:return 4;case bT:case ire:return 16;case Iz:return 536870912;default:return 16}default:return 16}}var Vu=null,DP=null,tT=null;function Mz(){if(tT)return tT;var n,r=DP,s=r.length,c,d="value"in Vu?Vu.value:Vu.textContent,p=d.length;for(n=0;n<s&&r[n]===d[n];n++);var g=s-n;for(c=1;c<=g&&r[s-c]===d[p-c];c++);return tT=d.slice(n,1<c?1-c:void 0)}function iT(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function bS(){return!0}function Q5(){return!1}function Ys(n){function r(s,c,d,p,g){this._reactName=s,this._targetInst=d,this.type=c,this.nativeEvent=p,this.target=g,this.currentTarget=null;for(var y in n)n.hasOwnProperty(y)&&(s=n[y],this[y]=s?s(p):p[y]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?bS:Q5,this.isPropagationStopped=Q5,this}return Jn(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=bS)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=bS)},persist:function(){},isPersistent:bS}),r}var Vg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kP=Ys(Vg),Wv=Jn({},Vg,{view:0,detail:0}),mre=Ys(Wv),fA,mA,NE,uw=Jn({},Wv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:LP,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==NE&&(NE&&n.type==="mousemove"?(fA=n.screenX-NE.screenX,mA=n.screenY-NE.screenY):mA=fA=0,NE=n),fA)},movementY:function(n){return"movementY"in n?n.movementY:mA}}),e3=Ys(uw),gre=Jn({},uw,{dataTransfer:0}),_re=Ys(gre),Ere=Jn({},Wv,{relatedTarget:0}),gA=Ys(Ere),vre=Jn({},Vg,{animationName:0,elapsedTime:0,pseudoElement:0}),yre=Ys(vre),Sre=Jn({},Vg,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Tre=Ys(Sre),wre=Jn({},Vg,{data:0}),t3=Ys(wre),Cre={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bre={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Rre={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ire(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=Rre[n])?!!r[n]:!1}function LP(){return Ire}var Are=Jn({},Wv,{key:function(n){if(n.key){var r=Cre[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=iT(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?bre[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:LP,charCode:function(n){return n.type==="keypress"?iT(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?iT(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Ore=Ys(Are),Pre=Jn({},uw,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),i3=Ys(Pre),Nre=Jn({},Wv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:LP}),xre=Ys(Nre),Dre=Jn({},Vg,{propertyName:0,elapsedTime:0,pseudoElement:0}),kre=Ys(Dre),Lre=Jn({},uw,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Mre=Ys(Lre),Ure=[9,13,27,32],MP=gd&&"CompositionEvent"in window,QE=null;gd&&"documentMode"in document&&(QE=document.documentMode);var jre=gd&&"TextEvent"in window&&!QE,Uz=gd&&(!MP||QE&&8<QE&&11>=QE),n3=String.fromCharCode(32),r3=!1;function jz(n,r){switch(n){case"keyup":return Ure.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vz(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var eg=!1;function Vre(n,r){switch(n){case"compositionend":return Vz(r);case"keypress":return r.which!==32?null:(r3=!0,n3);case"textInput":return n=r.data,n===n3&&r3?null:n;default:return null}}function Fre(n,r){if(eg)return n==="compositionend"||!MP&&jz(n,r)?(n=Mz(),tT=DP=Vu=null,eg=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Uz&&r.locale!=="ko"?null:r.data;default:return null}}var Bre={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function o3(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!Bre[n.type]:r==="textarea"}function Fz(n,r,s,c){_z(c),r=OT(r,"onChange"),0<r.length&&(s=new kP("onChange","change",null,s,c),n.push({event:s,listeners:r}))}var ev=null,_v=null;function Wre(n){Jz(n,0)}function hw(n){var r=ng(n);if(dz(r))return n}function zre(n,r){if(n==="change")return r}var Bz=!1;if(gd){var _A;if(gd){var EA="oninput"in document;if(!EA){var s3=document.createElement("div");s3.setAttribute("oninput","return;"),EA=typeof s3.oninput=="function"}_A=EA}else _A=!1;Bz=_A&&(!document.documentMode||9<document.documentMode)}function a3(){ev&&(ev.detachEvent("onpropertychange",Wz),_v=ev=null)}function Wz(n){if(n.propertyName==="value"&&hw(_v)){var r=[];Fz(r,_v,n,AP(n)),Sz(Wre,r)}}function Hre(n,r,s){n==="focusin"?(a3(),ev=r,_v=s,ev.attachEvent("onpropertychange",Wz)):n==="focusout"&&a3()}function Gre(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return hw(_v)}function Kre(n,r){if(n==="click")return hw(r)}function qre(n,r){if(n==="input"||n==="change")return hw(r)}function Yre(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Rc=typeof Object.is=="function"?Object.is:Yre;function Ev(n,r){if(Rc(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var s=Object.keys(n),c=Object.keys(r);if(s.length!==c.length)return!1;for(c=0;c<s.length;c++){var d=s[c];if(!eO.call(r,d)||!Rc(n[d],r[d]))return!1}return!0}function c3(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function l3(n,r){var s=c3(n);n=0;for(var c;s;){if(s.nodeType===3){if(c=n+s.textContent.length,n<=r&&c>=r)return{node:s,offset:r-n};n=c}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=c3(s)}}function zz(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?zz(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function Hz(){for(var n=window,r=TT();r instanceof n.HTMLIFrameElement;){try{var s=typeof r.contentWindow.location.href=="string"}catch{s=!1}if(s)n=r.contentWindow;else break;r=TT(n.document)}return r}function UP(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function $re(n){var r=Hz(),s=n.focusedElem,c=n.selectionRange;if(r!==s&&s&&s.ownerDocument&&zz(s.ownerDocument.documentElement,s)){if(c!==null&&UP(s)){if(r=c.start,n=c.end,n===void 0&&(n=r),"selectionStart"in s)s.selectionStart=r,s.selectionEnd=Math.min(n,s.value.length);else if(n=(r=s.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var d=s.textContent.length,p=Math.min(c.start,d);c=c.end===void 0?p:Math.min(c.end,d),!n.extend&&p>c&&(d=c,c=p,p=d),d=l3(s,p);var g=l3(s,c);d&&g&&(n.rangeCount!==1||n.anchorNode!==d.node||n.anchorOffset!==d.offset||n.focusNode!==g.node||n.focusOffset!==g.offset)&&(r=r.createRange(),r.setStart(d.node,d.offset),n.removeAllRanges(),p>c?(n.addRange(r),n.extend(g.node,g.offset)):(r.setEnd(g.node,g.offset),n.addRange(r)))}}for(r=[],n=s;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof s.focus=="function"&&s.focus(),s=0;s<r.length;s++)n=r[s],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var Xre=gd&&"documentMode"in document&&11>=document.documentMode,tg=null,vO=null,tv=null,yO=!1;function d3(n,r,s){var c=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;yO||tg==null||tg!==TT(c)||(c=tg,"selectionStart"in c&&UP(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),tv&&Ev(tv,c)||(tv=c,c=OT(vO,"onSelect"),0<c.length&&(r=new kP("onSelect","select",null,r,s),n.push({event:r,listeners:c}),r.target=tg)))}function RS(n,r){var s={};return s[n.toLowerCase()]=r.toLowerCase(),s["Webkit"+n]="webkit"+r,s["Moz"+n]="moz"+r,s}var ig={animationend:RS("Animation","AnimationEnd"),animationiteration:RS("Animation","AnimationIteration"),animationstart:RS("Animation","AnimationStart"),transitionend:RS("Transition","TransitionEnd")},vA={},Gz={};gd&&(Gz=document.createElement("div").style,"AnimationEvent"in window||(delete ig.animationend.animation,delete ig.animationiteration.animation,delete ig.animationstart.animation),"TransitionEvent"in window||delete ig.transitionend.transition);function pw(n){if(vA[n])return vA[n];if(!ig[n])return n;var r=ig[n],s;for(s in r)if(r.hasOwnProperty(s)&&s in Gz)return vA[n]=r[s];return n}var Kz=pw("animationend"),qz=pw("animationiteration"),Yz=pw("animationstart"),$z=pw("transitionend"),Xz=new Map,u3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ch(n,r){Xz.set(n,r),tf(r,[n])}for(var yA=0;yA<u3.length;yA++){var SA=u3[yA],Jre=SA.toLowerCase(),Zre=SA[0].toUpperCase()+SA.slice(1);ch(Jre,"on"+Zre)}ch(Kz,"onAnimationEnd");ch(qz,"onAnimationIteration");ch(Yz,"onAnimationStart");ch("dblclick","onDoubleClick");ch("focusin","onFocus");ch("focusout","onBlur");ch($z,"onTransitionEnd");yg("onMouseEnter",["mouseout","mouseover"]);yg("onMouseLeave",["mouseout","mouseover"]);yg("onPointerEnter",["pointerout","pointerover"]);yg("onPointerLeave",["pointerout","pointerover"]);tf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tf("onBeforeInput",["compositionend","keypress","textInput","paste"]);tf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var HE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qre=new Set("cancel close invalid load scroll toggle".split(" ").concat(HE));function h3(n,r,s){var c=n.type||"unknown-event";n.currentTarget=s,Jne(c,r,void 0,n),n.currentTarget=null}function Jz(n,r){r=(r&4)!==0;for(var s=0;s<n.length;s++){var c=n[s],d=c.event;c=c.listeners;e:{var p=void 0;if(r)for(var g=c.length-1;0<=g;g--){var y=c[g],T=y.instance,R=y.currentTarget;if(y=y.listener,T!==p&&d.isPropagationStopped())break e;h3(d,y,R),p=T}else for(g=0;g<c.length;g++){if(y=c[g],T=y.instance,R=y.currentTarget,y=y.listener,T!==p&&d.isPropagationStopped())break e;h3(d,y,R),p=T}}}if(CT)throw n=mO,CT=!1,mO=null,n}function kn(n,r){var s=r[bO];s===void 0&&(s=r[bO]=new Set);var c=n+"__bubble";s.has(c)||(Zz(r,n,2,!1),s.add(c))}function TA(n,r,s){var c=0;r&&(c|=4),Zz(s,n,c,r)}var IS="_reactListening"+Math.random().toString(36).slice(2);function vv(n){if(!n[IS]){n[IS]=!0,oz.forEach(function(s){s!=="selectionchange"&&(Qre.has(s)||TA(s,!1,n),TA(s,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[IS]||(r[IS]=!0,TA("selectionchange",!1,r))}}function Zz(n,r,s,c){switch(Lz(r)){case 1:var d=pre;break;case 4:d=fre;break;default:d=xP}s=d.bind(null,r,s,n),d=void 0,!fO||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(d=!0),c?d!==void 0?n.addEventListener(r,s,{capture:!0,passive:d}):n.addEventListener(r,s,!0):d!==void 0?n.addEventListener(r,s,{passive:d}):n.addEventListener(r,s,!1)}function wA(n,r,s,c,d){var p=c;if(!(r&1)&&!(r&2)&&c!==null)e:for(;;){if(c===null)return;var g=c.tag;if(g===3||g===4){var y=c.stateNode.containerInfo;if(y===d||y.nodeType===8&&y.parentNode===d)break;if(g===4)for(g=c.return;g!==null;){var T=g.tag;if((T===3||T===4)&&(T=g.stateNode.containerInfo,T===d||T.nodeType===8&&T.parentNode===d))return;g=g.return}for(;y!==null;){if(g=Vp(y),g===null)return;if(T=g.tag,T===5||T===6){c=p=g;continue e}y=y.parentNode}}c=c.return}Sz(function(){var R=p,N=AP(s),D=[];e:{var B=Xz.get(n);if(B!==void 0){var q=kP,J=n;switch(n){case"keypress":if(iT(s)===0)break e;case"keydown":case"keyup":q=Ore;break;case"focusin":J="focus",q=gA;break;case"focusout":J="blur",q=gA;break;case"beforeblur":case"afterblur":q=gA;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=e3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=_re;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=xre;break;case Kz:case qz:case Yz:q=yre;break;case $z:q=kre;break;case"scroll":q=mre;break;case"wheel":q=Mre;break;case"copy":case"cut":case"paste":q=Tre;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=i3}var Y=(r&4)!==0,te=!Y&&n==="scroll",Z=Y?B!==null?B+"Capture":null:B;Y=[];for(var ee=R,re;ee!==null;){re=ee;var pe=re.stateNode;if(re.tag===5&&pe!==null&&(re=pe,Z!==null&&(pe=pv(ee,Z),pe!=null&&Y.push(yv(ee,pe,re)))),te)break;ee=ee.return}0<Y.length&&(B=new q(B,J,null,s,N),D.push({event:B,listeners:Y}))}}if(!(r&7)){e:{if(B=n==="mouseover"||n==="pointerover",q=n==="mouseout"||n==="pointerout",B&&s!==hO&&(J=s.relatedTarget||s.fromElement)&&(Vp(J)||J[_d]))break e;if((q||B)&&(B=N.window===N?N:(B=N.ownerDocument)?B.defaultView||B.parentWindow:window,q?(J=s.relatedTarget||s.toElement,q=R,J=J?Vp(J):null,J!==null&&(te=nf(J),J!==te||J.tag!==5&&J.tag!==6)&&(J=null)):(q=null,J=R),q!==J)){if(Y=e3,pe="onMouseLeave",Z="onMouseEnter",ee="mouse",(n==="pointerout"||n==="pointerover")&&(Y=i3,pe="onPointerLeave",Z="onPointerEnter",ee="pointer"),te=q==null?B:ng(q),re=J==null?B:ng(J),B=new Y(pe,ee+"leave",q,s,N),B.target=te,B.relatedTarget=re,pe=null,Vp(N)===R&&(Y=new Y(Z,ee+"enter",J,s,N),Y.target=re,Y.relatedTarget=te,pe=Y),te=pe,q&&J)t:{for(Y=q,Z=J,ee=0,re=Y;re;re=qm(re))ee++;for(re=0,pe=Z;pe;pe=qm(pe))re++;for(;0<ee-re;)Y=qm(Y),ee--;for(;0<re-ee;)Z=qm(Z),re--;for(;ee--;){if(Y===Z||Z!==null&&Y===Z.alternate)break t;Y=qm(Y),Z=qm(Z)}Y=null}else Y=null;q!==null&&p3(D,B,q,Y,!1),J!==null&&te!==null&&p3(D,te,J,Y,!0)}}e:{if(B=R?ng(R):window,q=B.nodeName&&B.nodeName.toLowerCase(),q==="select"||q==="input"&&B.type==="file")var ve=zre;else if(o3(B))if(Bz)ve=qre;else{ve=Gre;var Oe=Hre}else(q=B.nodeName)&&q.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(ve=Kre);if(ve&&(ve=ve(n,R))){Fz(D,ve,s,N);break e}Oe&&Oe(n,B,R),n==="focusout"&&(Oe=B._wrapperState)&&Oe.controlled&&B.type==="number"&&aO(B,"number",B.value)}switch(Oe=R?ng(R):window,n){case"focusin":(o3(Oe)||Oe.contentEditable==="true")&&(tg=Oe,vO=R,tv=null);break;case"focusout":tv=vO=tg=null;break;case"mousedown":yO=!0;break;case"contextmenu":case"mouseup":case"dragend":yO=!1,d3(D,s,N);break;case"selectionchange":if(Xre)break;case"keydown":case"keyup":d3(D,s,N)}var Se;if(MP)e:{switch(n){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else eg?jz(n,s)&&(je="onCompositionEnd"):n==="keydown"&&s.keyCode===229&&(je="onCompositionStart");je&&(Uz&&s.locale!=="ko"&&(eg||je!=="onCompositionStart"?je==="onCompositionEnd"&&eg&&(Se=Mz()):(Vu=N,DP="value"in Vu?Vu.value:Vu.textContent,eg=!0)),Oe=OT(R,je),0<Oe.length&&(je=new t3(je,n,null,s,N),D.push({event:je,listeners:Oe}),Se?je.data=Se:(Se=Vz(s),Se!==null&&(je.data=Se)))),(Se=jre?Vre(n,s):Fre(n,s))&&(R=OT(R,"onBeforeInput"),0<R.length&&(N=new t3("onBeforeInput","beforeinput",null,s,N),D.push({event:N,listeners:R}),N.data=Se))}Jz(D,r)})}function yv(n,r,s){return{instance:n,listener:r,currentTarget:s}}function OT(n,r){for(var s=r+"Capture",c=[];n!==null;){var d=n,p=d.stateNode;d.tag===5&&p!==null&&(d=p,p=pv(n,s),p!=null&&c.unshift(yv(n,p,d)),p=pv(n,r),p!=null&&c.push(yv(n,p,d))),n=n.return}return c}function qm(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function p3(n,r,s,c,d){for(var p=r._reactName,g=[];s!==null&&s!==c;){var y=s,T=y.alternate,R=y.stateNode;if(T!==null&&T===c)break;y.tag===5&&R!==null&&(y=R,d?(T=pv(s,p),T!=null&&g.unshift(yv(s,T,y))):d||(T=pv(s,p),T!=null&&g.push(yv(s,T,y)))),s=s.return}g.length!==0&&n.push({event:r,listeners:g})}var eoe=/\r\n?/g,toe=/\u0000|\uFFFD/g;function f3(n){return(typeof n=="string"?n:""+n).replace(eoe,`
`).replace(toe,"")}function AS(n,r,s){if(r=f3(r),f3(n)!==r&&s)throw Error($e(425))}function PT(){}var SO=null,TO=null;function wO(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var CO=typeof setTimeout=="function"?setTimeout:void 0,ioe=typeof clearTimeout=="function"?clearTimeout:void 0,m3=typeof Promise=="function"?Promise:void 0,noe=typeof queueMicrotask=="function"?queueMicrotask:typeof m3<"u"?function(n){return m3.resolve(null).then(n).catch(roe)}:CO;function roe(n){setTimeout(function(){throw n})}function CA(n,r){var s=r,c=0;do{var d=s.nextSibling;if(n.removeChild(s),d&&d.nodeType===8)if(s=d.data,s==="/$"){if(c===0){n.removeChild(d),gv(r);return}c--}else s!=="$"&&s!=="$?"&&s!=="$!"||c++;s=d}while(s);gv(r)}function Xu(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function g3(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var s=n.data;if(s==="$"||s==="$!"||s==="$?"){if(r===0)return n;r--}else s==="/$"&&r++}n=n.previousSibling}return null}var Fg=Math.random().toString(36).slice(2),El="__reactFiber$"+Fg,Sv="__reactProps$"+Fg,_d="__reactContainer$"+Fg,bO="__reactEvents$"+Fg,ooe="__reactListeners$"+Fg,soe="__reactHandles$"+Fg;function Vp(n){var r=n[El];if(r)return r;for(var s=n.parentNode;s;){if(r=s[_d]||s[El]){if(s=r.alternate,r.child!==null||s!==null&&s.child!==null)for(n=g3(n);n!==null;){if(s=n[El])return s;n=g3(n)}return r}n=s,s=n.parentNode}return null}function zv(n){return n=n[El]||n[_d],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function ng(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($e(33))}function fw(n){return n[Sv]||null}var RO=[],rg=-1;function lh(n){return{current:n}}function Mn(n){0>rg||(n.current=RO[rg],RO[rg]=null,rg--)}function In(n,r){rg++,RO[rg]=n.current,n.current=r}var sh={},No=lh(sh),ws=lh(!1),Yp=sh;function Sg(n,r){var s=n.type.contextTypes;if(!s)return sh;var c=n.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===r)return c.__reactInternalMemoizedMaskedChildContext;var d={},p;for(p in s)d[p]=r[p];return c&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=d),d}function Cs(n){return n=n.childContextTypes,n!=null}function NT(){Mn(ws),Mn(No)}function _3(n,r,s){if(No.current!==sh)throw Error($e(168));In(No,r),In(ws,s)}function Qz(n,r,s){var c=n.stateNode;if(r=r.childContextTypes,typeof c.getChildContext!="function")return s;c=c.getChildContext();for(var d in c)if(!(d in r))throw Error($e(108,Hne(n)||"Unknown",d));return Jn({},s,c)}function xT(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||sh,Yp=No.current,In(No,n),In(ws,ws.current),!0}function E3(n,r,s){var c=n.stateNode;if(!c)throw Error($e(169));s?(n=Qz(n,r,Yp),c.__reactInternalMemoizedMergedChildContext=n,Mn(ws),Mn(No),In(No,n)):Mn(ws),In(ws,s)}var ud=null,mw=!1,bA=!1;function eH(n){ud===null?ud=[n]:ud.push(n)}function aoe(n){mw=!0,eH(n)}function dh(){if(!bA&&ud!==null){bA=!0;var n=0,r=cn;try{var s=ud;for(cn=1;n<s.length;n++){var c=s[n];do c=c(!0);while(c!==null)}ud=null,mw=!1}catch(d){throw ud!==null&&(ud=ud.slice(n+1)),bz(OP,dh),d}finally{cn=r,bA=!1}}return null}var og=[],sg=0,DT=null,kT=0,Pa=[],Na=0,$p=null,pd=1,fd="";function Mp(n,r){og[sg++]=kT,og[sg++]=DT,DT=n,kT=r}function tH(n,r,s){Pa[Na++]=pd,Pa[Na++]=fd,Pa[Na++]=$p,$p=n;var c=pd;n=fd;var d=32-wc(c)-1;c&=~(1<<d),s+=1;var p=32-wc(r)+d;if(30<p){var g=d-d%5;p=(c&(1<<g)-1).toString(32),c>>=g,d-=g,pd=1<<32-wc(r)+d|s<<d|c,fd=p+n}else pd=1<<p|s<<d|c,fd=n}function jP(n){n.return!==null&&(Mp(n,1),tH(n,1,0))}function VP(n){for(;n===DT;)DT=og[--sg],og[sg]=null,kT=og[--sg],og[sg]=null;for(;n===$p;)$p=Pa[--Na],Pa[Na]=null,fd=Pa[--Na],Pa[Na]=null,pd=Pa[--Na],Pa[Na]=null}var Gs=null,zs=null,zn=!1,Sc=null;function iH(n,r){var s=xa(5,null,null,0);s.elementType="DELETED",s.stateNode=r,s.return=n,r=n.deletions,r===null?(n.deletions=[s],n.flags|=16):r.push(s)}function v3(n,r){switch(n.tag){case 5:var s=n.type;return r=r.nodeType!==1||s.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,Gs=n,zs=Xu(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,Gs=n,zs=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(s=$p!==null?{id:pd,overflow:fd}:null,n.memoizedState={dehydrated:r,treeContext:s,retryLane:1073741824},s=xa(18,null,null,0),s.stateNode=r,s.return=n,n.child=s,Gs=n,zs=null,!0):!1;default:return!1}}function IO(n){return(n.mode&1)!==0&&(n.flags&128)===0}function AO(n){if(zn){var r=zs;if(r){var s=r;if(!v3(n,r)){if(IO(n))throw Error($e(418));r=Xu(s.nextSibling);var c=Gs;r&&v3(n,r)?iH(c,s):(n.flags=n.flags&-4097|2,zn=!1,Gs=n)}}else{if(IO(n))throw Error($e(418));n.flags=n.flags&-4097|2,zn=!1,Gs=n}}}function y3(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Gs=n}function OS(n){if(n!==Gs)return!1;if(!zn)return y3(n),zn=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!wO(n.type,n.memoizedProps)),r&&(r=zs)){if(IO(n))throw nH(),Error($e(418));for(;r;)iH(n,r),r=Xu(r.nextSibling)}if(y3(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($e(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var s=n.data;if(s==="/$"){if(r===0){zs=Xu(n.nextSibling);break e}r--}else s!=="$"&&s!=="$!"&&s!=="$?"||r++}n=n.nextSibling}zs=null}}else zs=Gs?Xu(n.stateNode.nextSibling):null;return!0}function nH(){for(var n=zs;n;)n=Xu(n.nextSibling)}function Tg(){zs=Gs=null,zn=!1}function FP(n){Sc===null?Sc=[n]:Sc.push(n)}var coe=yd.ReactCurrentBatchConfig;function xE(n,r,s){if(n=s.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(s._owner){if(s=s._owner,s){if(s.tag!==1)throw Error($e(309));var c=s.stateNode}if(!c)throw Error($e(147,n));var d=c,p=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===p?r.ref:(r=function(g){var y=d.refs;g===null?delete y[p]:y[p]=g},r._stringRef=p,r)}if(typeof n!="string")throw Error($e(284));if(!s._owner)throw Error($e(290,n))}return n}function PS(n,r){throw n=Object.prototype.toString.call(r),Error($e(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function S3(n){var r=n._init;return r(n._payload)}function rH(n){function r(Z,ee){if(n){var re=Z.deletions;re===null?(Z.deletions=[ee],Z.flags|=16):re.push(ee)}}function s(Z,ee){if(!n)return null;for(;ee!==null;)r(Z,ee),ee=ee.sibling;return null}function c(Z,ee){for(Z=new Map;ee!==null;)ee.key!==null?Z.set(ee.key,ee):Z.set(ee.index,ee),ee=ee.sibling;return Z}function d(Z,ee){return Z=eh(Z,ee),Z.index=0,Z.sibling=null,Z}function p(Z,ee,re){return Z.index=re,n?(re=Z.alternate,re!==null?(re=re.index,re<ee?(Z.flags|=2,ee):re):(Z.flags|=2,ee)):(Z.flags|=1048576,ee)}function g(Z){return n&&Z.alternate===null&&(Z.flags|=2),Z}function y(Z,ee,re,pe){return ee===null||ee.tag!==6?(ee=xA(re,Z.mode,pe),ee.return=Z,ee):(ee=d(ee,re),ee.return=Z,ee)}function T(Z,ee,re,pe){var ve=re.type;return ve===Qm?N(Z,ee,re.props.children,pe,re.key):ee!==null&&(ee.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===Lu&&S3(ve)===ee.type)?(pe=d(ee,re.props),pe.ref=xE(Z,ee,re),pe.return=Z,pe):(pe=lT(re.type,re.key,re.props,null,Z.mode,pe),pe.ref=xE(Z,ee,re),pe.return=Z,pe)}function R(Z,ee,re,pe){return ee===null||ee.tag!==4||ee.stateNode.containerInfo!==re.containerInfo||ee.stateNode.implementation!==re.implementation?(ee=DA(re,Z.mode,pe),ee.return=Z,ee):(ee=d(ee,re.children||[]),ee.return=Z,ee)}function N(Z,ee,re,pe,ve){return ee===null||ee.tag!==7?(ee=Hp(re,Z.mode,pe,ve),ee.return=Z,ee):(ee=d(ee,re),ee.return=Z,ee)}function D(Z,ee,re){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ee=xA(""+ee,Z.mode,re),ee.return=Z,ee;if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case vS:return re=lT(ee.type,ee.key,ee.props,null,Z.mode,re),re.ref=xE(Z,null,ee),re.return=Z,re;case Zm:return ee=DA(ee,Z.mode,re),ee.return=Z,ee;case Lu:var pe=ee._init;return D(Z,pe(ee._payload),re)}if(WE(ee)||IE(ee))return ee=Hp(ee,Z.mode,re,null),ee.return=Z,ee;PS(Z,ee)}return null}function B(Z,ee,re,pe){var ve=ee!==null?ee.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return ve!==null?null:y(Z,ee,""+re,pe);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case vS:return re.key===ve?T(Z,ee,re,pe):null;case Zm:return re.key===ve?R(Z,ee,re,pe):null;case Lu:return ve=re._init,B(Z,ee,ve(re._payload),pe)}if(WE(re)||IE(re))return ve!==null?null:N(Z,ee,re,pe,null);PS(Z,re)}return null}function q(Z,ee,re,pe,ve){if(typeof pe=="string"&&pe!==""||typeof pe=="number")return Z=Z.get(re)||null,y(ee,Z,""+pe,ve);if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case vS:return Z=Z.get(pe.key===null?re:pe.key)||null,T(ee,Z,pe,ve);case Zm:return Z=Z.get(pe.key===null?re:pe.key)||null,R(ee,Z,pe,ve);case Lu:var Oe=pe._init;return q(Z,ee,re,Oe(pe._payload),ve)}if(WE(pe)||IE(pe))return Z=Z.get(re)||null,N(ee,Z,pe,ve,null);PS(ee,pe)}return null}function J(Z,ee,re,pe){for(var ve=null,Oe=null,Se=ee,je=ee=0,ot=null;Se!==null&&je<re.length;je++){Se.index>je?(ot=Se,Se=null):ot=Se.sibling;var Qe=B(Z,Se,re[je],pe);if(Qe===null){Se===null&&(Se=ot);break}n&&Se&&Qe.alternate===null&&r(Z,Se),ee=p(Qe,ee,je),Oe===null?ve=Qe:Oe.sibling=Qe,Oe=Qe,Se=ot}if(je===re.length)return s(Z,Se),zn&&Mp(Z,je),ve;if(Se===null){for(;je<re.length;je++)Se=D(Z,re[je],pe),Se!==null&&(ee=p(Se,ee,je),Oe===null?ve=Se:Oe.sibling=Se,Oe=Se);return zn&&Mp(Z,je),ve}for(Se=c(Z,Se);je<re.length;je++)ot=q(Se,Z,je,re[je],pe),ot!==null&&(n&&ot.alternate!==null&&Se.delete(ot.key===null?je:ot.key),ee=p(ot,ee,je),Oe===null?ve=ot:Oe.sibling=ot,Oe=ot);return n&&Se.forEach(function(st){return r(Z,st)}),zn&&Mp(Z,je),ve}function Y(Z,ee,re,pe){var ve=IE(re);if(typeof ve!="function")throw Error($e(150));if(re=ve.call(re),re==null)throw Error($e(151));for(var Oe=ve=null,Se=ee,je=ee=0,ot=null,Qe=re.next();Se!==null&&!Qe.done;je++,Qe=re.next()){Se.index>je?(ot=Se,Se=null):ot=Se.sibling;var st=B(Z,Se,Qe.value,pe);if(st===null){Se===null&&(Se=ot);break}n&&Se&&st.alternate===null&&r(Z,Se),ee=p(st,ee,je),Oe===null?ve=st:Oe.sibling=st,Oe=st,Se=ot}if(Qe.done)return s(Z,Se),zn&&Mp(Z,je),ve;if(Se===null){for(;!Qe.done;je++,Qe=re.next())Qe=D(Z,Qe.value,pe),Qe!==null&&(ee=p(Qe,ee,je),Oe===null?ve=Qe:Oe.sibling=Qe,Oe=Qe);return zn&&Mp(Z,je),ve}for(Se=c(Z,Se);!Qe.done;je++,Qe=re.next())Qe=q(Se,Z,je,Qe.value,pe),Qe!==null&&(n&&Qe.alternate!==null&&Se.delete(Qe.key===null?je:Qe.key),ee=p(Qe,ee,je),Oe===null?ve=Qe:Oe.sibling=Qe,Oe=Qe);return n&&Se.forEach(function(ut){return r(Z,ut)}),zn&&Mp(Z,je),ve}function te(Z,ee,re,pe){if(typeof re=="object"&&re!==null&&re.type===Qm&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case vS:e:{for(var ve=re.key,Oe=ee;Oe!==null;){if(Oe.key===ve){if(ve=re.type,ve===Qm){if(Oe.tag===7){s(Z,Oe.sibling),ee=d(Oe,re.props.children),ee.return=Z,Z=ee;break e}}else if(Oe.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===Lu&&S3(ve)===Oe.type){s(Z,Oe.sibling),ee=d(Oe,re.props),ee.ref=xE(Z,Oe,re),ee.return=Z,Z=ee;break e}s(Z,Oe);break}else r(Z,Oe);Oe=Oe.sibling}re.type===Qm?(ee=Hp(re.props.children,Z.mode,pe,re.key),ee.return=Z,Z=ee):(pe=lT(re.type,re.key,re.props,null,Z.mode,pe),pe.ref=xE(Z,ee,re),pe.return=Z,Z=pe)}return g(Z);case Zm:e:{for(Oe=re.key;ee!==null;){if(ee.key===Oe)if(ee.tag===4&&ee.stateNode.containerInfo===re.containerInfo&&ee.stateNode.implementation===re.implementation){s(Z,ee.sibling),ee=d(ee,re.children||[]),ee.return=Z,Z=ee;break e}else{s(Z,ee);break}else r(Z,ee);ee=ee.sibling}ee=DA(re,Z.mode,pe),ee.return=Z,Z=ee}return g(Z);case Lu:return Oe=re._init,te(Z,ee,Oe(re._payload),pe)}if(WE(re))return J(Z,ee,re,pe);if(IE(re))return Y(Z,ee,re,pe);PS(Z,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,ee!==null&&ee.tag===6?(s(Z,ee.sibling),ee=d(ee,re),ee.return=Z,Z=ee):(s(Z,ee),ee=xA(re,Z.mode,pe),ee.return=Z,Z=ee),g(Z)):s(Z,ee)}return te}var wg=rH(!0),oH=rH(!1),LT=lh(null),MT=null,ag=null,BP=null;function WP(){BP=ag=MT=null}function zP(n){var r=LT.current;Mn(LT),n._currentValue=r}function OO(n,r,s){for(;n!==null;){var c=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,c!==null&&(c.childLanes|=r)):c!==null&&(c.childLanes&r)!==r&&(c.childLanes|=r),n===s)break;n=n.return}}function _g(n,r){MT=n,BP=ag=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&r&&(Ts=!0),n.firstContext=null)}function ka(n){var r=n._currentValue;if(BP!==n)if(n={context:n,memoizedValue:r,next:null},ag===null){if(MT===null)throw Error($e(308));ag=n,MT.dependencies={lanes:0,firstContext:n}}else ag=ag.next=n;return r}var Fp=null;function HP(n){Fp===null?Fp=[n]:Fp.push(n)}function sH(n,r,s,c){var d=r.interleaved;return d===null?(s.next=s,HP(r)):(s.next=d.next,d.next=s),r.interleaved=s,Ed(n,c)}function Ed(n,r){n.lanes|=r;var s=n.alternate;for(s!==null&&(s.lanes|=r),s=n,n=n.return;n!==null;)n.childLanes|=r,s=n.alternate,s!==null&&(s.childLanes|=r),s=n,n=n.return;return s.tag===3?s.stateNode:null}var Mu=!1;function GP(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function aH(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function md(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function Ju(n,r,s){var c=n.updateQueue;if(c===null)return null;if(c=c.shared,Vi&2){var d=c.pending;return d===null?r.next=r:(r.next=d.next,d.next=r),c.pending=r,Ed(n,s)}return d=c.interleaved,d===null?(r.next=r,HP(c)):(r.next=d.next,d.next=r),c.interleaved=r,Ed(n,s)}function nT(n,r,s){if(r=r.updateQueue,r!==null&&(r=r.shared,(s&4194240)!==0)){var c=r.lanes;c&=n.pendingLanes,s|=c,r.lanes=s,PP(n,s)}}function T3(n,r){var s=n.updateQueue,c=n.alternate;if(c!==null&&(c=c.updateQueue,s===c)){var d=null,p=null;if(s=s.firstBaseUpdate,s!==null){do{var g={eventTime:s.eventTime,lane:s.lane,tag:s.tag,payload:s.payload,callback:s.callback,next:null};p===null?d=p=g:p=p.next=g,s=s.next}while(s!==null);p===null?d=p=r:p=p.next=r}else d=p=r;s={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:p,shared:c.shared,effects:c.effects},n.updateQueue=s;return}n=s.lastBaseUpdate,n===null?s.firstBaseUpdate=r:n.next=r,s.lastBaseUpdate=r}function UT(n,r,s,c){var d=n.updateQueue;Mu=!1;var p=d.firstBaseUpdate,g=d.lastBaseUpdate,y=d.shared.pending;if(y!==null){d.shared.pending=null;var T=y,R=T.next;T.next=null,g===null?p=R:g.next=R,g=T;var N=n.alternate;N!==null&&(N=N.updateQueue,y=N.lastBaseUpdate,y!==g&&(y===null?N.firstBaseUpdate=R:y.next=R,N.lastBaseUpdate=T))}if(p!==null){var D=d.baseState;g=0,N=R=T=null,y=p;do{var B=y.lane,q=y.eventTime;if((c&B)===B){N!==null&&(N=N.next={eventTime:q,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null});e:{var J=n,Y=y;switch(B=r,q=s,Y.tag){case 1:if(J=Y.payload,typeof J=="function"){D=J.call(q,D,B);break e}D=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=Y.payload,B=typeof J=="function"?J.call(q,D,B):J,B==null)break e;D=Jn({},D,B);break e;case 2:Mu=!0}}y.callback!==null&&y.lane!==0&&(n.flags|=64,B=d.effects,B===null?d.effects=[y]:B.push(y))}else q={eventTime:q,lane:B,tag:y.tag,payload:y.payload,callback:y.callback,next:null},N===null?(R=N=q,T=D):N=N.next=q,g|=B;if(y=y.next,y===null){if(y=d.shared.pending,y===null)break;B=y,y=B.next,B.next=null,d.lastBaseUpdate=B,d.shared.pending=null}}while(1);if(N===null&&(T=D),d.baseState=T,d.firstBaseUpdate=R,d.lastBaseUpdate=N,r=d.shared.interleaved,r!==null){d=r;do g|=d.lane,d=d.next;while(d!==r)}else p===null&&(d.shared.lanes=0);Jp|=g,n.lanes=g,n.memoizedState=D}}function w3(n,r,s){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var c=n[r],d=c.callback;if(d!==null){if(c.callback=null,c=s,typeof d!="function")throw Error($e(191,d));d.call(c)}}}var Hv={},yl=lh(Hv),Tv=lh(Hv),wv=lh(Hv);function Bp(n){if(n===Hv)throw Error($e(174));return n}function KP(n,r){switch(In(wv,r),In(Tv,n),In(yl,Hv),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:lO(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=lO(r,n)}Mn(yl),In(yl,r)}function Cg(){Mn(yl),Mn(Tv),Mn(wv)}function cH(n){Bp(wv.current);var r=Bp(yl.current),s=lO(r,n.type);r!==s&&(In(Tv,n),In(yl,s))}function qP(n){Tv.current===n&&(Mn(yl),Mn(Tv))}var qn=lh(0);function jT(n){for(var r=n;r!==null;){if(r.tag===13){var s=r.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||s.data==="$?"||s.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var RA=[];function YP(){for(var n=0;n<RA.length;n++)RA[n]._workInProgressVersionPrimary=null;RA.length=0}var rT=yd.ReactCurrentDispatcher,IA=yd.ReactCurrentBatchConfig,Xp=0,$n=null,Nr=null,zr=null,VT=!1,iv=!1,Cv=0,loe=0;function wo(){throw Error($e(321))}function $P(n,r){if(r===null)return!1;for(var s=0;s<r.length&&s<n.length;s++)if(!Rc(n[s],r[s]))return!1;return!0}function XP(n,r,s,c,d,p){if(Xp=p,$n=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,rT.current=n===null||n.memoizedState===null?poe:foe,n=s(c,d),iv){p=0;do{if(iv=!1,Cv=0,25<=p)throw Error($e(301));p+=1,zr=Nr=null,r.updateQueue=null,rT.current=moe,n=s(c,d)}while(iv)}if(rT.current=FT,r=Nr!==null&&Nr.next!==null,Xp=0,zr=Nr=$n=null,VT=!1,r)throw Error($e(300));return n}function JP(){var n=Cv!==0;return Cv=0,n}function fl(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zr===null?$n.memoizedState=zr=n:zr=zr.next=n,zr}function La(){if(Nr===null){var n=$n.alternate;n=n!==null?n.memoizedState:null}else n=Nr.next;var r=zr===null?$n.memoizedState:zr.next;if(r!==null)zr=r,Nr=n;else{if(n===null)throw Error($e(310));Nr=n,n={memoizedState:Nr.memoizedState,baseState:Nr.baseState,baseQueue:Nr.baseQueue,queue:Nr.queue,next:null},zr===null?$n.memoizedState=zr=n:zr=zr.next=n}return zr}function bv(n,r){return typeof r=="function"?r(n):r}function AA(n){var r=La(),s=r.queue;if(s===null)throw Error($e(311));s.lastRenderedReducer=n;var c=Nr,d=c.baseQueue,p=s.pending;if(p!==null){if(d!==null){var g=d.next;d.next=p.next,p.next=g}c.baseQueue=d=p,s.pending=null}if(d!==null){p=d.next,c=c.baseState;var y=g=null,T=null,R=p;do{var N=R.lane;if((Xp&N)===N)T!==null&&(T=T.next={lane:0,action:R.action,hasEagerState:R.hasEagerState,eagerState:R.eagerState,next:null}),c=R.hasEagerState?R.eagerState:n(c,R.action);else{var D={lane:N,action:R.action,hasEagerState:R.hasEagerState,eagerState:R.eagerState,next:null};T===null?(y=T=D,g=c):T=T.next=D,$n.lanes|=N,Jp|=N}R=R.next}while(R!==null&&R!==p);T===null?g=c:T.next=y,Rc(c,r.memoizedState)||(Ts=!0),r.memoizedState=c,r.baseState=g,r.baseQueue=T,s.lastRenderedState=c}if(n=s.interleaved,n!==null){d=n;do p=d.lane,$n.lanes|=p,Jp|=p,d=d.next;while(d!==n)}else d===null&&(s.lanes=0);return[r.memoizedState,s.dispatch]}function OA(n){var r=La(),s=r.queue;if(s===null)throw Error($e(311));s.lastRenderedReducer=n;var c=s.dispatch,d=s.pending,p=r.memoizedState;if(d!==null){s.pending=null;var g=d=d.next;do p=n(p,g.action),g=g.next;while(g!==d);Rc(p,r.memoizedState)||(Ts=!0),r.memoizedState=p,r.baseQueue===null&&(r.baseState=p),s.lastRenderedState=p}return[p,c]}function lH(){}function dH(n,r){var s=$n,c=La(),d=r(),p=!Rc(c.memoizedState,d);if(p&&(c.memoizedState=d,Ts=!0),c=c.queue,ZP(pH.bind(null,s,c,n),[n]),c.getSnapshot!==r||p||zr!==null&&zr.memoizedState.tag&1){if(s.flags|=2048,Rv(9,hH.bind(null,s,c,d,r),void 0,null),Kr===null)throw Error($e(349));Xp&30||uH(s,r,d)}return d}function uH(n,r,s){n.flags|=16384,n={getSnapshot:r,value:s},r=$n.updateQueue,r===null?(r={lastEffect:null,stores:null},$n.updateQueue=r,r.stores=[n]):(s=r.stores,s===null?r.stores=[n]:s.push(n))}function hH(n,r,s,c){r.value=s,r.getSnapshot=c,fH(r)&&mH(n)}function pH(n,r,s){return s(function(){fH(r)&&mH(n)})}function fH(n){var r=n.getSnapshot;n=n.value;try{var s=r();return!Rc(n,s)}catch{return!0}}function mH(n){var r=Ed(n,1);r!==null&&Cc(r,n,1,-1)}function C3(n){var r=fl();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bv,lastRenderedState:n},r.queue=n,n=n.dispatch=hoe.bind(null,$n,n),[r.memoizedState,n]}function Rv(n,r,s,c){return n={tag:n,create:r,destroy:s,deps:c,next:null},r=$n.updateQueue,r===null?(r={lastEffect:null,stores:null},$n.updateQueue=r,r.lastEffect=n.next=n):(s=r.lastEffect,s===null?r.lastEffect=n.next=n:(c=s.next,s.next=n,n.next=c,r.lastEffect=n)),n}function gH(){return La().memoizedState}function oT(n,r,s,c){var d=fl();$n.flags|=n,d.memoizedState=Rv(1|r,s,void 0,c===void 0?null:c)}function gw(n,r,s,c){var d=La();c=c===void 0?null:c;var p=void 0;if(Nr!==null){var g=Nr.memoizedState;if(p=g.destroy,c!==null&&$P(c,g.deps)){d.memoizedState=Rv(r,s,p,c);return}}$n.flags|=n,d.memoizedState=Rv(1|r,s,p,c)}function b3(n,r){return oT(8390656,8,n,r)}function ZP(n,r){return gw(2048,8,n,r)}function _H(n,r){return gw(4,2,n,r)}function EH(n,r){return gw(4,4,n,r)}function vH(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function yH(n,r,s){return s=s!=null?s.concat([n]):null,gw(4,4,vH.bind(null,r,n),s)}function QP(){}function SH(n,r){var s=La();r=r===void 0?null:r;var c=s.memoizedState;return c!==null&&r!==null&&$P(r,c[1])?c[0]:(s.memoizedState=[n,r],n)}function TH(n,r){var s=La();r=r===void 0?null:r;var c=s.memoizedState;return c!==null&&r!==null&&$P(r,c[1])?c[0]:(n=n(),s.memoizedState=[n,r],n)}function wH(n,r,s){return Xp&21?(Rc(s,r)||(s=Az(),$n.lanes|=s,Jp|=s,n.baseState=!0),r):(n.baseState&&(n.baseState=!1,Ts=!0),n.memoizedState=s)}function doe(n,r){var s=cn;cn=s!==0&&4>s?s:4,n(!0);var c=IA.transition;IA.transition={};try{n(!1),r()}finally{cn=s,IA.transition=c}}function CH(){return La().memoizedState}function uoe(n,r,s){var c=Qu(n);if(s={lane:c,action:s,hasEagerState:!1,eagerState:null,next:null},bH(n))RH(r,s);else if(s=sH(n,r,s,c),s!==null){var d=Go();Cc(s,n,c,d),IH(s,r,c)}}function hoe(n,r,s){var c=Qu(n),d={lane:c,action:s,hasEagerState:!1,eagerState:null,next:null};if(bH(n))RH(r,d);else{var p=n.alternate;if(n.lanes===0&&(p===null||p.lanes===0)&&(p=r.lastRenderedReducer,p!==null))try{var g=r.lastRenderedState,y=p(g,s);if(d.hasEagerState=!0,d.eagerState=y,Rc(y,g)){var T=r.interleaved;T===null?(d.next=d,HP(r)):(d.next=T.next,T.next=d),r.interleaved=d;return}}catch{}finally{}s=sH(n,r,d,c),s!==null&&(d=Go(),Cc(s,n,c,d),IH(s,r,c))}}function bH(n){var r=n.alternate;return n===$n||r!==null&&r===$n}function RH(n,r){iv=VT=!0;var s=n.pending;s===null?r.next=r:(r.next=s.next,s.next=r),n.pending=r}function IH(n,r,s){if(s&4194240){var c=r.lanes;c&=n.pendingLanes,s|=c,r.lanes=s,PP(n,s)}}var FT={readContext:ka,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},poe={readContext:ka,useCallback:function(n,r){return fl().memoizedState=[n,r===void 0?null:r],n},useContext:ka,useEffect:b3,useImperativeHandle:function(n,r,s){return s=s!=null?s.concat([n]):null,oT(4194308,4,vH.bind(null,r,n),s)},useLayoutEffect:function(n,r){return oT(4194308,4,n,r)},useInsertionEffect:function(n,r){return oT(4,2,n,r)},useMemo:function(n,r){var s=fl();return r=r===void 0?null:r,n=n(),s.memoizedState=[n,r],n},useReducer:function(n,r,s){var c=fl();return r=s!==void 0?s(r):r,c.memoizedState=c.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},c.queue=n,n=n.dispatch=uoe.bind(null,$n,n),[c.memoizedState,n]},useRef:function(n){var r=fl();return n={current:n},r.memoizedState=n},useState:C3,useDebugValue:QP,useDeferredValue:function(n){return fl().memoizedState=n},useTransition:function(){var n=C3(!1),r=n[0];return n=doe.bind(null,n[1]),fl().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,s){var c=$n,d=fl();if(zn){if(s===void 0)throw Error($e(407));s=s()}else{if(s=r(),Kr===null)throw Error($e(349));Xp&30||uH(c,r,s)}d.memoizedState=s;var p={value:s,getSnapshot:r};return d.queue=p,b3(pH.bind(null,c,p,n),[n]),c.flags|=2048,Rv(9,hH.bind(null,c,p,s,r),void 0,null),s},useId:function(){var n=fl(),r=Kr.identifierPrefix;if(zn){var s=fd,c=pd;s=(c&~(1<<32-wc(c)-1)).toString(32)+s,r=":"+r+"R"+s,s=Cv++,0<s&&(r+="H"+s.toString(32)),r+=":"}else s=loe++,r=":"+r+"r"+s.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},foe={readContext:ka,useCallback:SH,useContext:ka,useEffect:ZP,useImperativeHandle:yH,useInsertionEffect:_H,useLayoutEffect:EH,useMemo:TH,useReducer:AA,useRef:gH,useState:function(){return AA(bv)},useDebugValue:QP,useDeferredValue:function(n){var r=La();return wH(r,Nr.memoizedState,n)},useTransition:function(){var n=AA(bv)[0],r=La().memoizedState;return[n,r]},useMutableSource:lH,useSyncExternalStore:dH,useId:CH,unstable_isNewReconciler:!1},moe={readContext:ka,useCallback:SH,useContext:ka,useEffect:ZP,useImperativeHandle:yH,useInsertionEffect:_H,useLayoutEffect:EH,useMemo:TH,useReducer:OA,useRef:gH,useState:function(){return OA(bv)},useDebugValue:QP,useDeferredValue:function(n){var r=La();return Nr===null?r.memoizedState=n:wH(r,Nr.memoizedState,n)},useTransition:function(){var n=OA(bv)[0],r=La().memoizedState;return[n,r]},useMutableSource:lH,useSyncExternalStore:dH,useId:CH,unstable_isNewReconciler:!1};function vc(n,r){if(n&&n.defaultProps){r=Jn({},r),n=n.defaultProps;for(var s in n)r[s]===void 0&&(r[s]=n[s]);return r}return r}function PO(n,r,s,c){r=n.memoizedState,s=s(c,r),s=s==null?r:Jn({},r,s),n.memoizedState=s,n.lanes===0&&(n.updateQueue.baseState=s)}var _w={isMounted:function(n){return(n=n._reactInternals)?nf(n)===n:!1},enqueueSetState:function(n,r,s){n=n._reactInternals;var c=Go(),d=Qu(n),p=md(c,d);p.payload=r,s!=null&&(p.callback=s),r=Ju(n,p,d),r!==null&&(Cc(r,n,d,c),nT(r,n,d))},enqueueReplaceState:function(n,r,s){n=n._reactInternals;var c=Go(),d=Qu(n),p=md(c,d);p.tag=1,p.payload=r,s!=null&&(p.callback=s),r=Ju(n,p,d),r!==null&&(Cc(r,n,d,c),nT(r,n,d))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var s=Go(),c=Qu(n),d=md(s,c);d.tag=2,r!=null&&(d.callback=r),r=Ju(n,d,c),r!==null&&(Cc(r,n,c,s),nT(r,n,c))}};function R3(n,r,s,c,d,p,g){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(c,p,g):r.prototype&&r.prototype.isPureReactComponent?!Ev(s,c)||!Ev(d,p):!0}function AH(n,r,s){var c=!1,d=sh,p=r.contextType;return typeof p=="object"&&p!==null?p=ka(p):(d=Cs(r)?Yp:No.current,c=r.contextTypes,p=(c=c!=null)?Sg(n,d):sh),r=new r(s,p),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=_w,n.stateNode=r,r._reactInternals=n,c&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=d,n.__reactInternalMemoizedMaskedChildContext=p),r}function I3(n,r,s,c){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(s,c),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(s,c),r.state!==n&&_w.enqueueReplaceState(r,r.state,null)}function NO(n,r,s,c){var d=n.stateNode;d.props=s,d.state=n.memoizedState,d.refs={},GP(n);var p=r.contextType;typeof p=="object"&&p!==null?d.context=ka(p):(p=Cs(r)?Yp:No.current,d.context=Sg(n,p)),d.state=n.memoizedState,p=r.getDerivedStateFromProps,typeof p=="function"&&(PO(n,r,p,s),d.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(r=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),r!==d.state&&_w.enqueueReplaceState(d,d.state,null),UT(n,s,d,c),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308)}function bg(n,r){try{var s="",c=r;do s+=zne(c),c=c.return;while(c);var d=s}catch(p){d=`
Error generating stack: `+p.message+`
`+p.stack}return{value:n,source:r,stack:d,digest:null}}function PA(n,r,s){return{value:n,source:null,stack:s??null,digest:r??null}}function xO(n,r){try{console.error(r.value)}catch(s){setTimeout(function(){throw s})}}var goe=typeof WeakMap=="function"?WeakMap:Map;function OH(n,r,s){s=md(-1,s),s.tag=3,s.payload={element:null};var c=r.value;return s.callback=function(){WT||(WT=!0,WO=c),xO(n,r)},s}function PH(n,r,s){s=md(-1,s),s.tag=3;var c=n.type.getDerivedStateFromError;if(typeof c=="function"){var d=r.value;s.payload=function(){return c(d)},s.callback=function(){xO(n,r)}}var p=n.stateNode;return p!==null&&typeof p.componentDidCatch=="function"&&(s.callback=function(){xO(n,r),typeof c!="function"&&(Zu===null?Zu=new Set([this]):Zu.add(this));var g=r.stack;this.componentDidCatch(r.value,{componentStack:g!==null?g:""})}),s}function A3(n,r,s){var c=n.pingCache;if(c===null){c=n.pingCache=new goe;var d=new Set;c.set(r,d)}else d=c.get(r),d===void 0&&(d=new Set,c.set(r,d));d.has(s)||(d.add(s),n=Poe.bind(null,n,r,s),r.then(n,n))}function O3(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function P3(n,r,s,c,d){return n.mode&1?(n.flags|=65536,n.lanes=d,n):(n===r?n.flags|=65536:(n.flags|=128,s.flags|=131072,s.flags&=-52805,s.tag===1&&(s.alternate===null?s.tag=17:(r=md(-1,1),r.tag=2,Ju(s,r,1))),s.lanes|=1),n)}var _oe=yd.ReactCurrentOwner,Ts=!1;function Ho(n,r,s,c){r.child=n===null?oH(r,null,s,c):wg(r,n.child,s,c)}function N3(n,r,s,c,d){s=s.render;var p=r.ref;return _g(r,d),c=XP(n,r,s,c,p,d),s=JP(),n!==null&&!Ts?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~d,vd(n,r,d)):(zn&&s&&jP(r),r.flags|=1,Ho(n,r,c,d),r.child)}function x3(n,r,s,c,d){if(n===null){var p=s.type;return typeof p=="function"&&!aN(p)&&p.defaultProps===void 0&&s.compare===null&&s.defaultProps===void 0?(r.tag=15,r.type=p,NH(n,r,p,c,d)):(n=lT(s.type,null,c,r,r.mode,d),n.ref=r.ref,n.return=r,r.child=n)}if(p=n.child,!(n.lanes&d)){var g=p.memoizedProps;if(s=s.compare,s=s!==null?s:Ev,s(g,c)&&n.ref===r.ref)return vd(n,r,d)}return r.flags|=1,n=eh(p,c),n.ref=r.ref,n.return=r,r.child=n}function NH(n,r,s,c,d){if(n!==null){var p=n.memoizedProps;if(Ev(p,c)&&n.ref===r.ref)if(Ts=!1,r.pendingProps=c=p,(n.lanes&d)!==0)n.flags&131072&&(Ts=!0);else return r.lanes=n.lanes,vd(n,r,d)}return DO(n,r,s,c,d)}function xH(n,r,s){var c=r.pendingProps,d=c.children,p=n!==null?n.memoizedState:null;if(c.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},In(lg,Ws),Ws|=s;else{if(!(s&1073741824))return n=p!==null?p.baseLanes|s:s,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,In(lg,Ws),Ws|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=p!==null?p.baseLanes:s,In(lg,Ws),Ws|=c}else p!==null?(c=p.baseLanes|s,r.memoizedState=null):c=s,In(lg,Ws),Ws|=c;return Ho(n,r,d,s),r.child}function DH(n,r){var s=r.ref;(n===null&&s!==null||n!==null&&n.ref!==s)&&(r.flags|=512,r.flags|=2097152)}function DO(n,r,s,c,d){var p=Cs(s)?Yp:No.current;return p=Sg(r,p),_g(r,d),s=XP(n,r,s,c,p,d),c=JP(),n!==null&&!Ts?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~d,vd(n,r,d)):(zn&&c&&jP(r),r.flags|=1,Ho(n,r,s,d),r.child)}function D3(n,r,s,c,d){if(Cs(s)){var p=!0;xT(r)}else p=!1;if(_g(r,d),r.stateNode===null)sT(n,r),AH(r,s,c),NO(r,s,c,d),c=!0;else if(n===null){var g=r.stateNode,y=r.memoizedProps;g.props=y;var T=g.context,R=s.contextType;typeof R=="object"&&R!==null?R=ka(R):(R=Cs(s)?Yp:No.current,R=Sg(r,R));var N=s.getDerivedStateFromProps,D=typeof N=="function"||typeof g.getSnapshotBeforeUpdate=="function";D||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(y!==c||T!==R)&&I3(r,g,c,R),Mu=!1;var B=r.memoizedState;g.state=B,UT(r,c,g,d),T=r.memoizedState,y!==c||B!==T||ws.current||Mu?(typeof N=="function"&&(PO(r,s,N,c),T=r.memoizedState),(y=Mu||R3(r,s,y,c,B,T,R))?(D||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(r.flags|=4194308)):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=c,r.memoizedState=T),g.props=c,g.state=T,g.context=R,c=y):(typeof g.componentDidMount=="function"&&(r.flags|=4194308),c=!1)}else{g=r.stateNode,aH(n,r),y=r.memoizedProps,R=r.type===r.elementType?y:vc(r.type,y),g.props=R,D=r.pendingProps,B=g.context,T=s.contextType,typeof T=="object"&&T!==null?T=ka(T):(T=Cs(s)?Yp:No.current,T=Sg(r,T));var q=s.getDerivedStateFromProps;(N=typeof q=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(y!==D||B!==T)&&I3(r,g,c,T),Mu=!1,B=r.memoizedState,g.state=B,UT(r,c,g,d);var J=r.memoizedState;y!==D||B!==J||ws.current||Mu?(typeof q=="function"&&(PO(r,s,q,c),J=r.memoizedState),(R=Mu||R3(r,s,R,c,B,J,T)||!1)?(N||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(c,J,T),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(c,J,T)),typeof g.componentDidUpdate=="function"&&(r.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof g.componentDidUpdate!="function"||y===n.memoizedProps&&B===n.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||y===n.memoizedProps&&B===n.memoizedState||(r.flags|=1024),r.memoizedProps=c,r.memoizedState=J),g.props=c,g.state=J,g.context=T,c=R):(typeof g.componentDidUpdate!="function"||y===n.memoizedProps&&B===n.memoizedState||(r.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||y===n.memoizedProps&&B===n.memoizedState||(r.flags|=1024),c=!1)}return kO(n,r,s,c,p,d)}function kO(n,r,s,c,d,p){DH(n,r);var g=(r.flags&128)!==0;if(!c&&!g)return d&&E3(r,s,!1),vd(n,r,p);c=r.stateNode,_oe.current=r;var y=g&&typeof s.getDerivedStateFromError!="function"?null:c.render();return r.flags|=1,n!==null&&g?(r.child=wg(r,n.child,null,p),r.child=wg(r,null,y,p)):Ho(n,r,y,p),r.memoizedState=c.state,d&&E3(r,s,!0),r.child}function kH(n){var r=n.stateNode;r.pendingContext?_3(n,r.pendingContext,r.pendingContext!==r.context):r.context&&_3(n,r.context,!1),KP(n,r.containerInfo)}function k3(n,r,s,c,d){return Tg(),FP(d),r.flags|=256,Ho(n,r,s,c),r.child}var LO={dehydrated:null,treeContext:null,retryLane:0};function MO(n){return{baseLanes:n,cachePool:null,transitions:null}}function LH(n,r,s){var c=r.pendingProps,d=qn.current,p=!1,g=(r.flags&128)!==0,y;if((y=g)||(y=n!==null&&n.memoizedState===null?!1:(d&2)!==0),y?(p=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(d|=1),In(qn,d&1),n===null)return AO(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(r.mode&1?n.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(g=c.children,n=c.fallback,p?(c=r.mode,p=r.child,g={mode:"hidden",children:g},!(c&1)&&p!==null?(p.childLanes=0,p.pendingProps=g):p=yw(g,c,0,null),n=Hp(n,c,s,null),p.return=r,n.return=r,p.sibling=n,r.child=p,r.child.memoizedState=MO(s),r.memoizedState=LO,n):eN(r,g));if(d=n.memoizedState,d!==null&&(y=d.dehydrated,y!==null))return Eoe(n,r,g,c,y,d,s);if(p){p=c.fallback,g=r.mode,d=n.child,y=d.sibling;var T={mode:"hidden",children:c.children};return!(g&1)&&r.child!==d?(c=r.child,c.childLanes=0,c.pendingProps=T,r.deletions=null):(c=eh(d,T),c.subtreeFlags=d.subtreeFlags&14680064),y!==null?p=eh(y,p):(p=Hp(p,g,s,null),p.flags|=2),p.return=r,c.return=r,c.sibling=p,r.child=c,c=p,p=r.child,g=n.child.memoizedState,g=g===null?MO(s):{baseLanes:g.baseLanes|s,cachePool:null,transitions:g.transitions},p.memoizedState=g,p.childLanes=n.childLanes&~s,r.memoizedState=LO,c}return p=n.child,n=p.sibling,c=eh(p,{mode:"visible",children:c.children}),!(r.mode&1)&&(c.lanes=s),c.return=r,c.sibling=null,n!==null&&(s=r.deletions,s===null?(r.deletions=[n],r.flags|=16):s.push(n)),r.child=c,r.memoizedState=null,c}function eN(n,r){return r=yw({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function NS(n,r,s,c){return c!==null&&FP(c),wg(r,n.child,null,s),n=eN(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function Eoe(n,r,s,c,d,p,g){if(s)return r.flags&256?(r.flags&=-257,c=PA(Error($e(422))),NS(n,r,g,c)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(p=c.fallback,d=r.mode,c=yw({mode:"visible",children:c.children},d,0,null),p=Hp(p,d,g,null),p.flags|=2,c.return=r,p.return=r,c.sibling=p,r.child=c,r.mode&1&&wg(r,n.child,null,g),r.child.memoizedState=MO(g),r.memoizedState=LO,p);if(!(r.mode&1))return NS(n,r,g,null);if(d.data==="$!"){if(c=d.nextSibling&&d.nextSibling.dataset,c)var y=c.dgst;return c=y,p=Error($e(419)),c=PA(p,c,void 0),NS(n,r,g,c)}if(y=(g&n.childLanes)!==0,Ts||y){if(c=Kr,c!==null){switch(g&-g){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(c.suspendedLanes|g)?0:d,d!==0&&d!==p.retryLane&&(p.retryLane=d,Ed(n,d),Cc(c,n,d,-1))}return sN(),c=PA(Error($e(421))),NS(n,r,g,c)}return d.data==="$?"?(r.flags|=128,r.child=n.child,r=Noe.bind(null,n),d._reactRetry=r,null):(n=p.treeContext,zs=Xu(d.nextSibling),Gs=r,zn=!0,Sc=null,n!==null&&(Pa[Na++]=pd,Pa[Na++]=fd,Pa[Na++]=$p,pd=n.id,fd=n.overflow,$p=r),r=eN(r,c.children),r.flags|=4096,r)}function L3(n,r,s){n.lanes|=r;var c=n.alternate;c!==null&&(c.lanes|=r),OO(n.return,r,s)}function NA(n,r,s,c,d){var p=n.memoizedState;p===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:c,tail:s,tailMode:d}:(p.isBackwards=r,p.rendering=null,p.renderingStartTime=0,p.last=c,p.tail=s,p.tailMode=d)}function MH(n,r,s){var c=r.pendingProps,d=c.revealOrder,p=c.tail;if(Ho(n,r,c.children,s),c=qn.current,c&2)c=c&1|2,r.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&L3(n,s,r);else if(n.tag===19)L3(n,s,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}c&=1}if(In(qn,c),!(r.mode&1))r.memoizedState=null;else switch(d){case"forwards":for(s=r.child,d=null;s!==null;)n=s.alternate,n!==null&&jT(n)===null&&(d=s),s=s.sibling;s=d,s===null?(d=r.child,r.child=null):(d=s.sibling,s.sibling=null),NA(r,!1,d,s,p);break;case"backwards":for(s=null,d=r.child,r.child=null;d!==null;){if(n=d.alternate,n!==null&&jT(n)===null){r.child=d;break}n=d.sibling,d.sibling=s,s=d,d=n}NA(r,!0,s,null,p);break;case"together":NA(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function sT(n,r){!(r.mode&1)&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function vd(n,r,s){if(n!==null&&(r.dependencies=n.dependencies),Jp|=r.lanes,!(s&r.childLanes))return null;if(n!==null&&r.child!==n.child)throw Error($e(153));if(r.child!==null){for(n=r.child,s=eh(n,n.pendingProps),r.child=s,s.return=r;n.sibling!==null;)n=n.sibling,s=s.sibling=eh(n,n.pendingProps),s.return=r;s.sibling=null}return r.child}function voe(n,r,s){switch(r.tag){case 3:kH(r),Tg();break;case 5:cH(r);break;case 1:Cs(r.type)&&xT(r);break;case 4:KP(r,r.stateNode.containerInfo);break;case 10:var c=r.type._context,d=r.memoizedProps.value;In(LT,c._currentValue),c._currentValue=d;break;case 13:if(c=r.memoizedState,c!==null)return c.dehydrated!==null?(In(qn,qn.current&1),r.flags|=128,null):s&r.child.childLanes?LH(n,r,s):(In(qn,qn.current&1),n=vd(n,r,s),n!==null?n.sibling:null);In(qn,qn.current&1);break;case 19:if(c=(s&r.childLanes)!==0,n.flags&128){if(c)return MH(n,r,s);r.flags|=128}if(d=r.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),In(qn,qn.current),c)break;return null;case 22:case 23:return r.lanes=0,xH(n,r,s)}return vd(n,r,s)}var UH,UO,jH,VH;UH=function(n,r){for(var s=r.child;s!==null;){if(s.tag===5||s.tag===6)n.appendChild(s.stateNode);else if(s.tag!==4&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return;s=s.return}s.sibling.return=s.return,s=s.sibling}};UO=function(){};jH=function(n,r,s,c){var d=n.memoizedProps;if(d!==c){n=r.stateNode,Bp(yl.current);var p=null;switch(s){case"input":d=oO(n,d),c=oO(n,c),p=[];break;case"select":d=Jn({},d,{value:void 0}),c=Jn({},c,{value:void 0}),p=[];break;case"textarea":d=cO(n,d),c=cO(n,c),p=[];break;default:typeof d.onClick!="function"&&typeof c.onClick=="function"&&(n.onclick=PT)}dO(s,c);var g;s=null;for(R in d)if(!c.hasOwnProperty(R)&&d.hasOwnProperty(R)&&d[R]!=null)if(R==="style"){var y=d[R];for(g in y)y.hasOwnProperty(g)&&(s||(s={}),s[g]="")}else R!=="dangerouslySetInnerHTML"&&R!=="children"&&R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&R!=="autoFocus"&&(uv.hasOwnProperty(R)?p||(p=[]):(p=p||[]).push(R,null));for(R in c){var T=c[R];if(y=d!=null?d[R]:void 0,c.hasOwnProperty(R)&&T!==y&&(T!=null||y!=null))if(R==="style")if(y){for(g in y)!y.hasOwnProperty(g)||T&&T.hasOwnProperty(g)||(s||(s={}),s[g]="");for(g in T)T.hasOwnProperty(g)&&y[g]!==T[g]&&(s||(s={}),s[g]=T[g])}else s||(p||(p=[]),p.push(R,s)),s=T;else R==="dangerouslySetInnerHTML"?(T=T?T.__html:void 0,y=y?y.__html:void 0,T!=null&&y!==T&&(p=p||[]).push(R,T)):R==="children"?typeof T!="string"&&typeof T!="number"||(p=p||[]).push(R,""+T):R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&(uv.hasOwnProperty(R)?(T!=null&&R==="onScroll"&&kn("scroll",n),p||y===T||(p=[])):(p=p||[]).push(R,T))}s&&(p=p||[]).push("style",s);var R=p;(r.updateQueue=R)&&(r.flags|=4)}};VH=function(n,r,s,c){s!==c&&(r.flags|=4)};function DE(n,r){if(!zn)switch(n.tailMode){case"hidden":r=n.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?n.tail=null:s.sibling=null;break;case"collapsed":s=n.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:c.sibling=null}}function Co(n){var r=n.alternate!==null&&n.alternate.child===n.child,s=0,c=0;if(r)for(var d=n.child;d!==null;)s|=d.lanes|d.childLanes,c|=d.subtreeFlags&14680064,c|=d.flags&14680064,d.return=n,d=d.sibling;else for(d=n.child;d!==null;)s|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=n,d=d.sibling;return n.subtreeFlags|=c,n.childLanes=s,r}function yoe(n,r,s){var c=r.pendingProps;switch(VP(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Co(r),null;case 1:return Cs(r.type)&&NT(),Co(r),null;case 3:return c=r.stateNode,Cg(),Mn(ws),Mn(No),YP(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(n===null||n.child===null)&&(OS(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Sc!==null&&(GO(Sc),Sc=null))),UO(n,r),Co(r),null;case 5:qP(r);var d=Bp(wv.current);if(s=r.type,n!==null&&r.stateNode!=null)jH(n,r,s,c,d),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!c){if(r.stateNode===null)throw Error($e(166));return Co(r),null}if(n=Bp(yl.current),OS(r)){c=r.stateNode,s=r.type;var p=r.memoizedProps;switch(c[El]=r,c[Sv]=p,n=(r.mode&1)!==0,s){case"dialog":kn("cancel",c),kn("close",c);break;case"iframe":case"object":case"embed":kn("load",c);break;case"video":case"audio":for(d=0;d<HE.length;d++)kn(HE[d],c);break;case"source":kn("error",c);break;case"img":case"image":case"link":kn("error",c),kn("load",c);break;case"details":kn("toggle",c);break;case"input":H5(c,p),kn("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!p.multiple},kn("invalid",c);break;case"textarea":K5(c,p),kn("invalid",c)}dO(s,p),d=null;for(var g in p)if(p.hasOwnProperty(g)){var y=p[g];g==="children"?typeof y=="string"?c.textContent!==y&&(p.suppressHydrationWarning!==!0&&AS(c.textContent,y,n),d=["children",y]):typeof y=="number"&&c.textContent!==""+y&&(p.suppressHydrationWarning!==!0&&AS(c.textContent,y,n),d=["children",""+y]):uv.hasOwnProperty(g)&&y!=null&&g==="onScroll"&&kn("scroll",c)}switch(s){case"input":yS(c),G5(c,p,!0);break;case"textarea":yS(c),q5(c);break;case"select":case"option":break;default:typeof p.onClick=="function"&&(c.onclick=PT)}c=d,r.updateQueue=c,c!==null&&(r.flags|=4)}else{g=d.nodeType===9?d:d.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=pz(s)),n==="http://www.w3.org/1999/xhtml"?s==="script"?(n=g.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof c.is=="string"?n=g.createElement(s,{is:c.is}):(n=g.createElement(s),s==="select"&&(g=n,c.multiple?g.multiple=!0:c.size&&(g.size=c.size))):n=g.createElementNS(n,s),n[El]=r,n[Sv]=c,UH(n,r,!1,!1),r.stateNode=n;e:{switch(g=uO(s,c),s){case"dialog":kn("cancel",n),kn("close",n),d=c;break;case"iframe":case"object":case"embed":kn("load",n),d=c;break;case"video":case"audio":for(d=0;d<HE.length;d++)kn(HE[d],n);d=c;break;case"source":kn("error",n),d=c;break;case"img":case"image":case"link":kn("error",n),kn("load",n),d=c;break;case"details":kn("toggle",n),d=c;break;case"input":H5(n,c),d=oO(n,c),kn("invalid",n);break;case"option":d=c;break;case"select":n._wrapperState={wasMultiple:!!c.multiple},d=Jn({},c,{value:void 0}),kn("invalid",n);break;case"textarea":K5(n,c),d=cO(n,c),kn("invalid",n);break;default:d=c}dO(s,d),y=d;for(p in y)if(y.hasOwnProperty(p)){var T=y[p];p==="style"?gz(n,T):p==="dangerouslySetInnerHTML"?(T=T?T.__html:void 0,T!=null&&fz(n,T)):p==="children"?typeof T=="string"?(s!=="textarea"||T!=="")&&hv(n,T):typeof T=="number"&&hv(n,""+T):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(uv.hasOwnProperty(p)?T!=null&&p==="onScroll"&&kn("scroll",n):T!=null&&CP(n,p,T,g))}switch(s){case"input":yS(n),G5(n,c,!1);break;case"textarea":yS(n),q5(n);break;case"option":c.value!=null&&n.setAttribute("value",""+oh(c.value));break;case"select":n.multiple=!!c.multiple,p=c.value,p!=null?pg(n,!!c.multiple,p,!1):c.defaultValue!=null&&pg(n,!!c.multiple,c.defaultValue,!0);break;default:typeof d.onClick=="function"&&(n.onclick=PT)}switch(s){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Co(r),null;case 6:if(n&&r.stateNode!=null)VH(n,r,n.memoizedProps,c);else{if(typeof c!="string"&&r.stateNode===null)throw Error($e(166));if(s=Bp(wv.current),Bp(yl.current),OS(r)){if(c=r.stateNode,s=r.memoizedProps,c[El]=r,(p=c.nodeValue!==s)&&(n=Gs,n!==null))switch(n.tag){case 3:AS(c.nodeValue,s,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&AS(c.nodeValue,s,(n.mode&1)!==0)}p&&(r.flags|=4)}else c=(s.nodeType===9?s:s.ownerDocument).createTextNode(c),c[El]=r,r.stateNode=c}return Co(r),null;case 13:if(Mn(qn),c=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(zn&&zs!==null&&r.mode&1&&!(r.flags&128))nH(),Tg(),r.flags|=98560,p=!1;else if(p=OS(r),c!==null&&c.dehydrated!==null){if(n===null){if(!p)throw Error($e(318));if(p=r.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error($e(317));p[El]=r}else Tg(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Co(r),p=!1}else Sc!==null&&(GO(Sc),Sc=null),p=!0;if(!p)return r.flags&65536?r:null}return r.flags&128?(r.lanes=s,r):(c=c!==null,c!==(n!==null&&n.memoizedState!==null)&&c&&(r.child.flags|=8192,r.mode&1&&(n===null||qn.current&1?xr===0&&(xr=3):sN())),r.updateQueue!==null&&(r.flags|=4),Co(r),null);case 4:return Cg(),UO(n,r),n===null&&vv(r.stateNode.containerInfo),Co(r),null;case 10:return zP(r.type._context),Co(r),null;case 17:return Cs(r.type)&&NT(),Co(r),null;case 19:if(Mn(qn),p=r.memoizedState,p===null)return Co(r),null;if(c=(r.flags&128)!==0,g=p.rendering,g===null)if(c)DE(p,!1);else{if(xr!==0||n!==null&&n.flags&128)for(n=r.child;n!==null;){if(g=jT(n),g!==null){for(r.flags|=128,DE(p,!1),c=g.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),r.subtreeFlags=0,c=s,s=r.child;s!==null;)p=s,n=c,p.flags&=14680066,g=p.alternate,g===null?(p.childLanes=0,p.lanes=n,p.child=null,p.subtreeFlags=0,p.memoizedProps=null,p.memoizedState=null,p.updateQueue=null,p.dependencies=null,p.stateNode=null):(p.childLanes=g.childLanes,p.lanes=g.lanes,p.child=g.child,p.subtreeFlags=0,p.deletions=null,p.memoizedProps=g.memoizedProps,p.memoizedState=g.memoizedState,p.updateQueue=g.updateQueue,p.type=g.type,n=g.dependencies,p.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),s=s.sibling;return In(qn,qn.current&1|2),r.child}n=n.sibling}p.tail!==null&&fr()>Rg&&(r.flags|=128,c=!0,DE(p,!1),r.lanes=4194304)}else{if(!c)if(n=jT(g),n!==null){if(r.flags|=128,c=!0,s=n.updateQueue,s!==null&&(r.updateQueue=s,r.flags|=4),DE(p,!0),p.tail===null&&p.tailMode==="hidden"&&!g.alternate&&!zn)return Co(r),null}else 2*fr()-p.renderingStartTime>Rg&&s!==1073741824&&(r.flags|=128,c=!0,DE(p,!1),r.lanes=4194304);p.isBackwards?(g.sibling=r.child,r.child=g):(s=p.last,s!==null?s.sibling=g:r.child=g,p.last=g)}return p.tail!==null?(r=p.tail,p.rendering=r,p.tail=r.sibling,p.renderingStartTime=fr(),r.sibling=null,s=qn.current,In(qn,c?s&1|2:s&1),r):(Co(r),null);case 22:case 23:return oN(),c=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==c&&(r.flags|=8192),c&&r.mode&1?Ws&1073741824&&(Co(r),r.subtreeFlags&6&&(r.flags|=8192)):Co(r),null;case 24:return null;case 25:return null}throw Error($e(156,r.tag))}function Soe(n,r){switch(VP(r),r.tag){case 1:return Cs(r.type)&&NT(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Cg(),Mn(ws),Mn(No),YP(),n=r.flags,n&65536&&!(n&128)?(r.flags=n&-65537|128,r):null;case 5:return qP(r),null;case 13:if(Mn(qn),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error($e(340));Tg()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return Mn(qn),null;case 4:return Cg(),null;case 10:return zP(r.type._context),null;case 22:case 23:return oN(),null;case 24:return null;default:return null}}var xS=!1,Ro=!1,Toe=typeof WeakSet=="function"?WeakSet:Set,ht=null;function cg(n,r){var s=n.ref;if(s!==null)if(typeof s=="function")try{s(null)}catch(c){ar(n,r,c)}else s.current=null}function jO(n,r,s){try{s()}catch(c){ar(n,r,c)}}var M3=!1;function woe(n,r){if(SO=IT,n=Hz(),UP(n)){if("selectionStart"in n)var s={start:n.selectionStart,end:n.selectionEnd};else e:{s=(s=n.ownerDocument)&&s.defaultView||window;var c=s.getSelection&&s.getSelection();if(c&&c.rangeCount!==0){s=c.anchorNode;var d=c.anchorOffset,p=c.focusNode;c=c.focusOffset;try{s.nodeType,p.nodeType}catch{s=null;break e}var g=0,y=-1,T=-1,R=0,N=0,D=n,B=null;t:for(;;){for(var q;D!==s||d!==0&&D.nodeType!==3||(y=g+d),D!==p||c!==0&&D.nodeType!==3||(T=g+c),D.nodeType===3&&(g+=D.nodeValue.length),(q=D.firstChild)!==null;)B=D,D=q;for(;;){if(D===n)break t;if(B===s&&++R===d&&(y=g),B===p&&++N===c&&(T=g),(q=D.nextSibling)!==null)break;D=B,B=D.parentNode}D=q}s=y===-1||T===-1?null:{start:y,end:T}}else s=null}s=s||{start:0,end:0}}else s=null;for(TO={focusedElem:n,selectionRange:s},IT=!1,ht=r;ht!==null;)if(r=ht,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,ht=n;else for(;ht!==null;){r=ht;try{var J=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var Y=J.memoizedProps,te=J.memoizedState,Z=r.stateNode,ee=Z.getSnapshotBeforeUpdate(r.elementType===r.type?Y:vc(r.type,Y),te);Z.__reactInternalSnapshotBeforeUpdate=ee}break;case 3:var re=r.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($e(163))}}catch(pe){ar(r,r.return,pe)}if(n=r.sibling,n!==null){n.return=r.return,ht=n;break}ht=r.return}return J=M3,M3=!1,J}function nv(n,r,s){var c=r.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var d=c=c.next;do{if((d.tag&n)===n){var p=d.destroy;d.destroy=void 0,p!==void 0&&jO(r,s,p)}d=d.next}while(d!==c)}}function Ew(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&n)===n){var c=s.create;s.destroy=c()}s=s.next}while(s!==r)}}function VO(n){var r=n.ref;if(r!==null){var s=n.stateNode;switch(n.tag){case 5:n=s;break;default:n=s}typeof r=="function"?r(n):r.current=n}}function FH(n){var r=n.alternate;r!==null&&(n.alternate=null,FH(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[El],delete r[Sv],delete r[bO],delete r[ooe],delete r[soe])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function BH(n){return n.tag===5||n.tag===3||n.tag===4}function U3(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||BH(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function FO(n,r,s){var c=n.tag;if(c===5||c===6)n=n.stateNode,r?s.nodeType===8?s.parentNode.insertBefore(n,r):s.insertBefore(n,r):(s.nodeType===8?(r=s.parentNode,r.insertBefore(n,s)):(r=s,r.appendChild(n)),s=s._reactRootContainer,s!=null||r.onclick!==null||(r.onclick=PT));else if(c!==4&&(n=n.child,n!==null))for(FO(n,r,s),n=n.sibling;n!==null;)FO(n,r,s),n=n.sibling}function BO(n,r,s){var c=n.tag;if(c===5||c===6)n=n.stateNode,r?s.insertBefore(n,r):s.appendChild(n);else if(c!==4&&(n=n.child,n!==null))for(BO(n,r,s),n=n.sibling;n!==null;)BO(n,r,s),n=n.sibling}var no=null,yc=!1;function xu(n,r,s){for(s=s.child;s!==null;)WH(n,r,s),s=s.sibling}function WH(n,r,s){if(vl&&typeof vl.onCommitFiberUnmount=="function")try{vl.onCommitFiberUnmount(dw,s)}catch{}switch(s.tag){case 5:Ro||cg(s,r);case 6:var c=no,d=yc;no=null,xu(n,r,s),no=c,yc=d,no!==null&&(yc?(n=no,s=s.stateNode,n.nodeType===8?n.parentNode.removeChild(s):n.removeChild(s)):no.removeChild(s.stateNode));break;case 18:no!==null&&(yc?(n=no,s=s.stateNode,n.nodeType===8?CA(n.parentNode,s):n.nodeType===1&&CA(n,s),gv(n)):CA(no,s.stateNode));break;case 4:c=no,d=yc,no=s.stateNode.containerInfo,yc=!0,xu(n,r,s),no=c,yc=d;break;case 0:case 11:case 14:case 15:if(!Ro&&(c=s.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){d=c=c.next;do{var p=d,g=p.destroy;p=p.tag,g!==void 0&&(p&2||p&4)&&jO(s,r,g),d=d.next}while(d!==c)}xu(n,r,s);break;case 1:if(!Ro&&(cg(s,r),c=s.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=s.memoizedProps,c.state=s.memoizedState,c.componentWillUnmount()}catch(y){ar(s,r,y)}xu(n,r,s);break;case 21:xu(n,r,s);break;case 22:s.mode&1?(Ro=(c=Ro)||s.memoizedState!==null,xu(n,r,s),Ro=c):xu(n,r,s);break;default:xu(n,r,s)}}function j3(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var s=n.stateNode;s===null&&(s=n.stateNode=new Toe),r.forEach(function(c){var d=xoe.bind(null,n,c);s.has(c)||(s.add(c),c.then(d,d))})}}function Ec(n,r){var s=r.deletions;if(s!==null)for(var c=0;c<s.length;c++){var d=s[c];try{var p=n,g=r,y=g;e:for(;y!==null;){switch(y.tag){case 5:no=y.stateNode,yc=!1;break e;case 3:no=y.stateNode.containerInfo,yc=!0;break e;case 4:no=y.stateNode.containerInfo,yc=!0;break e}y=y.return}if(no===null)throw Error($e(160));WH(p,g,d),no=null,yc=!1;var T=d.alternate;T!==null&&(T.return=null),d.return=null}catch(R){ar(d,r,R)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)zH(r,n),r=r.sibling}function zH(n,r){var s=n.alternate,c=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ec(r,n),hl(n),c&4){try{nv(3,n,n.return),Ew(3,n)}catch(Y){ar(n,n.return,Y)}try{nv(5,n,n.return)}catch(Y){ar(n,n.return,Y)}}break;case 1:Ec(r,n),hl(n),c&512&&s!==null&&cg(s,s.return);break;case 5:if(Ec(r,n),hl(n),c&512&&s!==null&&cg(s,s.return),n.flags&32){var d=n.stateNode;try{hv(d,"")}catch(Y){ar(n,n.return,Y)}}if(c&4&&(d=n.stateNode,d!=null)){var p=n.memoizedProps,g=s!==null?s.memoizedProps:p,y=n.type,T=n.updateQueue;if(n.updateQueue=null,T!==null)try{y==="input"&&p.type==="radio"&&p.name!=null&&uz(d,p),uO(y,g);var R=uO(y,p);for(g=0;g<T.length;g+=2){var N=T[g],D=T[g+1];N==="style"?gz(d,D):N==="dangerouslySetInnerHTML"?fz(d,D):N==="children"?hv(d,D):CP(d,N,D,R)}switch(y){case"input":sO(d,p);break;case"textarea":hz(d,p);break;case"select":var B=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!p.multiple;var q=p.value;q!=null?pg(d,!!p.multiple,q,!1):B!==!!p.multiple&&(p.defaultValue!=null?pg(d,!!p.multiple,p.defaultValue,!0):pg(d,!!p.multiple,p.multiple?[]:"",!1))}d[Sv]=p}catch(Y){ar(n,n.return,Y)}}break;case 6:if(Ec(r,n),hl(n),c&4){if(n.stateNode===null)throw Error($e(162));d=n.stateNode,p=n.memoizedProps;try{d.nodeValue=p}catch(Y){ar(n,n.return,Y)}}break;case 3:if(Ec(r,n),hl(n),c&4&&s!==null&&s.memoizedState.isDehydrated)try{gv(r.containerInfo)}catch(Y){ar(n,n.return,Y)}break;case 4:Ec(r,n),hl(n);break;case 13:Ec(r,n),hl(n),d=n.child,d.flags&8192&&(p=d.memoizedState!==null,d.stateNode.isHidden=p,!p||d.alternate!==null&&d.alternate.memoizedState!==null||(nN=fr())),c&4&&j3(n);break;case 22:if(N=s!==null&&s.memoizedState!==null,n.mode&1?(Ro=(R=Ro)||N,Ec(r,n),Ro=R):Ec(r,n),hl(n),c&8192){if(R=n.memoizedState!==null,(n.stateNode.isHidden=R)&&!N&&n.mode&1)for(ht=n,N=n.child;N!==null;){for(D=ht=N;ht!==null;){switch(B=ht,q=B.child,B.tag){case 0:case 11:case 14:case 15:nv(4,B,B.return);break;case 1:cg(B,B.return);var J=B.stateNode;if(typeof J.componentWillUnmount=="function"){c=B,s=B.return;try{r=c,J.props=r.memoizedProps,J.state=r.memoizedState,J.componentWillUnmount()}catch(Y){ar(c,s,Y)}}break;case 5:cg(B,B.return);break;case 22:if(B.memoizedState!==null){F3(D);continue}}q!==null?(q.return=B,ht=q):F3(D)}N=N.sibling}e:for(N=null,D=n;;){if(D.tag===5){if(N===null){N=D;try{d=D.stateNode,R?(p=d.style,typeof p.setProperty=="function"?p.setProperty("display","none","important"):p.display="none"):(y=D.stateNode,T=D.memoizedProps.style,g=T!=null&&T.hasOwnProperty("display")?T.display:null,y.style.display=mz("display",g))}catch(Y){ar(n,n.return,Y)}}}else if(D.tag===6){if(N===null)try{D.stateNode.nodeValue=R?"":D.memoizedProps}catch(Y){ar(n,n.return,Y)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===n)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===n)break e;for(;D.sibling===null;){if(D.return===null||D.return===n)break e;N===D&&(N=null),D=D.return}N===D&&(N=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:Ec(r,n),hl(n),c&4&&j3(n);break;case 21:break;default:Ec(r,n),hl(n)}}function hl(n){var r=n.flags;if(r&2){try{e:{for(var s=n.return;s!==null;){if(BH(s)){var c=s;break e}s=s.return}throw Error($e(160))}switch(c.tag){case 5:var d=c.stateNode;c.flags&32&&(hv(d,""),c.flags&=-33);var p=U3(n);BO(n,p,d);break;case 3:case 4:var g=c.stateNode.containerInfo,y=U3(n);FO(n,y,g);break;default:throw Error($e(161))}}catch(T){ar(n,n.return,T)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function Coe(n,r,s){ht=n,HH(n)}function HH(n,r,s){for(var c=(n.mode&1)!==0;ht!==null;){var d=ht,p=d.child;if(d.tag===22&&c){var g=d.memoizedState!==null||xS;if(!g){var y=d.alternate,T=y!==null&&y.memoizedState!==null||Ro;y=xS;var R=Ro;if(xS=g,(Ro=T)&&!R)for(ht=d;ht!==null;)g=ht,T=g.child,g.tag===22&&g.memoizedState!==null?B3(d):T!==null?(T.return=g,ht=T):B3(d);for(;p!==null;)ht=p,HH(p),p=p.sibling;ht=d,xS=y,Ro=R}V3(n)}else d.subtreeFlags&8772&&p!==null?(p.return=d,ht=p):V3(n)}}function V3(n){for(;ht!==null;){var r=ht;if(r.flags&8772){var s=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Ro||Ew(5,r);break;case 1:var c=r.stateNode;if(r.flags&4&&!Ro)if(s===null)c.componentDidMount();else{var d=r.elementType===r.type?s.memoizedProps:vc(r.type,s.memoizedProps);c.componentDidUpdate(d,s.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var p=r.updateQueue;p!==null&&w3(r,p,c);break;case 3:var g=r.updateQueue;if(g!==null){if(s=null,r.child!==null)switch(r.child.tag){case 5:s=r.child.stateNode;break;case 1:s=r.child.stateNode}w3(r,g,s)}break;case 5:var y=r.stateNode;if(s===null&&r.flags&4){s=y;var T=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":T.autoFocus&&s.focus();break;case"img":T.src&&(s.src=T.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var R=r.alternate;if(R!==null){var N=R.memoizedState;if(N!==null){var D=N.dehydrated;D!==null&&gv(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($e(163))}Ro||r.flags&512&&VO(r)}catch(B){ar(r,r.return,B)}}if(r===n){ht=null;break}if(s=r.sibling,s!==null){s.return=r.return,ht=s;break}ht=r.return}}function F3(n){for(;ht!==null;){var r=ht;if(r===n){ht=null;break}var s=r.sibling;if(s!==null){s.return=r.return,ht=s;break}ht=r.return}}function B3(n){for(;ht!==null;){var r=ht;try{switch(r.tag){case 0:case 11:case 15:var s=r.return;try{Ew(4,r)}catch(T){ar(r,s,T)}break;case 1:var c=r.stateNode;if(typeof c.componentDidMount=="function"){var d=r.return;try{c.componentDidMount()}catch(T){ar(r,d,T)}}var p=r.return;try{VO(r)}catch(T){ar(r,p,T)}break;case 5:var g=r.return;try{VO(r)}catch(T){ar(r,g,T)}}}catch(T){ar(r,r.return,T)}if(r===n){ht=null;break}var y=r.sibling;if(y!==null){y.return=r.return,ht=y;break}ht=r.return}}var boe=Math.ceil,BT=yd.ReactCurrentDispatcher,tN=yd.ReactCurrentOwner,Da=yd.ReactCurrentBatchConfig,Vi=0,Kr=null,wr=null,ao=0,Ws=0,lg=lh(0),xr=0,Iv=null,Jp=0,vw=0,iN=0,rv=null,ys=null,nN=0,Rg=1/0,ld=null,WT=!1,WO=null,Zu=null,DS=!1,Fu=null,zT=0,ov=0,zO=null,aT=-1,cT=0;function Go(){return Vi&6?fr():aT!==-1?aT:aT=fr()}function Qu(n){return n.mode&1?Vi&2&&ao!==0?ao&-ao:coe.transition!==null?(cT===0&&(cT=Az()),cT):(n=cn,n!==0||(n=window.event,n=n===void 0?16:Lz(n.type)),n):1}function Cc(n,r,s,c){if(50<ov)throw ov=0,zO=null,Error($e(185));Bv(n,s,c),(!(Vi&2)||n!==Kr)&&(n===Kr&&(!(Vi&2)&&(vw|=s),xr===4&&ju(n,ao)),bs(n,c),s===1&&Vi===0&&!(r.mode&1)&&(Rg=fr()+500,mw&&dh()))}function bs(n,r){var s=n.callbackNode;cre(n,r);var c=RT(n,n===Kr?ao:0);if(c===0)s!==null&&X5(s),n.callbackNode=null,n.callbackPriority=0;else if(r=c&-c,n.callbackPriority!==r){if(s!=null&&X5(s),r===1)n.tag===0?aoe(W3.bind(null,n)):eH(W3.bind(null,n)),noe(function(){!(Vi&6)&&dh()}),s=null;else{switch(Oz(c)){case 1:s=OP;break;case 4:s=Rz;break;case 16:s=bT;break;case 536870912:s=Iz;break;default:s=bT}s=ZH(s,GH.bind(null,n))}n.callbackPriority=r,n.callbackNode=s}}function GH(n,r){if(aT=-1,cT=0,Vi&6)throw Error($e(327));var s=n.callbackNode;if(Eg()&&n.callbackNode!==s)return null;var c=RT(n,n===Kr?ao:0);if(c===0)return null;if(c&30||c&n.expiredLanes||r)r=HT(n,c);else{r=c;var d=Vi;Vi|=2;var p=qH();(Kr!==n||ao!==r)&&(ld=null,Rg=fr()+500,zp(n,r));do try{Aoe();break}catch(y){KH(n,y)}while(1);WP(),BT.current=p,Vi=d,wr!==null?r=0:(Kr=null,ao=0,r=xr)}if(r!==0){if(r===2&&(d=gO(n),d!==0&&(c=d,r=HO(n,d))),r===1)throw s=Iv,zp(n,0),ju(n,c),bs(n,fr()),s;if(r===6)ju(n,c);else{if(d=n.current.alternate,!(c&30)&&!Roe(d)&&(r=HT(n,c),r===2&&(p=gO(n),p!==0&&(c=p,r=HO(n,p))),r===1))throw s=Iv,zp(n,0),ju(n,c),bs(n,fr()),s;switch(n.finishedWork=d,n.finishedLanes=c,r){case 0:case 1:throw Error($e(345));case 2:Up(n,ys,ld);break;case 3:if(ju(n,c),(c&130023424)===c&&(r=nN+500-fr(),10<r)){if(RT(n,0)!==0)break;if(d=n.suspendedLanes,(d&c)!==c){Go(),n.pingedLanes|=n.suspendedLanes&d;break}n.timeoutHandle=CO(Up.bind(null,n,ys,ld),r);break}Up(n,ys,ld);break;case 4:if(ju(n,c),(c&4194240)===c)break;for(r=n.eventTimes,d=-1;0<c;){var g=31-wc(c);p=1<<g,g=r[g],g>d&&(d=g),c&=~p}if(c=d,c=fr()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*boe(c/1960))-c,10<c){n.timeoutHandle=CO(Up.bind(null,n,ys,ld),c);break}Up(n,ys,ld);break;case 5:Up(n,ys,ld);break;default:throw Error($e(329))}}}return bs(n,fr()),n.callbackNode===s?GH.bind(null,n):null}function HO(n,r){var s=rv;return n.current.memoizedState.isDehydrated&&(zp(n,r).flags|=256),n=HT(n,r),n!==2&&(r=ys,ys=s,r!==null&&GO(r)),n}function GO(n){ys===null?ys=n:ys.push.apply(ys,n)}function Roe(n){for(var r=n;;){if(r.flags&16384){var s=r.updateQueue;if(s!==null&&(s=s.stores,s!==null))for(var c=0;c<s.length;c++){var d=s[c],p=d.getSnapshot;d=d.value;try{if(!Rc(p(),d))return!1}catch{return!1}}}if(s=r.child,r.subtreeFlags&16384&&s!==null)s.return=r,r=s;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ju(n,r){for(r&=~iN,r&=~vw,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var s=31-wc(r),c=1<<s;n[s]=-1,r&=~c}}function W3(n){if(Vi&6)throw Error($e(327));Eg();var r=RT(n,0);if(!(r&1))return bs(n,fr()),null;var s=HT(n,r);if(n.tag!==0&&s===2){var c=gO(n);c!==0&&(r=c,s=HO(n,c))}if(s===1)throw s=Iv,zp(n,0),ju(n,r),bs(n,fr()),s;if(s===6)throw Error($e(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,Up(n,ys,ld),bs(n,fr()),null}function rN(n,r){var s=Vi;Vi|=1;try{return n(r)}finally{Vi=s,Vi===0&&(Rg=fr()+500,mw&&dh())}}function Zp(n){Fu!==null&&Fu.tag===0&&!(Vi&6)&&Eg();var r=Vi;Vi|=1;var s=Da.transition,c=cn;try{if(Da.transition=null,cn=1,n)return n()}finally{cn=c,Da.transition=s,Vi=r,!(Vi&6)&&dh()}}function oN(){Ws=lg.current,Mn(lg)}function zp(n,r){n.finishedWork=null,n.finishedLanes=0;var s=n.timeoutHandle;if(s!==-1&&(n.timeoutHandle=-1,ioe(s)),wr!==null)for(s=wr.return;s!==null;){var c=s;switch(VP(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&NT();break;case 3:Cg(),Mn(ws),Mn(No),YP();break;case 5:qP(c);break;case 4:Cg();break;case 13:Mn(qn);break;case 19:Mn(qn);break;case 10:zP(c.type._context);break;case 22:case 23:oN()}s=s.return}if(Kr=n,wr=n=eh(n.current,null),ao=Ws=r,xr=0,Iv=null,iN=vw=Jp=0,ys=rv=null,Fp!==null){for(r=0;r<Fp.length;r++)if(s=Fp[r],c=s.interleaved,c!==null){s.interleaved=null;var d=c.next,p=s.pending;if(p!==null){var g=p.next;p.next=d,c.next=g}s.pending=c}Fp=null}return n}function KH(n,r){do{var s=wr;try{if(WP(),rT.current=FT,VT){for(var c=$n.memoizedState;c!==null;){var d=c.queue;d!==null&&(d.pending=null),c=c.next}VT=!1}if(Xp=0,zr=Nr=$n=null,iv=!1,Cv=0,tN.current=null,s===null||s.return===null){xr=1,Iv=r,wr=null;break}e:{var p=n,g=s.return,y=s,T=r;if(r=ao,y.flags|=32768,T!==null&&typeof T=="object"&&typeof T.then=="function"){var R=T,N=y,D=N.tag;if(!(N.mode&1)&&(D===0||D===11||D===15)){var B=N.alternate;B?(N.updateQueue=B.updateQueue,N.memoizedState=B.memoizedState,N.lanes=B.lanes):(N.updateQueue=null,N.memoizedState=null)}var q=O3(g);if(q!==null){q.flags&=-257,P3(q,g,y,p,r),q.mode&1&&A3(p,R,r),r=q,T=R;var J=r.updateQueue;if(J===null){var Y=new Set;Y.add(T),r.updateQueue=Y}else J.add(T);break e}else{if(!(r&1)){A3(p,R,r),sN();break e}T=Error($e(426))}}else if(zn&&y.mode&1){var te=O3(g);if(te!==null){!(te.flags&65536)&&(te.flags|=256),P3(te,g,y,p,r),FP(bg(T,y));break e}}p=T=bg(T,y),xr!==4&&(xr=2),rv===null?rv=[p]:rv.push(p),p=g;do{switch(p.tag){case 3:p.flags|=65536,r&=-r,p.lanes|=r;var Z=OH(p,T,r);T3(p,Z);break e;case 1:y=T;var ee=p.type,re=p.stateNode;if(!(p.flags&128)&&(typeof ee.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Zu===null||!Zu.has(re)))){p.flags|=65536,r&=-r,p.lanes|=r;var pe=PH(p,y,r);T3(p,pe);break e}}p=p.return}while(p!==null)}$H(s)}catch(ve){r=ve,wr===s&&s!==null&&(wr=s=s.return);continue}break}while(1)}function qH(){var n=BT.current;return BT.current=FT,n===null?FT:n}function sN(){(xr===0||xr===3||xr===2)&&(xr=4),Kr===null||!(Jp&268435455)&&!(vw&268435455)||ju(Kr,ao)}function HT(n,r){var s=Vi;Vi|=2;var c=qH();(Kr!==n||ao!==r)&&(ld=null,zp(n,r));do try{Ioe();break}catch(d){KH(n,d)}while(1);if(WP(),Vi=s,BT.current=c,wr!==null)throw Error($e(261));return Kr=null,ao=0,xr}function Ioe(){for(;wr!==null;)YH(wr)}function Aoe(){for(;wr!==null&&!Qne();)YH(wr)}function YH(n){var r=JH(n.alternate,n,Ws);n.memoizedProps=n.pendingProps,r===null?$H(n):wr=r,tN.current=null}function $H(n){var r=n;do{var s=r.alternate;if(n=r.return,r.flags&32768){if(s=Soe(s,r),s!==null){s.flags&=32767,wr=s;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{xr=6,wr=null;return}}else if(s=yoe(s,r,Ws),s!==null){wr=s;return}if(r=r.sibling,r!==null){wr=r;return}wr=r=n}while(r!==null);xr===0&&(xr=5)}function Up(n,r,s){var c=cn,d=Da.transition;try{Da.transition=null,cn=1,Ooe(n,r,s,c)}finally{Da.transition=d,cn=c}return null}function Ooe(n,r,s,c){do Eg();while(Fu!==null);if(Vi&6)throw Error($e(327));s=n.finishedWork;var d=n.finishedLanes;if(s===null)return null;if(n.finishedWork=null,n.finishedLanes=0,s===n.current)throw Error($e(177));n.callbackNode=null,n.callbackPriority=0;var p=s.lanes|s.childLanes;if(lre(n,p),n===Kr&&(wr=Kr=null,ao=0),!(s.subtreeFlags&2064)&&!(s.flags&2064)||DS||(DS=!0,ZH(bT,function(){return Eg(),null})),p=(s.flags&15990)!==0,s.subtreeFlags&15990||p){p=Da.transition,Da.transition=null;var g=cn;cn=1;var y=Vi;Vi|=4,tN.current=null,woe(n,s),zH(s,n),$re(TO),IT=!!SO,TO=SO=null,n.current=s,Coe(s),ere(),Vi=y,cn=g,Da.transition=p}else n.current=s;if(DS&&(DS=!1,Fu=n,zT=d),p=n.pendingLanes,p===0&&(Zu=null),nre(s.stateNode),bs(n,fr()),r!==null)for(c=n.onRecoverableError,s=0;s<r.length;s++)d=r[s],c(d.value,{componentStack:d.stack,digest:d.digest});if(WT)throw WT=!1,n=WO,WO=null,n;return zT&1&&n.tag!==0&&Eg(),p=n.pendingLanes,p&1?n===zO?ov++:(ov=0,zO=n):ov=0,dh(),null}function Eg(){if(Fu!==null){var n=Oz(zT),r=Da.transition,s=cn;try{if(Da.transition=null,cn=16>n?16:n,Fu===null)var c=!1;else{if(n=Fu,Fu=null,zT=0,Vi&6)throw Error($e(331));var d=Vi;for(Vi|=4,ht=n.current;ht!==null;){var p=ht,g=p.child;if(ht.flags&16){var y=p.deletions;if(y!==null){for(var T=0;T<y.length;T++){var R=y[T];for(ht=R;ht!==null;){var N=ht;switch(N.tag){case 0:case 11:case 15:nv(8,N,p)}var D=N.child;if(D!==null)D.return=N,ht=D;else for(;ht!==null;){N=ht;var B=N.sibling,q=N.return;if(FH(N),N===R){ht=null;break}if(B!==null){B.return=q,ht=B;break}ht=q}}}var J=p.alternate;if(J!==null){var Y=J.child;if(Y!==null){J.child=null;do{var te=Y.sibling;Y.sibling=null,Y=te}while(Y!==null)}}ht=p}}if(p.subtreeFlags&2064&&g!==null)g.return=p,ht=g;else e:for(;ht!==null;){if(p=ht,p.flags&2048)switch(p.tag){case 0:case 11:case 15:nv(9,p,p.return)}var Z=p.sibling;if(Z!==null){Z.return=p.return,ht=Z;break e}ht=p.return}}var ee=n.current;for(ht=ee;ht!==null;){g=ht;var re=g.child;if(g.subtreeFlags&2064&&re!==null)re.return=g,ht=re;else e:for(g=ee;ht!==null;){if(y=ht,y.flags&2048)try{switch(y.tag){case 0:case 11:case 15:Ew(9,y)}}catch(ve){ar(y,y.return,ve)}if(y===g){ht=null;break e}var pe=y.sibling;if(pe!==null){pe.return=y.return,ht=pe;break e}ht=y.return}}if(Vi=d,dh(),vl&&typeof vl.onPostCommitFiberRoot=="function")try{vl.onPostCommitFiberRoot(dw,n)}catch{}c=!0}return c}finally{cn=s,Da.transition=r}}return!1}function z3(n,r,s){r=bg(s,r),r=OH(n,r,1),n=Ju(n,r,1),r=Go(),n!==null&&(Bv(n,1,r),bs(n,r))}function ar(n,r,s){if(n.tag===3)z3(n,n,s);else for(;r!==null;){if(r.tag===3){z3(r,n,s);break}else if(r.tag===1){var c=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Zu===null||!Zu.has(c))){n=bg(s,n),n=PH(r,n,1),r=Ju(r,n,1),n=Go(),r!==null&&(Bv(r,1,n),bs(r,n));break}}r=r.return}}function Poe(n,r,s){var c=n.pingCache;c!==null&&c.delete(r),r=Go(),n.pingedLanes|=n.suspendedLanes&s,Kr===n&&(ao&s)===s&&(xr===4||xr===3&&(ao&130023424)===ao&&500>fr()-nN?zp(n,0):iN|=s),bs(n,r)}function XH(n,r){r===0&&(n.mode&1?(r=wS,wS<<=1,!(wS&130023424)&&(wS=4194304)):r=1);var s=Go();n=Ed(n,r),n!==null&&(Bv(n,r,s),bs(n,s))}function Noe(n){var r=n.memoizedState,s=0;r!==null&&(s=r.retryLane),XH(n,s)}function xoe(n,r){var s=0;switch(n.tag){case 13:var c=n.stateNode,d=n.memoizedState;d!==null&&(s=d.retryLane);break;case 19:c=n.stateNode;break;default:throw Error($e(314))}c!==null&&c.delete(r),XH(n,s)}var JH;JH=function(n,r,s){if(n!==null)if(n.memoizedProps!==r.pendingProps||ws.current)Ts=!0;else{if(!(n.lanes&s)&&!(r.flags&128))return Ts=!1,voe(n,r,s);Ts=!!(n.flags&131072)}else Ts=!1,zn&&r.flags&1048576&&tH(r,kT,r.index);switch(r.lanes=0,r.tag){case 2:var c=r.type;sT(n,r),n=r.pendingProps;var d=Sg(r,No.current);_g(r,s),d=XP(null,r,c,n,d,s);var p=JP();return r.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Cs(c)?(p=!0,xT(r)):p=!1,r.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,GP(r),d.updater=_w,r.stateNode=d,d._reactInternals=r,NO(r,c,n,s),r=kO(null,r,c,!0,p,s)):(r.tag=0,zn&&p&&jP(r),Ho(null,r,d,s),r=r.child),r;case 16:c=r.elementType;e:{switch(sT(n,r),n=r.pendingProps,d=c._init,c=d(c._payload),r.type=c,d=r.tag=koe(c),n=vc(c,n),d){case 0:r=DO(null,r,c,n,s);break e;case 1:r=D3(null,r,c,n,s);break e;case 11:r=N3(null,r,c,n,s);break e;case 14:r=x3(null,r,c,vc(c.type,n),s);break e}throw Error($e(306,c,""))}return r;case 0:return c=r.type,d=r.pendingProps,d=r.elementType===c?d:vc(c,d),DO(n,r,c,d,s);case 1:return c=r.type,d=r.pendingProps,d=r.elementType===c?d:vc(c,d),D3(n,r,c,d,s);case 3:e:{if(kH(r),n===null)throw Error($e(387));c=r.pendingProps,p=r.memoizedState,d=p.element,aH(n,r),UT(r,c,null,s);var g=r.memoizedState;if(c=g.element,p.isDehydrated)if(p={element:c,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},r.updateQueue.baseState=p,r.memoizedState=p,r.flags&256){d=bg(Error($e(423)),r),r=k3(n,r,c,s,d);break e}else if(c!==d){d=bg(Error($e(424)),r),r=k3(n,r,c,s,d);break e}else for(zs=Xu(r.stateNode.containerInfo.firstChild),Gs=r,zn=!0,Sc=null,s=oH(r,null,c,s),r.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Tg(),c===d){r=vd(n,r,s);break e}Ho(n,r,c,s)}r=r.child}return r;case 5:return cH(r),n===null&&AO(r),c=r.type,d=r.pendingProps,p=n!==null?n.memoizedProps:null,g=d.children,wO(c,d)?g=null:p!==null&&wO(c,p)&&(r.flags|=32),DH(n,r),Ho(n,r,g,s),r.child;case 6:return n===null&&AO(r),null;case 13:return LH(n,r,s);case 4:return KP(r,r.stateNode.containerInfo),c=r.pendingProps,n===null?r.child=wg(r,null,c,s):Ho(n,r,c,s),r.child;case 11:return c=r.type,d=r.pendingProps,d=r.elementType===c?d:vc(c,d),N3(n,r,c,d,s);case 7:return Ho(n,r,r.pendingProps,s),r.child;case 8:return Ho(n,r,r.pendingProps.children,s),r.child;case 12:return Ho(n,r,r.pendingProps.children,s),r.child;case 10:e:{if(c=r.type._context,d=r.pendingProps,p=r.memoizedProps,g=d.value,In(LT,c._currentValue),c._currentValue=g,p!==null)if(Rc(p.value,g)){if(p.children===d.children&&!ws.current){r=vd(n,r,s);break e}}else for(p=r.child,p!==null&&(p.return=r);p!==null;){var y=p.dependencies;if(y!==null){g=p.child;for(var T=y.firstContext;T!==null;){if(T.context===c){if(p.tag===1){T=md(-1,s&-s),T.tag=2;var R=p.updateQueue;if(R!==null){R=R.shared;var N=R.pending;N===null?T.next=T:(T.next=N.next,N.next=T),R.pending=T}}p.lanes|=s,T=p.alternate,T!==null&&(T.lanes|=s),OO(p.return,s,r),y.lanes|=s;break}T=T.next}}else if(p.tag===10)g=p.type===r.type?null:p.child;else if(p.tag===18){if(g=p.return,g===null)throw Error($e(341));g.lanes|=s,y=g.alternate,y!==null&&(y.lanes|=s),OO(g,s,r),g=p.sibling}else g=p.child;if(g!==null)g.return=p;else for(g=p;g!==null;){if(g===r){g=null;break}if(p=g.sibling,p!==null){p.return=g.return,g=p;break}g=g.return}p=g}Ho(n,r,d.children,s),r=r.child}return r;case 9:return d=r.type,c=r.pendingProps.children,_g(r,s),d=ka(d),c=c(d),r.flags|=1,Ho(n,r,c,s),r.child;case 14:return c=r.type,d=vc(c,r.pendingProps),d=vc(c.type,d),x3(n,r,c,d,s);case 15:return NH(n,r,r.type,r.pendingProps,s);case 17:return c=r.type,d=r.pendingProps,d=r.elementType===c?d:vc(c,d),sT(n,r),r.tag=1,Cs(c)?(n=!0,xT(r)):n=!1,_g(r,s),AH(r,c,d),NO(r,c,d,s),kO(null,r,c,!0,n,s);case 19:return MH(n,r,s);case 22:return xH(n,r,s)}throw Error($e(156,r.tag))};function ZH(n,r){return bz(n,r)}function Doe(n,r,s,c){this.tag=n,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xa(n,r,s,c){return new Doe(n,r,s,c)}function aN(n){return n=n.prototype,!(!n||!n.isReactComponent)}function koe(n){if(typeof n=="function")return aN(n)?1:0;if(n!=null){if(n=n.$$typeof,n===RP)return 11;if(n===IP)return 14}return 2}function eh(n,r){var s=n.alternate;return s===null?(s=xa(n.tag,r,n.key,n.mode),s.elementType=n.elementType,s.type=n.type,s.stateNode=n.stateNode,s.alternate=n,n.alternate=s):(s.pendingProps=r,s.type=n.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=n.flags&14680064,s.childLanes=n.childLanes,s.lanes=n.lanes,s.child=n.child,s.memoizedProps=n.memoizedProps,s.memoizedState=n.memoizedState,s.updateQueue=n.updateQueue,r=n.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},s.sibling=n.sibling,s.index=n.index,s.ref=n.ref,s}function lT(n,r,s,c,d,p){var g=2;if(c=n,typeof n=="function")aN(n)&&(g=1);else if(typeof n=="string")g=5;else e:switch(n){case Qm:return Hp(s.children,d,p,r);case bP:g=8,d|=8;break;case tO:return n=xa(12,s,r,d|2),n.elementType=tO,n.lanes=p,n;case iO:return n=xa(13,s,r,d),n.elementType=iO,n.lanes=p,n;case nO:return n=xa(19,s,r,d),n.elementType=nO,n.lanes=p,n;case cz:return yw(s,d,p,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case sz:g=10;break e;case az:g=9;break e;case RP:g=11;break e;case IP:g=14;break e;case Lu:g=16,c=null;break e}throw Error($e(130,n==null?n:typeof n,""))}return r=xa(g,s,r,d),r.elementType=n,r.type=c,r.lanes=p,r}function Hp(n,r,s,c){return n=xa(7,n,c,r),n.lanes=s,n}function yw(n,r,s,c){return n=xa(22,n,c,r),n.elementType=cz,n.lanes=s,n.stateNode={isHidden:!1},n}function xA(n,r,s){return n=xa(6,n,null,r),n.lanes=s,n}function DA(n,r,s){return r=xa(4,n.children!==null?n.children:[],n.key,r),r.lanes=s,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function Loe(n,r,s,c,d){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pA(0),this.expirationTimes=pA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pA(0),this.identifierPrefix=c,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function cN(n,r,s,c,d,p,g,y,T){return n=new Loe(n,r,s,y,T),r===1?(r=1,p===!0&&(r|=8)):r=0,p=xa(3,null,null,r),n.current=p,p.stateNode=n,p.memoizedState={element:c,isDehydrated:s,cache:null,transitions:null,pendingSuspenseBoundaries:null},GP(p),n}function Moe(n,r,s){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Zm,key:c==null?null:""+c,children:n,containerInfo:r,implementation:s}}function QH(n){if(!n)return sh;n=n._reactInternals;e:{if(nf(n)!==n||n.tag!==1)throw Error($e(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Cs(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error($e(171))}if(n.tag===1){var s=n.type;if(Cs(s))return Qz(n,s,r)}return r}function e6(n,r,s,c,d,p,g,y,T){return n=cN(s,c,!0,n,d,p,g,y,T),n.context=QH(null),s=n.current,c=Go(),d=Qu(s),p=md(c,d),p.callback=r??null,Ju(s,p,d),n.current.lanes=d,Bv(n,d,c),bs(n,c),n}function Sw(n,r,s,c){var d=r.current,p=Go(),g=Qu(d);return s=QH(s),r.context===null?r.context=s:r.pendingContext=s,r=md(p,g),r.payload={element:n},c=c===void 0?null:c,c!==null&&(r.callback=c),n=Ju(d,r,g),n!==null&&(Cc(n,d,g,p),nT(n,d,g)),g}function GT(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function H3(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var s=n.retryLane;n.retryLane=s!==0&&s<r?s:r}}function lN(n,r){H3(n,r),(n=n.alternate)&&H3(n,r)}function Uoe(){return null}var t6=typeof reportError=="function"?reportError:function(n){console.error(n)};function dN(n){this._internalRoot=n}Tw.prototype.render=dN.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error($e(409));Sw(n,r,null,null)};Tw.prototype.unmount=dN.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Zp(function(){Sw(null,n,null,null)}),r[_d]=null}};function Tw(n){this._internalRoot=n}Tw.prototype.unstable_scheduleHydration=function(n){if(n){var r=xz();n={blockedOn:null,target:n,priority:r};for(var s=0;s<Uu.length&&r!==0&&r<Uu[s].priority;s++);Uu.splice(s,0,n),s===0&&kz(n)}};function uN(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function ww(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function G3(){}function joe(n,r,s,c,d){if(d){if(typeof c=="function"){var p=c;c=function(){var R=GT(g);p.call(R)}}var g=e6(r,c,n,0,null,!1,!1,"",G3);return n._reactRootContainer=g,n[_d]=g.current,vv(n.nodeType===8?n.parentNode:n),Zp(),g}for(;d=n.lastChild;)n.removeChild(d);if(typeof c=="function"){var y=c;c=function(){var R=GT(T);y.call(R)}}var T=cN(n,0,!1,null,null,!1,!1,"",G3);return n._reactRootContainer=T,n[_d]=T.current,vv(n.nodeType===8?n.parentNode:n),Zp(function(){Sw(r,T,s,c)}),T}function Cw(n,r,s,c,d){var p=s._reactRootContainer;if(p){var g=p;if(typeof d=="function"){var y=d;d=function(){var T=GT(g);y.call(T)}}Sw(r,g,n,d)}else g=joe(s,r,n,d,c);return GT(g)}Pz=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var s=zE(r.pendingLanes);s!==0&&(PP(r,s|1),bs(r,fr()),!(Vi&6)&&(Rg=fr()+500,dh()))}break;case 13:Zp(function(){var c=Ed(n,1);if(c!==null){var d=Go();Cc(c,n,1,d)}}),lN(n,1)}};NP=function(n){if(n.tag===13){var r=Ed(n,134217728);if(r!==null){var s=Go();Cc(r,n,134217728,s)}lN(n,134217728)}};Nz=function(n){if(n.tag===13){var r=Qu(n),s=Ed(n,r);if(s!==null){var c=Go();Cc(s,n,r,c)}lN(n,r)}};xz=function(){return cn};Dz=function(n,r){var s=cn;try{return cn=n,r()}finally{cn=s}};pO=function(n,r,s){switch(r){case"input":if(sO(n,s),r=s.name,s.type==="radio"&&r!=null){for(s=n;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<s.length;r++){var c=s[r];if(c!==n&&c.form===n.form){var d=fw(c);if(!d)throw Error($e(90));dz(c),sO(c,d)}}}break;case"textarea":hz(n,s);break;case"select":r=s.value,r!=null&&pg(n,!!s.multiple,r,!1)}};vz=rN;yz=Zp;var Voe={usingClientEntryPoint:!1,Events:[zv,ng,fw,_z,Ez,rN]},kE={findFiberByHostInstance:Vp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Foe={bundleType:kE.bundleType,version:kE.version,rendererPackageName:kE.rendererPackageName,rendererConfig:kE.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yd.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=wz(n),n===null?null:n.stateNode},findFiberByHostInstance:kE.findFiberByHostInstance||Uoe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kS.isDisabled&&kS.supportsFiber)try{dw=kS.inject(Foe),vl=kS}catch{}}qs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Voe;qs.createPortal=function(n,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!uN(r))throw Error($e(200));return Moe(n,r,null,s)};qs.createRoot=function(n,r){if(!uN(n))throw Error($e(299));var s=!1,c="",d=t6;return r!=null&&(r.unstable_strictMode===!0&&(s=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onRecoverableError!==void 0&&(d=r.onRecoverableError)),r=cN(n,1,!1,null,null,s,!1,c,d),n[_d]=r.current,vv(n.nodeType===8?n.parentNode:n),new dN(r)};qs.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error($e(188)):(n=Object.keys(n).join(","),Error($e(268,n)));return n=wz(r),n=n===null?null:n.stateNode,n};qs.flushSync=function(n){return Zp(n)};qs.hydrate=function(n,r,s){if(!ww(r))throw Error($e(200));return Cw(null,n,r,!0,s)};qs.hydrateRoot=function(n,r,s){if(!uN(n))throw Error($e(405));var c=s!=null&&s.hydratedSources||null,d=!1,p="",g=t6;if(s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onRecoverableError!==void 0&&(g=s.onRecoverableError)),r=e6(r,null,n,1,s??null,d,!1,p,g),n[_d]=r.current,vv(n),c)for(n=0;n<c.length;n++)s=c[n],d=s._getVersion,d=d(s._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[s,d]:r.mutableSourceEagerHydrationData.push(s,d);return new Tw(r)};qs.render=function(n,r,s){if(!ww(r))throw Error($e(200));return Cw(null,n,r,!1,s)};qs.unmountComponentAtNode=function(n){if(!ww(n))throw Error($e(40));return n._reactRootContainer?(Zp(function(){Cw(null,null,n,!1,function(){n._reactRootContainer=null,n[_d]=null})}),!0):!1};qs.unstable_batchedUpdates=rN;qs.unstable_renderSubtreeIntoContainer=function(n,r,s,c){if(!ww(s))throw Error($e(200));if(n==null||n._reactInternals===void 0)throw Error($e(38));return Cw(n,r,s,!1,c)};qs.version="18.3.1-next-f1338f8080-20240426";function i6(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i6)}catch(n){console.error(n)}}i6(),iz.exports=qs;var hN=iz.exports,K3=hN;QA.createRoot=K3.createRoot,QA.hydrateRoot=K3.hydrateRoot;/**
 * @remix-run/router v1.19.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Av(){return Av=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},Av.apply(this,arguments)}var Bu;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Bu||(Bu={}));const q3="popstate";function Boe(n){n===void 0&&(n={});function r(d,p){let{pathname:g="/",search:y="",hash:T=""}=rf(d.location.hash.substr(1));return!g.startsWith("/")&&!g.startsWith(".")&&(g="/"+g),KO("",{pathname:g,search:y,hash:T},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function s(d,p){let g=d.document.querySelector("base"),y="";if(g&&g.getAttribute("href")){let T=d.location.href,R=T.indexOf("#");y=R===-1?T:T.slice(0,R)}return y+"#"+(typeof p=="string"?p:KT(p))}function c(d,p){pN(d.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(p)+")")}return zoe(r,s,c,n)}function Xn(n,r){if(n===!1||n===null||typeof n>"u")throw new Error(r)}function pN(n,r){if(!n){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function Woe(){return Math.random().toString(36).substr(2,8)}function Y3(n,r){return{usr:n.state,key:n.key,idx:r}}function KO(n,r,s,c){return s===void 0&&(s=null),Av({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof r=="string"?rf(r):r,{state:s,key:r&&r.key||c||Woe()})}function KT(n){let{pathname:r="/",search:s="",hash:c=""}=n;return s&&s!=="?"&&(r+=s.charAt(0)==="?"?s:"?"+s),c&&c!=="#"&&(r+=c.charAt(0)==="#"?c:"#"+c),r}function rf(n){let r={};if(n){let s=n.indexOf("#");s>=0&&(r.hash=n.substr(s),n=n.substr(0,s));let c=n.indexOf("?");c>=0&&(r.search=n.substr(c),n=n.substr(0,c)),n&&(r.pathname=n)}return r}function zoe(n,r,s,c){c===void 0&&(c={});let{window:d=document.defaultView,v5Compat:p=!1}=c,g=d.history,y=Bu.Pop,T=null,R=N();R==null&&(R=0,g.replaceState(Av({},g.state,{idx:R}),""));function N(){return(g.state||{idx:null}).idx}function D(){y=Bu.Pop;let te=N(),Z=te==null?null:te-R;R=te,T&&T({action:y,location:Y.location,delta:Z})}function B(te,Z){y=Bu.Push;let ee=KO(Y.location,te,Z);s&&s(ee,te),R=N()+1;let re=Y3(ee,R),pe=Y.createHref(ee);try{g.pushState(re,"",pe)}catch(ve){if(ve instanceof DOMException&&ve.name==="DataCloneError")throw ve;d.location.assign(pe)}p&&T&&T({action:y,location:Y.location,delta:1})}function q(te,Z){y=Bu.Replace;let ee=KO(Y.location,te,Z);s&&s(ee,te),R=N();let re=Y3(ee,R),pe=Y.createHref(ee);g.replaceState(re,"",pe),p&&T&&T({action:y,location:Y.location,delta:0})}function J(te){let Z=d.location.origin!=="null"?d.location.origin:d.location.href,ee=typeof te=="string"?te:KT(te);return ee=ee.replace(/ $/,"%20"),Xn(Z,"No window.location.(origin|href) available to create URL for href: "+ee),new URL(ee,Z)}let Y={get action(){return y},get location(){return n(d,g)},listen(te){if(T)throw new Error("A history only accepts one active listener");return d.addEventListener(q3,D),T=te,()=>{d.removeEventListener(q3,D),T=null}},createHref(te){return r(d,te)},createURL:J,encodeLocation(te){let Z=J(te);return{pathname:Z.pathname,search:Z.search,hash:Z.hash}},push:B,replace:q,go(te){return g.go(te)}};return Y}var $3;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})($3||($3={}));function Hoe(n,r,s){return s===void 0&&(s="/"),Goe(n,r,s,!1)}function Goe(n,r,s,c){let d=typeof r=="string"?rf(r):r,p=Ig(d.pathname||"/",s);if(p==null)return null;let g=n6(n);Koe(g);let y=null;for(let T=0;y==null&&T<g.length;++T){let R=nse(p);y=tse(g[T],R,c)}return y}function n6(n,r,s,c){r===void 0&&(r=[]),s===void 0&&(s=[]),c===void 0&&(c="");let d=(p,g,y)=>{let T={relativePath:y===void 0?p.path||"":y,caseSensitive:p.caseSensitive===!0,childrenIndex:g,route:p};T.relativePath.startsWith("/")&&(Xn(T.relativePath.startsWith(c),'Absolute route path "'+T.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),T.relativePath=T.relativePath.slice(c.length));let R=th([c,T.relativePath]),N=s.concat(T);p.children&&p.children.length>0&&(Xn(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+R+'".')),n6(p.children,r,N,R)),!(p.path==null&&!p.index)&&r.push({path:R,score:Qoe(R,p.index),routesMeta:N})};return n.forEach((p,g)=>{var y;if(p.path===""||!((y=p.path)!=null&&y.includes("?")))d(p,g);else for(let T of r6(p.path))d(p,g,T)}),r}function r6(n){let r=n.split("/");if(r.length===0)return[];let[s,...c]=r,d=s.endsWith("?"),p=s.replace(/\?$/,"");if(c.length===0)return d?[p,""]:[p];let g=r6(c.join("/")),y=[];return y.push(...g.map(T=>T===""?p:[p,T].join("/"))),d&&y.push(...g),y.map(T=>n.startsWith("/")&&T===""?"/":T)}function Koe(n){n.sort((r,s)=>r.score!==s.score?s.score-r.score:ese(r.routesMeta.map(c=>c.childrenIndex),s.routesMeta.map(c=>c.childrenIndex)))}const qoe=/^:[\w-]+$/,Yoe=3,$oe=2,Xoe=1,Joe=10,Zoe=-2,X3=n=>n==="*";function Qoe(n,r){let s=n.split("/"),c=s.length;return s.some(X3)&&(c+=Zoe),r&&(c+=$oe),s.filter(d=>!X3(d)).reduce((d,p)=>d+(qoe.test(p)?Yoe:p===""?Xoe:Joe),c)}function ese(n,r){return n.length===r.length&&n.slice(0,-1).every((c,d)=>c===r[d])?n[n.length-1]-r[r.length-1]:0}function tse(n,r,s){s===void 0&&(s=!1);let{routesMeta:c}=n,d={},p="/",g=[];for(let y=0;y<c.length;++y){let T=c[y],R=y===c.length-1,N=p==="/"?r:r.slice(p.length)||"/",D=qT({path:T.relativePath,caseSensitive:T.caseSensitive,end:R},N),B=T.route;if(!D&&R&&s&&!c[c.length-1].route.index&&(D=qT({path:T.relativePath,caseSensitive:T.caseSensitive,end:!1},N)),!D)return null;Object.assign(d,D.params),g.push({params:d,pathname:th([p,D.pathname]),pathnameBase:ase(th([p,D.pathnameBase])),route:B}),D.pathnameBase!=="/"&&(p=th([p,D.pathnameBase]))}return g}function qT(n,r){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,c]=ise(n.path,n.caseSensitive,n.end),d=r.match(s);if(!d)return null;let p=d[0],g=p.replace(/(.)\/+$/,"$1"),y=d.slice(1);return{params:c.reduce((R,N,D)=>{let{paramName:B,isOptional:q}=N;if(B==="*"){let Y=y[D]||"";g=p.slice(0,p.length-Y.length).replace(/(.)\/+$/,"$1")}const J=y[D];return q&&!J?R[B]=void 0:R[B]=(J||"").replace(/%2F/g,"/"),R},{}),pathname:p,pathnameBase:g,pattern:n}}function ise(n,r,s){r===void 0&&(r=!1),s===void 0&&(s=!0),pN(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let c=[],d="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,y,T)=>(c.push({paramName:y,isOptional:T!=null}),T?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(c.push({paramName:"*"}),d+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?d+="\\/*$":n!==""&&n!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,r?void 0:"i"),c]}function nse(n){try{return n.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return pN(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),n}}function Ig(n,r){if(r==="/")return n;if(!n.toLowerCase().startsWith(r.toLowerCase()))return null;let s=r.endsWith("/")?r.length-1:r.length,c=n.charAt(s);return c&&c!=="/"?null:n.slice(s)||"/"}function rse(n,r){r===void 0&&(r="/");let{pathname:s,search:c="",hash:d=""}=typeof n=="string"?rf(n):n;return{pathname:s?s.startsWith("/")?s:ose(s,r):r,search:cse(c),hash:lse(d)}}function ose(n,r){let s=r.replace(/\/+$/,"").split("/");return n.split("/").forEach(d=>{d===".."?s.length>1&&s.pop():d!=="."&&s.push(d)}),s.length>1?s.join("/"):"/"}function kA(n,r,s,c){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function sse(n){return n.filter((r,s)=>s===0||r.route.path&&r.route.path.length>0)}function fN(n,r){let s=sse(n);return r?s.map((c,d)=>d===s.length-1?c.pathname:c.pathnameBase):s.map(c=>c.pathnameBase)}function mN(n,r,s,c){c===void 0&&(c=!1);let d;typeof n=="string"?d=rf(n):(d=Av({},n),Xn(!d.pathname||!d.pathname.includes("?"),kA("?","pathname","search",d)),Xn(!d.pathname||!d.pathname.includes("#"),kA("#","pathname","hash",d)),Xn(!d.search||!d.search.includes("#"),kA("#","search","hash",d)));let p=n===""||d.pathname==="",g=p?"/":d.pathname,y;if(g==null)y=s;else{let D=r.length-1;if(!c&&g.startsWith("..")){let B=g.split("/");for(;B[0]==="..";)B.shift(),D-=1;d.pathname=B.join("/")}y=D>=0?r[D]:"/"}let T=rse(d,y),R=g&&g!=="/"&&g.endsWith("/"),N=(p||g===".")&&s.endsWith("/");return!T.pathname.endsWith("/")&&(R||N)&&(T.pathname+="/"),T}const th=n=>n.join("/").replace(/\/\/+/g,"/"),ase=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),cse=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,lse=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function dse(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const o6=["post","put","patch","delete"];new Set(o6);const use=["get",...o6];new Set(use);/**
 * React Router v6.26.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ov(){return Ov=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},Ov.apply(this,arguments)}const bw=le.createContext(null),s6=le.createContext(null),Sd=le.createContext(null),Rw=le.createContext(null),Td=le.createContext({outlet:null,matches:[],isDataRoute:!1}),a6=le.createContext(null);function hse(n,r){let{relative:s}=r===void 0?{}:r;Bg()||Xn(!1);let{basename:c,navigator:d}=le.useContext(Sd),{hash:p,pathname:g,search:y}=Iw(n,{relative:s}),T=g;return c!=="/"&&(T=g==="/"?c:th([c,g])),d.createHref({pathname:T,search:y,hash:p})}function Bg(){return le.useContext(Rw)!=null}function uh(){return Bg()||Xn(!1),le.useContext(Rw).location}function c6(n){le.useContext(Sd).static||le.useLayoutEffect(n)}function Ua(){let{isDataRoute:n}=le.useContext(Td);return n?bse():pse()}function pse(){Bg()||Xn(!1);let n=le.useContext(bw),{basename:r,future:s,navigator:c}=le.useContext(Sd),{matches:d}=le.useContext(Td),{pathname:p}=uh(),g=JSON.stringify(fN(d,s.v7_relativeSplatPath)),y=le.useRef(!1);return c6(()=>{y.current=!0}),le.useCallback(function(R,N){if(N===void 0&&(N={}),!y.current)return;if(typeof R=="number"){c.go(R);return}let D=mN(R,JSON.parse(g),p,N.relative==="path");n==null&&r!=="/"&&(D.pathname=D.pathname==="/"?r:th([r,D.pathname])),(N.replace?c.replace:c.push)(D,N.state,N)},[r,c,g,p,n])}function l6(){let{matches:n}=le.useContext(Td),r=n[n.length-1];return r?r.params:{}}function Iw(n,r){let{relative:s}=r===void 0?{}:r,{future:c}=le.useContext(Sd),{matches:d}=le.useContext(Td),{pathname:p}=uh(),g=JSON.stringify(fN(d,c.v7_relativeSplatPath));return le.useMemo(()=>mN(n,JSON.parse(g),p,s==="path"),[n,g,p,s])}function fse(n,r){return mse(n,r)}function mse(n,r,s,c){Bg()||Xn(!1);let{navigator:d}=le.useContext(Sd),{matches:p}=le.useContext(Td),g=p[p.length-1],y=g?g.params:{};g&&g.pathname;let T=g?g.pathnameBase:"/";g&&g.route;let R=uh(),N;if(r){var D;let te=typeof r=="string"?rf(r):r;T==="/"||(D=te.pathname)!=null&&D.startsWith(T)||Xn(!1),N=te}else N=R;let B=N.pathname||"/",q=B;if(T!=="/"){let te=T.replace(/^\//,"").split("/");q="/"+B.replace(/^\//,"").split("/").slice(te.length).join("/")}let J=Hoe(n,{pathname:q}),Y=yse(J&&J.map(te=>Object.assign({},te,{params:Object.assign({},y,te.params),pathname:th([T,d.encodeLocation?d.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?T:th([T,d.encodeLocation?d.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),p,s,c);return r&&Y?le.createElement(Rw.Provider,{value:{location:Ov({pathname:"/",search:"",hash:"",state:null,key:"default"},N),navigationType:Bu.Pop}},Y):Y}function gse(){let n=Cse(),r=dse(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},p=null;return le.createElement(le.Fragment,null,le.createElement("h2",null,"Unexpected Application Error!"),le.createElement("h3",{style:{fontStyle:"italic"}},r),s?le.createElement("pre",{style:d},s):null,p)}const _se=le.createElement(gse,null);class Ese extends le.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,s){return s.location!==r.location||s.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:s.error,location:s.location,revalidation:r.revalidation||s.revalidation}}componentDidCatch(r,s){console.error("React Router caught the following error during render",r,s)}render(){return this.state.error!==void 0?le.createElement(Td.Provider,{value:this.props.routeContext},le.createElement(a6.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function vse(n){let{routeContext:r,match:s,children:c}=n,d=le.useContext(bw);return d&&d.static&&d.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=s.route.id),le.createElement(Td.Provider,{value:r},c)}function yse(n,r,s,c){var d;if(r===void 0&&(r=[]),s===void 0&&(s=null),c===void 0&&(c=null),n==null){var p;if(!s)return null;if(s.errors)n=s.matches;else if((p=c)!=null&&p.v7_partialHydration&&r.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let g=n,y=(d=s)==null?void 0:d.errors;if(y!=null){let N=g.findIndex(D=>D.route.id&&(y==null?void 0:y[D.route.id])!==void 0);N>=0||Xn(!1),g=g.slice(0,Math.min(g.length,N+1))}let T=!1,R=-1;if(s&&c&&c.v7_partialHydration)for(let N=0;N<g.length;N++){let D=g[N];if((D.route.HydrateFallback||D.route.hydrateFallbackElement)&&(R=N),D.route.id){let{loaderData:B,errors:q}=s,J=D.route.loader&&B[D.route.id]===void 0&&(!q||q[D.route.id]===void 0);if(D.route.lazy||J){T=!0,R>=0?g=g.slice(0,R+1):g=[g[0]];break}}}return g.reduceRight((N,D,B)=>{let q,J=!1,Y=null,te=null;s&&(q=y&&D.route.id?y[D.route.id]:void 0,Y=D.route.errorElement||_se,T&&(R<0&&B===0?(Rse("route-fallback",!1),J=!0,te=null):R===B&&(J=!0,te=D.route.hydrateFallbackElement||null)));let Z=r.concat(g.slice(0,B+1)),ee=()=>{let re;return q?re=Y:J?re=te:D.route.Component?re=le.createElement(D.route.Component,null):D.route.element?re=D.route.element:re=N,le.createElement(vse,{match:D,routeContext:{outlet:N,matches:Z,isDataRoute:s!=null},children:re})};return s&&(D.route.ErrorBoundary||D.route.errorElement||B===0)?le.createElement(Ese,{location:s.location,revalidation:s.revalidation,component:Y,error:q,children:ee(),routeContext:{outlet:null,matches:Z,isDataRoute:!0}}):ee()},null)}var d6=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(d6||{}),YT=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(YT||{});function Sse(n){let r=le.useContext(bw);return r||Xn(!1),r}function Tse(n){let r=le.useContext(s6);return r||Xn(!1),r}function wse(n){let r=le.useContext(Td);return r||Xn(!1),r}function u6(n){let r=wse(),s=r.matches[r.matches.length-1];return s.route.id||Xn(!1),s.route.id}function Cse(){var n;let r=le.useContext(a6),s=Tse(YT.UseRouteError),c=u6(YT.UseRouteError);return r!==void 0?r:(n=s.errors)==null?void 0:n[c]}function bse(){let{router:n}=Sse(d6.UseNavigateStable),r=u6(YT.UseNavigateStable),s=le.useRef(!1);return c6(()=>{s.current=!0}),le.useCallback(function(d,p){p===void 0&&(p={}),s.current&&(typeof d=="number"?n.navigate(d):n.navigate(d,Ov({fromRouteId:r},p)))},[n,r])}const J3={};function Rse(n,r,s){!r&&!J3[n]&&(J3[n]=!0)}function h6(n){let{to:r,replace:s,state:c,relative:d}=n;Bg()||Xn(!1);let{future:p,static:g}=le.useContext(Sd),{matches:y}=le.useContext(Td),{pathname:T}=uh(),R=Ua(),N=mN(r,fN(y,p.v7_relativeSplatPath),T,d==="path"),D=JSON.stringify(N);return le.useEffect(()=>R(JSON.parse(D),{replace:s,state:c,relative:d}),[R,D,d,s,c]),null}function Sr(n){Xn(!1)}function Ise(n){let{basename:r="/",children:s=null,location:c,navigationType:d=Bu.Pop,navigator:p,static:g=!1,future:y}=n;Bg()&&Xn(!1);let T=r.replace(/^\/*/,"/"),R=le.useMemo(()=>({basename:T,navigator:p,static:g,future:Ov({v7_relativeSplatPath:!1},y)}),[T,y,p,g]);typeof c=="string"&&(c=rf(c));let{pathname:N="/",search:D="",hash:B="",state:q=null,key:J="default"}=c,Y=le.useMemo(()=>{let te=Ig(N,T);return te==null?null:{location:{pathname:te,search:D,hash:B,state:q,key:J},navigationType:d}},[T,N,D,B,q,J,d]);return Y==null?null:le.createElement(Sd.Provider,{value:R},le.createElement(Rw.Provider,{children:s,value:Y}))}function Ase(n){let{children:r,location:s}=n;return fse(qO(r),s)}new Promise(()=>{});function qO(n,r){r===void 0&&(r=[]);let s=[];return le.Children.forEach(n,(c,d)=>{if(!le.isValidElement(c))return;let p=[...r,d];if(c.type===le.Fragment){s.push.apply(s,qO(c.props.children,p));return}c.type!==Sr&&Xn(!1),!c.props.index||!c.props.children||Xn(!1);let g={id:c.props.id||p.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(g.children=qO(c.props.children,p)),s.push(g)}),s}/**
 * React Router DOM v6.26.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $T(){return $T=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},$T.apply(this,arguments)}function p6(n,r){if(n==null)return{};var s={},c=Object.keys(n),d,p;for(p=0;p<c.length;p++)d=c[p],!(r.indexOf(d)>=0)&&(s[d]=n[d]);return s}function Ose(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Pse(n,r){return n.button===0&&(!r||r==="_self")&&!Ose(n)}const Nse=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],xse=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],Dse="6";try{window.__reactRouterVersion=Dse}catch{}const kse=le.createContext({isTransitioning:!1}),Lse="startTransition",Z3=Pne[Lse];function Mse(n){let{basename:r,children:s,future:c,window:d}=n,p=le.useRef();p.current==null&&(p.current=Boe({window:d,v5Compat:!0}));let g=p.current,[y,T]=le.useState({action:g.action,location:g.location}),{v7_startTransition:R}=c||{},N=le.useCallback(D=>{R&&Z3?Z3(()=>T(D)):T(D)},[T,R]);return le.useLayoutEffect(()=>g.listen(N),[g,N]),le.createElement(Ise,{basename:r,children:s,location:y.location,navigationType:y.action,navigator:g,future:c})}const Use=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",jse=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Qp=le.forwardRef(function(r,s){let{onClick:c,relative:d,reloadDocument:p,replace:g,state:y,target:T,to:R,preventScrollReset:N,unstable_viewTransition:D}=r,B=p6(r,Nse),{basename:q}=le.useContext(Sd),J,Y=!1;if(typeof R=="string"&&jse.test(R)&&(J=R,Use))try{let re=new URL(window.location.href),pe=R.startsWith("//")?new URL(re.protocol+R):new URL(R),ve=Ig(pe.pathname,q);pe.origin===re.origin&&ve!=null?R=ve+pe.search+pe.hash:Y=!0}catch{}let te=hse(R,{relative:d}),Z=Bse(R,{replace:g,state:y,target:T,preventScrollReset:N,relative:d,unstable_viewTransition:D});function ee(re){c&&c(re),re.defaultPrevented||Z(re)}return le.createElement("a",$T({},B,{href:J||te,onClick:Y||p?c:ee,ref:s,target:T}))}),Vse=le.forwardRef(function(r,s){let{"aria-current":c="page",caseSensitive:d=!1,className:p="",end:g=!1,style:y,to:T,unstable_viewTransition:R,children:N}=r,D=p6(r,xse),B=Iw(T,{relative:D.relative}),q=uh(),J=le.useContext(s6),{navigator:Y,basename:te}=le.useContext(Sd),Z=J!=null&&Wse(B)&&R===!0,ee=Y.encodeLocation?Y.encodeLocation(B).pathname:B.pathname,re=q.pathname,pe=J&&J.navigation&&J.navigation.location?J.navigation.location.pathname:null;d||(re=re.toLowerCase(),pe=pe?pe.toLowerCase():null,ee=ee.toLowerCase()),pe&&te&&(pe=Ig(pe,te)||pe);const ve=ee!=="/"&&ee.endsWith("/")?ee.length-1:ee.length;let Oe=re===ee||!g&&re.startsWith(ee)&&re.charAt(ve)==="/",Se=pe!=null&&(pe===ee||!g&&pe.startsWith(ee)&&pe.charAt(ee.length)==="/"),je={isActive:Oe,isPending:Se,isTransitioning:Z},ot=Oe?c:void 0,Qe;typeof p=="function"?Qe=p(je):Qe=[p,Oe?"active":null,Se?"pending":null,Z?"transitioning":null].filter(Boolean).join(" ");let st=typeof y=="function"?y(je):y;return le.createElement(Qp,$T({},D,{"aria-current":ot,className:Qe,ref:s,style:st,to:T,unstable_viewTransition:R}),typeof N=="function"?N(je):N)});var YO;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(YO||(YO={}));var Q3;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Q3||(Q3={}));function Fse(n){let r=le.useContext(bw);return r||Xn(!1),r}function Bse(n,r){let{target:s,replace:c,state:d,preventScrollReset:p,relative:g,unstable_viewTransition:y}=r===void 0?{}:r,T=Ua(),R=uh(),N=Iw(n,{relative:g});return le.useCallback(D=>{if(Pse(D,s)){D.preventDefault();let B=c!==void 0?c:KT(R)===KT(N);T(n,{replace:B,state:d,preventScrollReset:p,relative:g,unstable_viewTransition:y})}},[R,T,N,c,d,s,n,p,g,y])}function Wse(n,r){r===void 0&&(r={});let s=le.useContext(kse);s==null&&Xn(!1);let{basename:c}=Fse(YO.useViewTransitionState),d=Iw(n,{relative:r.relative});if(!s.isTransitioning)return!1;let p=Ig(s.currentLocation.pathname,c)||s.currentLocation.pathname,g=Ig(s.nextLocation.pathname,c)||s.nextLocation.pathname;return qT(d.pathname,g)!=null||qT(d.pathname,p)!=null}var Io=function(){return Io=Object.assign||function(r){for(var s,c=1,d=arguments.length;c<d;c++){s=arguments[c];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(r[p]=s[p])}return r},Io.apply(this,arguments)};function Pv(n,r,s){if(s||arguments.length===2)for(var c=0,d=r.length,p;c<d;c++)(p||!(c in r))&&(p||(p=Array.prototype.slice.call(r,0,c)),p[c]=r[c]);return n.concat(p||Array.prototype.slice.call(r))}var Ln="-ms-",sv="-moz-",Qi="-webkit-",f6="comm",Aw="rule",gN="decl",zse="@import",m6="@keyframes",Hse="@layer",g6=Math.abs,_N=String.fromCharCode,$O=Object.assign;function Gse(n,r){return Hr(n,0)^45?(((r<<2^Hr(n,0))<<2^Hr(n,1))<<2^Hr(n,2))<<2^Hr(n,3):0}function _6(n){return n.trim()}function dd(n,r){return(n=r.exec(n))?n[0]:n}function fi(n,r,s){return n.replace(r,s)}function dT(n,r,s){return n.indexOf(r,s)}function Hr(n,r){return n.charCodeAt(r)|0}function Ag(n,r,s){return n.slice(r,s)}function _l(n){return n.length}function E6(n){return n.length}function GE(n,r){return r.push(n),n}function Kse(n,r){return n.map(r).join("")}function e4(n,r){return n.filter(function(s){return!dd(s,r)})}var Ow=1,Og=1,v6=0,Ma=0,Tr=0,Wg="";function Pw(n,r,s,c,d,p,g,y){return{value:n,root:r,parent:s,type:c,props:d,children:p,line:Ow,column:Og,length:g,return:"",siblings:y}}function ku(n,r){return $O(Pw("",null,null,"",null,null,0,n.siblings),n,{length:-n.length},r)}function Ym(n){for(;n.root;)n=ku(n.root,{children:[n]});GE(n,n.siblings)}function qse(){return Tr}function Yse(){return Tr=Ma>0?Hr(Wg,--Ma):0,Og--,Tr===10&&(Og=1,Ow--),Tr}function bc(){return Tr=Ma<v6?Hr(Wg,Ma++):0,Og++,Tr===10&&(Og=1,Ow++),Tr}function Gp(){return Hr(Wg,Ma)}function uT(){return Ma}function Nw(n,r){return Ag(Wg,n,r)}function XO(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function $se(n){return Ow=Og=1,v6=_l(Wg=n),Ma=0,[]}function Xse(n){return Wg="",n}function LA(n){return _6(Nw(Ma-1,JO(n===91?n+2:n===40?n+1:n)))}function Jse(n){for(;(Tr=Gp())&&Tr<33;)bc();return XO(n)>2||XO(Tr)>3?"":" "}function Zse(n,r){for(;--r&&bc()&&!(Tr<48||Tr>102||Tr>57&&Tr<65||Tr>70&&Tr<97););return Nw(n,uT()+(r<6&&Gp()==32&&bc()==32))}function JO(n){for(;bc();)switch(Tr){case n:return Ma;case 34:case 39:n!==34&&n!==39&&JO(Tr);break;case 40:n===41&&JO(n);break;case 92:bc();break}return Ma}function Qse(n,r){for(;bc()&&n+Tr!==47+10;)if(n+Tr===42+42&&Gp()===47)break;return"/*"+Nw(r,Ma-1)+"*"+_N(n===47?n:bc())}function eae(n){for(;!XO(Gp());)bc();return Nw(n,Ma)}function tae(n){return Xse(hT("",null,null,null,[""],n=$se(n),0,[0],n))}function hT(n,r,s,c,d,p,g,y,T){for(var R=0,N=0,D=g,B=0,q=0,J=0,Y=1,te=1,Z=1,ee=0,re="",pe=d,ve=p,Oe=c,Se=re;te;)switch(J=ee,ee=bc()){case 40:if(J!=108&&Hr(Se,D-1)==58){dT(Se+=fi(LA(ee),"&","&\f"),"&\f",g6(R?y[R-1]:0))!=-1&&(Z=-1);break}case 34:case 39:case 91:Se+=LA(ee);break;case 9:case 10:case 13:case 32:Se+=Jse(J);break;case 92:Se+=Zse(uT()-1,7);continue;case 47:switch(Gp()){case 42:case 47:GE(iae(Qse(bc(),uT()),r,s,T),T);break;default:Se+="/"}break;case 123*Y:y[R++]=_l(Se)*Z;case 125*Y:case 59:case 0:switch(ee){case 0:case 125:te=0;case 59+N:Z==-1&&(Se=fi(Se,/\f/g,"")),q>0&&_l(Se)-D&&GE(q>32?i4(Se+";",c,s,D-1,T):i4(fi(Se," ","")+";",c,s,D-2,T),T);break;case 59:Se+=";";default:if(GE(Oe=t4(Se,r,s,R,N,d,y,re,pe=[],ve=[],D,p),p),ee===123)if(N===0)hT(Se,r,Oe,Oe,pe,p,D,y,ve);else switch(B===99&&Hr(Se,3)===110?100:B){case 100:case 108:case 109:case 115:hT(n,Oe,Oe,c&&GE(t4(n,Oe,Oe,0,0,d,y,re,d,pe=[],D,ve),ve),d,ve,D,y,c?pe:ve);break;default:hT(Se,Oe,Oe,Oe,[""],ve,0,y,ve)}}R=N=q=0,Y=Z=1,re=Se="",D=g;break;case 58:D=1+_l(Se),q=J;default:if(Y<1){if(ee==123)--Y;else if(ee==125&&Y++==0&&Yse()==125)continue}switch(Se+=_N(ee),ee*Y){case 38:Z=N>0?1:(Se+="\f",-1);break;case 44:y[R++]=(_l(Se)-1)*Z,Z=1;break;case 64:Gp()===45&&(Se+=LA(bc())),B=Gp(),N=D=_l(re=Se+=eae(uT())),ee++;break;case 45:J===45&&_l(Se)==2&&(Y=0)}}return p}function t4(n,r,s,c,d,p,g,y,T,R,N,D){for(var B=d-1,q=d===0?p:[""],J=E6(q),Y=0,te=0,Z=0;Y<c;++Y)for(var ee=0,re=Ag(n,B+1,B=g6(te=g[Y])),pe=n;ee<J;++ee)(pe=_6(te>0?q[ee]+" "+re:fi(re,/&\f/g,q[ee])))&&(T[Z++]=pe);return Pw(n,r,s,d===0?Aw:y,T,R,N,D)}function iae(n,r,s,c){return Pw(n,r,s,f6,_N(qse()),Ag(n,2,-2),0,c)}function i4(n,r,s,c,d){return Pw(n,r,s,gN,Ag(n,0,c),Ag(n,c+1,-1),c,d)}function y6(n,r,s){switch(Gse(n,r)){case 5103:return Qi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Qi+n+n;case 4789:return sv+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return Qi+n+sv+n+Ln+n+n;case 5936:switch(Hr(n,r+11)){case 114:return Qi+n+Ln+fi(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return Qi+n+Ln+fi(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return Qi+n+Ln+fi(n,/[svh]\w+-[tblr]{2}/,"lr")+n}case 6828:case 4268:case 2903:return Qi+n+Ln+n+n;case 6165:return Qi+n+Ln+"flex-"+n+n;case 5187:return Qi+n+fi(n,/(\w+).+(:[^]+)/,Qi+"box-$1$2"+Ln+"flex-$1$2")+n;case 5443:return Qi+n+Ln+"flex-item-"+fi(n,/flex-|-self/g,"")+(dd(n,/flex-|baseline/)?"":Ln+"grid-row-"+fi(n,/flex-|-self/g,""))+n;case 4675:return Qi+n+Ln+"flex-line-pack"+fi(n,/align-content|flex-|-self/g,"")+n;case 5548:return Qi+n+Ln+fi(n,"shrink","negative")+n;case 5292:return Qi+n+Ln+fi(n,"basis","preferred-size")+n;case 6060:return Qi+"box-"+fi(n,"-grow","")+Qi+n+Ln+fi(n,"grow","positive")+n;case 4554:return Qi+fi(n,/([^-])(transform)/g,"$1"+Qi+"$2")+n;case 6187:return fi(fi(fi(n,/(zoom-|grab)/,Qi+"$1"),/(image-set)/,Qi+"$1"),n,"")+n;case 5495:case 3959:return fi(n,/(image-set\([^]*)/,Qi+"$1$`$1");case 4968:return fi(fi(n,/(.+:)(flex-)?(.*)/,Qi+"box-pack:$3"+Ln+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Qi+n+n;case 4200:if(!dd(n,/flex-|baseline/))return Ln+"grid-column-align"+Ag(n,r)+n;break;case 2592:case 3360:return Ln+fi(n,"template-","")+n;case 4384:case 3616:return s&&s.some(function(c,d){return r=d,dd(c.props,/grid-\w+-end/)})?~dT(n+(s=s[r].value),"span",0)?n:Ln+fi(n,"-start","")+n+Ln+"grid-row-span:"+(~dT(s,"span",0)?dd(s,/\d+/):+dd(s,/\d+/)-+dd(n,/\d+/))+";":Ln+fi(n,"-start","")+n;case 4896:case 4128:return s&&s.some(function(c){return dd(c.props,/grid-\w+-start/)})?n:Ln+fi(fi(n,"-end","-span"),"span ","")+n;case 4095:case 3583:case 4068:case 2532:return fi(n,/(.+)-inline(.+)/,Qi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(_l(n)-1-r>6)switch(Hr(n,r+1)){case 109:if(Hr(n,r+4)!==45)break;case 102:return fi(n,/(.+:)(.+)-([^]+)/,"$1"+Qi+"$2-$3$1"+sv+(Hr(n,r+3)==108?"$3":"$2-$3"))+n;case 115:return~dT(n,"stretch",0)?y6(fi(n,"stretch","fill-available"),r,s)+n:n}break;case 5152:case 5920:return fi(n,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(c,d,p,g,y,T,R){return Ln+d+":"+p+R+(g?Ln+d+"-span:"+(y?T:+T-+p)+R:"")+n});case 4949:if(Hr(n,r+6)===121)return fi(n,":",":"+Qi)+n;break;case 6444:switch(Hr(n,Hr(n,14)===45?18:11)){case 120:return fi(n,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Qi+(Hr(n,14)===45?"inline-":"")+"box$3$1"+Qi+"$2$3$1"+Ln+"$2box$3")+n;case 100:return fi(n,":",":"+Ln)+n}break;case 5719:case 2647:case 2135:case 3927:case 2391:return fi(n,"scroll-","scroll-snap-")+n}return n}function XT(n,r){for(var s="",c=0;c<n.length;c++)s+=r(n[c],c,n,r)||"";return s}function nae(n,r,s,c){switch(n.type){case Hse:if(n.children.length)break;case zse:case gN:return n.return=n.return||n.value;case f6:return"";case m6:return n.return=n.value+"{"+XT(n.children,c)+"}";case Aw:if(!_l(n.value=n.props.join(",")))return""}return _l(s=XT(n.children,c))?n.return=n.value+"{"+s+"}":""}function rae(n){var r=E6(n);return function(s,c,d,p){for(var g="",y=0;y<r;y++)g+=n[y](s,c,d,p)||"";return g}}function oae(n){return function(r){r.root||(r=r.return)&&n(r)}}function sae(n,r,s,c){if(n.length>-1&&!n.return)switch(n.type){case gN:n.return=y6(n.value,n.length,s);return;case m6:return XT([ku(n,{value:fi(n.value,"@","@"+Qi)})],c);case Aw:if(n.length)return Kse(s=n.props,function(d){switch(dd(d,c=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Ym(ku(n,{props:[fi(d,/:(read-\w+)/,":"+sv+"$1")]})),Ym(ku(n,{props:[d]})),$O(n,{props:e4(s,c)});break;case"::placeholder":Ym(ku(n,{props:[fi(d,/:(plac\w+)/,":"+Qi+"input-$1")]})),Ym(ku(n,{props:[fi(d,/:(plac\w+)/,":"+sv+"$1")]})),Ym(ku(n,{props:[fi(d,/:(plac\w+)/,Ln+"input-$1")]})),Ym(ku(n,{props:[d]})),$O(n,{props:e4(s,c)});break}return""})}}var aae={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Pg=typeof process<"u"&&process.env!==void 0&&({}.REACT_APP_SC_ATTR||{}.SC_ATTR)||"data-styled",S6="active",T6="data-styled-version",xw="6.1.12",EN=`/*!sc*/
`,JT=typeof window<"u"&&"HTMLElement"in window,cae=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&{}.REACT_APP_SC_DISABLE_SPEEDY!==""?{}.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&{}.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&process.env!==void 0&&{}.SC_DISABLE_SPEEDY!==void 0&&{}.SC_DISABLE_SPEEDY!==""&&{}.SC_DISABLE_SPEEDY!=="false"&&{}.SC_DISABLE_SPEEDY),lae={},Dw=Object.freeze([]),Ng=Object.freeze({});function w6(n,r,s){return s===void 0&&(s=Ng),n.theme!==s.theme&&n.theme||r||s.theme}var C6=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),dae=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,uae=/(^-|-$)/g;function n4(n){return n.replace(dae,"-").replace(uae,"")}var hae=/(a)(d)/gi,LS=52,r4=function(n){return String.fromCharCode(n+(n>25?39:97))};function ZO(n){var r,s="";for(r=Math.abs(n);r>LS;r=r/LS|0)s=r4(r%LS)+s;return(r4(r%LS)+s).replace(hae,"$1-$2")}var MA,b6=5381,dg=function(n,r){for(var s=r.length;s;)n=33*n^r.charCodeAt(--s);return n},R6=function(n){return dg(b6,n)};function I6(n){return ZO(R6(n)>>>0)}function pae(n){return n.displayName||n.name||"Component"}function UA(n){return typeof n=="string"&&!0}var A6=typeof Symbol=="function"&&Symbol.for,O6=A6?Symbol.for("react.memo"):60115,fae=A6?Symbol.for("react.forward_ref"):60112,mae={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},gae={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},P6={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},_ae=((MA={})[fae]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},MA[O6]=P6,MA);function o4(n){return("type"in(r=n)&&r.type.$$typeof)===O6?P6:"$$typeof"in n?_ae[n.$$typeof]:mae;var r}var Eae=Object.defineProperty,vae=Object.getOwnPropertyNames,s4=Object.getOwnPropertySymbols,yae=Object.getOwnPropertyDescriptor,Sae=Object.getPrototypeOf,a4=Object.prototype;function N6(n,r,s){if(typeof r!="string"){if(a4){var c=Sae(r);c&&c!==a4&&N6(n,c,s)}var d=vae(r);s4&&(d=d.concat(s4(r)));for(var p=o4(n),g=o4(r),y=0;y<d.length;++y){var T=d[y];if(!(T in gae||s&&s[T]||g&&T in g||p&&T in p)){var R=yae(r,T);try{Eae(n,T,R)}catch{}}}}return n}function xg(n){return typeof n=="function"}function vN(n){return typeof n=="object"&&"styledComponentId"in n}function Wp(n,r){return n&&r?"".concat(n," ").concat(r):n||r||""}function QO(n,r){if(n.length===0)return"";for(var s=n[0],c=1;c<n.length;c++)s+=r?r+n[c]:n[c];return s}function Nv(n){return n!==null&&typeof n=="object"&&n.constructor.name===Object.name&&!("props"in n&&n.$$typeof)}function eP(n,r,s){if(s===void 0&&(s=!1),!s&&!Nv(n)&&!Array.isArray(n))return r;if(Array.isArray(r))for(var c=0;c<r.length;c++)n[c]=eP(n[c],r[c]);else if(Nv(r))for(var c in r)n[c]=eP(n[c],r[c]);return n}function yN(n,r){Object.defineProperty(n,"toString",{value:r})}function Gv(n){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(n," for more information.").concat(r.length>0?" Args: ".concat(r.join(", ")):""))}var Tae=function(){function n(r){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=r}return n.prototype.indexOfGroup=function(r){for(var s=0,c=0;c<r;c++)s+=this.groupSizes[c];return s},n.prototype.insertRules=function(r,s){if(r>=this.groupSizes.length){for(var c=this.groupSizes,d=c.length,p=d;r>=p;)if((p<<=1)<0)throw Gv(16,"".concat(r));this.groupSizes=new Uint32Array(p),this.groupSizes.set(c),this.length=p;for(var g=d;g<p;g++)this.groupSizes[g]=0}for(var y=this.indexOfGroup(r+1),T=(g=0,s.length);g<T;g++)this.tag.insertRule(y,s[g])&&(this.groupSizes[r]++,y++)},n.prototype.clearGroup=function(r){if(r<this.length){var s=this.groupSizes[r],c=this.indexOfGroup(r),d=c+s;this.groupSizes[r]=0;for(var p=c;p<d;p++)this.tag.deleteRule(c)}},n.prototype.getGroup=function(r){var s="";if(r>=this.length||this.groupSizes[r]===0)return s;for(var c=this.groupSizes[r],d=this.indexOfGroup(r),p=d+c,g=d;g<p;g++)s+="".concat(this.tag.getRule(g)).concat(EN);return s},n}(),pT=new Map,ZT=new Map,fT=1,MS=function(n){if(pT.has(n))return pT.get(n);for(;ZT.has(fT);)fT++;var r=fT++;return pT.set(n,r),ZT.set(r,n),r},wae=function(n,r){fT=r+1,pT.set(n,r),ZT.set(r,n)},Cae="style[".concat(Pg,"][").concat(T6,'="').concat(xw,'"]'),bae=new RegExp("^".concat(Pg,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Rae=function(n,r,s){for(var c,d=s.split(","),p=0,g=d.length;p<g;p++)(c=d[p])&&n.registerName(r,c)},Iae=function(n,r){for(var s,c=((s=r.textContent)!==null&&s!==void 0?s:"").split(EN),d=[],p=0,g=c.length;p<g;p++){var y=c[p].trim();if(y){var T=y.match(bae);if(T){var R=0|parseInt(T[1],10),N=T[2];R!==0&&(wae(N,R),Rae(n,N,T[3]),n.getTag().insertRules(R,d)),d.length=0}else d.push(y)}}},c4=function(n){for(var r=document.querySelectorAll(Cae),s=0,c=r.length;s<c;s++){var d=r[s];d&&d.getAttribute(Pg)!==S6&&(Iae(n,d),d.parentNode&&d.parentNode.removeChild(d))}};function Aae(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var x6=function(n){var r=document.head,s=n||r,c=document.createElement("style"),d=function(y){var T=Array.from(y.querySelectorAll("style[".concat(Pg,"]")));return T[T.length-1]}(s),p=d!==void 0?d.nextSibling:null;c.setAttribute(Pg,S6),c.setAttribute(T6,xw);var g=Aae();return g&&c.setAttribute("nonce",g),s.insertBefore(c,p),c},Oae=function(){function n(r){this.element=x6(r),this.element.appendChild(document.createTextNode("")),this.sheet=function(s){if(s.sheet)return s.sheet;for(var c=document.styleSheets,d=0,p=c.length;d<p;d++){var g=c[d];if(g.ownerNode===s)return g}throw Gv(17)}(this.element),this.length=0}return n.prototype.insertRule=function(r,s){try{return this.sheet.insertRule(s,r),this.length++,!0}catch{return!1}},n.prototype.deleteRule=function(r){this.sheet.deleteRule(r),this.length--},n.prototype.getRule=function(r){var s=this.sheet.cssRules[r];return s&&s.cssText?s.cssText:""},n}(),Pae=function(){function n(r){this.element=x6(r),this.nodes=this.element.childNodes,this.length=0}return n.prototype.insertRule=function(r,s){if(r<=this.length&&r>=0){var c=document.createTextNode(s);return this.element.insertBefore(c,this.nodes[r]||null),this.length++,!0}return!1},n.prototype.deleteRule=function(r){this.element.removeChild(this.nodes[r]),this.length--},n.prototype.getRule=function(r){return r<this.length?this.nodes[r].textContent:""},n}(),Nae=function(){function n(r){this.rules=[],this.length=0}return n.prototype.insertRule=function(r,s){return r<=this.length&&(this.rules.splice(r,0,s),this.length++,!0)},n.prototype.deleteRule=function(r){this.rules.splice(r,1),this.length--},n.prototype.getRule=function(r){return r<this.length?this.rules[r]:""},n}(),l4=JT,xae={isServer:!JT,useCSSOMInjection:!cae},QT=function(){function n(r,s,c){r===void 0&&(r=Ng),s===void 0&&(s={});var d=this;this.options=Io(Io({},xae),r),this.gs=s,this.names=new Map(c),this.server=!!r.isServer,!this.server&&JT&&l4&&(l4=!1,c4(this)),yN(this,function(){return function(p){for(var g=p.getTag(),y=g.length,T="",R=function(D){var B=function(Z){return ZT.get(Z)}(D);if(B===void 0)return"continue";var q=p.names.get(B),J=g.getGroup(D);if(q===void 0||!q.size||J.length===0)return"continue";var Y="".concat(Pg,".g").concat(D,'[id="').concat(B,'"]'),te="";q!==void 0&&q.forEach(function(Z){Z.length>0&&(te+="".concat(Z,","))}),T+="".concat(J).concat(Y,'{content:"').concat(te,'"}').concat(EN)},N=0;N<y;N++)R(N);return T}(d)})}return n.registerId=function(r){return MS(r)},n.prototype.rehydrate=function(){!this.server&&JT&&c4(this)},n.prototype.reconstructWithOptions=function(r,s){return s===void 0&&(s=!0),new n(Io(Io({},this.options),r),this.gs,s&&this.names||void 0)},n.prototype.allocateGSInstance=function(r){return this.gs[r]=(this.gs[r]||0)+1},n.prototype.getTag=function(){return this.tag||(this.tag=(r=function(s){var c=s.useCSSOMInjection,d=s.target;return s.isServer?new Nae(d):c?new Oae(d):new Pae(d)}(this.options),new Tae(r)));var r},n.prototype.hasNameForId=function(r,s){return this.names.has(r)&&this.names.get(r).has(s)},n.prototype.registerName=function(r,s){if(MS(r),this.names.has(r))this.names.get(r).add(s);else{var c=new Set;c.add(s),this.names.set(r,c)}},n.prototype.insertRules=function(r,s,c){this.registerName(r,s),this.getTag().insertRules(MS(r),c)},n.prototype.clearNames=function(r){this.names.has(r)&&this.names.get(r).clear()},n.prototype.clearRules=function(r){this.getTag().clearGroup(MS(r)),this.clearNames(r)},n.prototype.clearTag=function(){this.tag=void 0},n}(),Dae=/&/g,kae=/^\s*\/\/.*$/gm;function D6(n,r){return n.map(function(s){return s.type==="rule"&&(s.value="".concat(r," ").concat(s.value),s.value=s.value.replaceAll(",",",".concat(r," ")),s.props=s.props.map(function(c){return"".concat(r," ").concat(c)})),Array.isArray(s.children)&&s.type!=="@keyframes"&&(s.children=D6(s.children,r)),s})}function Lae(n){var r,s,c,d=n===void 0?Ng:n,p=d.options,g=p===void 0?Ng:p,y=d.plugins,T=y===void 0?Dw:y,R=function(B,q,J){return J.startsWith(s)&&J.endsWith(s)&&J.replaceAll(s,"").length>0?".".concat(r):B},N=T.slice();N.push(function(B){B.type===Aw&&B.value.includes("&")&&(B.props[0]=B.props[0].replace(Dae,s).replace(c,R))}),g.prefix&&N.push(sae),N.push(nae);var D=function(B,q,J,Y){q===void 0&&(q=""),J===void 0&&(J=""),Y===void 0&&(Y="&"),r=Y,s=q,c=new RegExp("\\".concat(s,"\\b"),"g");var te=B.replace(kae,""),Z=tae(J||q?"".concat(J," ").concat(q," { ").concat(te," }"):te);g.namespace&&(Z=D6(Z,g.namespace));var ee=[];return XT(Z,rae(N.concat(oae(function(re){return ee.push(re)})))),ee};return D.hash=T.length?T.reduce(function(B,q){return q.name||Gv(15),dg(B,q.name)},b6).toString():"",D}var Mae=new QT,tP=Lae(),k6=oo.createContext({shouldForwardProp:void 0,styleSheet:Mae,stylis:tP});k6.Consumer;oo.createContext(void 0);function iP(){return le.useContext(k6)}var Uae=function(){function n(r,s){var c=this;this.inject=function(d,p){p===void 0&&(p=tP);var g=c.name+p.hash;d.hasNameForId(c.id,g)||d.insertRules(c.id,g,p(c.rules,g,"@keyframes"))},this.name=r,this.id="sc-keyframes-".concat(r),this.rules=s,yN(this,function(){throw Gv(12,String(c.name))})}return n.prototype.getName=function(r){return r===void 0&&(r=tP),this.name+r.hash},n}(),jae=function(n){return n>="A"&&n<="Z"};function d4(n){for(var r="",s=0;s<n.length;s++){var c=n[s];if(s===1&&c==="-"&&n[0]==="-")return n;jae(c)?r+="-"+c.toLowerCase():r+=c}return r.startsWith("ms-")?"-"+r:r}var L6=function(n){return n==null||n===!1||n===""},M6=function(n){var r,s,c=[];for(var d in n){var p=n[d];n.hasOwnProperty(d)&&!L6(p)&&(Array.isArray(p)&&p.isCss||xg(p)?c.push("".concat(d4(d),":"),p,";"):Nv(p)?c.push.apply(c,Pv(Pv(["".concat(d," {")],M6(p),!1),["}"],!1)):c.push("".concat(d4(d),": ").concat((r=d,(s=p)==null||typeof s=="boolean"||s===""?"":typeof s!="number"||s===0||r in aae||r.startsWith("--")?String(s).trim():"".concat(s,"px")),";")))}return c};function ih(n,r,s,c){if(L6(n))return[];if(vN(n))return[".".concat(n.styledComponentId)];if(xg(n)){if(!xg(p=n)||p.prototype&&p.prototype.isReactComponent||!r)return[n];var d=n(r);return ih(d,r,s,c)}var p;return n instanceof Uae?s?(n.inject(s,c),[n.getName(c)]):[n]:Nv(n)?M6(n):Array.isArray(n)?Array.prototype.concat.apply(Dw,n.map(function(g){return ih(g,r,s,c)})):[n.toString()]}function U6(n){for(var r=0;r<n.length;r+=1){var s=n[r];if(xg(s)&&!vN(s))return!1}return!0}var Vae=R6(xw),Fae=function(){function n(r,s,c){this.rules=r,this.staticRulesId="",this.isStatic=(c===void 0||c.isStatic)&&U6(r),this.componentId=s,this.baseHash=dg(Vae,s),this.baseStyle=c,QT.registerId(s)}return n.prototype.generateAndInjectStyles=function(r,s,c){var d=this.baseStyle?this.baseStyle.generateAndInjectStyles(r,s,c):"";if(this.isStatic&&!c.hash)if(this.staticRulesId&&s.hasNameForId(this.componentId,this.staticRulesId))d=Wp(d,this.staticRulesId);else{var p=QO(ih(this.rules,r,s,c)),g=ZO(dg(this.baseHash,p)>>>0);if(!s.hasNameForId(this.componentId,g)){var y=c(p,".".concat(g),void 0,this.componentId);s.insertRules(this.componentId,g,y)}d=Wp(d,g),this.staticRulesId=g}else{for(var T=dg(this.baseHash,c.hash),R="",N=0;N<this.rules.length;N++){var D=this.rules[N];if(typeof D=="string")R+=D;else if(D){var B=QO(ih(D,r,s,c));T=dg(T,B+N),R+=B}}if(R){var q=ZO(T>>>0);s.hasNameForId(this.componentId,q)||s.insertRules(this.componentId,q,c(R,".".concat(q),void 0,this.componentId)),d=Wp(d,q)}}return d},n}(),SN=oo.createContext(void 0);SN.Consumer;var jA={};function Bae(n,r,s){var c=vN(n),d=n,p=!UA(n),g=r.attrs,y=g===void 0?Dw:g,T=r.componentId,R=T===void 0?function(pe,ve){var Oe=typeof pe!="string"?"sc":n4(pe);jA[Oe]=(jA[Oe]||0)+1;var Se="".concat(Oe,"-").concat(I6(xw+Oe+jA[Oe]));return ve?"".concat(ve,"-").concat(Se):Se}(r.displayName,r.parentComponentId):T,N=r.displayName,D=N===void 0?function(pe){return UA(pe)?"styled.".concat(pe):"Styled(".concat(pae(pe),")")}(n):N,B=r.displayName&&r.componentId?"".concat(n4(r.displayName),"-").concat(r.componentId):r.componentId||R,q=c&&d.attrs?d.attrs.concat(y).filter(Boolean):y,J=r.shouldForwardProp;if(c&&d.shouldForwardProp){var Y=d.shouldForwardProp;if(r.shouldForwardProp){var te=r.shouldForwardProp;J=function(pe,ve){return Y(pe,ve)&&te(pe,ve)}}else J=Y}var Z=new Fae(s,B,c?d.componentStyle:void 0);function ee(pe,ve){return function(Oe,Se,je){var ot=Oe.attrs,Qe=Oe.componentStyle,st=Oe.defaultProps,ut=Oe.foldedComponentIds,Ni=Oe.styledComponentId,gt=Oe.target,At=oo.useContext(SN),yt=iP(),Lt=Oe.shouldForwardProp||yt.shouldForwardProp,Ue=w6(Se,At,st)||Ng,Je=function(ge,lt,vt){for(var Jt,zi=Io(Io({},lt),{className:void 0,theme:vt}),bi=0;bi<ge.length;bi+=1){var gn=xg(Jt=ge[bi])?Jt(zi):Jt;for(var Tn in gn)zi[Tn]=Tn==="className"?Wp(zi[Tn],gn[Tn]):Tn==="style"?Io(Io({},zi[Tn]),gn[Tn]):gn[Tn]}return lt.className&&(zi.className=Wp(zi.className,lt.className)),zi}(ot,Se,Ue),Ie=Je.as||gt,pt={};for(var St in Je)Je[St]===void 0||St[0]==="$"||St==="as"||St==="theme"&&Je.theme===Ue||(St==="forwardedAs"?pt.as=Je.forwardedAs:Lt&&!Lt(St,Ie)||(pt[St]=Je[St]));var yi=function(ge,lt){var vt=iP(),Jt=ge.generateAndInjectStyles(lt,vt.styleSheet,vt.stylis);return Jt}(Qe,Je),Ot=Wp(ut,Ni);return yi&&(Ot+=" "+yi),Je.className&&(Ot+=" "+Je.className),pt[UA(Ie)&&!C6.has(Ie)?"class":"className"]=Ot,pt.ref=je,le.createElement(Ie,pt)}(re,pe,ve)}ee.displayName=D;var re=oo.forwardRef(ee);return re.attrs=q,re.componentStyle=Z,re.displayName=D,re.shouldForwardProp=J,re.foldedComponentIds=c?Wp(d.foldedComponentIds,d.styledComponentId):"",re.styledComponentId=B,re.target=c?d.target:n,Object.defineProperty(re,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(pe){this._foldedDefaultProps=c?function(ve){for(var Oe=[],Se=1;Se<arguments.length;Se++)Oe[Se-1]=arguments[Se];for(var je=0,ot=Oe;je<ot.length;je++)eP(ve,ot[je],!0);return ve}({},d.defaultProps,pe):pe}}),yN(re,function(){return".".concat(re.styledComponentId)}),p&&N6(re,n,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),re}function u4(n,r){for(var s=[n[0]],c=0,d=r.length;c<d;c+=1)s.push(r[c],n[c+1]);return s}var h4=function(n){return Object.assign(n,{isCss:!0})};function j6(n){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(xg(n)||Nv(n))return h4(ih(u4(Dw,Pv([n],r,!0))));var c=n;return r.length===0&&c.length===1&&typeof c[0]=="string"?ih(c):h4(ih(u4(c,r)))}function nP(n,r,s){if(s===void 0&&(s=Ng),!r)throw Gv(1,r);var c=function(d){for(var p=[],g=1;g<arguments.length;g++)p[g-1]=arguments[g];return n(r,s,j6.apply(void 0,Pv([d],p,!1)))};return c.attrs=function(d){return nP(n,r,Io(Io({},s),{attrs:Array.prototype.concat(s.attrs,d).filter(Boolean)}))},c.withConfig=function(d){return nP(n,r,Io(Io({},s),d))},c}var V6=function(n){return nP(Bae,n)},be=V6;C6.forEach(function(n){be[n]=V6(n)});var Wae=function(){function n(r,s){this.rules=r,this.componentId=s,this.isStatic=U6(r),QT.registerId(this.componentId+1)}return n.prototype.createStyles=function(r,s,c,d){var p=d(QO(ih(this.rules,s,c,d)),""),g=this.componentId+r;c.insertRules(g,g,p)},n.prototype.removeStyles=function(r,s){s.clearRules(this.componentId+r)},n.prototype.renderStyles=function(r,s,c,d){r>2&&QT.registerId(this.componentId+r),this.removeStyles(r,c),this.createStyles(r,s,c,d)},n}();function zae(n){for(var r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var c=j6.apply(void 0,Pv([n],r,!1)),d="sc-global-".concat(I6(JSON.stringify(c))),p=new Wae(c,d),g=function(T){var R=iP(),N=oo.useContext(SN),D=oo.useRef(R.styleSheet.allocateGSInstance(d)).current;return R.styleSheet.server&&y(D,T,R.styleSheet,N,R.stylis),oo.useLayoutEffect(function(){if(!R.styleSheet.server)return y(D,T,R.styleSheet,N,R.stylis),function(){return p.removeStyles(D,R.styleSheet)}},[D,T,R.styleSheet,N,R.stylis]),null};function y(T,R,N,D,B){if(p.isStatic)p.renderStyles(T,lae,N,B);else{var q=Io(Io({},R),{theme:w6(R,D,g.defaultProps)});p.renderStyles(T,q,N,B)}}return oo.memo(g)}const de={white:"#FFFFFF",primary600:"#234A45",primary500:"#004F44",primary500opacity:"rgba(0, 79, 68, 0.6)",primary400:"#A6B0A5",primary300:"#DDE2D7",primary200:"#EBEEE3",primary100:"#F3FFFC",secondary600:"#3d4e4c",secondary500:"#c0d4ca",secondary400:"#EFE6E5",secondary300:"#79aca9",tertiary500:"#ed1c24",tertiary500opacity:"rgba(237, 28, 36, 0.6)",tertiary600:"#bb141a",tertiary400:"#f48466",tertiary300:"#f58d42",gray50:"#F0F1F3",gray100:"#E6E8EB",gray200:"#C3C7CE",gray300:"#A5ACB5",gray400:"#87909D",gray500:"#697484",danger:"#d1534f",pastel1:"#95e7e0",pastel2:"#f3de2c",pastel3:"#6eeb83",pastel4:"#f1c884",pastel5:"#f26a4f",blue:"#405a95"},Gi=({children:n,type:r,htmlElement:s,max:c,disabled:d,width:p,size:g,bg:y,...T})=>s==="a"?O.jsx(Gae,{bg:y,size:g,width:p,type:r,max:c,...T,children:n}):O.jsx(Hae,{bg:y,size:g,width:p,disabled:d,type:r,max:c,...T,children:n}),Hae=be.button`
  min-height: ${n=>n.size==="little"?"40px":"58px"};
  white-space: nowrap;
  padding: ${n=>n.size==="little"?"0 10px":!n.width&&"0 41px"};
  background-color: ${n=>n.bg||(n.type==="primary"?de.primary500:n.type==="secondary"?de.tertiary400:de.white)};
  color: ${n=>n.type==="primary"||n.type==="secondary"?de.white:de.primary500};
  border: none;
  font-family: 'DM Sans';
  font-size: ${n=>n.size==="little"?"0.7rem":"1.1rem"};
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  width: ${n=>n.width?n.width:n.max&&"max-content"};

  &:hover {
    opacity: ${n=>n.type!=="secondary"&&"0.7"};
    background-color: ${n=>n.type==="secondary"&&de.tertiary600};
  }

  &:disabled {
    pointer-events: none;
    background-color: ${de.gray300};
  }
`,Gae=be.a`
  min-height: ${n=>n.size==="little"?"40px":"58px"};
  white-space: nowrap;
  padding: ${n=>n.size==="little"?"0 10px":!n.width&&"0 41px"};
  background-color: ${n=>n.bg||(n.type==="primary"?de.primary500:n.type==="secondary"?de.tertiary400:de.white)};
  color: ${n=>n.type==="primary"?de.white:de.primary500};
  border: none;
  font-family: 'DM Sans';
  font-size: ${n=>n.size==="little"?"0.7rem":"1.1rem"};
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  width: ${n=>n.width?n.width:n.max&&"max-content"};
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;

  &:hover {
    opacity: 0.7;
  }

  &:disabled {
    pointer-events: none;
    background-color: ${de.gray300};
  }
`,Kae="/assets/sponsor1-e2c61949.png",qae=({value:n})=>O.jsxs(Yae,{children:[O.jsx("div",{className:"img-container",children:O.jsx($ae,{src:`/logo/${n.codigo_pais}${n.id}`})}),O.jsxs("div",{className:"titles-container",children:[O.jsx("b",{children:n.empresa}),O.jsxs("h3",{children:["Visite nuestra ",O.jsx("a",{href:"https://"+n.web,target:"_blank",children:"pgina web"})]})]}),O.jsxs("div",{className:"data",children:[O.jsxs("div",{className:"data-row",children:[O.jsx("i",{className:"fa-solid fa-phone"}),O.jsx("p",{children:n.telefono})]}),O.jsxs("div",{className:"data-row",children:[O.jsx("i",{className:"fa-solid fa-envelope"}),O.jsx("p",{children:n.correo})]}),O.jsxs("div",{className:"data-row",children:[O.jsx("i",{className:"fa-solid fa-map-pin"}),O.jsx("p",{children:n.direccion})]}),O.jsxs("div",{className:"data-row",children:[O.jsx("i",{className:"fa-solid fa-map-location-dot"}),O.jsxs("p",{children:[n.ciudad," - ",n.pais]})]})]})]}),Yae=be.div`
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;

  & .img-container {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 220px;
    min-height: 220px;
    width: 100%;
  }

  & .titles-container {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  & .data {
    display: flex;
    flex-direction: column;
    gap: 16px;
    height: 100%;
    overflow: auto;
    padding: 8px 40px 24px;
    width: 100%;
  }

  & .data-row {
    display: flex;
    gap: 24px;
    align-items: center;
  }

  & i {
    color: rgba(0, 0, 0, .8);
    opacity: 0.6;
    width: 20px;
    text-align: center;
    font-size: 1.1rem;
  }
  & p {
    opacity: 0.5;
    text-align: justify;
    font-size: 1.1rem;
    font-weight: 600;
  }
  & b {
    opacity: 0.8;
    text-align: justify;
    font-size: 1.3rem;
    font-weight: 600;
  }

  h3 {
    align-self: center;
    font-size: 1.3rem;
    color: rgba(0, 0, 0, .8);
    opacity: 0.6;
    padding: 8px 0 16px;

    & > a {
      text-decoration: none;
      color: ${de.primary600};
      position: relative;

      &::after {
        position: absolute;
        content: "";
        width: 100%;
        height: 1px;
        background-color: ${de.primary600};
        left: 0;
        bottom: 0;
        transform-origin: right;
        transform: scale(0);
        transition: transform 0.3s;
      }

      &:hover::after {
        transform-origin: left;
        transform: scale(1);
      }
    }
  }
`,$ae=be.img`
  max-width: 80%;
  max-height: 90%;
  object-fit: cover;
`,p4="/assets/pin-844963a5.png";var F6={},B6={};(function(n){var r=ro&&ro.__assign||function(){return r=Object.assign||function(J){for(var Y,te=1,Z=arguments.length;te<Z;te++){Y=arguments[te];for(var ee in Y)Object.prototype.hasOwnProperty.call(Y,ee)&&(J[ee]=Y[ee])}return J},r.apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var s;(function(J){J.Browser="browser",J.Server="server",J.Native="native"})(s=n.Device||(n.Device={}));var c=s.Browser,d=s.Server,p=s.Native,g=!!(typeof window<"u"&&window.document&&window.document.createElement),y=typeof navigator<"u"&&navigator.product=="ReactNative",T=y?p:g?c:d,R={isBrowser:T===c,isServer:T===d,isNative:T===p,device:T,canUseWorkers:typeof Worker<"u",canUseEventListeners:T===c&&!!window.addEventListener,canUseViewport:T===c&&!!window.screen},N=function(){for(var J=[],Y=0;Y<arguments.length;Y++)J[Y]=arguments[Y];return J.reduce(function(te,Z){return r(r({},te),Z)},{})},D=function(J){return Object.keys(J).map(function(Y){return J[Y]})},B=function(){return N((D(R),R))},q=B();n.weAreServer=function(){R.isServer=!0,q=B()},n.useSSR=function(){return q},n.default=n.useSSR})(B6);(function(n){var r=ro&&ro.__assign||function(){return r=Object.assign||function(T){for(var R,N=1,D=arguments.length;N<D;N++){R=arguments[N];for(var B in R)Object.prototype.hasOwnProperty.call(R,B)&&(T[B]=R[B])}return T},r.apply(this,arguments)},s=ro&&ro.__rest||function(T,R){var N={};for(var D in T)Object.prototype.hasOwnProperty.call(T,D)&&R.indexOf(D)<0&&(N[D]=T[D]);if(T!=null&&typeof Object.getOwnPropertySymbols=="function")for(var B=0,D=Object.getOwnPropertySymbols(T);B<D.length;B++)R.indexOf(D[B])<0&&Object.prototype.propertyIsEnumerable.call(T,D[B])&&(N[D[B]]=T[D[B]]);return N},c=ro&&ro.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(n,"__esModule",{value:!0});var d=le,p=hN,g=c(B6);n.errorMessage1="You must either add a `ref` to the element you are interacting with or pass an `event` to openPortal(e) or togglePortal(e) when the `programmaticallyOpen` option is not set to `true`.";function y(T){T===void 0&&(T={});var R=T.closeOnOutsideClick,N=R===void 0?!0:R,D=T.closeOnEsc,B=D===void 0?!0:D,q=T.bindTo,J=T.isOpen,Y=J===void 0?!1:J,te=T.onOpen,Z=T.onClose,ee=T.onPortalClick,re=T.programmaticallyOpen,pe=re===void 0?!1:re,ve=s(T,["closeOnOutsideClick","closeOnEsc","bindTo","isOpen","onOpen","onClose","onPortalClick","programmaticallyOpen"]),Oe=g.default(),Se=Oe.isServer,je=Oe.isBrowser,ot=d.useState(Y),Qe=ot[0],st=ot[1],ut=d.useRef(Qe),Ni=d.useCallback(function(vt){ut.current=vt,st(vt)},[]),gt=d.useRef(),At=d.useRef(je?document.createElement("div"):null);d.useEffect(function(){je&&!At.current&&(At.current=document.createElement("div"))},[je,At]);var yt=d.useMemo(function(){if(!Se)return q&&p.findDOMNode(q)||document.body},[Se,q]),Lt=function(vt){if(!vt)return{portal:At,targetEl:gt,event:vt};var Jt=vt||{};Jt.persist&&Jt.persist(),Jt.portal=At,Jt.targetEl=gt,Jt.event=vt;var zi=vt.currentTarget;return!gt.current&&zi&&zi!==document&&(gt.current=Jt.currentTarget),Jt},Ue=Object.entries(ve).reduce(function(vt,Jt){var zi=Jt[0],bi=Jt[1];return vt[zi]=function(gn){Se||bi(Lt(gn))},vt},{}),Je=d.useCallback(function(vt){if(!Se){var Jt=Lt(vt);if(gt.current==null&&!pe)throw setTimeout(function(){return Ni(!0)},0),Error(n.errorMessage1);te&&te(Jt),Ni(!0)}},[Se,At,Ni,gt,te]),Ie=d.useCallback(function(vt){if(!Se){var Jt=Lt(vt);Z&&ut.current&&Z(Jt),ut.current&&Ni(!1)}},[Se,Z,Ni]),pt=d.useCallback(function(vt){return ut.current?Ie(vt):Je(vt)},[Ie,Je]),St=d.useCallback(function(vt){return vt.key==="Escape"&&B?Ie(vt):void 0},[B,Ie]),yi=d.useCallback(function(vt){var Jt=function(zi){return zi.current.contains(vt.target)};Jt(At)||vt.button!==0||!ut.current||gt.current&&Jt(gt)||N&&Ie(vt)},[Se,Ie,N,At]),Ot=d.useCallback(function(vt){if(!(Se||!(At.current instanceof HTMLElement))){var Jt=Lt(vt);At.current.contains(Jt.target)&&ee&&ee(Jt),yi(vt)}},[yi]),ge=d.useRef({});d.useEffect(function(){if(!Se&&!(!(yt instanceof HTMLElement)||!(At.current instanceof HTMLElement))){var vt={onScroll:"scroll",onWheel:"wheel"},Jt=At.current;return yt.appendChild(At.current),Object.entries(vt).forEach(function(zi){var bi=zi[0],gn=zi[1];ve[bi]&&(ge.current[bi]=function(Tn){return ve[bi](Lt(Tn))},document.addEventListener(gn,ge.current[bi]))}),document.addEventListener("keydown",St),document.addEventListener("mousedown",Ot),function(){Object.entries(vt).forEach(function(zi){var bi=zi[0],gn=zi[1];ve[bi]&&(document.removeEventListener(gn,ge.current[bi]),delete ge.current[bi])}),document.removeEventListener("keydown",St),document.removeEventListener("mousedown",Ot),yt.removeChild(Jt)}}},[Se,yi,St,yt,At]);var lt=d.useCallback(function(vt){var Jt=vt.children;return At.current!=null?p.createPortal(Jt,At.current):null},[At]);return Object.assign([Je,Ie,ut.current,lt,pt,gt,At],r(r({isOpen:ut.current,openPortal:Je,ref:gt,closePortal:Ie,togglePortal:pt,Portal:lt,portalRef:At},Ue),{bind:r({ref:gt},Ue)}))}n.default=y})(F6);const Xae=Vv(F6),Kv=({close:n,children:r})=>{const{Portal:s}=Xae();return O.jsx(s,{children:O.jsxs(Jae,{children:[O.jsx(Zae,{onClick:n}),r]})})},Jae=be.div`
  position: fixed;
  inset: 0;
  z-index: 1002;
  display: flex;
  align-items: center;
  justify-content: center;
  isolation: isolate;
  animation: appearModal .5s;

  @keyframes appearModal {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`,Zae=be.div`
  position: fixed;
  inset: 0;
  width: 100%;
  background-color: ${de.primary500opacity};
  z-index: -1;
`,Qae=({color:n,inclinacion:r,children:s,onClick:c,active:d,size:p=160,padding:g=60})=>O.jsx(ece,{size:p,padding:g,children:d?O.jsx(Kv,{close:c,children:O.jsxs(f4,{className:d?"active":"",bg:n,inclinacion:r,onClick:c,children:[O.jsx("img",{className:"alfiler",src:p4}),s]})}):O.jsxs(f4,{onClick:c,bg:n,inclinacion:r,children:[O.jsx("img",{className:"alfiler",src:p4}),s]})}),ece=be.div`
  min-width: ${n=>n.size}px;
  min-height: ${n=>n.size}px;
  max-width: ${n=>n.size}px;
  max-height: ${n=>n.size}px;
  width: ${n=>n.size}px;
  height: ${n=>n.size}px;
  margin: 0 ${n=>n.padding}px;

  @media screen and (max-width: 600px) {
    margin: 0 30px;
  }
`,f4=be.div`
  width: 100%;
  height: 100%;
  background-color: ${n=>n.bg};
  transform: rotate(${n=>n.inclinacion}deg);
  transition: all 0.3s;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 5px 6px 5px -4px rgba(0,0,0,0.5);
  position: relative;

  & > .alfiler {
    position: absolute;
    top: -10px;
    width: 25px;
    transform: rotate(-25deg);
  }

  &:hover {
    scale: 1.2;
  }

  &.active {
    width: 500px;
    height: 500px;
    transform: rotate(0);
    animation: grow .5s;
    transition: none;

    & > .alfiler {
      width: 50px;
      top: -30px;
    }

    &:hover {
      scale: 1;
    }

    @keyframes grow {
      from {
        scale: .4;
      }
      to {
        scale: 1;
      }
    }
  }
`,tce="/assets/publiciteAqui-20a1e3ac.png",m4=({value:n,onClick:r,active:s,size:c=160,padding:d=60})=>O.jsx(Qae,{onClick:r,active:s,color:n.color,inclinacion:n.inclinacion,size:c,padding:d,children:Object.keys(n).length===3?O.jsx(g4,{src:tce}):s?O.jsx(qae,{value:n}):O.jsx(g4,{src:`/logo/${n.codigo_pais}${n.id}`})}),g4=be.img`
  max-width: 80%;
  max-height: 80%;
  object-fit: cover;
`;be.p`
  color: ${de.primary400};
  font-weight: 600;
  font-size: 16px;
  width: 100%;
  white-space: pre-wrap;
  text-align: center;
  user-select: none;
`;const ice=(n,r)=>(n=Math.ceil(n),r=Math.floor(r),Math.floor(Math.random()*(r-n)+n)),_4=n=>{let r;const s=new Set,c=(N,D)=>{const B=typeof N=="function"?N(r):N;if(!Object.is(B,r)){const q=r;r=D??(typeof B!="object"||B===null)?B:Object.assign({},r,B),s.forEach(J=>J(r,q))}},d=()=>r,T={setState:c,getState:d,getInitialState:()=>R,subscribe:N=>(s.add(N),()=>s.delete(N)),destroy:()=>{s.clear()}},R=r=n(c,d,T);return T},nce=n=>n?_4(n):_4;var W6={exports:{}},z6={},H6={exports:{}},G6={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dg=le;function rce(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var oce=typeof Object.is=="function"?Object.is:rce,sce=Dg.useState,ace=Dg.useEffect,cce=Dg.useLayoutEffect,lce=Dg.useDebugValue;function dce(n,r){var s=r(),c=sce({inst:{value:s,getSnapshot:r}}),d=c[0].inst,p=c[1];return cce(function(){d.value=s,d.getSnapshot=r,VA(d)&&p({inst:d})},[n,s,r]),ace(function(){return VA(d)&&p({inst:d}),n(function(){VA(d)&&p({inst:d})})},[n]),lce(s),s}function VA(n){var r=n.getSnapshot;n=n.value;try{var s=r();return!oce(n,s)}catch{return!0}}function uce(n,r){return r()}var hce=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?uce:dce;G6.useSyncExternalStore=Dg.useSyncExternalStore!==void 0?Dg.useSyncExternalStore:hce;H6.exports=G6;var pce=H6.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kw=le,fce=pce;function mce(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var gce=typeof Object.is=="function"?Object.is:mce,_ce=fce.useSyncExternalStore,Ece=kw.useRef,vce=kw.useEffect,yce=kw.useMemo,Sce=kw.useDebugValue;z6.useSyncExternalStoreWithSelector=function(n,r,s,c,d){var p=Ece(null);if(p.current===null){var g={hasValue:!1,value:null};p.current=g}else g=p.current;p=yce(function(){function T(q){if(!R){if(R=!0,N=q,q=c(q),d!==void 0&&g.hasValue){var J=g.value;if(d(J,q))return D=J}return D=q}if(J=D,gce(N,q))return J;var Y=c(q);return d!==void 0&&d(J,Y)?J:(N=q,D=Y)}var R=!1,N,D,B=s===void 0?null:s;return[function(){return T(r())},B===null?void 0:function(){return T(B())}]},[r,s,c,d]);var y=_ce(n,p[0],p[1]);return vce(function(){g.hasValue=!0,g.value=y},[y]),Sce(y),y};W6.exports=z6;var Tce=W6.exports;const wce=Vv(Tce),{useDebugValue:Cce}=oo,{useSyncExternalStoreWithSelector:bce}=wce;const Rce=n=>n;function Ice(n,r=Rce,s){const c=bce(n.subscribe,n.getState,n.getServerState||n.getInitialState,r,s);return Cce(c),c}const E4=n=>{const r=typeof n=="function"?nce(n):n,s=(c,d)=>Ice(r,c,d);return Object.assign(s,r),s},TN=n=>n?E4(n):E4,Lw=TN(n=>({publicidadGeneral:null,publicidadEspecifica:null,setPublicidadGeneral:r=>n(s=>({...s,publicidadGeneral:r})),setPublicidadEspecifica:r=>n(s=>({...s,publicidadEspecifica:r}))})),K6=({size:n,padding:r,tipo:s="G"})=>{const{publicidadGeneral:c,publicidadEspecifica:d}=Lw(),p=s==="G"?c:d,g=le.useCallback(()=>{const D=p.length%5;if(D>0)for(let B=0;B<5-D;B++)p.push(null);return p.map((B,q)=>({...B,inclinacion:ice(-6,7),color:de[`pastel${q%5+1}`],img:Kae}))},[]),[y]=le.useState(g()),[T,R]=le.useState(null),N=D=>{R(T===D?null:D)};return O.jsxs(Ace,{active:T!==null,width:y.length*360,speed:y.length*6,children:[O.jsx("div",{id:"sponsors-animation",children:y.map((D,B)=>O.jsx(m4,{onClick:()=>N(B),active:T===B,value:D,size:n,padding:r},B))}),O.jsx("div",{children:y.map((D,B)=>O.jsx(m4,{onClick:()=>N(y.length+B),active:T===y.length+B,value:D,size:n,padding:r},y.length+B))})]})},Ace=be.div`
  width: 100%;
  overflow: hidden;
  padding: 32px 0;
  display: flex;

  & > div {
    display: flex;
    align-items: center;
    white-space: nowrap;
    align-items: center;
    animation: movefooter ${n=>n.speed}s linear infinite;
    animation-play-state: ${n=>n.active?"paused":""};
    
    @keyframes movefooter {
      from {
        transform: translateX(0);
      }
      to {
        transform: translateX(-100%);
      }
    }
  }
`,q6="/assets/logotext-white-faaea8ae.png",Oce=()=>O.jsx("p",{children:"Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quo a culpa distinctio sapiente, nihil dignissimos consequatur modi perferendis facere officia inventore asperiores adipisci ipsum mollitia unde pariatur quis quae. Fugit, nemo obcaecati quae architecto nostrum aliquid quis officiis laudantium quidem facere velit hic animi suscipit facilis perspiciatis, perferendis aspernatur provident porro optio accusantium alias, dicta amet saepe. Ipsa qui sed porro asperiores hic adipisci similique voluptas consequatur a. Quaerat quo, soluta tempora, similique, animi accusantium autem voluptatibus aliquid asperiores rem provident exercitationem est consequuntur facilis ad quas doloribus suscipit magni? Quidem inventore iste assumenda recusandae quisquam animi porro vel a repellendus, provident cupiditate repellat quo magni unde expedita amet aut dolor sapiente, libero vero soluta eaque id odio? At sed et accusantium distinctio hic soluta corporis eos aliquid maiores laborum necessitatibus ratione culpa quod, ad nihil nobis odio delectus consectetur? Iure ipsum deleniti earum numquam fugiat quas commodi, incidunt nostrum repellendus est sapiente quos veniam accusamus et ut minus maxime. Ipsam est molestiae a quos eveniet velit odit accusamus vero quod officia in perferendis, perspiciatis repellat eius reprehenderit dignissimos fuga atque. Fugiat optio saepe distinctio! Ea numquam voluptatibus sunt molestiae, ipsam saepe sint soluta repellendus eveniet maxime consectetur unde deleniti?"}),Pce=()=>O.jsx("p",{children:"Lorem ipsum dolor sit amet consectetur adipisicing elit. Vitae distinctio odio consequatur ad necessitatibus cupiditate debitis eos nihil, at delectus facilis laudantium. Dignissimos est quidem voluptate. Quod consectetur facilis aliquid et quibusdam quasi vero unde repellat nemo eius sunt minus quis repudiandae, tempore soluta voluptate architecto asperiores laudantium, eaque placeat qui reprehenderit libero aperiam. Facere voluptas, minus porro expedita similique laboriosam quibusdam, consequuntur, deserunt et ipsam aperiam necessitatibus mollitia. Labore explicabo quas voluptatum nam totam quos id, amet nisi laudantium, repellat, harum dolore aspernatur ipsam illum sed in? Autem libero, impedit perferendis ipsum dolores placeat quo consequuntur nemo molestiae blanditiis dignissimos dolorem doloribus asperiores veniam cupiditate. Deleniti id consectetur eveniet nobis iusto accusamus libero modi vitae quos nisi saepe porro omnis ipsa, dignissimos ratione quod voluptatum nihil fugit. Doloribus culpa aliquam repellendus veniam modi, laudantium fugit! Assumenda qui, nesciunt consectetur nisi velit facilis non veniam consequuntur, officia delectus unde quod."}),Nce=({close:n,tipo:r})=>O.jsx(Kv,{close:n,children:O.jsxs(xce,{children:[O.jsx("button",{onClick:n,children:O.jsx("i",{className:"fa-solid fa-xmark"})}),O.jsx("h3",{children:r==="politicas"?"Polticas de privacidad":"Trminos y condiciones"}),O.jsx(Dce,{id:"info",children:r==="politicas"?O.jsx(Oce,{}):O.jsx(Pce,{})})]})}),xce=be.div`
  width: 800px;
  max-height: 500px;
  background-color: ${de.primary300};
  padding: 40px 40px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: center;
  position: relative;
  
  & > h3 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
    line-height: 32px;

    @media screen and (max-width: 560px) {
      font-size: 1.4rem;
    }
  }

  & > button {
    position: absolute;
    right: 45px;
    top: 45px;
    border: none;
    background-color: transparent;
    color: ${de.primary500};
    font-size: 1.2rem;
    cursor: pointer;
    transition: scale 0.3s;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    align-self: flex-start;

    &:hover {
      scale: 1.2;
    }

    @media screen and (max-width: 500px) {
      right: 20px;
    }
  }

  @media screen and (max-width: 820px) {
    width: 100%;
  }
  @media screen and (max-width: 500px) {
    padding: 40px 20px;
  }
`,Dce=be.div`
  border: 2px solid ${de.primary500};
  background-color: ${de.primary200};
  padding: 40px;
  display: flex;
  flex-direction: column;
  overflow: auto;
  gap: 20px;
  
  & > b {
    font-size: 1.2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }

  & > p {
    opacity: 0.8;
    line-height: 28px;
  }
`,kce=()=>{const[n,r]=le.useState(null);return O.jsxs(Lce,{children:[O.jsx("small",{children:" Copyright Doctor Tomatto 2021 - 2023. Todos los derechos reservados."}),n&&O.jsx(Nce,{close:()=>r(!1),tipo:n}),O.jsxs("small",{children:[O.jsx("button",{onClick:()=>r("terminos"),children:"Trminos y condiciones"})," | ",O.jsx("button",{onClick:()=>r("politicas"),children:"Polticas de privacidad"})]})]})},Lce=be.div`
  padding: 20px;
  text-align: center;
  display: flex;
  justify-content: space-around;
  width: 100%;
  flex-wrap: wrap;
  gap: 20px;

  & button {
    background-color: transparent;
    color: ${de.white};
    border: none;
    cursor: pointer;
    transition: all 0.3s;
  }
  & button:hover {
    opacity: 0.7;
  }
`,Mce=()=>{const n=Ua(),{publicidadGeneral:r}=Lw();return O.jsxs(Uce,{children:[O.jsxs(jce,{children:[O.jsxs("h2",{children:["Tenemos la ",O.jsx("span",{children:"solucin"})," para su ",O.jsx("span",{children:"cultivo"})]}),r&&O.jsx(K6,{})]}),O.jsxs(Vce,{children:[O.jsx("div",{children:O.jsx("img",{src:q6})}),O.jsx("div",{children:O.jsxs("div",{children:[O.jsx("p",{children:"Av. Villarroel"}),O.jsx("p",{children:"Cochabamba, Bolivia"}),O.jsx("p",{children:"info@tecnopolis.ai"}),O.jsx("p",{children:"+59172244087"})]})}),O.jsx("div",{children:O.jsx("div",{className:"util-links",children:O.jsxs("div",{children:[O.jsx("div",{children:O.jsxs(LE,{onClick:()=>n("/"),children:[O.jsx("i",{className:"fa-solid fa-chevron-right"}),"Inicio"]})}),O.jsx("div",{children:O.jsxs(LE,{onClick:()=>n("/analizar"),children:[O.jsx("i",{className:"fa-solid fa-chevron-right"}),"Analizar Imagen"]})}),O.jsx("div",{children:O.jsxs(LE,{onClick:()=>n("/mapa"),children:[O.jsx("i",{className:"fa-solid fa-chevron-right"}),"Mapa Enfermedades"]})}),O.jsx("div",{children:O.jsxs(LE,{onClick:()=>n("/objetivo"),children:[O.jsx("i",{className:"fa-solid fa-chevron-right"}),"Objetivo"]})}),O.jsx("div",{children:O.jsxs(LE,{onClick:()=>n("/blog"),children:[O.jsx("i",{className:"fa-solid fa-chevron-right"}),"Blog"]})})]})})}),O.jsxs("div",{children:[O.jsx(Gi,{type:"secondary",onClick:()=>n("/contacto"),children:"Entre en contacto!"}),O.jsx("div",{children:O.jsxs(Fce,{children:[O.jsx("a",{children:O.jsx("i",{className:"fa-brands fa-linkedin"})}),O.jsx("a",{children:O.jsx("i",{className:"fa-brands fa-instagram"})})]})})]})]}),O.jsx(kce,{})]})},Uce=be.footer`
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  background-color: ${de.primary600};
  color: ${de.white};
  position: relative;
  z-index: 5;
`,jce=be.div`
  width: 80%;
  display: flex;
  justify-content: center;
  flex-direction: column;
  align-items: center;
  padding: 10px 0;
  background-color: ${de.primary200};
  margin-bottom: 40px;
  margin-top: 40px;
  position: relative;
  isolation: isolate;

  @media screen and (max-width: 600px) {
    width: 100%;
  }

  & > h2 {
    font-weight: 600;
    font-family: 'Chillax';
    line-height: 32px;
    color: ${de.primary400};
    text-align: center;

    & > span {
      color: ${de.primary500};
    }
  }

  @media screen and (max-width: 790px) {
    flex-direction: column;
    gap: 20px;
    padding: 20px 40px;
  }
`,Vce=be.div`
  display: flex;
  justify-content: space-evenly;
  width: 100%;
  padding: 0 40px 40px;
  gap: 80px;
  border-bottom: 1px solid ${de.white};
  flex-wrap: wrap;

  @media screen and (max-width: 1460px) {
    gap: 20px;
  }

  @media screen and (max-width: 1460px) {
    gap: 40px;
  }

  & > div {
    display: flex;
    flex: 1;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    min-width: 250px;

    @media screen and (max-width: 500px) {
      width: 100%;
    }

    & img {
      width: 200px;
      height: 200px;
      object-fit: cover;
    }

    & > h4 {
      text-align: center;
    }

    & > div {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    & p, a {
      font-size: .8rem;
      line-height: 28px;
      text-align: justify;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    & a {
      width: max-content;
      cursor: pointer;
    }

    & a:hover {
      opacity: 0.7;
    }

    & .util-links {
      flex-direction: row;
      gap: 40px;

      & > div {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
    }
  }
`,LE=be.button`
  font-size: .8rem;
  line-height: 28px;
  text-align: justify;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 10px;
  color: ${de.white};
  text-decoration: none;
  background-color: transparent;
  border: none;
  cursor: pointer;
  white-space: nowrap;

  &:hover {
    opacity: 0.7;
  }
`,Fce=be.div`
  display: flex;
  gap: 10px;

  & i {
    font-size: 32px;
    cursor: pointer;
    transition: all 0.3s;

    &:hover {
      opacity: 0.7;
    }
  }
`,wN="/assets/logo-b7a98226.png",Bce="/assets/text-white-30e1c0df.png",Wce="/assets/text-green-34eaa105.png",qv=TN(n=>({color:de.primary500,changeColor:r=>n(s=>({...s,color:r}))})),$s=TN(n=>{const r=localStorage.getItem("tomattouser");return{user:r?JSON.parse(r):null,actualCity:null,actualCoords:null,setUser:s=>{localStorage.setItem("tomattouser",JSON.stringify(s)),n(c=>({...c,user:s}))},setActualCity:s=>{n(c=>({...c,actualCity:s}))},setActualCoords:s=>{n(c=>({...c,actualCoords:s}))}}}),zce=()=>{const{color:n}=qv(),[r,s]=le.useState(!1),{pathname:c}=uh(),{user:d}=$s();return le.useEffect(()=>{window.scrollTo(0,0),s(!1)},[c]),O.jsx(Gce,{children:O.jsxs(Kce,{bg:n,children:[O.jsx(Hce,{bg:n}),O.jsxs(qce,{to:"/",children:[O.jsx(Yce,{src:wN}),O.jsx($ce,{src:n===de.primary500?Bce:Wce})]}),O.jsxs(Xce,{bg:n,open:r,children:[O.jsx("li",{children:O.jsx($m,{to:"/",children:"Inicio"})}),O.jsx("li",{children:O.jsx($m,{to:"/analizar",children:"Analizar Imagen"})}),O.jsx("li",{children:O.jsx($m,{to:"/mapa",children:"Mapa Enfermedades"})}),O.jsx("li",{children:O.jsx($m,{to:"/objetivo",children:"Objetivo"})}),O.jsx("li",{children:O.jsx($m,{to:"/blog",children:"Blog"})}),O.jsx("li",{children:O.jsx($m,{to:"/contacto",children:"Contacto"})})]}),O.jsxs(Jce,{children:[d&&O.jsx(v4,{to:"/cart",className:"fa-solid fa-cart-shopping"}),O.jsx(v4,{className:"fa-regular fa-user",to:"/login"}),O.jsx(Zce,{onClick:()=>s(!r),children:r?O.jsx("i",{className:"fa-solid fa-xmark"}):O.jsx("i",{className:"fa-solid fa-bars"})})]})]})})},Hce=zae`
  body {
    background-color: ${n=>n.bg};
    transition: background-color 0.3s;
  }
`,Gce=be.nav`
  position: relative;
`,Kce=be.div`
  width: 100%;
  position: fixed;
  top: 0;
  z-index: 1001;
  display: flex;
  flex-direction: row;
  height: 85px;
  justify-content: space-between;
  padding: 10px 140px;
  align-items: center;
  background-color: ${n=>n.bg};
  transition: all 0.3s;
  gap: 20px;

  & * {
    color: ${n=>n.bg===de.primary500?de.white:de.primary500};

    &::after {
      background-color: ${n=>n.bg===de.primary500?de.white:de.primary500};
    }
  }

  @media screen and (max-width: 1640px) {
    padding: 10px 40px;
  }
`,qce=be(Qp)`
  height: 100%;
  display: flex;
  align-items: center;
  gap: 15px;
  cursor: pointer;
  text-decoration: none;
`,Yce=be.img`
  height: 100%;
`,$ce=be.img`
  transition: all 0.3s;
  width: 160px;

  @media screen and (max-width: 530px) {
    width: 100px;
  }
  @media screen and (max-width: 460px) {
    display: none;
  }
`,Xce=be.ul`
  display: flex;
  flex-direction: row;
  list-style: none;
  gap: 40px;
  background-color: ${n=>n.bg};
  transition: background-color 0.3s;

  @media screen and (max-width: 1260px) {
    opacity: ${n=>n.open?"1":"0"};
    pointer-events: ${n=>!n.open&&"none"};
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    justify-content: center;
    padding: 0 40px 20px;
    flex-wrap: wrap;
    transition: all 0.3s;
  }
`,$m=be(Vse)`
  cursor: pointer;
  font-family: 'DM Sans';
  transition: all 0.3s;
  text-decoration: none;
  position: relative;
  white-space: nowrap;

  &::after {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    content: "";
    height: 1px;
    scale: 0;
    transform-origin: right;
    transition: scale .5s;
  }

  &.active::after, &:hover::after {
    scale: 1;
    transform-origin: left;
  }

  &:hover {
    opacity: 0.7;
  }
`,Jce=be.div`
  display: flex;
  gap: 18px;
  align-items: center;
`,v4=be(Qp)`
  height: 20px;
  width: 20px;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  text-decoration: none;

  &:hover {
    opacity: 0.7;
  }
`,Zce=be.button`
  background-color: transparent;
  border: none;
  height: 20px;
  width: 20px;
  font-size: 20px;
  margin-left: 20px;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
  display: none;

  &:hover {
    opacity: 0.7;
  }

  @media screen and (max-width: 1260px) {
    display: flex;
  }
`,Xo=n=>{const{changeColor:r}=qv();le.useEffect(()=>{r(n)},[])},CN="tomatto_jwt_auth",Qce=n=>{document.cookie=`${CN}=${JSON.stringify(n)}; path=/; samesite=strict`},Y6=()=>{const n=ele(CN);return n?JSON.parse(n):null},bN=()=>{document.cookie=`${CN}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`};function ele(n){let r=n+"=",s=document.cookie.split(";");for(let c=0;c<s.length;c++){let d=s[c];for(;d.charAt(0)==" ";)d=d.substring(1);if(d.indexOf(r)==0)return d.substring(r.length,d.length)}return""}var $6={exports:{}};/*!
* sweetalert2 v11.12.4
* Released under the MIT License.
*/(function(n,r){(function(s,c){n.exports=c()})(ro,function(){function s(K,A){(A==null||A>K.length)&&(A=K.length);for(var j=0,G=Array(A);j<A;j++)G[j]=K[j];return G}function c(K){if(Array.isArray(K))return K}function d(K){if(Array.isArray(K))return s(K)}function p(K,A,j){if(typeof K=="function"?K===A:K.has(A))return arguments.length<3?A:j;throw new TypeError("Private element is not present on this object")}function g(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}function y(K,A,j){return A=ee(A),ot(K,pe()?Reflect.construct(A,j||[],ee(K).constructor):A.apply(K,j))}function T(K,A){if(A.has(K))throw new TypeError("Cannot initialize the same private elements twice on an object")}function R(K,A){if(!(K instanceof A))throw new TypeError("Cannot call a class as a function")}function N(K,A){return K.get(p(K,A))}function D(K,A,j){T(K,A),A.set(K,j)}function B(K,A,j){return K.set(p(K,A),j),j}function q(K,A,j){if(pe())return Reflect.construct.apply(null,arguments);var G=[null];G.push.apply(G,A);var ce=new(K.bind.apply(K,G));return ce}function J(K,A){for(var j=0;j<A.length;j++){var G=A[j];G.enumerable=G.enumerable||!1,G.configurable=!0,"value"in G&&(G.writable=!0),Object.defineProperty(K,yt(G.key),G)}}function Y(K,A,j){return A&&J(K.prototype,A),Object.defineProperty(K,"prototype",{writable:!1}),K}function te(K,A){var j=typeof Symbol<"u"&&K[Symbol.iterator]||K["@@iterator"];if(!j){if(Array.isArray(K)||(j=Ue(K))||A){j&&(K=j);var G=0,ce=function(){};return{s:ce,n:function(){return G>=K.length?{done:!0}:{done:!1,value:K[G++]}},e:function(Yt){throw Yt},f:ce}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Pe,tt=!0,Ht=!1;return{s:function(){j=j.call(K)},n:function(){var Yt=j.next();return tt=Yt.done,Yt},e:function(Yt){Ht=!0,Pe=Yt},f:function(){try{tt||j.return==null||j.return()}finally{if(Ht)throw Pe}}}}function Z(){return Z=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(K,A,j){var G=ut(K,A);if(G){var ce=Object.getOwnPropertyDescriptor(G,A);return ce.get?ce.get.call(arguments.length<3?K:j):ce.value}},Z.apply(null,arguments)}function ee(K){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(A){return A.__proto__||Object.getPrototypeOf(A)},ee(K)}function re(K,A){if(typeof A!="function"&&A!==null)throw new TypeError("Super expression must either be null or a function");K.prototype=Object.create(A&&A.prototype,{constructor:{value:K,writable:!0,configurable:!0}}),Object.defineProperty(K,"prototype",{writable:!1}),A&&Qe(K,A)}function pe(){try{var K=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pe=function(){return!!K})()}function ve(K){if(typeof Symbol<"u"&&K[Symbol.iterator]!=null||K["@@iterator"]!=null)return Array.from(K)}function Oe(K,A){var j=K==null?null:typeof Symbol<"u"&&K[Symbol.iterator]||K["@@iterator"];if(j!=null){var G,ce,Pe,tt,Ht=[],Yt=!0,Un=!1;try{if(Pe=(j=j.call(K)).next,A!==0)for(;!(Yt=(G=Pe.call(j)).done)&&(Ht.push(G.value),Ht.length!==A);Yt=!0);}catch($h){Un=!0,ce=$h}finally{try{if(!Yt&&j.return!=null&&(tt=j.return(),Object(tt)!==tt))return}finally{if(Un)throw ce}}return Ht}}function Se(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function je(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ot(K,A){if(A&&(typeof A=="object"||typeof A=="function"))return A;if(A!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(K)}function Qe(K,A){return Qe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(j,G){return j.__proto__=G,j},Qe(K,A)}function st(K,A){return c(K)||Oe(K,A)||Ue(K,A)||Se()}function ut(K,A){for(;!{}.hasOwnProperty.call(K,A)&&(K=ee(K))!==null;);return K}function Ni(K,A,j,G){var ce=Z(ee(K.prototype),A,j);return function(Pe){return ce.apply(j,Pe)}}function gt(K){return d(K)||ve(K)||Ue(K)||je()}function At(K,A){if(typeof K!="object"||!K)return K;var j=K[Symbol.toPrimitive];if(j!==void 0){var G=j.call(K,A);if(typeof G!="object")return G;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(K)}function yt(K){var A=At(K,"string");return typeof A=="symbol"?A:A+""}function Lt(K){"@babel/helpers - typeof";return Lt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},Lt(K)}function Ue(K,A){if(K){if(typeof K=="string")return s(K,A);var j={}.toString.call(K).slice(8,-1);return j==="Object"&&K.constructor&&(j=K.constructor.name),j==="Map"||j==="Set"?Array.from(K):j==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(j)?s(K,A):void 0}}var Je=100,Ie={},pt=function(){Ie.previousActiveElement instanceof HTMLElement?(Ie.previousActiveElement.focus(),Ie.previousActiveElement=null):document.body&&document.body.focus()},St=function(A){return new Promise(function(j){if(!A)return j();var G=window.scrollX,ce=window.scrollY;Ie.restoreFocusTimeout=setTimeout(function(){pt(),j()},Je),window.scrollTo(G,ce)})},yi="swal2-",Ot=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"],ge=Ot.reduce(function(K,A){return K[A]=yi+A,K},{}),lt=["success","warning","info","question","error"],vt=lt.reduce(function(K,A){return K[A]=yi+A,K},{}),Jt="SweetAlert2:",zi=function(A){return A.charAt(0).toUpperCase()+A.slice(1)},bi=function(A){console.warn("".concat(Jt," ").concat(Lt(A)==="object"?A.join(" "):A))},gn=function(A){console.error("".concat(Jt," ").concat(A))},Tn=[],ph=function(A){Tn.includes(A)||(Tn.push(A),bi(A))},hf=function(A){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;ph('"'.concat(A,'" is deprecated and will be removed in the next major release.').concat(j?' Use "'.concat(j,'" instead.'):""))},Jo=function(A){return typeof A=="function"?A():A},Cd=function(A){return A&&typeof A.toPromise=="function"},Va=function(A){return Cd(A)?A.toPromise():Promise.resolve(A)},qr=function(A){return A&&Promise.resolve(A)===A},Cr=function(){return document.body.querySelector(".".concat(ge.container))},Ic=function(A){var j=Cr();return j?j.querySelector(A):null},Fi=function(A){return Ic(".".concat(A))},Zt=function(){return Fi(ge.popup)},Xs=function(){return Fi(ge.icon)},fh=function(){return Fi(ge["icon-content"])},pf=function(){return Fi(ge.title)},Ac=function(){return Fi(ge["html-container"])},lr=function(){return Fi(ge.image)},Zo=function(){return Fi(ge["progress-steps"])},wl=function(){return Fi(ge["validation-message"])},Yr=function(){return Ic(".".concat(ge.actions," .").concat(ge.confirm))},Js=function(){return Ic(".".concat(ge.actions," .").concat(ge.cancel))},Zs=function(){return Ic(".".concat(ge.actions," .").concat(ge.deny))},mh=function(){return Fi(ge["input-label"])},Rs=function(){return Ic(".".concat(ge.loader))},lo=function(){return Fi(ge.actions)},gh=function(){return Fi(ge.footer)},Qs=function(){return Fi(ge["timer-progress-bar"])},_h=function(){return Fi(ge.close)},Oc=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Cl=function(){var A=Zt();if(!A)return[];var j=A.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),G=Array.from(j).sort(function(tt,Ht){var Yt=parseInt(tt.getAttribute("tabindex")||"0"),Un=parseInt(Ht.getAttribute("tabindex")||"0");return Yt>Un?1:Yt<Un?-1:0}),ce=A.querySelectorAll(Oc),Pe=Array.from(ce).filter(function(tt){return tt.getAttribute("tabindex")!=="-1"});return gt(new Set(G.concat(Pe))).filter(function(tt){return dr(tt)})},bd=function(){return Xr(document.body,ge.shown)&&!Xr(document.body,ge["toast-shown"])&&!Xr(document.body,ge["no-backdrop"])},bl=function(){var A=Zt();return A?Xr(A,ge.toast):!1},zg=function(){var A=Zt();return A?A.hasAttribute("data-loading"):!1},$r=function(A,j){if(A.textContent="",j){var G=new DOMParser,ce=G.parseFromString(j,"text/html"),Pe=ce.querySelector("head");Pe&&Array.from(Pe.childNodes).forEach(function(Ht){A.appendChild(Ht)});var tt=ce.querySelector("body");tt&&Array.from(tt.childNodes).forEach(function(Ht){Ht instanceof HTMLVideoElement||Ht instanceof HTMLAudioElement?A.appendChild(Ht.cloneNode(!0)):A.appendChild(Ht)})}},Xr=function(A,j){if(!j)return!1;for(var G=j.split(/\s+/),ce=0;ce<G.length;ce++)if(!A.classList.contains(G[ce]))return!1;return!0},Hg=function(A,j){Array.from(A.classList).forEach(function(G){!Object.values(ge).includes(G)&&!Object.values(vt).includes(G)&&!Object.values(j.showClass||{}).includes(G)&&A.classList.remove(G)})},Zn=function(A,j,G){if(Hg(A,j),!!j.customClass){var ce=j.customClass[G];if(ce){if(typeof ce!="string"&&!ce.forEach){bi("Invalid type of customClass.".concat(G,'! Expected string or iterable object, got "').concat(Lt(ce),'"'));return}zt(A,ce)}}},Rd=function(A,j){if(!j)return null;switch(j){case"select":case"textarea":case"file":return A.querySelector(".".concat(ge.popup," > .").concat(ge[j]));case"checkbox":return A.querySelector(".".concat(ge.popup," > .").concat(ge.checkbox," input"));case"radio":return A.querySelector(".".concat(ge.popup," > .").concat(ge.radio," input:checked"))||A.querySelector(".".concat(ge.popup," > .").concat(ge.radio," input:first-child"));case"range":return A.querySelector(".".concat(ge.popup," > .").concat(ge.range," input"));default:return A.querySelector(".".concat(ge.popup," > .").concat(ge.input))}},Id=function(A){if(A.focus(),A.type!=="file"){var j=A.value;A.value="",A.value=j}},ff=function(A,j,G){!A||!j||(typeof j=="string"&&(j=j.split(/\s+/).filter(Boolean)),j.forEach(function(ce){Array.isArray(A)?A.forEach(function(Pe){G?Pe.classList.add(ce):Pe.classList.remove(ce)}):G?A.classList.add(ce):A.classList.remove(ce)}))},zt=function(A,j){ff(A,j,!0)},Qo=function(A,j){ff(A,j,!1)},ea=function(A,j){for(var G=Array.from(A.children),ce=0;ce<G.length;ce++){var Pe=G[ce];if(Pe instanceof HTMLElement&&Xr(Pe,j))return Pe}},Hn=function(A,j,G){G==="".concat(parseInt(G))&&(G=parseInt(G)),G||parseInt(G)===0?A.style.setProperty(j,typeof G=="number"?"".concat(G,"px"):G):A.style.removeProperty(j)},it=function(A){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";A&&(A.style.display=j)},Qn=function(A){A&&(A.style.display="none")},Rl=function(A){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"block";A&&new MutationObserver(function(){Fa(A,A.innerHTML,j)}).observe(A,{childList:!0,subtree:!0})},Eh=function(A,j,G,ce){var Pe=A.querySelector(j);Pe&&Pe.style.setProperty(G,ce)},Fa=function(A,j){var G=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";j?it(A,G):Qn(A)},dr=function(A){return!!(A&&(A.offsetWidth||A.offsetHeight||A.getClientRects().length))},mf=function(){return!dr(Yr())&&!dr(Zs())&&!dr(Js())},Ba=function(A){return A.scrollHeight>A.clientHeight},Ad=function(A){var j=window.getComputedStyle(A),G=parseFloat(j.getPropertyValue("animation-duration")||"0"),ce=parseFloat(j.getPropertyValue("transition-duration")||"0");return G>0||ce>0},Il=function(A){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,G=Qs();G&&dr(G)&&(j&&(G.style.transition="none",G.style.width="100%"),setTimeout(function(){G.style.transition="width ".concat(A/1e3,"s linear"),G.style.width="0%"},10))},gf=function(){var A=Qs();if(A){var j=parseInt(window.getComputedStyle(A).width);A.style.removeProperty("transition"),A.style.width="100%";var G=parseInt(window.getComputedStyle(A).width),ce=j/G*100;A.style.width="".concat(ce,"%")}},Wa=function(){return typeof window>"u"||typeof document>"u"},Gg=`
 <div aria-labelledby="`.concat(ge.title,'" aria-describedby="').concat(ge["html-container"],'" class="').concat(ge.popup,`" tabindex="-1">
   <button type="button" class="`).concat(ge.close,`"></button>
   <ul class="`).concat(ge["progress-steps"],`"></ul>
   <div class="`).concat(ge.icon,`"></div>
   <img class="`).concat(ge.image,`" />
   <h2 class="`).concat(ge.title,'" id="').concat(ge.title,`"></h2>
   <div class="`).concat(ge["html-container"],'" id="').concat(ge["html-container"],`"></div>
   <input class="`).concat(ge.input,'" id="').concat(ge.input,`" />
   <input type="file" class="`).concat(ge.file,`" />
   <div class="`).concat(ge.range,`">
     <input type="range" />
     <output></output>
   </div>
   <select class="`).concat(ge.select,'" id="').concat(ge.select,`"></select>
   <div class="`).concat(ge.radio,`"></div>
   <label class="`).concat(ge.checkbox,`">
     <input type="checkbox" id="`).concat(ge.checkbox,`" />
     <span class="`).concat(ge.label,`"></span>
   </label>
   <textarea class="`).concat(ge.textarea,'" id="').concat(ge.textarea,`"></textarea>
   <div class="`).concat(ge["validation-message"],'" id="').concat(ge["validation-message"],`"></div>
   <div class="`).concat(ge.actions,`">
     <div class="`).concat(ge.loader,`"></div>
     <button type="button" class="`).concat(ge.confirm,`"></button>
     <button type="button" class="`).concat(ge.deny,`"></button>
     <button type="button" class="`).concat(ge.cancel,`"></button>
   </div>
   <div class="`).concat(ge.footer,`"></div>
   <div class="`).concat(ge["timer-progress-bar-container"],`">
     <div class="`).concat(ge["timer-progress-bar"],`"></div>
   </div>
 </div>
`).replace(/(^|\n)\s*/g,""),_f=function(){var A=Cr();return A?(A.remove(),Qo([document.documentElement,document.body],[ge["no-backdrop"],ge["toast-shown"],ge["has-column"]]),!0):!1},mr=function(){Ie.currentInstance.resetValidationMessage()},Od=function(){var A=Zt(),j=ea(A,ge.input),G=ea(A,ge.file),ce=A.querySelector(".".concat(ge.range," input")),Pe=A.querySelector(".".concat(ge.range," output")),tt=ea(A,ge.select),Ht=A.querySelector(".".concat(ge.checkbox," input")),Yt=ea(A,ge.textarea);j.oninput=mr,G.onchange=mr,tt.onchange=mr,Ht.onchange=mr,Yt.oninput=mr,ce.oninput=function(){mr(),Pe.value=ce.value},ce.onchange=function(){mr(),Pe.value=ce.value}},Kg=function(A){return typeof A=="string"?document.querySelector(A):A},An=function(A){var j=Zt();j.setAttribute("role",A.toast?"alert":"dialog"),j.setAttribute("aria-live",A.toast?"polite":"assertive"),A.toast||j.setAttribute("aria-modal","true")},qg=function(A){window.getComputedStyle(A).direction==="rtl"&&zt(Cr(),ge.rtl)},Yg=function(A){var j=_f();if(Wa()){gn("SweetAlert2 requires document to initialize");return}var G=document.createElement("div");G.className=ge.container,j&&zt(G,ge["no-transition"]),$r(G,Gg);var ce=Kg(A.target);ce.appendChild(G),An(A),qg(ce),Od()},vh=function(A,j){A instanceof HTMLElement?j.appendChild(A):Lt(A)==="object"?yh(A,j):A&&$r(j,A)},yh=function(A,j){A.jquery?za(j,A):$r(j,A.toString())},za=function(A,j){if(A.textContent="",0 in j)for(var G=0;G in j;G++)A.appendChild(j[G].cloneNode(!0));else A.appendChild(j.cloneNode(!0))},ta=function(){if(Wa())return!1;var K=document.createElement("div");return typeof K.style.webkitAnimation<"u"?"webkitAnimationEnd":typeof K.style.animation<"u"?"animationend":!1}(),Sh=function(A,j){var G=lo(),ce=Rs();!G||!ce||(!j.showConfirmButton&&!j.showDenyButton&&!j.showCancelButton?Qn(G):it(G),Zn(G,j,"actions"),Al(G,ce,j),$r(ce,j.loaderHtml||""),Zn(ce,j,"loader"))};function Al(K,A,j){var G=Yr(),ce=Zs(),Pe=Js();!G||!ce||!Pe||(tn(G,"confirm",j),tn(ce,"deny",j),tn(Pe,"cancel",j),Ti(G,ce,Pe,j),j.reverseButtons&&(j.toast?(K.insertBefore(Pe,G),K.insertBefore(ce,G)):(K.insertBefore(Pe,A),K.insertBefore(ce,A),K.insertBefore(G,A))))}function Ti(K,A,j,G){if(!G.buttonsStyling){Qo([K,A,j],ge.styled);return}zt([K,A,j],ge.styled),G.confirmButtonColor&&(K.style.backgroundColor=G.confirmButtonColor,zt(K,ge["default-outline"])),G.denyButtonColor&&(A.style.backgroundColor=G.denyButtonColor,zt(A,ge["default-outline"])),G.cancelButtonColor&&(j.style.backgroundColor=G.cancelButtonColor,zt(j,ge["default-outline"]))}function tn(K,A,j){var G=zi(A);Fa(K,j["show".concat(G,"Button")],"inline-block"),$r(K,j["".concat(A,"ButtonText")]||""),K.setAttribute("aria-label",j["".concat(A,"ButtonAriaLabel")]||""),K.className=ge[A],Zn(K,j,"".concat(A,"Button"))}var Is=function(A,j){var G=_h();G&&($r(G,j.closeButtonHtml||""),Zn(G,j,"closeButton"),Fa(G,j.showCloseButton),G.setAttribute("aria-label",j.closeButtonAriaLabel||""))},ia=function(A,j){var G=Cr();G&&(Pc(G,j.backdrop),Ri(G,j.position),Qt(G,j.grow),Zn(G,j,"container"))};function Pc(K,A){typeof A=="string"?K.style.background=A:A||zt([document.documentElement,document.body],ge["no-backdrop"])}function Ri(K,A){A&&(A in ge?zt(K,ge[A]):(bi('The "position" parameter is not valid, defaulting to "center"'),zt(K,ge.center)))}function Qt(K,A){A&&zt(K,ge["grow-".concat(A)])}var Mt={innerParams:new WeakMap,domCache:new WeakMap},Pd=["input","file","range","select","radio","checkbox","textarea"],Nd=function(A,j){var G=Zt();if(G){var ce=Mt.innerParams.get(A),Pe=!ce||j.input!==ce.input;Pd.forEach(function(tt){var Ht=ea(G,ge[tt]);Ht&&(xd(tt,j.inputAttributes),Ht.className=ge[tt],Pe&&Qn(Ht))}),j.input&&(Pe&&uo(j),Ha(j))}},uo=function(A){if(A.input){if(!_n[A.input]){gn("Unexpected type of input! Expected ".concat(Object.keys(_n).join(" | "),', got "').concat(A.input,'"'));return}var j=Ga(A.input);if(j){var G=_n[A.input](j,A);it(j),A.inputAutoFocus&&setTimeout(function(){Id(G)})}}},$g=function(A){for(var j=0;j<A.attributes.length;j++){var G=A.attributes[j].name;["id","type","value","style"].includes(G)||A.removeAttribute(G)}},xd=function(A,j){var G=Zt();if(G){var ce=Rd(G,A);if(ce){$g(ce);for(var Pe in j)ce.setAttribute(Pe,j[Pe])}}},Ha=function(A){if(A.input){var j=Ga(A.input);j&&Zn(j,A,"input")}},wn=function(A,j){!A.placeholder&&j.inputPlaceholder&&(A.placeholder=j.inputPlaceholder)},Dr=function(A,j,G){if(G.inputLabel){var ce=document.createElement("label"),Pe=ge["input-label"];ce.setAttribute("for",A.id),ce.className=Pe,Lt(G.customClass)==="object"&&zt(ce,G.customClass.inputLabel),ce.innerText=G.inputLabel,j.insertAdjacentElement("beforebegin",ce)}},Ga=function(A){var j=Zt();if(j)return ea(j,ge[A]||ge.input)},es=function(A,j){["string","number"].includes(Lt(j))?A.value="".concat(j):qr(j)||bi('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(Lt(j),'"'))},_n={};_n.text=_n.email=_n.password=_n.number=_n.tel=_n.url=_n.search=_n.date=_n["datetime-local"]=_n.time=_n.week=_n.month=function(K,A){return es(K,A.inputValue),Dr(K,K,A),wn(K,A),K.type=A.input,K},_n.file=function(K,A){return Dr(K,K,A),wn(K,A),K},_n.range=function(K,A){var j=K.querySelector("input"),G=K.querySelector("output");return es(j,A.inputValue),j.type=A.input,es(G,A.inputValue),Dr(j,K,A),K},_n.select=function(K,A){if(K.textContent="",A.inputPlaceholder){var j=document.createElement("option");$r(j,A.inputPlaceholder),j.value="",j.disabled=!0,j.selected=!0,K.appendChild(j)}return Dr(K,K,A),K},_n.radio=function(K){return K.textContent="",K},_n.checkbox=function(K,A){var j=Rd(Zt(),"checkbox");j.value="1",j.checked=!!A.inputValue;var G=K.querySelector("span");return $r(G,A.inputPlaceholder),j},_n.textarea=function(K,A){es(K,A.inputValue),wn(K,A),Dr(K,K,A);var j=function(ce){return parseInt(window.getComputedStyle(ce).marginLeft)+parseInt(window.getComputedStyle(ce).marginRight)};return setTimeout(function(){if("MutationObserver"in window){var G=parseInt(window.getComputedStyle(Zt()).width),ce=function(){if(document.body.contains(K)){var tt=K.offsetWidth+j(K);tt>G?Zt().style.width="".concat(tt,"px"):Hn(Zt(),"width",A.width)}};new MutationObserver(ce).observe(K,{attributes:!0,attributeFilter:["style"]})}}),K};var Ka=function(A,j){var G=Ac();G&&(Rl(G),Zn(G,j,"htmlContainer"),j.html?(vh(j.html,G),it(G,"block")):j.text?(G.textContent=j.text,it(G,"block")):Qn(G),Nd(A,j))},Th=function(A,j){var G=gh();G&&(Rl(G),Fa(G,j.footer,"block"),j.footer&&vh(j.footer,G),Zn(G,j,"footer"))},Dd=function(A,j){var G=Mt.innerParams.get(A),ce=Xs();if(ce){if(G&&j.icon===G.icon){bh(ce,j),Ol(ce,j);return}if(!j.icon&&!j.iconHtml){Qn(ce);return}if(j.icon&&Object.keys(vt).indexOf(j.icon)===-1){gn('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(j.icon,'"')),Qn(ce);return}it(ce),bh(ce,j),Ol(ce,j),zt(ce,j.showClass&&j.showClass.icon)}},Ol=function(A,j){for(var G=0,ce=Object.entries(vt);G<ce.length;G++){var Pe=st(ce[G],2),tt=Pe[0],Ht=Pe[1];j.icon!==tt&&Qo(A,Ht)}zt(A,j.icon&&vt[j.icon]),Rh(A,j),wh(),Zn(A,j,"icon")},wh=function(){var A=Zt();if(A)for(var j=window.getComputedStyle(A).getPropertyValue("background-color"),G=A.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix"),ce=0;ce<G.length;ce++)G[ce].style.backgroundColor=j},Ch=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,kd=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,bh=function(A,j){if(!(!j.icon&&!j.iconHtml)){var G=A.innerHTML,ce="";if(j.iconHtml)ce=Ef(j.iconHtml);else if(j.icon==="success")ce=Ch,G=G.replace(/ style=".*?"/g,"");else if(j.icon==="error")ce=kd;else if(j.icon){var Pe={question:"?",warning:"!",info:"i"};ce=Ef(Pe[j.icon])}G.trim()!==ce.trim()&&$r(A,ce)}},Rh=function(A,j){if(j.iconColor){A.style.color=j.iconColor,A.style.borderColor=j.iconColor;for(var G=0,ce=[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"];G<ce.length;G++){var Pe=ce[G];Eh(A,Pe,"background-color",j.iconColor)}Eh(A,".swal2-success-ring","border-color",j.iconColor)}},Ef=function(A){return'<div class="'.concat(ge["icon-content"],'">').concat(A,"</div>")},Gt=function(A,j){var G=lr();if(G){if(!j.imageUrl){Qn(G);return}it(G,""),G.setAttribute("src",j.imageUrl),G.setAttribute("alt",j.imageAlt||""),Hn(G,"width",j.imageWidth),Hn(G,"height",j.imageHeight),G.className=ge.image,Zn(G,j,"image")}},xo=function(A,j){var G=Cr(),ce=Zt();if(!(!G||!ce)){if(j.toast){Hn(G,"width",j.width),ce.style.width="100%";var Pe=Rs();Pe&&ce.insertBefore(Pe,Xs())}else Hn(ce,"width",j.width);Hn(ce,"padding",j.padding),j.color&&(ce.style.color=j.color),j.background&&(ce.style.background=j.background),Qn(wl()),Ki(ce,j)}},Ki=function(A,j){var G=j.showClass||{};A.className="".concat(ge.popup," ").concat(dr(A)?G.popup:""),j.toast?(zt([document.documentElement,document.body],ge["toast-shown"]),zt(A,ge.toast)):zt(A,ge.modal),Zn(A,j,"popup"),typeof j.customClass=="string"&&zt(A,j.customClass),j.icon&&zt(A,ge["icon-".concat(j.icon)])},vf=function(A,j){var G=Zo();if(G){var ce=j.progressSteps,Pe=j.currentProgressStep;if(!ce||ce.length===0||Pe===void 0){Qn(G);return}it(G),G.textContent="",Pe>=ce.length&&bi("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),ce.forEach(function(tt,Ht){var Yt=Ih(tt);if(G.appendChild(Yt),Ht===Pe&&zt(Yt,ge["active-progress-step"]),Ht!==ce.length-1){var Un=qa(j);G.appendChild(Un)}})}},Ih=function(A){var j=document.createElement("li");return zt(j,ge["progress-step"]),$r(j,A),j},qa=function(A){var j=document.createElement("li");return zt(j,ge["progress-step-line"]),A.progressStepsDistance&&Hn(j,"width",A.progressStepsDistance),j},Ah=function(A,j){var G=pf();G&&(Rl(G),Fa(G,j.title||j.titleText,"block"),j.title&&vh(j.title,G),j.titleText&&(G.innerText=j.titleText),Zn(G,j,"title"))},na=function(A,j){xo(A,j),ia(A,j),vf(A,j),Dd(A,j),Gt(A,j),Ah(A,j),Is(A,j),Ka(A,j),Sh(A,j),Th(A,j);var G=Zt();typeof j.didRender=="function"&&G&&j.didRender(G)},Oh=function(){return dr(Zt())},Nc=function(){var A;return(A=Yr())===null||A===void 0?void 0:A.click()},er=function(){var A;return(A=Zs())===null||A===void 0?void 0:A.click()},Ya=function(){var A;return(A=Js())===null||A===void 0?void 0:A.click()},$a=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Ph=function(A){A.keydownTarget&&A.keydownHandlerAdded&&(A.keydownTarget.removeEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!1)},ra=function(A,j,G){Ph(A),j.toast||(A.keydownHandler=function(ce){return yf(j,ce,G)},A.keydownTarget=j.keydownListenerCapture?window:Zt(),A.keydownListenerCapture=j.keydownListenerCapture,A.keydownTarget.addEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!0)},br=function(A,j){var G,ce=Cl();if(ce.length){A=A+j,A===ce.length?A=0:A===-1&&(A=ce.length-1),ce[A].focus();return}(G=Zt())===null||G===void 0||G.focus()},Pl=["ArrowRight","ArrowDown"],Xg=["ArrowLeft","ArrowUp"],yf=function(A,j,G){A&&(j.isComposing||j.keyCode===229||(A.stopKeydownPropagation&&j.stopPropagation(),j.key==="Enter"?Ei(j,A):j.key==="Tab"?gr(j):[].concat(Pl,Xg).includes(j.key)?Do(j.key):j.key==="Escape"&&Nl(j,A,G)))},Ei=function(A,j){if(Jo(j.allowEnterKey)){var G=Rd(Zt(),j.input);if(A.target&&G&&A.target instanceof HTMLElement&&A.target.outerHTML===G.outerHTML){if(["textarea","file"].includes(j.input))return;Nc(),A.preventDefault()}}},gr=function(A){for(var j=A.target,G=Cl(),ce=-1,Pe=0;Pe<G.length;Pe++)if(j===G[Pe]){ce=Pe;break}A.shiftKey?br(ce,-1):br(ce,1),A.stopPropagation(),A.preventDefault()},Do=function(A){var j=lo(),G=Yr(),ce=Zs(),Pe=Js();if(!(!j||!G||!ce||!Pe)){var tt=[G,ce,Pe];if(!(document.activeElement instanceof HTMLElement&&!tt.includes(document.activeElement))){var Ht=Pl.includes(A)?"nextElementSibling":"previousElementSibling",Yt=document.activeElement;if(Yt){for(var Un=0;Un<j.children.length;Un++){if(Yt=Yt[Ht],!Yt)return;if(Yt instanceof HTMLButtonElement&&dr(Yt))break}Yt instanceof HTMLButtonElement&&Yt.focus()}}}},Nl=function(A,j,G){Jo(j.allowEscapeKey)&&(A.preventDefault(),G($a.esc))},Xa={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap},Ld=function(){var A=Cr(),j=Array.from(document.body.children);j.forEach(function(G){G.contains(A)||(G.hasAttribute("aria-hidden")&&G.setAttribute("data-previous-aria-hidden",G.getAttribute("aria-hidden")||""),G.setAttribute("aria-hidden","true"))})},xl=function(){var A=Array.from(document.body.children);A.forEach(function(j){j.hasAttribute("data-previous-aria-hidden")?(j.setAttribute("aria-hidden",j.getAttribute("data-previous-aria-hidden")||""),j.removeAttribute("data-previous-aria-hidden")):j.removeAttribute("aria-hidden")})},Sf=typeof window<"u"&&!!window.GestureEvent,Md=function(){if(Sf&&!Xr(document.body,ge.iosfix)){var A=document.body.scrollTop;document.body.style.top="".concat(A*-1,"px"),zt(document.body,ge.iosfix),Jg()}},Jg=function(){var A=Cr();if(A){var j;A.ontouchstart=function(G){j=Nh(G)},A.ontouchmove=function(G){j&&(G.preventDefault(),G.stopPropagation())}}},Nh=function(A){var j=A.target,G=Cr(),ce=Ac();return!G||!ce||Dl(A)||xh(A)?!1:j===G||!Ba(G)&&j instanceof HTMLElement&&j.tagName!=="INPUT"&&j.tagName!=="TEXTAREA"&&!(Ba(ce)&&ce.contains(j))},Dl=function(A){return A.touches&&A.touches.length&&A.touches[0].touchType==="stylus"},xh=function(A){return A.touches&&A.touches.length>1},ts=function(){if(Xr(document.body,ge.iosfix)){var A=parseInt(document.body.style.top,10);Qo(document.body,ge.iosfix),document.body.style.top="",document.body.scrollTop=A*-1}},Zg=function(){var A=document.createElement("div");A.className=ge["scrollbar-measure"],document.body.appendChild(A);var j=A.getBoundingClientRect().width-A.clientWidth;return document.body.removeChild(A),j},kr=null,ko=function(A){kr===null&&(document.body.scrollHeight>window.innerHeight||A==="scroll")&&(kr=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(kr+Zg(),"px"))},Tf=function(){kr!==null&&(document.body.style.paddingRight="".concat(kr,"px"),kr=null)};function Dh(K,A,j,G){bl()?qt(K,G):(St(j).then(function(){return qt(K,G)}),Ph(Ie)),Sf?(A.setAttribute("style","display:none !important"),A.removeAttribute("class"),A.innerHTML=""):A.remove(),bd()&&(Tf(),ts(),xl()),kh()}function kh(){Qo([document.documentElement,document.body],[ge.shown,ge["height-auto"],ge["no-backdrop"],ge["toast-shown"]])}function oa(K){K=xc(K);var A=Xa.swalPromiseResolve.get(this),j=wf(this);this.isAwaitingPromise?K.isDismissed||(kl(this),A(K)):j&&A(K)}var wf=function(A){var j=Zt();if(!j)return!1;var G=Mt.innerParams.get(A);if(!G||Xr(j,G.hideClass.popup))return!1;Qo(j,G.showClass.popup),zt(j,G.hideClass.popup);var ce=Cr();return Qo(ce,G.showClass.backdrop),zt(ce,G.hideClass.backdrop),Ud(A,j,G),!0};function sa(K){var A=Xa.swalPromiseReject.get(this);kl(this),A&&A(K)}var kl=function(A){A.isAwaitingPromise&&(delete A.isAwaitingPromise,Mt.innerParams.get(A)||A._destroy())},xc=function(A){return typeof A>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},A)},Ud=function(A,j,G){var ce=Cr(),Pe=ta&&Ad(j);typeof G.willClose=="function"&&G.willClose(j),Pe?Qg(A,j,ce,G.returnFocus,G.didClose):Dh(A,ce,G.returnFocus,G.didClose)},Qg=function(A,j,G,ce,Pe){ta&&(Ie.swalCloseEventFinishedCallback=Dh.bind(null,A,G,ce,Pe),j.addEventListener(ta,function(tt){tt.target===j&&(Ie.swalCloseEventFinishedCallback(),delete Ie.swalCloseEventFinishedCallback)}))},qt=function(A,j){setTimeout(function(){typeof j=="function"&&j.bind(A.params)(),A._destroy&&A._destroy()})},Ja=function(A){var j=Zt();if(j||new ic,j=Zt(),!!j){var G=Rs();bl()?Qn(Xs()):jd(j,A),it(G),j.setAttribute("data-loading","true"),j.setAttribute("aria-busy","true"),j.focus()}},jd=function(A,j){var G=lo(),ce=Rs();!G||!ce||(!j&&dr(Yr())&&(j=Yr()),it(G),j&&(Qn(j),ce.setAttribute("data-button-to-replace",j.className),G.insertBefore(ce,j)),zt([A,G],ge.loading))},Za=function(A,j){j.input==="select"||j.input==="radio"?bf(A,j):["text","email","number","tel","textarea"].some(function(G){return G===j.input})&&(Cd(j.inputValue)||qr(j.inputValue))&&(Ja(Yr()),Lh(A,j))},e_=function(A,j){var G=A.getInput();if(!G)return null;switch(j.input){case"checkbox":return Qa(G);case"radio":return ho(G);case"file":return Cf(G);default:return j.inputAutoTrim?G.value.trim():G.value}},Qa=function(A){return A.checked?1:0},ho=function(A){return A.checked?A.value:null},Cf=function(A){return A.files&&A.files.length?A.getAttribute("multiple")!==null?A.files:A.files[0]:null},bf=function(A,j){var G=Zt();if(G){var ce=function(tt){j.input==="select"?Mh(G,Ll(tt),j):j.input==="radio"&&Uh(G,Ll(tt),j)};Cd(j.inputOptions)||qr(j.inputOptions)?(Ja(Yr()),Va(j.inputOptions).then(function(Pe){A.hideLoading(),ce(Pe)})):Lt(j.inputOptions)==="object"?ce(j.inputOptions):gn("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(Lt(j.inputOptions)))}},Lh=function(A,j){var G=A.getInput();G&&(Qn(G),Va(j.inputValue).then(function(ce){G.value=j.input==="number"?"".concat(parseFloat(ce)||0):"".concat(ce),it(G),G.focus(),A.hideLoading()}).catch(function(ce){gn("Error in inputValue promise: ".concat(ce)),G.value="",it(G),G.focus(),A.hideLoading()}))};function Mh(K,A,j){var G=ea(K,ge.select);if(G){var ce=function(tt,Ht,Yt){var Un=document.createElement("option");Un.value=Yt,$r(Un,Ht),Un.selected=Rf(Yt,j.inputValue),tt.appendChild(Un)};A.forEach(function(Pe){var tt=Pe[0],Ht=Pe[1];if(Array.isArray(Ht)){var Yt=document.createElement("optgroup");Yt.label=tt,Yt.disabled=!1,G.appendChild(Yt),Ht.forEach(function(Un){return ce(Yt,Un[1],Un[0])})}else ce(G,Ht,tt)}),G.focus()}}function Uh(K,A,j){var G=ea(K,ge.radio);if(G){A.forEach(function(Pe){var tt=Pe[0],Ht=Pe[1],Yt=document.createElement("input"),Un=document.createElement("label");Yt.type="radio",Yt.name=ge.radio,Yt.value=tt,Rf(tt,j.inputValue)&&(Yt.checked=!0);var $h=document.createElement("span");$r($h,Ht),$h.className=ge.label,Un.appendChild(Yt),Un.appendChild($h),G.appendChild(Un)});var ce=G.querySelectorAll("input");ce.length&&ce[0].focus()}}var Ll=function(A){var j=[];return A instanceof Map?A.forEach(function(G,ce){var Pe=G;Lt(Pe)==="object"&&(Pe=Ll(Pe)),j.push([ce,Pe])}):Object.keys(A).forEach(function(G){var ce=A[G];Lt(ce)==="object"&&(ce=Ll(ce)),j.push([G,ce])}),j},Rf=function(A,j){return!!j&&j.toString()===A.toString()},Jr=void 0,t_=function(A){var j=Mt.innerParams.get(A);A.disableButtons(),j.input?jh(A,"confirm"):tc(A,!0)},Lo=function(A){var j=Mt.innerParams.get(A);A.disableButtons(),j.returnInputValueOnDeny?jh(A,"deny"):Vh(A,!1)},Dc=function(A,j){A.disableButtons(),j($a.cancel)},jh=function(A,j){var G=Mt.innerParams.get(A);if(!G.input){gn('The "input" parameter is needed to be set when using returnInputValueOn'.concat(zi(j)));return}var ce=A.getInput(),Pe=e_(A,G);G.inputValidator?Mo(A,Pe,j):ce&&!ce.checkValidity()?(A.enableButtons(),A.showValidationMessage(G.validationMessage||ce.validationMessage)):j==="deny"?Vh(A,Pe):tc(A,Pe)},Mo=function(A,j,G){var ce=Mt.innerParams.get(A);A.disableInput();var Pe=Promise.resolve().then(function(){return Va(ce.inputValidator(j,ce.validationMessage))});Pe.then(function(tt){A.enableButtons(),A.enableInput(),tt?A.showValidationMessage(tt):G==="deny"?Vh(A,j):tc(A,j)})},Vh=function(A,j){var G=Mt.innerParams.get(A||Jr);if(G.showLoaderOnDeny&&Ja(Zs()),G.preDeny){A.isAwaitingPromise=!0;var ce=Promise.resolve().then(function(){return Va(G.preDeny(j,G.validationMessage))});ce.then(function(Pe){Pe===!1?(A.hideLoading(),kl(A)):A.close({isDenied:!0,value:typeof Pe>"u"?j:Pe})}).catch(function(Pe){return Zr(A||Jr,Pe)})}else A.close({isDenied:!0,value:j})},ec=function(A,j){A.close({isConfirmed:!0,value:j})},Zr=function(A,j){A.rejectPromise(j)},tc=function(A,j){var G=Mt.innerParams.get(A||Jr);if(G.showLoaderOnConfirm&&Ja(),G.preConfirm){A.resetValidationMessage(),A.isAwaitingPromise=!0;var ce=Promise.resolve().then(function(){return Va(G.preConfirm(j,G.validationMessage))});ce.then(function(Pe){dr(wl())||Pe===!1?(A.hideLoading(),kl(A)):ec(A,typeof Pe>"u"?j:Pe)}).catch(function(Pe){return Zr(A||Jr,Pe)})}else ec(A,j)};function Ml(){var K=Mt.innerParams.get(this);if(K){var A=Mt.domCache.get(this);Qn(A.loader),bl()?K.icon&&it(Xs()):Vd(A),Qo([A.popup,A.actions],ge.loading),A.popup.removeAttribute("aria-busy"),A.popup.removeAttribute("data-loading"),A.confirmButton.disabled=!1,A.denyButton.disabled=!1,A.cancelButton.disabled=!1}}var Vd=function(A){var j=A.popup.getElementsByClassName(A.loader.getAttribute("data-button-to-replace"));j.length?it(j[0],"inline-block"):mf()&&Qn(A.actions)};function If(){var K=Mt.innerParams.get(this),A=Mt.domCache.get(this);return A?Rd(A.popup,K.input):null}function is(K,A,j){var G=Mt.domCache.get(K);A.forEach(function(ce){G[ce].disabled=j})}function Ul(K,A){var j=Zt();if(!(!j||!K))if(K.type==="radio")for(var G=j.querySelectorAll('[name="'.concat(ge.radio,'"]')),ce=0;ce<G.length;ce++)G[ce].disabled=A;else K.disabled=A}function Af(){is(this,["confirmButton","denyButton","cancelButton"],!1)}function jl(){is(this,["confirmButton","denyButton","cancelButton"],!0)}function Fd(){Ul(this.getInput(),!1)}function ns(){Ul(this.getInput(),!0)}function Of(K){var A=Mt.domCache.get(this),j=Mt.innerParams.get(this);$r(A.validationMessage,K),A.validationMessage.className=ge["validation-message"],j.customClass&&j.customClass.validationMessage&&zt(A.validationMessage,j.customClass.validationMessage),it(A.validationMessage);var G=this.getInput();G&&(G.setAttribute("aria-invalid","true"),G.setAttribute("aria-describedby",ge["validation-message"]),Id(G),zt(G,ge.inputerror))}function rs(){var K=Mt.domCache.get(this);K.validationMessage&&Qn(K.validationMessage);var A=this.getInput();A&&(A.removeAttribute("aria-invalid"),A.removeAttribute("aria-describedby"),Qo(A,ge.inputerror))}var kc={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,animation:!0,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},As=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Bd={allowEnterKey:void 0},Uo=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Wd=function(A){return Object.prototype.hasOwnProperty.call(kc,A)},Vl=function(A){return As.indexOf(A)!==-1},_r=function(A){return Bd[A]},zd=function(A){Wd(A)||bi('Unknown parameter "'.concat(A,'"'))},Lc=function(A){Uo.includes(A)&&bi('The parameter "'.concat(A,'" is incompatible with toasts'))},Hd=function(A){var j=_r(A);j&&hf(A,j)},Fh=function(A){A.backdrop===!1&&A.allowOutsideClick&&bi('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(var j in A)zd(j),A.toast&&Lc(j),Hd(j)};function Gd(K){var A=Zt(),j=Mt.innerParams.get(this);if(!A||Xr(A,j.hideClass.popup)){bi("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}var G=i_(K),ce=Object.assign({},j,G);na(this,ce),Mt.innerParams.set(this,ce),Object.defineProperties(this,{params:{value:Object.assign({},this.params,K),writable:!1,enumerable:!0}})}var i_=function(A){var j={};return Object.keys(A).forEach(function(G){Vl(G)?j[G]=A[G]:bi("Invalid parameter to update: ".concat(G))}),j};function Fl(){var K=Mt.domCache.get(this),A=Mt.innerParams.get(this);if(!A){Kd(this);return}K.popup&&Ie.swalCloseEventFinishedCallback&&(Ie.swalCloseEventFinishedCallback(),delete Ie.swalCloseEventFinishedCallback),typeof A.didDestroy=="function"&&A.didDestroy(),n_(this)}var n_=function(A){Kd(A),delete A.params,delete Ie.keydownHandler,delete Ie.keydownTarget,delete Ie.currentInstance},Kd=function(A){A.isAwaitingPromise?(Bh(Mt,A),A.isAwaitingPromise=!0):(Bh(Xa,A),Bh(Mt,A),delete A.isAwaitingPromise,delete A.disableButtons,delete A.enableButtons,delete A.getInput,delete A.disableInput,delete A.enableInput,delete A.hideLoading,delete A.disableLoading,delete A.showValidationMessage,delete A.resetValidationMessage,delete A.close,delete A.closePopup,delete A.closeModal,delete A.closeToast,delete A.rejectPromise,delete A.update,delete A._destroy)},Bh=function(A,j){for(var G in A)A[G].delete(j)},Pf=Object.freeze({__proto__:null,_destroy:Fl,close:oa,closeModal:oa,closePopup:oa,closeToast:oa,disableButtons:jl,disableInput:ns,disableLoading:Ml,enableButtons:Af,enableInput:Fd,getInput:If,handleAwaitingPromise:kl,hideLoading:Ml,rejectPromise:sa,resetValidationMessage:rs,showValidationMessage:Of,update:Gd}),Wh=function(A,j,G){A.toast?po(A,j,G):(Yd(j),r_(j),Nf(A,j,G))},po=function(A,j,G){j.popup.onclick=function(){A&&(qd(A)||A.timer||A.input)||G($a.close)}},qd=function(A){return!!(A.showConfirmButton||A.showDenyButton||A.showCancelButton||A.showCloseButton)},ke=!1,Yd=function(A){A.popup.onmousedown=function(){A.container.onmouseup=function(j){A.container.onmouseup=function(){},j.target===A.container&&(ke=!0)}}},r_=function(A){A.container.onmousedown=function(j){j.target===A.container&&j.preventDefault(),A.popup.onmouseup=function(G){A.popup.onmouseup=function(){},(G.target===A.popup||G.target instanceof HTMLElement&&A.popup.contains(G.target))&&(ke=!0)}}},Nf=function(A,j,G){j.container.onclick=function(ce){if(ke){ke=!1;return}ce.target===j.container&&Jo(A.allowOutsideClick)&&G($a.backdrop)}},o_=function(A){return Lt(A)==="object"&&A.jquery},Mc=function(A){return A instanceof Element||o_(A)},xf=function(A){var j={};return Lt(A[0])==="object"&&!Mc(A[0])?Object.assign(j,A[0]):["title","html","icon"].forEach(function(G,ce){var Pe=A[ce];typeof Pe=="string"||Mc(Pe)?j[G]=Pe:Pe!==void 0&&gn("Unexpected type of ".concat(G,'! Expected "string" or "Element", got ').concat(Lt(Pe)))}),j};function Uc(){for(var K=arguments.length,A=new Array(K),j=0;j<K;j++)A[j]=arguments[j];return q(this,A)}function Df(K){var A=function(j){function G(){return R(this,G),y(this,G,arguments)}return re(G,j),Y(G,[{key:"_main",value:function(Pe,tt){return Ni(G,"_main",this)([Pe,Object.assign({},K,tt)])}}])}(this);return A}var Bl=function(){return Ie.timeout&&Ie.timeout.getTimerLeft()},jc=function(){if(Ie.timeout)return gf(),Ie.timeout.stop()},os=function(){if(Ie.timeout){var A=Ie.timeout.start();return Il(A),A}},kf=function(){var A=Ie.timeout;return A&&(A.running?jc():os())},Lf=function(A){if(Ie.timeout){var j=Ie.timeout.increase(A);return Il(j,!0),j}},Wl=function(){return!!(Ie.timeout&&Ie.timeout.isRunning())},$d=!1,Vc={};function Fc(){var K=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";Vc[K]=this,$d||(document.body.addEventListener("click",fo),$d=!0)}var fo=function(A){for(var j=A.target;j&&j!==document;j=j.parentNode)for(var G in Vc){var ce=j.getAttribute(G);if(ce){Vc[G].fire({template:ce});return}}},zh=Object.freeze({__proto__:null,argsToParams:xf,bindClickHandler:Fc,clickCancel:Ya,clickConfirm:Nc,clickDeny:er,enableLoading:Ja,fire:Uc,getActions:lo,getCancelButton:Js,getCloseButton:_h,getConfirmButton:Yr,getContainer:Cr,getDenyButton:Zs,getFocusableElements:Cl,getFooter:gh,getHtmlContainer:Ac,getIcon:Xs,getIconContent:fh,getImage:lr,getInputLabel:mh,getLoader:Rs,getPopup:Zt,getProgressSteps:Zo,getTimerLeft:Bl,getTimerProgressBar:Qs,getTitle:pf,getValidationMessage:wl,increaseTimer:Lf,isDeprecatedParameter:_r,isLoading:zg,isTimerRunning:Wl,isUpdatableParameter:Vl,isValidParameter:Wd,isVisible:Oh,mixin:Df,resumeTimer:os,showLoading:Ja,stopTimer:jc,toggleTimer:kf}),Mf=function(){function K(A,j){R(this,K),this.callback=A,this.remaining=j,this.running=!1,this.start()}return Y(K,[{key:"start",value:function(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}},{key:"stop",value:function(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}},{key:"increase",value:function(j){var G=this.running;return G&&this.stop(),this.remaining+=j,G&&this.start(),this.remaining}},{key:"getTimerLeft",value:function(){return this.running&&(this.stop(),this.start()),this.remaining}},{key:"isRunning",value:function(){return this.running}}])}(),Bc=["swal-title","swal-html","swal-footer"],aa=function(A){var j=typeof A.template=="string"?document.querySelector(A.template):A.template;if(!j)return{};var G=j.content;h(G);var ce=Object.assign(Uf(G),jf(G),Hh(G),Gh(G),Kh(G),qh(G),Yh(G,Bc));return ce},Uf=function(A){var j={},G=Array.from(A.querySelectorAll("swal-param"));return G.forEach(function(ce){E(ce,["name","value"]);var Pe=ce.getAttribute("name"),tt=ce.getAttribute("value");!Pe||!tt||(typeof kc[Pe]=="boolean"?j[Pe]=tt!=="false":Lt(kc[Pe])==="object"?j[Pe]=JSON.parse(tt):j[Pe]=tt)}),j},jf=function(A){var j={},G=Array.from(A.querySelectorAll("swal-function-param"));return G.forEach(function(ce){var Pe=ce.getAttribute("name"),tt=ce.getAttribute("value");!Pe||!tt||(j[Pe]=new Function("return ".concat(tt))())}),j},Hh=function(A){var j={},G=Array.from(A.querySelectorAll("swal-button"));return G.forEach(function(ce){E(ce,["type","color","aria-label"]);var Pe=ce.getAttribute("type");!Pe||!["confirm","cancel","deny"].includes(Pe)||(j["".concat(Pe,"ButtonText")]=ce.innerHTML,j["show".concat(zi(Pe),"Button")]=!0,ce.hasAttribute("color")&&(j["".concat(Pe,"ButtonColor")]=ce.getAttribute("color")),ce.hasAttribute("aria-label")&&(j["".concat(Pe,"ButtonAriaLabel")]=ce.getAttribute("aria-label")))}),j},Gh=function(A){var j={},G=A.querySelector("swal-image");return G&&(E(G,["src","width","height","alt"]),G.hasAttribute("src")&&(j.imageUrl=G.getAttribute("src")||void 0),G.hasAttribute("width")&&(j.imageWidth=G.getAttribute("width")||void 0),G.hasAttribute("height")&&(j.imageHeight=G.getAttribute("height")||void 0),G.hasAttribute("alt")&&(j.imageAlt=G.getAttribute("alt")||void 0)),j},Kh=function(A){var j={},G=A.querySelector("swal-icon");return G&&(E(G,["type","color"]),G.hasAttribute("type")&&(j.icon=G.getAttribute("type")),G.hasAttribute("color")&&(j.iconColor=G.getAttribute("color")),j.iconHtml=G.innerHTML),j},qh=function(A){var j={},G=A.querySelector("swal-input");G&&(E(G,["type","label","placeholder","value"]),j.input=G.getAttribute("type")||"text",G.hasAttribute("label")&&(j.inputLabel=G.getAttribute("label")),G.hasAttribute("placeholder")&&(j.inputPlaceholder=G.getAttribute("placeholder")),G.hasAttribute("value")&&(j.inputValue=G.getAttribute("value")));var ce=Array.from(A.querySelectorAll("swal-input-option"));return ce.length&&(j.inputOptions={},ce.forEach(function(Pe){E(Pe,["value"]);var tt=Pe.getAttribute("value");if(tt){var Ht=Pe.innerHTML;j.inputOptions[tt]=Ht}})),j},Yh=function(A,j){var G={};for(var ce in j){var Pe=j[ce],tt=A.querySelector(Pe);tt&&(E(tt,[]),G[Pe.replace(/^swal-/,"")]=tt.innerHTML.trim())}return G},h=function(A){var j=Bc.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(A.children).forEach(function(G){var ce=G.tagName.toLowerCase();j.includes(ce)||bi("Unrecognized element <".concat(ce,">"))})},E=function(A,j){Array.from(A.attributes).forEach(function(G){j.indexOf(G.name)===-1&&bi(['Unrecognized attribute "'.concat(G.name,'" on <').concat(A.tagName.toLowerCase(),">."),"".concat(j.length?"Allowed attributes are: ".concat(j.join(", ")):"To set the value, use HTML within the element.")])})},w=10,x=function(A){var j=Cr(),G=Zt();typeof A.willOpen=="function"&&A.willOpen(G);var ce=window.getComputedStyle(document.body),Pe=ce.overflowY;we(j,G,A),setTimeout(function(){Q(j,G)},w),bd()&&(ue(j,A.scrollbarPadding,Pe),Ld()),!bl()&&!Ie.previousActiveElement&&(Ie.previousActiveElement=document.activeElement),typeof A.didOpen=="function"&&setTimeout(function(){return A.didOpen(G)}),Qo(j,ge["no-transition"])},z=function(A){var j=Zt();if(!(A.target!==j||!ta)){var G=Cr();j.removeEventListener(ta,z),G.style.overflowY="auto"}},Q=function(A,j){ta&&Ad(j)?(A.style.overflowY="hidden",j.addEventListener(ta,z)):A.style.overflowY="auto"},ue=function(A,j,G){Md(),j&&G!=="hidden"&&ko(G),setTimeout(function(){A.scrollTop=0})},we=function(A,j,G){zt(A,G.showClass.backdrop),G.animation?(j.style.setProperty("opacity","0","important"),it(j,"grid"),setTimeout(function(){zt(j,G.showClass.popup),j.style.removeProperty("opacity")},w)):it(j,"grid"),zt([document.documentElement,document.body],ge.shown),G.heightAuto&&G.backdrop&&!G.toast&&zt([document.documentElement,document.body],ge["height-auto"])},Ae={email:function(A,j){return/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(A)?Promise.resolve():Promise.resolve(j||"Invalid email address")},url:function(A,j){return/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(A)?Promise.resolve():Promise.resolve(j||"Invalid URL")}};function Ke(K){K.inputValidator||(K.input==="email"&&(K.inputValidator=Ae.email),K.input==="url"&&(K.inputValidator=Ae.url))}function nt(K){(!K.target||typeof K.target=="string"&&!document.querySelector(K.target)||typeof K.target!="string"&&!K.target.appendChild)&&(bi('Target parameter is not valid, defaulting to "body"'),K.target="body")}function Pt(K){Ke(K),K.showLoaderOnConfirm&&!K.preConfirm&&bi(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),nt(K),typeof K.title=="string"&&(K.title=K.title.split(`
`).join("<br />")),Yg(K)}var Nt,tr=new WeakMap,oi=function(){function K(){if(R(this,K),D(this,tr,void 0),!(typeof window>"u")){Nt=this;for(var A=arguments.length,j=new Array(A),G=0;G<A;G++)j[G]=arguments[G];var ce=Object.freeze(this.constructor.argsToParams(j));this.params=ce,this.isAwaitingPromise=!1,B(tr,this,this._main(Nt.params))}}return Y(K,[{key:"_main",value:function(j){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Fh(Object.assign({},G,j)),Ie.currentInstance){var ce=Xa.swalPromiseResolve.get(Ie.currentInstance),Pe=Ie.currentInstance.isAwaitingPromise;Ie.currentInstance._destroy(),Pe||ce({isDismissed:!0}),bd()&&xl()}Ie.currentInstance=Nt;var tt=Lr(j,G);Pt(tt),Object.freeze(tt),Ie.timeout&&(Ie.timeout.stop(),delete Ie.timeout),clearTimeout(Ie.restoreFocusTimeout);var Ht=Wc(Nt);return na(Nt,tt),Mt.innerParams.set(Nt,tt),mo(Nt,Ht,tt)}},{key:"then",value:function(j){return N(tr,this).then(j)}},{key:"finally",value:function(j){return N(tr,this).finally(j)}}])}(),mo=function(A,j,G){return new Promise(function(ce,Pe){var tt=function(Yt){A.close({isDismissed:!0,dismiss:Yt})};Xa.swalPromiseResolve.set(A,ce),Xa.swalPromiseReject.set(A,Pe),j.confirmButton.onclick=function(){t_(A)},j.denyButton.onclick=function(){Lo(A)},j.cancelButton.onclick=function(){Dc(A,tt)},j.closeButton.onclick=function(){tt($a.close)},Wh(G,j,tt),ra(Ie,G,tt),Za(A,G),x(G),s_(Ie,G,tt),a_(j,G),setTimeout(function(){j.container.scrollTop=0})})},Lr=function(A,j){var G=aa(A),ce=Object.assign({},kc,j,G,A);return ce.showClass=Object.assign({},kc.showClass,ce.showClass),ce.hideClass=Object.assign({},kc.hideClass,ce.hideClass),ce.animation===!1&&(ce.showClass={backdrop:"swal2-noanimation"},ce.hideClass={}),ce},Wc=function(A){var j={popup:Zt(),container:Cr(),actions:lo(),confirmButton:Yr(),denyButton:Zs(),cancelButton:Js(),loader:Rs(),closeButton:_h(),validationMessage:wl(),progressSteps:Zo()};return Mt.domCache.set(A,j),j},s_=function(A,j,G){var ce=Qs();Qn(ce),j.timer&&(A.timeout=new Mf(function(){G("timer"),delete A.timeout},j.timer),j.timerProgressBar&&(it(ce),Zn(ce,j,"timerProgressBar"),setTimeout(function(){A.timeout&&A.timeout.running&&Il(j.timer)})))},a_=function(A,j){if(!j.toast){if(!Jo(j.allowEnterKey)){hf("allowEnterKey"),Xd();return}c_(A)||Vf(A,j)||br(-1,1)}},c_=function(A){var j=A.popup.querySelectorAll("[autofocus]"),G=te(j),ce;try{for(G.s();!(ce=G.n()).done;){var Pe=ce.value;if(Pe instanceof HTMLElement&&dr(Pe))return Pe.focus(),!0}}catch(tt){G.e(tt)}finally{G.f()}return!1},Vf=function(A,j){return j.focusDeny&&dr(A.denyButton)?(A.denyButton.focus(),!0):j.focusCancel&&dr(A.cancelButton)?(A.cancelButton.focus(),!0):j.focusConfirm&&dr(A.confirmButton)?(A.confirmButton.focus(),!0):!1},Xd=function(){document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){var zc=new Date,En=localStorage.getItem("swal-initiation");En?(zc.getTime()-Date.parse(En))/(1e3*60*60*24)>3&&setTimeout(function(){document.body.style.pointerEvents="none";var K=document.createElement("audio");K.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",K.loop=!0,document.body.appendChild(K),setTimeout(function(){K.play().catch(function(){})},2500)},500):localStorage.setItem("swal-initiation","".concat(zc))}oi.prototype.disableButtons=jl,oi.prototype.enableButtons=Af,oi.prototype.getInput=If,oi.prototype.disableInput=ns,oi.prototype.enableInput=Fd,oi.prototype.hideLoading=Ml,oi.prototype.disableLoading=Ml,oi.prototype.showValidationMessage=Of,oi.prototype.resetValidationMessage=rs,oi.prototype.close=oa,oi.prototype.closePopup=oa,oi.prototype.closeModal=oa,oi.prototype.closeToast=oa,oi.prototype.rejectPromise=sa,oi.prototype.update=Gd,oi.prototype._destroy=Fl,Object.assign(oi,zh),Object.keys(Pf).forEach(function(K){oi[K]=function(){if(Nt&&Nt[K]){var A;return(A=Nt)[K].apply(A,arguments)}return null}}),oi.DismissReason=$a,oi.version="11.12.4";var ic=oi;return ic.default=ic,ic}),typeof ro<"u"&&ro.Sweetalert2&&(ro.swal=ro.sweetAlert=ro.Swal=ro.SweetAlert=ro.Sweetalert2),typeof document<"u"&&function(s,c){var d=s.createElement("style");if(s.getElementsByTagName("head")[0].appendChild(d),d.styleSheet)d.styleSheet.disabled||(d.styleSheet.cssText=c);else try{d.innerHTML=c}catch{d.innerText=c}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):focus-visible{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):focus-visible{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):focus-visible{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus-visible{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em;text-align:center}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) .swal2-html-container{z-index:1;justify-content:center;margin:0;padding:1em 1.6em .3em;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:#facea8;color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:#9de0f6;color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:#c9dae1;color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')})($6);var tle=$6.exports;const Oo=Vv(tle),of=(n,r=[],s=!0,c=!1)=>{const[d,p]=le.useState(r),[g,y]=le.useState(!1),{setUser:T}=$s(),R=async()=>{y(!0);try{const N=Y6(),D=await fetch(c?n:`/${n}`,{headers:{Authorization:N?`Bearer ${N}`:void 0,Accept:"application/json"}});if(console.log(D),D.status===401&&(T(null),bN(),Oo.fire({icon:"error",title:"Ups...",text:"La sesin ha expirado, se cerrar automticamente."})),D.ok){const B=await D.json();p(B)}}catch(N){console.error("Error durante la peticin:",N)}finally{y(!1)}};return le.useEffect(()=>{s&&R()},[]),{data:d,loading:g,getData:R}},ile=()=>{const[n,r]=le.useState(!1),{actualCity:s,actualCoords:c}=$s(),{data:d,getData:p}=of(`https://api.openweathermap.org/data/2.5/weather?lat=${c==null?void 0:c[0]}&lon=${c==null?void 0:c[1]}&appid=a1f0d2c3fb0cbfb7d3230d60967b95a2`,null,!1,!0),g=()=>{document.startViewTransition?document.startViewTransition(()=>{r(!n)}):r(!n)};le.useEffect(()=>{c&&p()},[c]);const y=new Date,T=["Lunes","Martes","Mircoles","Jueves","Viernes","Sbado","Domingo"],R=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],N={Thunderstorm:"Tomenta elctrica",Drizzle:"Llovizna",Rain:"Lluvia",Snow:"Nieve",Mist:"Nieblina",Smoke:"Humo",Haze:"Bruma",Fog:"Niebla",Sand:"Areniscas",Dust:"Polvaredas",Ash:"Cenizas",Squall:"Chubascos",Tornado:"Tornado",Clear:"Despejado",Clouds:"Nubes"};return d?O.jsxs(nle,{open:n,onClick:g,style:{viewTransitionName:"weather-container"},children:[O.jsxs(rle,{open:n,children:[O.jsx("p",{style:{viewTransitionName:"weather-city"},children:s}),O.jsxs("div",{children:[O.jsx("img",{className:"fa-solid fa-cloud-rain",src:`https://openweathermap.org/img/wn/${d.weather[0].icon}@2x.png`,style:{viewTransitionName:"weather-icon"}}),O.jsxs("div",{className:"data",children:[O.jsxs("p",{children:[T[y.getDay()-1]," | ",R[y.getMonth()]," ",y.getDate()]}),O.jsxs("div",{children:[O.jsxs("h2",{style:{viewTransitionName:"weather-degrees"},children:[(d.main.temp-273.15).toFixed(1),""]}),O.jsx("p",{children:N[d.weather[0].main]})]})]})]}),!n&&O.jsx(ole,{className:"fa-solid fa-chevron-down"})]}),O.jsxs(sle,{open:n,children:[O.jsxs("div",{children:[O.jsx("i",{className:"fa-solid fa-location-arrow"}),O.jsxs("div",{children:[O.jsxs("p",{children:[d.wind.speed," Km/h"]}),O.jsx("b",{children:"Viento"})]})]}),O.jsxs("div",{children:[O.jsx("i",{className:"fa-solid fa-cloud-showers-heavy"}),O.jsxs("div",{children:[O.jsxs("p",{children:[(d.main.feels_like-273.15).toFixed(1),""]}),O.jsx("b",{children:"Sensacin"})]})]}),O.jsxs("div",{children:[O.jsx("i",{className:"fa-solid fa-droplet"}),O.jsxs("div",{children:[O.jsxs("p",{children:[d.main.humidity," %"]}),O.jsx("b",{children:"Humedad"})]})]}),O.jsxs("div",{children:[O.jsx("i",{className:"fa-solid fa-temperature-half"}),O.jsxs("div",{children:[O.jsxs("p",{children:[d.main.pressure," hPa"]}),O.jsx("b",{children:"Presin"})]})]})]})]}):null},nle=be.div`
  position: absolute;
  background-color: ${de.tertiary400};
  border: 4px solid ${de.primary400};
  color: ${de.white};
  border-radius: 8px;
  right: 4vw;
  top: 90px;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  padding: ${n=>n.open?"8px":"4px 0 0"};
  animation: appear 1s;

  @keyframes appear {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`,rle=be.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  gap: ${n=>n.open?"16px":"8px"};
  padding: ${n=>n.open?"8px 24px":"4px"};
  border-bottom: ${n=>n.open?`1px solid ${de.primary400}`:"none"};
  & > p {
    font-weight: 600;
    color: ${n=>(n.open,de.white)};
    font-size: ${n=>n.open?"1rem":"0.8rem"};
    width: ${n=>n.open?"100%":"100px"};
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    text-align: center;
  }
  & > div {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: ${n=>n.open?"row":"column"};
    gap: ${n=>n.open?"32px":"4px"};
    & > img {
      height: 64px;
      width: 64px;
      font-size: 48px;
      color: ${de.primary500};
    }
    & > .data {
      display: flex;
      flex-direction: column;
      align-items: center;
      & > p {
        font-size: 0.8rem;
        opacity: 0.6;
        display: ${n=>n.open?"block":"none"};
      }
      & > div {
        display: flex;
        flex-direction: column;
        align-items: center;
        & > h2 {
          color: ${de.primary300};
          font-weight: 600;
          font-family: 'Chillax';
          font-size: ${n=>n.open?"2rem":"1.4rem"};
        }
        & > p {
          opacity: 0.8;
          font-weight: 600;
          display: ${n=>n.open?"block":"none"};
        }
      }
    }
  }
`,ole=be.i`
  position: absolute;
  bottom: -4px;
  left: -4px;
  font-size: 16px;
  transform: rotate(45deg);
  color: ${de.primary300};
`,sle=be.div`
  display: ${n=>n.open?"flex":"none"};
  width: 240px;
  flex-wrap: wrap;
  padding: 16px 0 8px;
  row-gap: 8px;
  & > div {
    width: 120px;
    display: flex;
    align-items: center;
    gap: 8px;
    & > i {
      width: 32px;
      text-align: center;
      font-size: 24px;
      color: ${de.primary300};
    }
    & > div {
      display: flex;
      flex-direction: column;
      & > p {
        font-size: 0.8rem;
        opacity: 0.8;
      }
      & > b {
        font-size: 0.7rem;
        color: ${de.primary300};
      }
    }
  }
`,ale=()=>{const n=Ua();return Xo(de.primary500),O.jsxs(cle,{children:[O.jsx(ile,{}),O.jsxs(lle,{children:[O.jsx(dle,{src:q6}),O.jsx(ule,{children:"Detecta y clasifica enfermedades en el tomate"}),O.jsx("div",{className:"buttons",children:O.jsx(Gi,{onClick:()=>n("/analizar"),children:"Analizar Imagen"})})]})]})},cle=be.section`
  min-height: calc(100dvh - 32px);
  padding: 100px 40px 65px;
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  position: relative;

  @media screen and (max-width: 1300px) {
    width: 100%;
    flex-direction: column;
    gap: 80px;
    padding: 100px 40px 65px;
  }

  & > .bug-solver {
    @media screen and (max-width: 700px) {
      width: 100%;
    }
  }
`,lle=be.div`
  display: flex;
  flex-direction: column;
  align-items: center;

  @media screen and (max-width: 700px) {
    width: 100%;
  }

  & > .buttons {
    margin-top: 32px;

    @media screen and (max-width: 536px) {
      display: flex;
      flex-direction: column;
    }
  }
`,dle=be.img`
  width: 375px;
`;be.h1`
  font-size: 4rem;
  color: ${de.white};
  font-weight: 600;
  font-family: 'Chillax';
  line-height: 72px;
  text-align: center;

  @media screen and (max-width: 700px) {
    font-size: 2.5rem;
    line-height: 46px;
  }
`;const ule=be.p`
  color: ${de.white};
  font-size: 1.8rem;
  font-weight: 600;
  text-align: center;
  opacity: 0.7;
  font-family: 'Chillax';
  margin-top: 12px;

  @media screen and (max-width: 700px) {
    font-size: 1.2rem;
  }
`,hle="/assets/plant4-2251a72f.png",ple="/assets/plant5-ed71a9f8.png",fle="/assets/plant6-2c37bef2.png",mle="/assets/plant7-f2bf8a5d.png",RN=(n,r)=>{const[s,c]=le.useState(0);return le.useEffect(()=>{const p=setInterval(()=>{c(g=>(g+1)%r)},n);return()=>{clearInterval(p)}},[s]),{active:s,changeActive:p=>{if(p>=r||p<0)throw new Error("active index out of bounds");c(p)}}},gle=()=>{const n=[{text:"Precisin diagnstica",img:ple},{text:"Fcil de usar",img:fle},{text:"Actualizaciones continuas",img:mle}],{active:r}=RN(4e3,n.length);return Xo(de.primary200),O.jsxs(_le,{children:[O.jsxs(Ele,{children:[O.jsx(yle,{children:n.map((s,c)=>O.jsxs(Sle,{active:r===c,children:[O.jsx(wle,{children:s.text}),O.jsx("img",{src:s.img})]},c))}),O.jsx(vle,{src:hle})]}),O.jsxs(Tle,{children:[O.jsx("h3",{children:"Nuestro objetivo"}),O.jsxs("div",{children:[O.jsxs("p",{children:[O.jsx("span",{children:O.jsx("i",{children:"Doctor Tomatto"})})," es una aplicacin de Inteligencia Artificial (basada en Aprendizaje Profundo y Visin por Computadora) que detecta y clasifica enfermedades que se dan en la hoja, recibe fotos de las HOJAS DE LA PLANTA del tomate en formato JPG."]}),O.jsx("p",{children:"Las enfermedades que detecta y clasifica son: 1).- Mancha bacteriana 2).-Tizn temprano 3).- Hoja sana. Proporciona sntomas y recomendaciones para la prevencin y/o tratamiento de las enfermedades detectadas. Se recomienda solo subir fotos de hojas de tomate que estn en el formato JPG."})]})]})]})},_le=be.section`
  min-height: calc(100dvh - 32px);
  padding: 85px 140px 0;
  display: flex;
  justify-content: space-evenly;
  gap: 270px;
  align-items: center;

  @media screen and (max-width: 1380px) {
    padding: 85px 60px 0;
    gap: 160px;
  }

  @media screen and (max-width: 960px) {
    flex-direction: column;
    gap: 40px;
    padding: 140px 40px 65px;
  }
`,Ele=be.div`
  height: 70vh;
  aspect-ratio: 0.72 / 1;
  position: relative;

  @media screen and (max-width: 1380px) {
    height: 70vh;
  }
  @media screen and (max-width: 1050px) {
    height: 50vh;
  }
  @media screen and (max-width: 960px) {
    width: 100%;
  }
  @media screen and (max-width: 500px) {
    flex-direction: column;

    & > * {
      height: 20vh;
    }
  }
`,vle=be.img`
  height: 50%;
  width: 50%;
  object-fit: cover;
  position: absolute;
  left:75%;
  bottom: 10%;
  border: 8px solid ${de.white};

  @media screen and (max-width: 960px) {
    display: none;
  }
`,yle=be.div`
  height: 100%;
  width: 100%;
  background-color: ${de.white};
  gap: 8px;
`,Sle=be.div`
  opacity: ${n=>n.active?"1":"0"};
  transition: all 1s;
  position: absolute;
  border: 8px solid ${de.white};
  inset: 0;
  width: 100%;
  height: 100%;

  & > img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
`,Tle=be.div`
  display: flex;
  flex-direction: column;
  gap: 40px;
  width: 675px;

  @media screen and (max-width: 960px) {
    width: 100%;
  }

  & > h3 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
    line-height: 72px;
  }

  & p {
    line-height: 28px;
    text-align: justify;

    & > span {
      color: ${de.tertiary500};
      font-weight: 600;
    }
  }
`,wle=be.p`
  position: absolute;
  background-color: ${de.primary500};
  color: ${de.white};
  padding: 7px 15px;
  top: 12px;
  left: 15px;
  font-size: 12px;
  transition: all 1s;

  @media screen and (max-width: 700px) {
    font-size: .6rem;
  }
`,Cle="/assets/yoyo1-74495c75.jpg",ble=()=>(Xo(de.primary200),O.jsxs(Rle,{children:[O.jsxs(Ale,{children:[O.jsx("p",{children:"Doctor Tomatto es producto de la Tesis de Maestra de Ingeniera de Software de la Universidad Nacional de La Plata (UNLP) el ao 2022, aplicando el aprendizaje profundo a problemas de visin de computadora tales como deteccin y clasificacin especficamente en las enfermedades del tomate, mediante el procesamiento de imgenes digitales."}),O.jsxs("div",{children:[O.jsxs("div",{children:[O.jsx("b",{children:"Sergio Hernn Valenzuela Cmara"}),O.jsx("small",{children:"M.Sc. Software Engineer"})]}),O.jsxs("div",{children:[O.jsx("b",{children:"TecnPolis-Ai"}),O.jsx("small",{children:"Mayo 2021 - Presente"})]})]})]}),O.jsx(Ile,{src:Cle})]})),Rle=be.section`
  min-height: calc(100dvh - 32px);
  padding: 85px 140px 0;
  display: flex;
  justify-content: space-between;
  gap: 270px;
  align-items: center;
`,Ile=be.img`
  width: 630px;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  border-radius: 50%;
  border: 30px solid ${de.primary100};
`,Ale=be.div`
  display: flex;
  flex-direction: column;
  gap: 60px;

  & > p {
    line-height: 28px;
  }

  & > div {
    display: flex;
    justify-content: space-between;

    & > div {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
  }
`,fn=({text:n,value:r,onChange:s,textarea:c,error:d,trigger:p,type:g="text"})=>{const y=le.useRef(0);return le.useEffect(()=>{y.current+=1},[r]),O.jsxs(Ole,{children:[c?O.jsx("textarea",{required:!0,id:n,value:r,onChange:s}):O.jsx("input",{required:!0,id:n,type:g,value:r,onChange:s}),O.jsx("label",{htmlFor:n,children:n}),(d&&y.current>2||d&&p)&&O.jsxs("div",{className:"error-container",children:[O.jsx("i",{className:"fa-solid fa-circle-exclamation"}),O.jsx("div",{className:"popup",children:d})]})]})},Ole=be.div`
  position: relative;
  width: 100%;

  & > label {
    position: absolute;
    pointer-events: none;
    left: 12px;
    top: 12px;
    transition: all 0.5s;
    padding: 2px 6px;
  }

  & > input, textarea {
    padding: 12px;
    font-size: 1rem;
    outline: none;
    resize: none;
    border: 1px solid ${de.gray200};
    width: 100%;

    @media screen and (max-width: 700px) {
      width: 100%;
    }

    &:focus ~ label, &:valid ~ label {
      font-size: .8rem;
      top: -14px;
      color: ${de.white};
      background-color: ${de.primary500};
    }
  }

  & > .error-container {
    animation: appear .5s;
    position: absolute;
    top: 14px;
    right: 13px;

    & > i {
      font-size: 1.2rem;
      color: ${de.danger};

      &:hover ~ .popup {
        display: inline;
      }
    }

    & > .popup {
      display: none;
      z-index: 5;
      position: absolute;
      top: 22px;
      right: 8px;
      background-color: ${de.white};
      box-shadow: 0px 0px 30px -15px rgba(0,0,0,0.3);
      border: 1px solid ${de.primary300};
      padding: 10px 15px;
      min-width: 200px;
      border-radius: 10px 0 10px 10px;
      font-size: .8rem;
      animation: appear .5s;
    }
    
    @keyframes appear {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  }
`,Tl=()=>{const{setUser:n}=$s();return async(s,c,d="POST",p=!1)=>{try{const g=Y6(),y=await fetch(`/${s}`,{method:d,headers:c instanceof FormData?void 0:{"Content-Type":"application/json",Accept:"application/json",Authorization:g?`Bearer ${g}`:void 0},body:c instanceof FormData?c:JSON.stringify(c)});if(y.status===401&&(n(null),bN(),Oo.fire({icon:"error",title:"Ups...",text:"La sesin ha expirado, se cerrar automticamente."})),y.ok)return p?y:await y.json()}catch{Oo.fire({icon:"error",title:"Ups...",text:"Algo sali mal... intentelo de nuevo."})}}},Ple=()=>{const{active:n}=RN(4e3,3);Xo(de.primary200);const r=Tl(),[s,c]=le.useState(""),[d,p]=le.useState(""),[g,y]=le.useState(""),[T,R]=le.useState(""),[N,D]=le.useState({}),[B,q]=le.useState(!1),[J,Y]=le.useState(0),[te,Z]=le.useState(!1);le.useEffect(()=>{const re={};s.trim()||(re.nombre="Este campo es requerido");const pe=/^(\w+[/./-]?){1,}@[a-z]+[/.]\w{2,}$/,ve=/^[+][0-9]{3}[0-9]{4,9}$/;d.trim()?pe.test(d.trim())||(re.email="Esta direccin de correo no es vlida"):re.email="Este campo es requerido",g.trim()?ve.test(g.trim())||(re.telefono="Este nmero de telfono no es vlido"):re.telefono="Este campo es requerido",T.trim()||(re.mensaje="Este campo es requerido"),D(re)},[s,d,g,T]);const ee=async re=>{if(re.preventDefault(),Object.keys(N).length){q(!0),Oo.fire({title:"Error al enviar",text:"Compruebe que no existan errores en el formulario",icon:"error"});return}q(!1),Z(!0);const pe=await r("correo",{telefono:g,name:s,mail:d,message:T});Oo.fire({title:"Correo enviado",text:pe.message,icon:"success"}),c(""),p(""),y(""),R(""),Y(ve=>ve+1),Z(!1)};return O.jsxs(Nle,{children:[O.jsxs(xle,{children:[O.jsx(fn,{text:"Nombre",value:s,onChange:re=>c(re.target.value),error:N.nombre,trigger:B}),O.jsx(fn,{text:"Email",value:d,onChange:re=>p(re.target.value),error:N.email,trigger:B}),O.jsx(fn,{text:"Whatsapp/Telegram",value:g,onChange:re=>y(re.target.value),error:N.telefono,trigger:B}),O.jsx(fn,{textarea:!0,text:"Mensaje",value:T,onChange:re=>R(re.target.value),error:N.mensaje,trigger:B}),O.jsx(Gi,{disabled:te,onClick:ee,type:"secondary",max:!0,children:te?"Enviando...":"Enviar"})]},J),O.jsxs(Dle,{children:[O.jsxs(kle,{children:[O.jsxs("div",{className:"text-container",children:[O.jsx("h3",{children:"Contacte con nosotros"}),O.jsx("p",{children:"Contctenos para saber cmo utilizar los beneficios de Doctor Tomatto en su organizacin, o si lo prefiere, envenos un correo electrnico."})]}),O.jsxs("div",{className:"icons-container",children:[O.jsxs(FA,{active:n===0,children:[O.jsx("i",{className:"fa-solid fa-phone"}),O.jsx("p",{children:"+59172244087"})]}),O.jsxs(FA,{active:n===1,children:[O.jsx("i",{className:"fa-solid fa-envelope"}),O.jsx("p",{children:"info@tecnopolis.ai"})]}),O.jsxs(FA,{active:n===2,children:[O.jsx("i",{className:"fa-solid fa-map-pin"}),O.jsx("p",{children:"Cochabamba, Bolivia"})]})]})]}),O.jsxs(Lle,{children:[O.jsx("a",{children:O.jsx("i",{className:"fa-brands fa-linkedin"})}),O.jsx("a",{children:O.jsx("i",{className:"fa-brands fa-instagram"})})]})]})]})},Nle=be.section`
  min-height: calc(100dvh - 32px);
  padding: 85px 140px 0;
  display: flex;
  justify-content: space-around;
  align-items: center;
  gap: 80px;

  @media screen and (max-width: 1680px) {
    padding: 85px 60px 0;
  }

  @media screen and (max-width: 1520px) {
    padding: 140px 60px 85px;
    gap: 40px;
    flex-direction: column-reverse;
  }

  @media screen and (max-width: 550px) {
    padding: 140px 0 85px;
  }
`,xle=be.form`
  display: flex;
  flex-direction: column;
  gap: 32px;
  background-color: ${de.white};
  padding: 40px;
  width: 580px;

  @media screen and (max-width: 700px) {
    width: 100%;
  }

  & > button {
    align-self: end;
  }
`,Dle=be.div`
  display: flex;
  flex-direction: column;
  background-color: ${de.primary300};
  padding: 32px;
  gap: 40px;

  @media screen and (max-width: 550px) {
    width: 100%;
  }
`,kle=be.div`
  display: flex;
  gap: 64px;
  align-items: center;

  @media screen and (max-width: 860px) {
    flex-direction: column;
    gap: 40px;
  }

  & > .text-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 380px;

    @media screen and (max-width: 550px) {
      width: 100%;

      & > h3 {
        text-align: center;
      }
    }

    & > h3 {
      font-size: 2rem;
      color: ${de.primary500};
      font-weight: 600;
      font-family: 'Chillax';
    }

    & > p {
      line-height: 28px;
      text-align: justify;
    }
  }

  & > .icons-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
`,FA=be.div`
  display: flex;
  gap: 20px;
  align-items: center;
  padding: 10px 20px;
  border-radius: 5px;
  background-color: ${n=>n.active?de.primary500:de.primary400};
  color: ${de.white};
  transition: all 0.3s;

  &:hover {
    background-color: ${de.primary500};
  }

  & > i {
    width: 20px;
  }

  & > p {
    white-space: nowrap;
  }
`,Lle=be.div`
  display: flex;
  justify-content: center;
  gap: 10px;

  & > a {
    text-decoration: none;
    color: ${de.white};
    background-color: ${de.primary400};
    width: 40px;
    height: 40px;
    font-size: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 5px;
    transition: all 0.3s;
    cursor: pointer;

    &:hover {
      background-color: ${de.primary500};
    }
  }
`,X6="/assets/incognita-fd07f6db.png",J6=()=>{const[n,r]=le.useState(window.innerWidth);return le.useEffect(()=>{window.addEventListener("resize",()=>{r(window.innerWidth)})},[]),n},Mle=()=>O.jsx(Ule,{}),Ule=be.div`
  width: 24px;
  height: 24px;
  border: 5px dotted #FFF;
  border-radius: 50%;
  display: inline-block;
  position: relative;
  box-sizing: border-box;
animation: rotation 2s linear infinite;

  @keyframes rotation {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  } 
`,jle="/assets/foto-138ed0de.jpg",Vle=()=>O.jsxs(O.Fragment,{children:[O.jsx("p",{children:"Los pasos para evitar el ataque de la mancha bacteriana deben de iniciar de la mano al inicio de la temporada. Ya que este patgeno puede ser transmitido por las semillas, por lo que pueden aparecer manchas tempranas en las plntulas mientras se encuentran en el invernadero."}),O.jsx("p",{children:"Las bacterias se propagan de una planta a otra planta mediante el agua, la mayora de las veces a travs de gotas de salpicaduras del riego superior, lluvia, aplicaciones sin relizar el metodod correcto. Dado que las bacterias prefieren los ambientes clidos y hmedos, los trasplantes que crecen en un invernadero ofrecen un hogar perfecto para las manchas bacterianas."}),O.jsx("p",{children:"Es importante el uso de semillas y trasplantes sin enfermedades para el control temprano de la mancha bacteriana. Rociar cobre puede brindar niveles moderados de proteccin. Cuando se presenten manchas bacterianas, evitar el uso de riego desde arriba. La rotacin de cultivos no hospederos y el control de las hierbas y plantas silvestres son buenas medidas preventivas. Buenas prcticas de saneamiento, que incluyen limpiar el equipo usado en campos enfermos y arar los restos de las plantas inmediatamente despus de la cosecha, pueden ayudar a reducir las prdidas por esta enfermedad."})]}),Fle=()=>O.jsxs(O.Fragment,{children:[O.jsx("p",{children:"Los sntomas de la Mancha Bacteriana pueden aparecer en todas las partes superficiales de la planta. Los primeros sntomas observados en las hojas son manchas oscuras, acuosas y circulares que miden menos de 3 mm de dimetro."}),O.jsx("p",{children:"Estas manchas se vuelven angulares y la superficie puede parecer grasienta, con el centro traslcido y el borde negro. Los centros de estas lesiones se secan y agrietan pronto y una aureola amarilla podra aparecer alrededor de la lesin. Las lesiones tienden a ser ms numerosas en el follaje joven."}),O.jsx("p",{children:"Durante periodos de abundante humedad (lluvias fuertes, neblina o roco) las hojas tendrn una apariencia marchita en vez de las tpicas manchas en las hojas. Las infecciones en el fruto comienzan como pequeos puntos realzados de color negro, que pueden estar rodeados con una aureola blanca de apariencia grasienta. Estas lesiones pueden alcanzar entre 4 y 5 mm de dimetro y tornarse cafs, estar ligeramente realzadas y tener una apariencia costrosa. Pueden tambin tener los bordes realzados y estar hundidas al centro."})]}),Ble=()=>O.jsxs(O.Fragment,{children:[O.jsx("b",{children:"1. Control qumico"}),O.jsx("p",{children:"El control qumico de esta enfermedad es complejo. La existencia de numerosas especies y razas favorece la rpida aparicin de resistencias a las materias activas utilizadas. Por esta razn, se recomienda prevenir la enfermedad con tratamientos regulares a base de cobre."}),O.jsx("p",{children:"Una vez instalado en el cultivo el patgeno, se puede optar por realizar 2 tratamientos semanales de cobre y en uno de ellos, aplicar adems Mancozeb y Maneb alternativamente para reforzar la funcin fungicida-bactericida del cobre y evitar la aparicin de resistencias."}),O.jsx("b",{children:"2. Control biolgico"}),O.jsx("p",{children:"A nivel de semilleros, la utilizacin de bacterifagos para controlar la enfermedad en trasplantes ha resultado un xito."})]}),y4="/assets/foto-7a1d6e08.jpg",Wle=()=>O.jsxs(O.Fragment,{children:[O.jsx("p",{children:"CONTROL QUIMICO DEL TIZON TEMPRANO "}),O.jsx("p",{children:"Tratamientos preventivos: si las condiciones climticas favorecen el tizn temprano, se recomienda un programa de tratamiento preventivo, que comienza despus del trasplante con un intervalo de 7-10 das."}),O.jsx("p",{children:"Tratamientos de control: una variedad de fungicidas son efectivas para el control del tizn temprano."}),O.jsx("p",{children:"Los fungicidas ms comunes que se usan para el control del tizn temprano incluyen Mancozeb, Maneb, Chlorothalonil, difenoconazole y oxicloruro de cobre."})]}),zle=()=>O.jsxs(O.Fragment,{children:[O.jsx("p",{children:"Hojas: los primeros sntomas aparecen en las hojas inferiores como manchas marrones irregulares o redondas. Las primeras manchas son pequeas, pero a medida que la enfermedad avanza, se agrandan y alcanzan un tamao de 1,5 cm. Los anillos concntricos se desarrollan dentro de las manchas y son frecuentemente rodeadas con un halo amarillo. Los sntomas se extienden por toda la planta y pueden afectar a las hojas superiores de la planta, el tallo y la fruta."}),O.jsx("p",{children:"La enfermedad puede resultar en una fuerte defoliacin de las hojas inferiores. Esto expone la fruta a la quemadura de sol. La defoliacin podra resultar en una prdida de rendimiento del 30-50%."}),O.jsx("p",{children:"Tallo: los sntomas en los tallos aparecen como lesiones marrones con anillos concntricos oscuros. En las plntulas, los sntomas aparecen justo por encima de la lnea del suelo."}),O.jsx("p",{children:"Fruto: los sntomas pueden aparecer en frutos maduros o inmaduros, cerca del tallo. Las manchas son oscuras con anillos concntricos."})]}),Hle=()=>O.jsxs(O.Fragment,{children:[O.jsx("p",{children:"Utilizar 3-4 aos de rotacin de cultivos con cultivos no solanceos. Dado que el tizn temprano se transmite por el suelo, la rotacin de cultivos puede ayudar a reducir el nivel de patgeno."}),O.jsx("p",{children:"Usar riego por goteo en lugar de riego por aspersores puede ayudar a mantener el follaje seco."}),O.jsx("p",{children:"Seleccionar variedades resistentes que sean menos susceptibles al tizn temprano."}),O.jsx("p",{children:"Durante la produccin:"}),O.jsx("p",{children:"La deteccin temprana del tizn temprano es importante para reducir la gravedad de la enfermedad y permite tomar medidas adicionales antes de que la enfermedad se propague. Por lo tanto, es esencial conocer los sntomas iniciales y realizar un monitoreo regular de las plantas."}),O.jsx("p",{children:"Las herramientas digitales, que estn disponibles en la actualidad, pueden ayudar a predecir las condiciones para el desarrollo de la enfermedad e identificar correctamente el tizn temprano."}),O.jsx("p",{children:"Utilice herramientas de poda desinfectadas."}),O.jsx("p",{children:"Destruye las plantas enfermas inmediatamente despus de la cosecha."}),O.jsx("p",{children:"Elimine las malezas solanceas que podran ser huspedes alternativos para Alternaria. Por ejemplo, Datura spp. (Jimsonweed), Solanum carolinense y Solanum ptycanthum."})]}),Z6={"Mancha Bacteriana":{foto:jle,sintomas:O.jsx(Fle,{}),prevencion:O.jsx(Vle,{}),tratamiento:O.jsx(Ble,{})},"Tizon Temprano":{foto:y4,sintomas:O.jsx(zle,{}),prevencion:O.jsx(Wle,{}),tratamiento:O.jsx(Hle,{})},"Tomate Sano":{foto:y4}},Gle=({close:n,enfermedad:r,page:s})=>{const{publicidadEspecifica:c}=Lw();return O.jsx(Kv,{close:n,children:O.jsxs(Kle,{children:[O.jsx("button",{onClick:n,children:O.jsx("i",{className:"fa-solid fa-xmark"})}),O.jsx("h3",{children:s==="sintomas"?"Sntomas":s==="tratamiento"?"Tratamiento":s==="prevencion"&&"Prevencin"}),O.jsx(qle,{id:"info",children:Z6[r][s]}),c&&O.jsx(K6,{size:120,padding:32,tipo:"E"})]})})},Kle=be.div`
  width: 800px;
  height: 550px;
  background-color: ${de.primary300};
  padding: 40px 40px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: center;
  position: relative;
  
  & > h3 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
    line-height: 32px;
  }

  & > button {
    position: absolute;
    right: 45px;
    top: 45px;
    border: none;
    background-color: transparent;
    color: ${de.primary500};
    font-size: 1.2rem;
    cursor: pointer;
    transition: scale 0.3s;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    align-self: flex-start;

    &:hover {
      scale: 1.2;
    }

    @media screen and (max-width: 500px) {
      right: 20px;
    }
  }

  @media screen and (max-width: 820px) {
    width: 100%;
  }
  @media screen and (max-width: 500px) {
    padding: 40px 20px;
  }
`,qle=be.div`
  border: 2px solid ${de.primary500};
  background-color: ${de.primary200};
  height: 60%;
  padding: 40px;
  display: flex;
  flex-direction: column;
  overflow: auto;
  gap: 20px;
  
  & > b {
    font-size: 1.2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }

  & > p {
    opacity: 0.8;
    line-height: 28px;
  }
`;be.div`
  display: flex;

  & > div {
    margin: 0 32px;
  }

  @media screen and (max-width: 590px) {
    align-self: flex-start;
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    padding: 16px 0 40px;
  }
`;const xv=({src:n,label:r,borderRadius:s=0,border:c=0,size:d})=>{const[p,g]=le.useState(!1);return O.jsxs(O.Fragment,{children:[O.jsxs(Yle,{border:c,borderRadius:s,children:[O.jsx($le,{src:n,onClick:()=>g(!0)}),r&&O.jsx(Xle,{children:r})]}),p&&O.jsx(Kv,{close:()=>g(!1),children:O.jsxs(Jle,{children:[r&&O.jsx("p",{children:r}),O.jsx("div",{children:O.jsx(Zle,{onClick:()=>g(!1),src:n})})]})})]})},Yle=be.div`
  width: ${n=>n.size?n.size+"px":"100%"};
  height: ${n=>n.size?n.size+"px":"100%"};
  position: relative;
  border: ${n=>n.border+"px solid "+de.primary500};
  border-radius: ${n=>n.borderRadius+"px"};
  overflow: hidden;
`,$le=be.img`
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: pointer;
`,Xle=be.p`
  position: absolute;
  background-color: ${de.primary500};
  color: ${de.white};
  padding: 7px 15px;
  top: 12px;
  left: 15px;
  font-size: 12px;
  transition: all 1s;
  pointer-events: none;

  @media screen and (max-width: 500px) {
    font-size: .8rem;
  }
`,Jle=be.div`
  display: flex;
  flex-direction: column;
  animation: growImage .5s;
  cursor: pointer;
  background-color: ${de.primary200};
  border: 4px solid ${de.primary400};
  max-width: 95%;
  width: 620px;

  & > p {
    width: 100%;
    padding: 8px 16px 4px;
    font-weight: 600;
    color: ${de.primary500};
  }

  & > div {
    width: 100%;
    height: 450px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  @keyframes growImage {
    from {
      scale: .3;
    }
    to {
      scale: 1;
    }
  }
`,Zle=be.img`
  width: 100%;
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  
`,Q6=({data:n,component:r,borderWidth:s,borderColor:c=de.primary500,interval:d=6e3})=>{const{active:p,changeActive:g}=RN(d,n.length);return O.jsxs(Qle,{borderWidth:s,borderColor:c,children:[n.map((y,T)=>O.jsx(ede,{active:T===p,children:r(y,T)},T)),O.jsx(tde,{children:n.map((y,T)=>O.jsx(ide,{active:T===p,onClick:()=>g(T)}))})]})},Qle=be.div`
  border: ${n=>n.borderWidth}px solid ${n=>n.borderColor};
  width: 100%;
  height: 100%;
  position: relative;
  isolation: isolate;
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.3);
`,ede=be.div`
  position: absolute;
  inset: 0;
  opacity: ${n=>n.active?1:0};
  transition: opacity 1s;
  pointer-events: ${n=>!n.active&&"none"};

  & > * {
    width: 100%;
    height: 100%;
  }
`,tde=be.div`
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 6px 0;
  background-color: ${de.primary500opacity};
  backdrop-filter: blur(4px);
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 4px;
`,ide=be.button`
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: none;
  border: 2px solid ${de.white};
  background-color: ${n=>n.active&&de.primary500};
  cursor: pointer;
  transition: background-color 1s;
`,nde=({data:n,preview:r,reset:s})=>{const c=n.prediccion,[d,p]=le.useState(null),{user:g}=$s(),y=`${g.pais}_${g.email}`,T=[{src:r,label:"Foto subida"},{src:`/output/${y}`,label:"Deteccin de la hoja"},{src:`/output/Area${y}`,label:"rea hoja detectada"}];return O.jsxs(rde,{children:[O.jsxs(ode,{children:[O.jsx(sde,{onClick:s,children:O.jsx("i",{className:"fa-solid fa-xmark"})}),O.jsx("h2",{children:"Prediccin"}),O.jsxs("p",{className:"prediccion",children:[n.prediccion," ",n.porcentaje,"%"]}),O.jsxs("div",{className:"images-container",children:[O.jsx(xv,{src:Z6[c].foto}),O.jsx("div",{children:O.jsx(Q6,{data:T,borderWidth:4,component:R=>O.jsx(xv,{src:R.src,label:R.label})})})]}),O.jsxs("div",{className:"buttons-container",children:[O.jsx(Gi,{disabled:c==="Tomate Sano",bg:de.pastel3,width:"200px",type:"primary",onClick:()=>p("sintomas"),children:"Sntomas"}),O.jsx(Gi,{disabled:c==="Tomate Sano",bg:de.tertiary300,width:"200px",type:"primary",onClick:()=>p("prevencion"),children:"Prevencin"}),O.jsx(Gi,{disabled:c==="Tomate Sano",bg:de.tertiary500,width:"200px",type:"primary",onClick:()=>p("tratamiento"),children:"Tratamiento"})]})]}),d&&O.jsx(Gle,{close:()=>p(null),enfermedad:c,page:d})]})},rde=be.section`
  min-height: calc(100dvh - 32px);
  padding: 85px 240px 0px;
  display: flex;
  flex-direction: column;
  animation: appearResult 2s;
  justify-content: center;

  @media screen and (max-width: 1420px) {
    padding: 85px 100px 0px;
  }

  @media screen and (max-width: 700px) {
    padding: 85px 0 0;
  }

  @keyframes appearResult {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`,ode=be.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  min-width: 400px;
  padding: 8px 32px 20px;
  background-color: ${de.primary300};
  gap: 32px;
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.2);

  @media screen and (max-height: 700px) {
    gap: 8px
  }

  @media screen and (max-width: 500px) {
    padding: 0px 8px 20px;
    width: 100%;
  }

  & h2 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }

  & .prediccion {
    padding: 8px 16px;
    background-color: ${de.tertiary600};
    color: ${de.white};
    font-weight: 600;
  }

  & .images-container {
    margin: 12px 0;
    display: flex;
    gap: 24px;
    width: 100%;
    justify-content: space-evenly;
    align-items: center;
    flex-direction: row;
    
    & > * {
      height: 280px;
      width: 440px;

      @media screen and (max-width: 500px) {
        width: 300px;
        height: 200px;
      }
    }

    & > div:first-child {
      border: 4px solid ${de.primary500};
    }

    @media screen and (max-width: 1090px) {
      flex-direction: column;
    }

    @media screen and (max-width: 500px) {
      width: 320px;
    }
  }

  & .buttons-container {
    display: flex;
    gap: 24px;
    justify-content: center;

    @media screen and (max-width: 930px) {
      flex-direction: column;
    }
  }
`,sde=be.button`
  border: none;
  background-color: transparent;
  color: ${de.primary500};
  font-size: 1.2rem;
  cursor: pointer;
  transition: scale 0.3s;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  align-self: flex-start;
  position: absolute;
  top: 12px;
  right: 32px;

  &:hover {
    scale: 1.2;
  }
`,ade=({preview:n,reset:r})=>O.jsx(cde,{children:O.jsxs(lde,{children:[O.jsx("h2",{children:"Error!"}),O.jsxs("p",{children:["La foto subida no corresponde a una hoja de tomate o tiene una probabilidad ","< 70%"]}),O.jsx("img",{src:n}),O.jsx(Gi,{type:"secondary",onClick:r,children:"Subir otra imagen"})]})}),cde=be.section`
  min-height: calc(100dvh - 32px);
  padding: 85px 240px 0px;
  display: flex;
  flex-direction: column;
  animation: appearResult 2s;
  justify-content: center;

  @media screen and (max-width: 1420px) {
    padding: 85px 100px 0px;
  }

  @media screen and (max-width: 700px) {
    padding: 85px 0 0;
  }

  @keyframes appearResult {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`,lde=be.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 400px;
  padding: 20px 32px 20px;
  background-color: ${de.primary300};
  gap: 8px;
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.2);

  @media screen and (max-height: 700px) {
    gap: 12px
  }

  @media screen and (max-width: 500px) {
    padding: 0px 8px 20px;
    width: 100%;
  }

  & h2 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }

  & > p {
    font-size: 1.1rem;
    padding: 8px 16px;
    background-color: ${de.tertiary600};
    color: ${de.white};
    font-weight: 600;
  }

  & img {
    max-height: 400px;
    border: 4px solid ${de.primary500};
  }
`,dde=()=>{const n=J6(),{user:r}=$s(),{changeColor:s}=qv(),[c,d]=le.useState(null),[p,g]=le.useState(null),[y,T]=le.useState(!1),[R,N]=le.useState(null),[D,B]=le.useState("enfermedad"),q=Tl();le.useEffect(()=>{s(n>560?de.primary200:de.secondary500)},[n]),le.useEffect(()=>{if(c){const te=new FileReader;te.readAsDataURL(c),te.addEventListener("load",()=>{g(te.result)})}},[c]);const J=async()=>{T(!0);const te=new FormData;te.append("pais_user",r.pais),te.append("email_user",r.email),te.append("file",c),te.append("type",D);const Z=await q("analizar",te,"POST",!0);if(Z.ok){const ee=await Z.json();N(ee)}else Oo.fire({title:"Ups! algo sali mal",text:"Vuelva a intentarlo",icon:"error"});T(!1)},Y=()=>{d(null),g(null),N(null)};return R?R.error?O.jsx(ade,{reset:Y,preview:p}):(console.log(R),O.jsx(nde,{reset:Y,data:R.data,preview:p})):O.jsx(ude,{children:O.jsxs(hde,{children:[O.jsx(_de,{children:O.jsx("img",{src:c?p:X6})}),O.jsxs(pde,{children:[O.jsxs(fde,{children:[O.jsx("h2",{children:"Analizar imagen"}),O.jsx("p",{children:"Formatos permitidos: .jpg"})]}),O.jsxs(mde,{children:[O.jsxs(gde,{children:[O.jsxs("p",{children:["Seleccionar foto de hojas de la planta de tomate","."]}),O.jsxs("select",{value:D,onChange:te=>B(te.target.value),children:[O.jsx("option",{value:"enfermedad",children:"Enfermedad"}),O.jsx("option",{value:"plaga",children:"Plaga"})]}),O.jsxs("div",{className:"inputContainer",children:[O.jsx("label",{htmlFor:"inputfile",children:c?"Seleccionar otra foto":"Seleccionar una foto"}),O.jsx("input",{onChange:te=>d(te.target.files[0]),accept:".jpg",id:"inputfile",type:"file"})]})]}),O.jsx(Gi,{onClick:J,disabled:!c||y,type:"secondary",width:"147px",children:y?O.jsx(Mle,{}):"Subir foto"})]})]})]})})},ude=be.section`
  min-height: calc(100dvh - 32px);
  padding: 145px 140px 60px;
  display: flex;
  justify-content: space-around;
  align-items: center;

  @media screen and (max-width: 560px) {
    padding: 85px 0 0;
  }
`,hde=be.div`
  background-color: ${de.secondary500};
  padding: 60px 60px 60px;
  color: ${de.secondary600};
  display: flex;
  justify-content: space-between;
  gap: 60px;
  min-height: 400px;
  max-width: 1077px;
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.15);

  @media screen and (max-width: 1100px) {
    flex-direction: column;
    align-items: center;
  }
  @media screen and (max-width: 560px) {
    width: 100%;
    padding: 60px 40px 80px;
    border-bottom: none;
  }
`,pde=be.div`
  min-height: 250px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  gap: 20px;
`,fde=be.div`
  display: flex;
  flex-direction: column;
  gap: 12px;

  & > h2 {
    font-size: 2rem;
    font-weight: 600;
    font-family: 'Chillax';
  }
  & > p {
    opacity: 0.7;
  }
`,mde=be.div`
  display: flex;
  gap: 60px;
  align-items: end;

  @media screen and (max-width: 780px) {
    flex-direction: column;
    gap: 20px;
    align-items: center;

    & > button {
      width: 100%;
    }
  }
`,gde=be.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 270px;

  @media screen and (max-width: 560px) {
    width: auto;
  }

  & > p {
    text-align: justify;
    line-height: 28px;
  }

  & > select {
    background-color: ${de.secondary400};
    border: 2px solid ${de.primary500};
    padding: 4px 16px;
    color: ${de.primary500}
  }

  & > .inputContainer {
    height: 58px;
    position: relative;

    & > label {
      background-color: ${de.secondary400};
      cursor: pointer;
      border: 3px dashed ${de.secondary600};
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;

      &:hover {
        opacity: 0.7;
      }
    }

    & > input {
      display: none;
    }
  }
`,_de=be.div`
  width: 406px;
  height: 280px;
  display: flex;
  justify-content: center;

  & > img {
    width: 100%;
    max-width: 100%;
    max-height: 100%;
    border: 4px solid ${de.secondary300};
    object-fit: contain;
    object-position: center;
  }
`;/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function Yv(n){return n+.5|0}const Wu=(n,r,s)=>Math.max(Math.min(n,s),r);function KE(n){return Wu(Yv(n*2.55),0,255)}function nh(n){return Wu(Yv(n*255),0,255)}function hd(n){return Wu(Yv(n/2.55)/100,0,1)}function S4(n){return Wu(Yv(n*100),0,100)}const Oa={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},rP=[..."0123456789ABCDEF"],Ede=n=>rP[n&15],vde=n=>rP[(n&240)>>4]+rP[n&15],US=n=>(n&240)>>4===(n&15),yde=n=>US(n.r)&&US(n.g)&&US(n.b)&&US(n.a);function Sde(n){var r=n.length,s;return n[0]==="#"&&(r===4||r===5?s={r:255&Oa[n[1]]*17,g:255&Oa[n[2]]*17,b:255&Oa[n[3]]*17,a:r===5?Oa[n[4]]*17:255}:(r===7||r===9)&&(s={r:Oa[n[1]]<<4|Oa[n[2]],g:Oa[n[3]]<<4|Oa[n[4]],b:Oa[n[5]]<<4|Oa[n[6]],a:r===9?Oa[n[7]]<<4|Oa[n[8]]:255})),s}const Tde=(n,r)=>n<255?r(n):"";function wde(n){var r=yde(n)?Ede:vde;return n?"#"+r(n.r)+r(n.g)+r(n.b)+Tde(n.a,r):void 0}const Cde=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function eG(n,r,s){const c=r*Math.min(s,1-s),d=(p,g=(p+n/30)%12)=>s-c*Math.max(Math.min(g-3,9-g,1),-1);return[d(0),d(8),d(4)]}function bde(n,r,s){const c=(d,p=(d+n/60)%6)=>s-s*r*Math.max(Math.min(p,4-p,1),0);return[c(5),c(3),c(1)]}function Rde(n,r,s){const c=eG(n,1,.5);let d;for(r+s>1&&(d=1/(r+s),r*=d,s*=d),d=0;d<3;d++)c[d]*=1-r-s,c[d]+=r;return c}function Ide(n,r,s,c,d){return n===d?(r-s)/c+(r<s?6:0):r===d?(s-n)/c+2:(n-r)/c+4}function IN(n){const s=n.r/255,c=n.g/255,d=n.b/255,p=Math.max(s,c,d),g=Math.min(s,c,d),y=(p+g)/2;let T,R,N;return p!==g&&(N=p-g,R=y>.5?N/(2-p-g):N/(p+g),T=Ide(s,c,d,N,p),T=T*60+.5),[T|0,R||0,y]}function AN(n,r,s,c){return(Array.isArray(r)?n(r[0],r[1],r[2]):n(r,s,c)).map(nh)}function ON(n,r,s){return AN(eG,n,r,s)}function Ade(n,r,s){return AN(Rde,n,r,s)}function Ode(n,r,s){return AN(bde,n,r,s)}function tG(n){return(n%360+360)%360}function Pde(n){const r=Cde.exec(n);let s=255,c;if(!r)return;r[5]!==c&&(s=r[6]?KE(+r[5]):nh(+r[5]));const d=tG(+r[2]),p=+r[3]/100,g=+r[4]/100;return r[1]==="hwb"?c=Ade(d,p,g):r[1]==="hsv"?c=Ode(d,p,g):c=ON(d,p,g),{r:c[0],g:c[1],b:c[2],a:s}}function Nde(n,r){var s=IN(n);s[0]=tG(s[0]+r),s=ON(s),n.r=s[0],n.g=s[1],n.b=s[2]}function xde(n){if(!n)return;const r=IN(n),s=r[0],c=S4(r[1]),d=S4(r[2]);return n.a<255?`hsla(${s}, ${c}%, ${d}%, ${hd(n.a)})`:`hsl(${s}, ${c}%, ${d}%)`}const T4={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},w4={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Dde(){const n={},r=Object.keys(w4),s=Object.keys(T4);let c,d,p,g,y;for(c=0;c<r.length;c++){for(g=y=r[c],d=0;d<s.length;d++)p=s[d],y=y.replace(p,T4[p]);p=parseInt(w4[g],16),n[y]=[p>>16&255,p>>8&255,p&255]}return n}let jS;function kde(n){jS||(jS=Dde(),jS.transparent=[0,0,0,0]);const r=jS[n.toLowerCase()];return r&&{r:r[0],g:r[1],b:r[2],a:r.length===4?r[3]:255}}const Lde=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Mde(n){const r=Lde.exec(n);let s=255,c,d,p;if(r){if(r[7]!==c){const g=+r[7];s=r[8]?KE(g):Wu(g*255,0,255)}return c=+r[1],d=+r[3],p=+r[5],c=255&(r[2]?KE(c):Wu(c,0,255)),d=255&(r[4]?KE(d):Wu(d,0,255)),p=255&(r[6]?KE(p):Wu(p,0,255)),{r:c,g:d,b:p,a:s}}}function Ude(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${hd(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const BA=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,Xm=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function jde(n,r,s){const c=Xm(hd(n.r)),d=Xm(hd(n.g)),p=Xm(hd(n.b));return{r:nh(BA(c+s*(Xm(hd(r.r))-c))),g:nh(BA(d+s*(Xm(hd(r.g))-d))),b:nh(BA(p+s*(Xm(hd(r.b))-p))),a:n.a+s*(r.a-n.a)}}function VS(n,r,s){if(n){let c=IN(n);c[r]=Math.max(0,Math.min(c[r]+c[r]*s,r===0?360:1)),c=ON(c),n.r=c[0],n.g=c[1],n.b=c[2]}}function iG(n,r){return n&&Object.assign(r||{},n)}function C4(n){var r={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(r={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(r.a=nh(n[3]))):(r=iG(n,{r:0,g:0,b:0,a:1}),r.a=nh(r.a)),r}function Vde(n){return n.charAt(0)==="r"?Mde(n):Pde(n)}class Dv{constructor(r){if(r instanceof Dv)return r;const s=typeof r;let c;s==="object"?c=C4(r):s==="string"&&(c=Sde(r)||kde(r)||Vde(r)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var r=iG(this._rgb);return r&&(r.a=hd(r.a)),r}set rgb(r){this._rgb=C4(r)}rgbString(){return this._valid?Ude(this._rgb):void 0}hexString(){return this._valid?wde(this._rgb):void 0}hslString(){return this._valid?xde(this._rgb):void 0}mix(r,s){if(r){const c=this.rgb,d=r.rgb;let p;const g=s===p?.5:s,y=2*g-1,T=c.a-d.a,R=((y*T===-1?y:(y+T)/(1+y*T))+1)/2;p=1-R,c.r=255&R*c.r+p*d.r+.5,c.g=255&R*c.g+p*d.g+.5,c.b=255&R*c.b+p*d.b+.5,c.a=g*c.a+(1-g)*d.a,this.rgb=c}return this}interpolate(r,s){return r&&(this._rgb=jde(this._rgb,r._rgb,s)),this}clone(){return new Dv(this.rgb)}alpha(r){return this._rgb.a=nh(r),this}clearer(r){const s=this._rgb;return s.a*=1-r,this}greyscale(){const r=this._rgb,s=Yv(r.r*.3+r.g*.59+r.b*.11);return r.r=r.g=r.b=s,this}opaquer(r){const s=this._rgb;return s.a*=1+r,this}negate(){const r=this._rgb;return r.r=255-r.r,r.g=255-r.g,r.b=255-r.b,this}lighten(r){return VS(this._rgb,2,r),this}darken(r){return VS(this._rgb,2,-r),this}saturate(r){return VS(this._rgb,1,r),this}desaturate(r){return VS(this._rgb,1,-r),this}rotate(r){return Nde(this._rgb,r),this}}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */function od(){}const Fde=(()=>{let n=0;return()=>n++})();function mn(n){return n===null||typeof n>"u"}function Yn(n){if(Array.isArray&&Array.isArray(n))return!0;const r=Object.prototype.toString.call(n);return r.slice(0,7)==="[object"&&r.slice(-6)==="Array]"}function Wi(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Gr(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function Bs(n,r){return Gr(n)?n:r}function en(n,r){return typeof n>"u"?r:n}const Bde=(n,r)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*r:+n;function Rn(n,r,s){if(n&&typeof n.call=="function")return n.apply(s,r)}function an(n,r,s,c){let d,p,g;if(Yn(n))if(p=n.length,c)for(d=p-1;d>=0;d--)r.call(s,n[d],d);else for(d=0;d<p;d++)r.call(s,n[d],d);else if(Wi(n))for(g=Object.keys(n),p=g.length,d=0;d<p;d++)r.call(s,n[g[d]],g[d])}function ew(n,r){let s,c,d,p;if(!n||!r||n.length!==r.length)return!1;for(s=0,c=n.length;s<c;++s)if(d=n[s],p=r[s],d.datasetIndex!==p.datasetIndex||d.index!==p.index)return!1;return!0}function tw(n){if(Yn(n))return n.map(tw);if(Wi(n)){const r=Object.create(null),s=Object.keys(n),c=s.length;let d=0;for(;d<c;++d)r[s[d]]=tw(n[s[d]]);return r}return n}function nG(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function Wde(n,r,s,c){if(!nG(n))return;const d=r[n],p=s[n];Wi(d)&&Wi(p)?kv(d,p,c):r[n]=tw(p)}function kv(n,r,s){const c=Yn(r)?r:[r],d=c.length;if(!Wi(n))return n;s=s||{};const p=s.merger||Wde;let g;for(let y=0;y<d;++y){if(g=c[y],!Wi(g))continue;const T=Object.keys(g);for(let R=0,N=T.length;R<N;++R)p(T[R],n,g,s)}return n}function av(n,r){return kv(n,r,{merger:zde})}function zde(n,r,s){if(!nG(n))return;const c=r[n],d=s[n];Wi(c)&&Wi(d)?av(c,d):Object.prototype.hasOwnProperty.call(r,n)||(r[n]=tw(d))}const b4={"":n=>n,x:n=>n.x,y:n=>n.y};function Hde(n){const r=n.split("."),s=[];let c="";for(const d of r)c+=d,c.endsWith("\\")?c=c.slice(0,-1)+".":(s.push(c),c="");return s}function Gde(n){const r=Hde(n);return s=>{for(const c of r){if(c==="")break;s=s&&s[c]}return s}}function kg(n,r){return(b4[r]||(b4[r]=Gde(r)))(n)}function PN(n){return n.charAt(0).toUpperCase()+n.slice(1)}const Lv=n=>typeof n<"u",ah=n=>typeof n=="function",R4=(n,r)=>{if(n.size!==r.size)return!1;for(const s of n)if(!r.has(s))return!1;return!0};function Kde(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const Po=Math.PI,Sl=2*Po,iw=Number.POSITIVE_INFINITY,qde=Po/180,Hs=Po/2,xp=Po/4,I4=Po*2/3,zu=Math.log10,rh=Math.sign;function mT(n,r,s){return Math.abs(n-r)<s}function A4(n){const r=Math.round(n);n=mT(n,r,n/1e3)?r:n;const s=Math.pow(10,Math.floor(zu(n))),c=n/s;return(c<=1?1:c<=2?2:c<=5?5:10)*s}function Yde(n){const r=[],s=Math.sqrt(n);let c;for(c=1;c<s;c++)n%c===0&&(r.push(c),r.push(n/c));return s===(s|0)&&r.push(s),r.sort((d,p)=>d-p).pop(),r}function nw(n){return!isNaN(parseFloat(n))&&isFinite(n)}function $de(n,r){const s=Math.round(n);return s-r<=n&&s+r>=n}function rG(n,r,s){let c,d,p;for(c=0,d=n.length;c<d;c++)p=n[c][s],isNaN(p)||(r.min=Math.min(r.min,p),r.max=Math.max(r.max,p))}function Hu(n){return n*(Po/180)}function NN(n){return n*(180/Po)}function O4(n){if(!Gr(n))return;let r=1,s=0;for(;Math.round(n*r)/r!==n;)r*=10,s++;return s}function Xde(n,r){const s=r.x-n.x,c=r.y-n.y,d=Math.sqrt(s*s+c*c);let p=Math.atan2(c,s);return p<-.5*Po&&(p+=Sl),{angle:p,distance:d}}function Jde(n,r){return Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2))}function gl(n){return(n%Sl+Sl)%Sl}function Zde(n,r,s,c){const d=gl(n),p=gl(r),g=gl(s),y=gl(p-d),T=gl(g-d),R=gl(d-p),N=gl(d-g);return d===p||d===g||c&&p===g||y>T&&R<N}function Tc(n,r,s){return Math.max(r,Math.min(s,n))}function Qde(n){return Tc(n,-32768,32767)}function ug(n,r,s,c=1e-6){return n>=Math.min(r,s)-c&&n<=Math.max(r,s)+c}function xN(n,r,s){s=s||(g=>n[g]<r);let c=n.length-1,d=0,p;for(;c-d>1;)p=d+c>>1,s(p)?d=p:c=p;return{lo:d,hi:c}}const oP=(n,r,s,c)=>xN(n,s,c?d=>{const p=n[d][r];return p<s||p===s&&n[d+1][r]===s}:d=>n[d][r]<s),eue=(n,r,s)=>xN(n,s,c=>n[c][r]>=s);function tue(n,r,s){let c=0,d=n.length;for(;c<d&&n[c]<r;)c++;for(;d>c&&n[d-1]>s;)d--;return c>0||d<n.length?n.slice(c,d):n}const oG=["push","pop","shift","splice","unshift"];function iue(n,r){if(n._chartjs){n._chartjs.listeners.push(r);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[r]}}),oG.forEach(s=>{const c="_onData"+PN(s),d=n[s];Object.defineProperty(n,s,{configurable:!0,enumerable:!1,value(...p){const g=d.apply(this,p);return n._chartjs.listeners.forEach(y=>{typeof y[c]=="function"&&y[c](...p)}),g}})})}function P4(n,r){const s=n._chartjs;if(!s)return;const c=s.listeners,d=c.indexOf(r);d!==-1&&c.splice(d,1),!(c.length>0)&&(oG.forEach(p=>{delete n[p]}),delete n._chartjs)}function sG(n){const r=new Set(n);return r.size===n.length?n:Array.from(r)}const aG=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function cG(n,r){let s=[],c=!1;return function(...d){s=d,c||(c=!0,aG.call(window,()=>{c=!1,n.apply(r,s)}))}}function nue(n,r){let s;return function(...c){return r?(clearTimeout(s),s=setTimeout(n,r,c)):n.apply(this,c),r}}const lG=n=>n==="start"?"left":n==="end"?"right":"center",Fs=(n,r,s)=>n==="start"?r:n==="end"?s:(r+s)/2,rue=(n,r,s,c)=>n===(c?"left":"right")?s:n==="center"?(r+s)/2:r,FS=n=>n===0||n===1,N4=(n,r,s)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-r)*Sl/s)),x4=(n,r,s)=>Math.pow(2,-10*n)*Math.sin((n-r)*Sl/s)+1,cv={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*Hs)+1,easeOutSine:n=>Math.sin(n*Hs),easeInOutSine:n=>-.5*(Math.cos(Po*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>FS(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>FS(n)?n:N4(n,.075,.3),easeOutElastic:n=>FS(n)?n:x4(n,.075,.3),easeInOutElastic(n){return FS(n)?n:n<.5?.5*N4(n*2,.1125,.45):.5+.5*x4(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let r=1.70158;return(n/=.5)<1?.5*(n*n*(((r*=1.525)+1)*n-r)):.5*((n-=2)*n*(((r*=1.525)+1)*n+r)+2)},easeInBounce:n=>1-cv.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?cv.easeInBounce(n*2)*.5:cv.easeOutBounce(n*2-1)*.5+.5};function dG(n){if(n&&typeof n=="object"){const r=n.toString();return r==="[object CanvasPattern]"||r==="[object CanvasGradient]"}return!1}function D4(n){return dG(n)?n:new Dv(n)}function WA(n){return dG(n)?n:new Dv(n).saturate(.5).darken(.1).hexString()}const oue=["x","y","borderWidth","radius","tension"],sue=["color","borderColor","backgroundColor"];function aue(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:r=>r!=="onProgress"&&r!=="onComplete"&&r!=="fn"}),n.set("animations",{colors:{type:"color",properties:sue},numbers:{type:"number",properties:oue}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:r=>r|0}}}})}function cue(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const k4=new Map;function lue(n,r){r=r||{};const s=n+JSON.stringify(r);let c=k4.get(s);return c||(c=new Intl.NumberFormat(n,r),k4.set(s,c)),c}function DN(n,r,s){return lue(r,s).format(n)}const uG={values(n){return Yn(n)?n:""+n},numeric(n,r,s){if(n===0)return"0";const c=this.chart.options.locale;let d,p=n;if(s.length>1){const R=Math.max(Math.abs(s[0].value),Math.abs(s[s.length-1].value));(R<1e-4||R>1e15)&&(d="scientific"),p=due(n,s)}const g=zu(Math.abs(p)),y=isNaN(g)?1:Math.max(Math.min(-1*Math.floor(g),20),0),T={notation:d,minimumFractionDigits:y,maximumFractionDigits:y};return Object.assign(T,this.options.ticks.format),DN(n,c,T)},logarithmic(n,r,s){if(n===0)return"0";const c=s[r].significand||n/Math.pow(10,Math.floor(zu(n)));return[1,2,3,5,10,15].includes(c)||r>.8*s.length?uG.numeric.call(this,n,r,s):""}};function due(n,r){let s=r.length>3?r[2].value-r[1].value:r[1].value-r[0].value;return Math.abs(s)>=1&&n!==Math.floor(n)&&(s=n-Math.floor(n)),s}var Mw={formatters:uG};function uue(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(r,s)=>s.lineWidth,tickColor:(r,s)=>s.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Mw.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:r=>!r.startsWith("before")&&!r.startsWith("after")&&r!=="callback"&&r!=="parser",_indexable:r=>r!=="borderDash"&&r!=="tickBorderDash"&&r!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:r=>r!=="backdropPadding"&&r!=="callback",_indexable:r=>r!=="backdropPadding"})}const ef=Object.create(null),sP=Object.create(null);function lv(n,r){if(!r)return n;const s=r.split(".");for(let c=0,d=s.length;c<d;++c){const p=s[c];n=n[p]||(n[p]=Object.create(null))}return n}function zA(n,r,s){return typeof r=="string"?kv(lv(n,r),s):kv(lv(n,""),r)}class hue{constructor(r,s){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=c=>c.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(c,d)=>WA(d.backgroundColor),this.hoverBorderColor=(c,d)=>WA(d.borderColor),this.hoverColor=(c,d)=>WA(d.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(r),this.apply(s)}set(r,s){return zA(this,r,s)}get(r){return lv(this,r)}describe(r,s){return zA(sP,r,s)}override(r,s){return zA(ef,r,s)}route(r,s,c,d){const p=lv(this,r),g=lv(this,c),y="_"+s;Object.defineProperties(p,{[y]:{value:p[s],writable:!0},[s]:{enumerable:!0,get(){const T=this[y],R=g[d];return Wi(T)?Object.assign({},R,T):en(T,R)},set(T){this[y]=T}}})}apply(r){r.forEach(s=>s(this))}}var cr=new hue({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[aue,cue,uue]);function pue(n){return!n||mn(n.size)||mn(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function rw(n,r,s,c,d){let p=r[d];return p||(p=r[d]=n.measureText(d).width,s.push(d)),p>c&&(c=p),c}function fue(n,r,s,c){c=c||{};let d=c.data=c.data||{},p=c.garbageCollect=c.garbageCollect||[];c.font!==r&&(d=c.data={},p=c.garbageCollect=[],c.font=r),n.save(),n.font=r;let g=0;const y=s.length;let T,R,N,D,B;for(T=0;T<y;T++)if(D=s[T],D!=null&&!Yn(D))g=rw(n,d,p,g,D);else if(Yn(D))for(R=0,N=D.length;R<N;R++)B=D[R],B!=null&&!Yn(B)&&(g=rw(n,d,p,g,B));n.restore();const q=p.length/2;if(q>s.length){for(T=0;T<q;T++)delete d[p[T]];p.splice(0,q)}return g}function Dp(n,r,s){const c=n.currentDevicePixelRatio,d=s!==0?Math.max(s/2,.5):0;return Math.round((r-d)*c)/c+d}function L4(n,r){!r&&!n||(r=r||n.getContext("2d"),r.save(),r.resetTransform(),r.clearRect(0,0,n.width,n.height),r.restore())}function M4(n,r,s,c){hG(n,r,s,c,null)}function hG(n,r,s,c,d){let p,g,y,T,R,N,D,B;const q=r.pointStyle,J=r.rotation,Y=r.radius;let te=(J||0)*qde;if(q&&typeof q=="object"&&(p=q.toString(),p==="[object HTMLImageElement]"||p==="[object HTMLCanvasElement]")){n.save(),n.translate(s,c),n.rotate(te),n.drawImage(q,-q.width/2,-q.height/2,q.width,q.height),n.restore();return}if(!(isNaN(Y)||Y<=0)){switch(n.beginPath(),q){default:d?n.ellipse(s,c,d/2,Y,0,0,Sl):n.arc(s,c,Y,0,Sl),n.closePath();break;case"triangle":N=d?d/2:Y,n.moveTo(s+Math.sin(te)*N,c-Math.cos(te)*Y),te+=I4,n.lineTo(s+Math.sin(te)*N,c-Math.cos(te)*Y),te+=I4,n.lineTo(s+Math.sin(te)*N,c-Math.cos(te)*Y),n.closePath();break;case"rectRounded":R=Y*.516,T=Y-R,g=Math.cos(te+xp)*T,D=Math.cos(te+xp)*(d?d/2-R:T),y=Math.sin(te+xp)*T,B=Math.sin(te+xp)*(d?d/2-R:T),n.arc(s-D,c-y,R,te-Po,te-Hs),n.arc(s+B,c-g,R,te-Hs,te),n.arc(s+D,c+y,R,te,te+Hs),n.arc(s-B,c+g,R,te+Hs,te+Po),n.closePath();break;case"rect":if(!J){T=Math.SQRT1_2*Y,N=d?d/2:T,n.rect(s-N,c-T,2*N,2*T);break}te+=xp;case"rectRot":D=Math.cos(te)*(d?d/2:Y),g=Math.cos(te)*Y,y=Math.sin(te)*Y,B=Math.sin(te)*(d?d/2:Y),n.moveTo(s-D,c-y),n.lineTo(s+B,c-g),n.lineTo(s+D,c+y),n.lineTo(s-B,c+g),n.closePath();break;case"crossRot":te+=xp;case"cross":D=Math.cos(te)*(d?d/2:Y),g=Math.cos(te)*Y,y=Math.sin(te)*Y,B=Math.sin(te)*(d?d/2:Y),n.moveTo(s-D,c-y),n.lineTo(s+D,c+y),n.moveTo(s+B,c-g),n.lineTo(s-B,c+g);break;case"star":D=Math.cos(te)*(d?d/2:Y),g=Math.cos(te)*Y,y=Math.sin(te)*Y,B=Math.sin(te)*(d?d/2:Y),n.moveTo(s-D,c-y),n.lineTo(s+D,c+y),n.moveTo(s+B,c-g),n.lineTo(s-B,c+g),te+=xp,D=Math.cos(te)*(d?d/2:Y),g=Math.cos(te)*Y,y=Math.sin(te)*Y,B=Math.sin(te)*(d?d/2:Y),n.moveTo(s-D,c-y),n.lineTo(s+D,c+y),n.moveTo(s+B,c-g),n.lineTo(s-B,c+g);break;case"line":g=d?d/2:Math.cos(te)*Y,y=Math.sin(te)*Y,n.moveTo(s-g,c-y),n.lineTo(s+g,c+y);break;case"dash":n.moveTo(s,c),n.lineTo(s+Math.cos(te)*(d?d/2:Y),c+Math.sin(te)*Y);break;case!1:n.closePath();break}n.fill(),r.borderWidth>0&&n.stroke()}}function hg(n,r,s){return s=s||.5,!r||n&&n.x>r.left-s&&n.x<r.right+s&&n.y>r.top-s&&n.y<r.bottom+s}function kN(n,r){n.save(),n.beginPath(),n.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),n.clip()}function LN(n){n.restore()}function mue(n,r){r.translation&&n.translate(r.translation[0],r.translation[1]),mn(r.rotation)||n.rotate(r.rotation),r.color&&(n.fillStyle=r.color),r.textAlign&&(n.textAlign=r.textAlign),r.textBaseline&&(n.textBaseline=r.textBaseline)}function gue(n,r,s,c,d){if(d.strikethrough||d.underline){const p=n.measureText(c),g=r-p.actualBoundingBoxLeft,y=r+p.actualBoundingBoxRight,T=s-p.actualBoundingBoxAscent,R=s+p.actualBoundingBoxDescent,N=d.strikethrough?(T+R)/2:R;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=d.decorationWidth||2,n.moveTo(g,N),n.lineTo(y,N),n.stroke()}}function _ue(n,r){const s=n.fillStyle;n.fillStyle=r.color,n.fillRect(r.left,r.top,r.width,r.height),n.fillStyle=s}function Lg(n,r,s,c,d,p={}){const g=Yn(r)?r:[r],y=p.strokeWidth>0&&p.strokeColor!=="";let T,R;for(n.save(),n.font=d.string,mue(n,p),T=0;T<g.length;++T)R=g[T],p.backdrop&&_ue(n,p.backdrop),y&&(p.strokeColor&&(n.strokeStyle=p.strokeColor),mn(p.strokeWidth)||(n.lineWidth=p.strokeWidth),n.strokeText(R,s,c,p.maxWidth)),n.fillText(R,s,c,p.maxWidth),gue(n,s,c,R,p),c+=Number(d.lineHeight);n.restore()}function Mv(n,r){const{x:s,y:c,w:d,h:p,radius:g}=r;n.arc(s+g.topLeft,c+g.topLeft,g.topLeft,1.5*Po,Po,!0),n.lineTo(s,c+p-g.bottomLeft),n.arc(s+g.bottomLeft,c+p-g.bottomLeft,g.bottomLeft,Po,Hs,!0),n.lineTo(s+d-g.bottomRight,c+p),n.arc(s+d-g.bottomRight,c+p-g.bottomRight,g.bottomRight,Hs,0,!0),n.lineTo(s+d,c+g.topRight),n.arc(s+d-g.topRight,c+g.topRight,g.topRight,0,-Hs,!0),n.lineTo(s+g.topLeft,c)}const Eue=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,vue=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function yue(n,r){const s=(""+n).match(Eue);if(!s||s[1]==="normal")return r*1.2;switch(n=+s[2],s[3]){case"px":return n;case"%":n/=100;break}return r*n}const Sue=n=>+n||0;function pG(n,r){const s={},c=Wi(r),d=c?Object.keys(r):r,p=Wi(n)?c?g=>en(n[g],n[r[g]]):g=>n[g]:()=>n;for(const g of d)s[g]=Sue(p(g));return s}function fG(n){return pG(n,{top:"y",right:"x",bottom:"y",left:"x"})}function Kp(n){return pG(n,["topLeft","topRight","bottomLeft","bottomRight"])}function qo(n){const r=fG(n);return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function so(n,r){n=n||{},r=r||cr.font;let s=en(n.size,r.size);typeof s=="string"&&(s=parseInt(s,10));let c=en(n.style,r.style);c&&!(""+c).match(vue)&&(console.warn('Invalid font style specified: "'+c+'"'),c=void 0);const d={family:en(n.family,r.family),lineHeight:yue(en(n.lineHeight,r.lineHeight),s),size:s,style:c,weight:en(n.weight,r.weight),string:""};return d.string=pue(d),d}function BS(n,r,s,c){let d=!0,p,g,y;for(p=0,g=n.length;p<g;++p)if(y=n[p],y!==void 0&&(r!==void 0&&typeof y=="function"&&(y=y(r),d=!1),s!==void 0&&Yn(y)&&(y=y[s%y.length],d=!1),y!==void 0))return c&&!d&&(c.cacheable=!1),y}function Tue(n,r,s){const{min:c,max:d}=n,p=Bde(r,(d-c)/2),g=(y,T)=>s&&y===0?0:y+T;return{min:g(c,-Math.abs(p)),max:g(d,p)}}function sf(n,r){return Object.assign(Object.create(n),r)}function MN(n,r=[""],s,c,d=()=>n[0]){const p=s||n;typeof c>"u"&&(c=EG("_fallback",n));const g={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:p,_fallback:c,_getTarget:d,override:y=>MN([y,...n],r,p,c)};return new Proxy(g,{deleteProperty(y,T){return delete y[T],delete y._keys,delete n[0][T],!0},get(y,T){return gG(y,T,()=>Pue(T,r,n,y))},getOwnPropertyDescriptor(y,T){return Reflect.getOwnPropertyDescriptor(y._scopes[0],T)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(y,T){return j4(y).includes(T)},ownKeys(y){return j4(y)},set(y,T,R){const N=y._storage||(y._storage=d());return y[T]=N[T]=R,delete y._keys,!0}})}function Mg(n,r,s,c){const d={_cacheable:!1,_proxy:n,_context:r,_subProxy:s,_stack:new Set,_descriptors:mG(n,c),setContext:p=>Mg(n,p,s,c),override:p=>Mg(n.override(p),r,s,c)};return new Proxy(d,{deleteProperty(p,g){return delete p[g],delete n[g],!0},get(p,g,y){return gG(p,g,()=>Cue(p,g,y))},getOwnPropertyDescriptor(p,g){return p._descriptors.allKeys?Reflect.has(n,g)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,g)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(p,g){return Reflect.has(n,g)},ownKeys(){return Reflect.ownKeys(n)},set(p,g,y){return n[g]=y,delete p[g],!0}})}function mG(n,r={scriptable:!0,indexable:!0}){const{_scriptable:s=r.scriptable,_indexable:c=r.indexable,_allKeys:d=r.allKeys}=n;return{allKeys:d,scriptable:s,indexable:c,isScriptable:ah(s)?s:()=>s,isIndexable:ah(c)?c:()=>c}}const wue=(n,r)=>n?n+PN(r):r,UN=(n,r)=>Wi(r)&&n!=="adapters"&&(Object.getPrototypeOf(r)===null||r.constructor===Object);function gG(n,r,s){if(Object.prototype.hasOwnProperty.call(n,r)||r==="constructor")return n[r];const c=s();return n[r]=c,c}function Cue(n,r,s){const{_proxy:c,_context:d,_subProxy:p,_descriptors:g}=n;let y=c[r];return ah(y)&&g.isScriptable(r)&&(y=bue(r,y,n,s)),Yn(y)&&y.length&&(y=Rue(r,y,n,g.isIndexable)),UN(r,y)&&(y=Mg(y,d,p&&p[r],g)),y}function bue(n,r,s,c){const{_proxy:d,_context:p,_subProxy:g,_stack:y}=s;if(y.has(n))throw new Error("Recursion detected: "+Array.from(y).join("->")+"->"+n);y.add(n);let T=r(p,g||c);return y.delete(n),UN(n,T)&&(T=jN(d._scopes,d,n,T)),T}function Rue(n,r,s,c){const{_proxy:d,_context:p,_subProxy:g,_descriptors:y}=s;if(typeof p.index<"u"&&c(n))return r[p.index%r.length];if(Wi(r[0])){const T=r,R=d._scopes.filter(N=>N!==T);r=[];for(const N of T){const D=jN(R,d,n,N);r.push(Mg(D,p,g&&g[n],y))}}return r}function _G(n,r,s){return ah(n)?n(r,s):n}const Iue=(n,r)=>n===!0?r:typeof n=="string"?kg(r,n):void 0;function Aue(n,r,s,c,d){for(const p of r){const g=Iue(s,p);if(g){n.add(g);const y=_G(g._fallback,s,d);if(typeof y<"u"&&y!==s&&y!==c)return y}else if(g===!1&&typeof c<"u"&&s!==c)return null}return!1}function jN(n,r,s,c){const d=r._rootScopes,p=_G(r._fallback,s,c),g=[...n,...d],y=new Set;y.add(c);let T=U4(y,g,s,p||s,c);return T===null||typeof p<"u"&&p!==s&&(T=U4(y,g,p,T,c),T===null)?!1:MN(Array.from(y),[""],d,p,()=>Oue(r,s,c))}function U4(n,r,s,c,d){for(;s;)s=Aue(n,r,s,c,d);return s}function Oue(n,r,s){const c=n._getTarget();r in c||(c[r]={});const d=c[r];return Yn(d)&&Wi(s)?s:d||{}}function Pue(n,r,s,c){let d;for(const p of r)if(d=EG(wue(p,n),s),typeof d<"u")return UN(n,d)?jN(s,c,n,d):d}function EG(n,r){for(const s of r){if(!s)continue;const c=s[n];if(typeof c<"u")return c}}function j4(n){let r=n._keys;return r||(r=n._keys=Nue(n._scopes)),r}function Nue(n){const r=new Set;for(const s of n)for(const c of Object.keys(s).filter(d=>!d.startsWith("_")))r.add(c);return Array.from(r)}function VN(){return typeof window<"u"&&typeof document<"u"}function FN(n){let r=n.parentNode;return r&&r.toString()==="[object ShadowRoot]"&&(r=r.host),r}function ow(n,r,s){let c;return typeof n=="string"?(c=parseInt(n,10),n.indexOf("%")!==-1&&(c=c/100*r.parentNode[s])):c=n,c}const Uw=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function xue(n,r){return Uw(n).getPropertyValue(r)}const Due=["top","right","bottom","left"];function qp(n,r,s){const c={};s=s?"-"+s:"";for(let d=0;d<4;d++){const p=Due[d];c[p]=parseFloat(n[r+"-"+p+s])||0}return c.width=c.left+c.right,c.height=c.top+c.bottom,c}const kue=(n,r,s)=>(n>0||r>0)&&(!s||!s.shadowRoot);function Lue(n,r){const s=n.touches,c=s&&s.length?s[0]:n,{offsetX:d,offsetY:p}=c;let g=!1,y,T;if(kue(d,p,n.target))y=d,T=p;else{const R=r.getBoundingClientRect();y=c.clientX-R.left,T=c.clientY-R.top,g=!0}return{x:y,y:T,box:g}}function jp(n,r){if("native"in n)return n;const{canvas:s,currentDevicePixelRatio:c}=r,d=Uw(s),p=d.boxSizing==="border-box",g=qp(d,"padding"),y=qp(d,"border","width"),{x:T,y:R,box:N}=Lue(n,s),D=g.left+(N&&y.left),B=g.top+(N&&y.top);let{width:q,height:J}=r;return p&&(q-=g.width+y.width,J-=g.height+y.height),{x:Math.round((T-D)/q*s.width/c),y:Math.round((R-B)/J*s.height/c)}}function Mue(n,r,s){let c,d;if(r===void 0||s===void 0){const p=n&&FN(n);if(!p)r=n.clientWidth,s=n.clientHeight;else{const g=p.getBoundingClientRect(),y=Uw(p),T=qp(y,"border","width"),R=qp(y,"padding");r=g.width-R.width-T.width,s=g.height-R.height-T.height,c=ow(y.maxWidth,p,"clientWidth"),d=ow(y.maxHeight,p,"clientHeight")}}return{width:r,height:s,maxWidth:c||iw,maxHeight:d||iw}}const WS=n=>Math.round(n*10)/10;function Uue(n,r,s,c){const d=Uw(n),p=qp(d,"margin"),g=ow(d.maxWidth,n,"clientWidth")||iw,y=ow(d.maxHeight,n,"clientHeight")||iw,T=Mue(n,r,s);let{width:R,height:N}=T;if(d.boxSizing==="content-box"){const B=qp(d,"border","width"),q=qp(d,"padding");R-=q.width+B.width,N-=q.height+B.height}return R=Math.max(0,R-p.width),N=Math.max(0,c?R/c:N-p.height),R=WS(Math.min(R,g,T.maxWidth)),N=WS(Math.min(N,y,T.maxHeight)),R&&!N&&(N=WS(R/2)),(r!==void 0||s!==void 0)&&c&&T.height&&N>T.height&&(N=T.height,R=WS(Math.floor(N*c))),{width:R,height:N}}function V4(n,r,s){const c=r||1,d=Math.floor(n.height*c),p=Math.floor(n.width*c);n.height=Math.floor(n.height),n.width=Math.floor(n.width);const g=n.canvas;return g.style&&(s||!g.style.height&&!g.style.width)&&(g.style.height=`${n.height}px`,g.style.width=`${n.width}px`),n.currentDevicePixelRatio!==c||g.height!==d||g.width!==p?(n.currentDevicePixelRatio=c,g.height=d,g.width=p,n.ctx.setTransform(c,0,0,c,0,0),!0):!1}const jue=function(){let n=!1;try{const r={get passive(){return n=!0,!1}};VN()&&(window.addEventListener("test",null,r),window.removeEventListener("test",null,r))}catch{}return n}();function F4(n,r){const s=xue(n,r),c=s&&s.match(/^(\d+)(\.\d+)?px$/);return c?+c[1]:void 0}const Vue=function(n,r){return{x(s){return n+n+r-s},setWidth(s){r=s},textAlign(s){return s==="center"?s:s==="right"?"left":"right"},xPlus(s,c){return s-c},leftForLtr(s,c){return s-c}}},Fue=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,r){return n+r},leftForLtr(n,r){return n}}};function vg(n,r,s){return n?Vue(r,s):Fue()}function vG(n,r){let s,c;(r==="ltr"||r==="rtl")&&(s=n.canvas.style,c=[s.getPropertyValue("direction"),s.getPropertyPriority("direction")],s.setProperty("direction",r,"important"),n.prevTextDirection=c)}function yG(n,r){r!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",r[0],r[1]))}/*!
 * Chart.js v4.4.3
 * https://www.chartjs.org
 * (c) 2024 Chart.js Contributors
 * Released under the MIT License
 */class Bue{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(r,s,c,d){const p=s.listeners[d],g=s.duration;p.forEach(y=>y({chart:r,initial:s.initial,numSteps:g,currentStep:Math.min(c-s.start,g)}))}_refresh(){this._request||(this._running=!0,this._request=aG.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(r=Date.now()){let s=0;this._charts.forEach((c,d)=>{if(!c.running||!c.items.length)return;const p=c.items;let g=p.length-1,y=!1,T;for(;g>=0;--g)T=p[g],T._active?(T._total>c.duration&&(c.duration=T._total),T.tick(r),y=!0):(p[g]=p[p.length-1],p.pop());y&&(d.draw(),this._notify(d,c,r,"progress")),p.length||(c.running=!1,this._notify(d,c,r,"complete"),c.initial=!1),s+=p.length}),this._lastDate=r,s===0&&(this._running=!1)}_getAnims(r){const s=this._charts;let c=s.get(r);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},s.set(r,c)),c}listen(r,s,c){this._getAnims(r).listeners[s].push(c)}add(r,s){!s||!s.length||this._getAnims(r).items.push(...s)}has(r){return this._getAnims(r).items.length>0}start(r){const s=this._charts.get(r);s&&(s.running=!0,s.start=Date.now(),s.duration=s.items.reduce((c,d)=>Math.max(c,d._duration),0),this._refresh())}running(r){if(!this._running)return!1;const s=this._charts.get(r);return!(!s||!s.running||!s.items.length)}stop(r){const s=this._charts.get(r);if(!s||!s.items.length)return;const c=s.items;let d=c.length-1;for(;d>=0;--d)c[d].cancel();s.items=[],this._notify(r,s,Date.now(),"complete")}remove(r){return this._charts.delete(r)}}var ad=new Bue;const B4="transparent",Wue={boolean(n,r,s){return s>.5?r:n},color(n,r,s){const c=D4(n||B4),d=c.valid&&D4(r||B4);return d&&d.valid?d.mix(c,s).hexString():r},number(n,r,s){return n+(r-n)*s}};class zue{constructor(r,s,c,d){const p=s[c];d=BS([r.to,d,p,r.from]);const g=BS([r.from,p,d]);this._active=!0,this._fn=r.fn||Wue[r.type||typeof g],this._easing=cv[r.easing]||cv.linear,this._start=Math.floor(Date.now()+(r.delay||0)),this._duration=this._total=Math.floor(r.duration),this._loop=!!r.loop,this._target=s,this._prop=c,this._from=g,this._to=d,this._promises=void 0}active(){return this._active}update(r,s,c){if(this._active){this._notify(!1);const d=this._target[this._prop],p=c-this._start,g=this._duration-p;this._start=c,this._duration=Math.floor(Math.max(g,r.duration)),this._total+=p,this._loop=!!r.loop,this._to=BS([r.to,s,d,r.from]),this._from=BS([r.from,d,s])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(r){const s=r-this._start,c=this._duration,d=this._prop,p=this._from,g=this._loop,y=this._to;let T;if(this._active=p!==y&&(g||s<c),!this._active){this._target[d]=y,this._notify(!0);return}if(s<0){this._target[d]=p;return}T=s/c%2,T=g&&T>1?2-T:T,T=this._easing(Math.min(1,Math.max(0,T))),this._target[d]=this._fn(p,y,T)}wait(){const r=this._promises||(this._promises=[]);return new Promise((s,c)=>{r.push({res:s,rej:c})})}_notify(r){const s=r?"res":"rej",c=this._promises||[];for(let d=0;d<c.length;d++)c[d][s]()}}class SG{constructor(r,s){this._chart=r,this._properties=new Map,this.configure(s)}configure(r){if(!Wi(r))return;const s=Object.keys(cr.animation),c=this._properties;Object.getOwnPropertyNames(r).forEach(d=>{const p=r[d];if(!Wi(p))return;const g={};for(const y of s)g[y]=p[y];(Yn(p.properties)&&p.properties||[d]).forEach(y=>{(y===d||!c.has(y))&&c.set(y,g)})})}_animateOptions(r,s){const c=s.options,d=Gue(r,c);if(!d)return[];const p=this._createAnimations(d,c);return c.$shared&&Hue(r.options.$animations,c).then(()=>{r.options=c},()=>{}),p}_createAnimations(r,s){const c=this._properties,d=[],p=r.$animations||(r.$animations={}),g=Object.keys(s),y=Date.now();let T;for(T=g.length-1;T>=0;--T){const R=g[T];if(R.charAt(0)==="$")continue;if(R==="options"){d.push(...this._animateOptions(r,s));continue}const N=s[R];let D=p[R];const B=c.get(R);if(D)if(B&&D.active()){D.update(B,N,y);continue}else D.cancel();if(!B||!B.duration){r[R]=N;continue}p[R]=D=new zue(B,r,R,N),d.push(D)}return d}update(r,s){if(this._properties.size===0){Object.assign(r,s);return}const c=this._createAnimations(r,s);if(c.length)return ad.add(this._chart,c),!0}}function Hue(n,r){const s=[],c=Object.keys(r);for(let d=0;d<c.length;d++){const p=n[c[d]];p&&p.active()&&s.push(p.wait())}return Promise.all(s)}function Gue(n,r){if(!r)return;let s=n.options;if(!s){n.options=r;return}return s.$shared&&(n.options=s=Object.assign({},s,{$shared:!1,$animations:{}})),s}function W4(n,r){const s=n&&n.options||{},c=s.reverse,d=s.min===void 0?r:0,p=s.max===void 0?r:0;return{start:c?p:d,end:c?d:p}}function Kue(n,r,s){if(s===!1)return!1;const c=W4(n,s),d=W4(r,s);return{top:d.end,right:c.end,bottom:d.start,left:c.start}}function que(n){let r,s,c,d;return Wi(n)?(r=n.top,s=n.right,c=n.bottom,d=n.left):r=s=c=d=n,{top:r,right:s,bottom:c,left:d,disabled:n===!1}}function TG(n,r){const s=[],c=n._getSortedDatasetMetas(r);let d,p;for(d=0,p=c.length;d<p;++d)s.push(c[d].index);return s}function z4(n,r,s,c={}){const d=n.keys,p=c.mode==="single";let g,y,T,R;if(r!==null){for(g=0,y=d.length;g<y;++g){if(T=+d[g],T===s){if(c.all)continue;break}R=n.values[T],Gr(R)&&(p||r===0||rh(r)===rh(R))&&(r+=R)}return r}}function Yue(n,r){const{iScale:s,vScale:c}=r,d=s.axis==="x"?"x":"y",p=c.axis==="x"?"x":"y",g=Object.keys(n),y=new Array(g.length);let T,R,N;for(T=0,R=g.length;T<R;++T)N=g[T],y[T]={[d]:N,[p]:n[N]};return y}function H4(n,r){const s=n&&n.options.stacked;return s||s===void 0&&r.stack!==void 0}function $ue(n,r,s){return`${n.id}.${r.id}.${s.stack||s.type}`}function Xue(n){const{min:r,max:s,minDefined:c,maxDefined:d}=n.getUserBounds();return{min:c?r:Number.NEGATIVE_INFINITY,max:d?s:Number.POSITIVE_INFINITY}}function Jue(n,r,s){const c=n[r]||(n[r]={});return c[s]||(c[s]={})}function G4(n,r,s,c){for(const d of r.getMatchingVisibleMetas(c).reverse()){const p=n[d.index];if(s&&p>0||!s&&p<0)return d.index}return null}function K4(n,r){const{chart:s,_cachedMeta:c}=n,d=s._stacks||(s._stacks={}),{iScale:p,vScale:g,index:y}=c,T=p.axis,R=g.axis,N=$ue(p,g,c),D=r.length;let B;for(let q=0;q<D;++q){const J=r[q],{[T]:Y,[R]:te}=J,Z=J._stacks||(J._stacks={});B=Z[R]=Jue(d,N,Y),B[y]=te,B._top=G4(B,g,!0,c.type),B._bottom=G4(B,g,!1,c.type);const ee=B._visualValues||(B._visualValues={});ee[y]=te}}function HA(n,r){const s=n.scales;return Object.keys(s).filter(c=>s[c].axis===r).shift()}function Zue(n,r){return sf(n,{active:!1,dataset:void 0,datasetIndex:r,index:r,mode:"default",type:"dataset"})}function Que(n,r,s){return sf(n,{active:!1,dataIndex:r,parsed:void 0,raw:void 0,element:s,index:r,mode:"default",type:"data"})}function ME(n,r){const s=n.controller.index,c=n.vScale&&n.vScale.axis;if(c){r=r||n._parsed;for(const d of r){const p=d._stacks;if(!p||p[c]===void 0||p[c][s]===void 0)return;delete p[c][s],p[c]._visualValues!==void 0&&p[c]._visualValues[s]!==void 0&&delete p[c]._visualValues[s]}}}const GA=n=>n==="reset"||n==="none",q4=(n,r)=>r?n:Object.assign({},n),ehe=(n,r,s)=>n&&!r.hidden&&r._stacked&&{keys:TG(s,!0),values:null};class dv{constructor(r,s){this.chart=r,this._ctx=r.ctx,this.index=s,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const r=this._cachedMeta;this.configure(),this.linkScales(),r._stacked=H4(r.vScale,r),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(r){this.index!==r&&ME(this._cachedMeta),this.index=r}linkScales(){const r=this.chart,s=this._cachedMeta,c=this.getDataset(),d=(D,B,q,J)=>D==="x"?B:D==="r"?J:q,p=s.xAxisID=en(c.xAxisID,HA(r,"x")),g=s.yAxisID=en(c.yAxisID,HA(r,"y")),y=s.rAxisID=en(c.rAxisID,HA(r,"r")),T=s.indexAxis,R=s.iAxisID=d(T,p,g,y),N=s.vAxisID=d(T,g,p,y);s.xScale=this.getScaleForId(p),s.yScale=this.getScaleForId(g),s.rScale=this.getScaleForId(y),s.iScale=this.getScaleForId(R),s.vScale=this.getScaleForId(N)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(r){return this.chart.scales[r]}_getOtherScale(r){const s=this._cachedMeta;return r===s.iScale?s.vScale:s.iScale}reset(){this._update("reset")}_destroy(){const r=this._cachedMeta;this._data&&P4(this._data,this),r._stacked&&ME(r)}_dataCheck(){const r=this.getDataset(),s=r.data||(r.data=[]),c=this._data;if(Wi(s)){const d=this._cachedMeta;this._data=Yue(s,d)}else if(c!==s){if(c){P4(c,this);const d=this._cachedMeta;ME(d),d._parsed=[]}s&&Object.isExtensible(s)&&iue(s,this),this._syncList=[],this._data=s}}addElements(){const r=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(r.dataset=new this.datasetElementType)}buildOrUpdateElements(r){const s=this._cachedMeta,c=this.getDataset();let d=!1;this._dataCheck();const p=s._stacked;s._stacked=H4(s.vScale,s),s.stack!==c.stack&&(d=!0,ME(s),s.stack=c.stack),this._resyncElements(r),(d||p!==s._stacked)&&K4(this,s._parsed)}configure(){const r=this.chart.config,s=r.datasetScopeKeys(this._type),c=r.getOptionScopes(this.getDataset(),s,!0);this.options=r.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(r,s){const{_cachedMeta:c,_data:d}=this,{iScale:p,_stacked:g}=c,y=p.axis;let T=r===0&&s===d.length?!0:c._sorted,R=r>0&&c._parsed[r-1],N,D,B;if(this._parsing===!1)c._parsed=d,c._sorted=!0,B=d;else{Yn(d[r])?B=this.parseArrayData(c,d,r,s):Wi(d[r])?B=this.parseObjectData(c,d,r,s):B=this.parsePrimitiveData(c,d,r,s);const q=()=>D[y]===null||R&&D[y]<R[y];for(N=0;N<s;++N)c._parsed[N+r]=D=B[N],T&&(q()&&(T=!1),R=D);c._sorted=T}g&&K4(this,B)}parsePrimitiveData(r,s,c,d){const{iScale:p,vScale:g}=r,y=p.axis,T=g.axis,R=p.getLabels(),N=p===g,D=new Array(d);let B,q,J;for(B=0,q=d;B<q;++B)J=B+c,D[B]={[y]:N||p.parse(R[J],J),[T]:g.parse(s[J],J)};return D}parseArrayData(r,s,c,d){const{xScale:p,yScale:g}=r,y=new Array(d);let T,R,N,D;for(T=0,R=d;T<R;++T)N=T+c,D=s[N],y[T]={x:p.parse(D[0],N),y:g.parse(D[1],N)};return y}parseObjectData(r,s,c,d){const{xScale:p,yScale:g}=r,{xAxisKey:y="x",yAxisKey:T="y"}=this._parsing,R=new Array(d);let N,D,B,q;for(N=0,D=d;N<D;++N)B=N+c,q=s[B],R[N]={x:p.parse(kg(q,y),B),y:g.parse(kg(q,T),B)};return R}getParsed(r){return this._cachedMeta._parsed[r]}getDataElement(r){return this._cachedMeta.data[r]}applyStack(r,s,c){const d=this.chart,p=this._cachedMeta,g=s[r.axis],y={keys:TG(d,!0),values:s._stacks[r.axis]._visualValues};return z4(y,g,p.index,{mode:c})}updateRangeFromParsed(r,s,c,d){const p=c[s.axis];let g=p===null?NaN:p;const y=d&&c._stacks[s.axis];d&&y&&(d.values=y,g=z4(d,p,this._cachedMeta.index)),r.min=Math.min(r.min,g),r.max=Math.max(r.max,g)}getMinMax(r,s){const c=this._cachedMeta,d=c._parsed,p=c._sorted&&r===c.iScale,g=d.length,y=this._getOtherScale(r),T=ehe(s,c,this.chart),R={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:N,max:D}=Xue(y);let B,q;function J(){q=d[B];const Y=q[y.axis];return!Gr(q[r.axis])||N>Y||D<Y}for(B=0;B<g&&!(!J()&&(this.updateRangeFromParsed(R,r,q,T),p));++B);if(p){for(B=g-1;B>=0;--B)if(!J()){this.updateRangeFromParsed(R,r,q,T);break}}return R}getAllParsedValues(r){const s=this._cachedMeta._parsed,c=[];let d,p,g;for(d=0,p=s.length;d<p;++d)g=s[d][r.axis],Gr(g)&&c.push(g);return c}getMaxOverflow(){return!1}getLabelAndValue(r){const s=this._cachedMeta,c=s.iScale,d=s.vScale,p=this.getParsed(r);return{label:c?""+c.getLabelForValue(p[c.axis]):"",value:d?""+d.getLabelForValue(p[d.axis]):""}}_update(r){const s=this._cachedMeta;this.update(r||"default"),s._clip=que(en(this.options.clip,Kue(s.xScale,s.yScale,this.getMaxOverflow())))}update(r){}draw(){const r=this._ctx,s=this.chart,c=this._cachedMeta,d=c.data||[],p=s.chartArea,g=[],y=this._drawStart||0,T=this._drawCount||d.length-y,R=this.options.drawActiveElementsOnTop;let N;for(c.dataset&&c.dataset.draw(r,p,y,T),N=y;N<y+T;++N){const D=d[N];D.hidden||(D.active&&R?g.push(D):D.draw(r,p))}for(N=0;N<g.length;++N)g[N].draw(r,p)}getStyle(r,s){const c=s?"active":"default";return r===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(r||0,c)}getContext(r,s,c){const d=this.getDataset();let p;if(r>=0&&r<this._cachedMeta.data.length){const g=this._cachedMeta.data[r];p=g.$context||(g.$context=Que(this.getContext(),r,g)),p.parsed=this.getParsed(r),p.raw=d.data[r],p.index=p.dataIndex=r}else p=this.$context||(this.$context=Zue(this.chart.getContext(),this.index)),p.dataset=d,p.index=p.datasetIndex=this.index;return p.active=!!s,p.mode=c,p}resolveDatasetElementOptions(r){return this._resolveElementOptions(this.datasetElementType.id,r)}resolveDataElementOptions(r,s){return this._resolveElementOptions(this.dataElementType.id,s,r)}_resolveElementOptions(r,s="default",c){const d=s==="active",p=this._cachedDataOpts,g=r+"-"+s,y=p[g],T=this.enableOptionSharing&&Lv(c);if(y)return q4(y,T);const R=this.chart.config,N=R.datasetElementScopeKeys(this._type,r),D=d?[`${r}Hover`,"hover",r,""]:[r,""],B=R.getOptionScopes(this.getDataset(),N),q=Object.keys(cr.elements[r]),J=()=>this.getContext(c,d,s),Y=R.resolveNamedOptions(B,q,J,D);return Y.$shared&&(Y.$shared=T,p[g]=Object.freeze(q4(Y,T))),Y}_resolveAnimations(r,s,c){const d=this.chart,p=this._cachedDataOpts,g=`animation-${s}`,y=p[g];if(y)return y;let T;if(d.options.animation!==!1){const N=this.chart.config,D=N.datasetAnimationScopeKeys(this._type,s),B=N.getOptionScopes(this.getDataset(),D);T=N.createResolver(B,this.getContext(r,c,s))}const R=new SG(d,T&&T.animations);return T&&T._cacheable&&(p[g]=Object.freeze(R)),R}getSharedOptions(r){if(r.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},r))}includeOptions(r,s){return!s||GA(r)||this.chart._animationsDisabled}_getSharedOptions(r,s){const c=this.resolveDataElementOptions(r,s),d=this._sharedOptions,p=this.getSharedOptions(c),g=this.includeOptions(s,p)||p!==d;return this.updateSharedOptions(p,s,c),{sharedOptions:p,includeOptions:g}}updateElement(r,s,c,d){GA(d)?Object.assign(r,c):this._resolveAnimations(s,d).update(r,c)}updateSharedOptions(r,s,c){r&&!GA(s)&&this._resolveAnimations(void 0,s).update(r,c)}_setStyle(r,s,c,d){r.active=d;const p=this.getStyle(s,d);this._resolveAnimations(s,c,d).update(r,{options:!d&&this.getSharedOptions(p)||p})}removeHoverStyle(r,s,c){this._setStyle(r,c,"active",!1)}setHoverStyle(r,s,c){this._setStyle(r,c,"active",!0)}_removeDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!1)}_setDatasetHoverStyle(){const r=this._cachedMeta.dataset;r&&this._setStyle(r,void 0,"active",!0)}_resyncElements(r){const s=this._data,c=this._cachedMeta.data;for(const[y,T,R]of this._syncList)this[y](T,R);this._syncList=[];const d=c.length,p=s.length,g=Math.min(p,d);g&&this.parse(0,g),p>d?this._insertElements(d,p-d,r):p<d&&this._removeElements(p,d-p)}_insertElements(r,s,c=!0){const d=this._cachedMeta,p=d.data,g=r+s;let y;const T=R=>{for(R.length+=s,y=R.length-1;y>=g;y--)R[y]=R[y-s]};for(T(p),y=r;y<g;++y)p[y]=new this.dataElementType;this._parsing&&T(d._parsed),this.parse(r,s),c&&this.updateElements(p,r,s,"reset")}updateElements(r,s,c,d){}_removeElements(r,s){const c=this._cachedMeta;if(this._parsing){const d=c._parsed.splice(r,s);c._stacked&&ME(c,d)}c.data.splice(r,s)}_sync(r){if(this._parsing)this._syncList.push(r);else{const[s,c,d]=r;this[s](c,d)}this.chart._dataChanges.push([this.index,...r])}_onDataPush(){const r=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-r,r])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(r,s){s&&this._sync(["_removeElements",r,s]);const c=arguments.length-2;c&&this._sync(["_insertElements",r,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ri(dv,"defaults",{}),ri(dv,"datasetElementType",null),ri(dv,"dataElementType",null);function the(n,r){if(!n._cache.$bar){const s=n.getMatchingVisibleMetas(r);let c=[];for(let d=0,p=s.length;d<p;d++)c=c.concat(s[d].controller.getAllParsedValues(n));n._cache.$bar=sG(c.sort((d,p)=>d-p))}return n._cache.$bar}function ihe(n){const r=n.iScale,s=the(r,n.type);let c=r._length,d,p,g,y;const T=()=>{g===32767||g===-32768||(Lv(y)&&(c=Math.min(c,Math.abs(g-y)||c)),y=g)};for(d=0,p=s.length;d<p;++d)g=r.getPixelForValue(s[d]),T();for(y=void 0,d=0,p=r.ticks.length;d<p;++d)g=r.getPixelForTick(d),T();return c}function nhe(n,r,s,c){const d=s.barThickness;let p,g;return mn(d)?(p=r.min*s.categoryPercentage,g=s.barPercentage):(p=d*c,g=1),{chunk:p/c,ratio:g,start:r.pixels[n]-p/2}}function rhe(n,r,s,c){const d=r.pixels,p=d[n];let g=n>0?d[n-1]:null,y=n<d.length-1?d[n+1]:null;const T=s.categoryPercentage;g===null&&(g=p-(y===null?r.end-r.start:y-p)),y===null&&(y=p+p-g);const R=p-(p-Math.min(g,y))/2*T;return{chunk:Math.abs(y-g)/2*T/c,ratio:s.barPercentage,start:R}}function ohe(n,r,s,c){const d=s.parse(n[0],c),p=s.parse(n[1],c),g=Math.min(d,p),y=Math.max(d,p);let T=g,R=y;Math.abs(g)>Math.abs(y)&&(T=y,R=g),r[s.axis]=R,r._custom={barStart:T,barEnd:R,start:d,end:p,min:g,max:y}}function wG(n,r,s,c){return Yn(n)?ohe(n,r,s,c):r[s.axis]=s.parse(n,c),r}function Y4(n,r,s,c){const d=n.iScale,p=n.vScale,g=d.getLabels(),y=d===p,T=[];let R,N,D,B;for(R=s,N=s+c;R<N;++R)B=r[R],D={},D[d.axis]=y||d.parse(g[R],R),T.push(wG(B,D,p,R));return T}function KA(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function she(n,r,s){return n!==0?rh(n):(r.isHorizontal()?1:-1)*(r.min>=s?1:-1)}function ahe(n){let r,s,c,d,p;return n.horizontal?(r=n.base>n.x,s="left",c="right"):(r=n.base<n.y,s="bottom",c="top"),r?(d="end",p="start"):(d="start",p="end"),{start:s,end:c,reverse:r,top:d,bottom:p}}function che(n,r,s,c){let d=r.borderSkipped;const p={};if(!d){n.borderSkipped=p;return}if(d===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:g,end:y,reverse:T,top:R,bottom:N}=ahe(n);d==="middle"&&s&&(n.enableBorderRadius=!0,(s._top||0)===c?d=R:(s._bottom||0)===c?d=N:(p[$4(N,g,y,T)]=!0,d=R)),p[$4(d,g,y,T)]=!0,n.borderSkipped=p}function $4(n,r,s,c){return c?(n=lhe(n,r,s),n=X4(n,s,r)):n=X4(n,r,s),n}function lhe(n,r,s){return n===r?s:n===s?r:n}function X4(n,r,s){return n==="start"?r:n==="end"?s:n}function dhe(n,{inflateAmount:r},s){n.inflateAmount=r==="auto"?s===1?.33:0:r}class gT extends dv{parsePrimitiveData(r,s,c,d){return Y4(r,s,c,d)}parseArrayData(r,s,c,d){return Y4(r,s,c,d)}parseObjectData(r,s,c,d){const{iScale:p,vScale:g}=r,{xAxisKey:y="x",yAxisKey:T="y"}=this._parsing,R=p.axis==="x"?y:T,N=g.axis==="x"?y:T,D=[];let B,q,J,Y;for(B=c,q=c+d;B<q;++B)Y=s[B],J={},J[p.axis]=p.parse(kg(Y,R),B),D.push(wG(kg(Y,N),J,g,B));return D}updateRangeFromParsed(r,s,c,d){super.updateRangeFromParsed(r,s,c,d);const p=c._custom;p&&s===this._cachedMeta.vScale&&(r.min=Math.min(r.min,p.min),r.max=Math.max(r.max,p.max))}getMaxOverflow(){return 0}getLabelAndValue(r){const s=this._cachedMeta,{iScale:c,vScale:d}=s,p=this.getParsed(r),g=p._custom,y=KA(g)?"["+g.start+", "+g.end+"]":""+d.getLabelForValue(p[d.axis]);return{label:""+c.getLabelForValue(p[c.axis]),value:y}}initialize(){this.enableOptionSharing=!0,super.initialize();const r=this._cachedMeta;r.stack=this.getDataset().stack}update(r){const s=this._cachedMeta;this.updateElements(s.data,0,s.data.length,r)}updateElements(r,s,c,d){const p=d==="reset",{index:g,_cachedMeta:{vScale:y}}=this,T=y.getBasePixel(),R=y.isHorizontal(),N=this._getRuler(),{sharedOptions:D,includeOptions:B}=this._getSharedOptions(s,d);for(let q=s;q<s+c;q++){const J=this.getParsed(q),Y=p||mn(J[y.axis])?{base:T,head:T}:this._calculateBarValuePixels(q),te=this._calculateBarIndexPixels(q,N),Z=(J._stacks||{})[y.axis],ee={horizontal:R,base:Y.base,enableBorderRadius:!Z||KA(J._custom)||g===Z._top||g===Z._bottom,x:R?Y.head:te.center,y:R?te.center:Y.head,height:R?te.size:Math.abs(Y.size),width:R?Math.abs(Y.size):te.size};B&&(ee.options=D||this.resolveDataElementOptions(q,r[q].active?"active":d));const re=ee.options||r[q].options;che(ee,re,Z,g),dhe(ee,re,N.ratio),this.updateElement(r[q],q,ee,d)}}_getStacks(r,s){const{iScale:c}=this._cachedMeta,d=c.getMatchingVisibleMetas(this._type).filter(T=>T.controller.options.grouped),p=c.options.stacked,g=[],y=T=>{const R=T.controller.getParsed(s),N=R&&R[T.vScale.axis];if(mn(N)||isNaN(N))return!0};for(const T of d)if(!(s!==void 0&&y(T))&&((p===!1||g.indexOf(T.stack)===-1||p===void 0&&T.stack===void 0)&&g.push(T.stack),T.index===r))break;return g.length||g.push(void 0),g}_getStackCount(r){return this._getStacks(void 0,r).length}_getStackIndex(r,s,c){const d=this._getStacks(r,c),p=s!==void 0?d.indexOf(s):-1;return p===-1?d.length-1:p}_getRuler(){const r=this.options,s=this._cachedMeta,c=s.iScale,d=[];let p,g;for(p=0,g=s.data.length;p<g;++p)d.push(c.getPixelForValue(this.getParsed(p)[c.axis],p));const y=r.barThickness;return{min:y||ihe(s),pixels:d,start:c._startPixel,end:c._endPixel,stackCount:this._getStackCount(),scale:c,grouped:r.grouped,ratio:y?1:r.categoryPercentage*r.barPercentage}}_calculateBarValuePixels(r){const{_cachedMeta:{vScale:s,_stacked:c,index:d},options:{base:p,minBarLength:g}}=this,y=p||0,T=this.getParsed(r),R=T._custom,N=KA(R);let D=T[s.axis],B=0,q=c?this.applyStack(s,T,c):D,J,Y;q!==D&&(B=q-D,q=D),N&&(D=R.barStart,q=R.barEnd-R.barStart,D!==0&&rh(D)!==rh(R.barEnd)&&(B=0),B+=D);const te=!mn(p)&&!N?p:B;let Z=s.getPixelForValue(te);if(this.chart.getDataVisibility(r)?J=s.getPixelForValue(B+q):J=Z,Y=J-Z,Math.abs(Y)<g){Y=she(Y,s,y)*g,D===y&&(Z-=Y/2);const ee=s.getPixelForDecimal(0),re=s.getPixelForDecimal(1),pe=Math.min(ee,re),ve=Math.max(ee,re);Z=Math.max(Math.min(Z,ve),pe),J=Z+Y,c&&!N&&(T._stacks[s.axis]._visualValues[d]=s.getValueForPixel(J)-s.getValueForPixel(Z))}if(Z===s.getPixelForValue(y)){const ee=rh(Y)*s.getLineWidthForValue(y)/2;Z+=ee,Y-=ee}return{size:Y,base:Z,head:J,center:J+Y/2}}_calculateBarIndexPixels(r,s){const c=s.scale,d=this.options,p=d.skipNull,g=en(d.maxBarThickness,1/0);let y,T;if(s.grouped){const R=p?this._getStackCount(r):s.stackCount,N=d.barThickness==="flex"?rhe(r,s,d,R):nhe(r,s,d,R),D=this._getStackIndex(this.index,this._cachedMeta.stack,p?r:void 0);y=N.start+N.chunk*D+N.chunk/2,T=Math.min(g,N.chunk*N.ratio)}else y=c.getPixelForValue(this.getParsed(r)[c.axis],r),T=Math.min(g,s.min*s.ratio);return{base:y-T/2,head:y+T/2,center:y,size:T}}draw(){const r=this._cachedMeta,s=r.vScale,c=r.data,d=c.length;let p=0;for(;p<d;++p)this.getParsed(p)[s.axis]!==null&&!c[p].hidden&&c[p].draw(this._ctx)}}ri(gT,"id","bar"),ri(gT,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ri(gT,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});function kp(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class BN{constructor(r){ri(this,"options");this.options=r||{}}static override(r){Object.assign(BN.prototype,r)}init(){}formats(){return kp()}parse(){return kp()}format(){return kp()}add(){return kp()}diff(){return kp()}startOf(){return kp()}endOf(){return kp()}}var uhe={_date:BN};function hhe(n,r,s,c){const{controller:d,data:p,_sorted:g}=n,y=d._cachedMeta.iScale;if(y&&r===y.axis&&r!=="r"&&g&&p.length){const T=y._reversePixels?eue:oP;if(c){if(d._sharedOptions){const R=p[0],N=typeof R.getRange=="function"&&R.getRange(r);if(N){const D=T(p,r,s-N),B=T(p,r,s+N);return{lo:D.lo,hi:B.hi}}}}else return T(p,r,s)}return{lo:0,hi:p.length-1}}function $v(n,r,s,c,d){const p=n.getSortedVisibleDatasetMetas(),g=s[r];for(let y=0,T=p.length;y<T;++y){const{index:R,data:N}=p[y],{lo:D,hi:B}=hhe(p[y],r,g,d);for(let q=D;q<=B;++q){const J=N[q];J.skip||c(J,R,q)}}}function phe(n){const r=n.indexOf("x")!==-1,s=n.indexOf("y")!==-1;return function(c,d){const p=r?Math.abs(c.x-d.x):0,g=s?Math.abs(c.y-d.y):0;return Math.sqrt(Math.pow(p,2)+Math.pow(g,2))}}function qA(n,r,s,c,d){const p=[];return!d&&!n.isPointInArea(r)||$v(n,s,r,function(y,T,R){!d&&!hg(y,n.chartArea,0)||y.inRange(r.x,r.y,c)&&p.push({element:y,datasetIndex:T,index:R})},!0),p}function fhe(n,r,s,c){let d=[];function p(g,y,T){const{startAngle:R,endAngle:N}=g.getProps(["startAngle","endAngle"],c),{angle:D}=Xde(g,{x:r.x,y:r.y});Zde(D,R,N)&&d.push({element:g,datasetIndex:y,index:T})}return $v(n,s,r,p),d}function mhe(n,r,s,c,d,p){let g=[];const y=phe(s);let T=Number.POSITIVE_INFINITY;function R(N,D,B){const q=N.inRange(r.x,r.y,d);if(c&&!q)return;const J=N.getCenterPoint(d);if(!(!!p||n.isPointInArea(J))&&!q)return;const te=y(r,J);te<T?(g=[{element:N,datasetIndex:D,index:B}],T=te):te===T&&g.push({element:N,datasetIndex:D,index:B})}return $v(n,s,r,R),g}function YA(n,r,s,c,d,p){return!p&&!n.isPointInArea(r)?[]:s==="r"&&!c?fhe(n,r,s,d):mhe(n,r,s,c,d,p)}function J4(n,r,s,c,d){const p=[],g=s==="x"?"inXRange":"inYRange";let y=!1;return $v(n,s,r,(T,R,N)=>{T[g](r[s],d)&&(p.push({element:T,datasetIndex:R,index:N}),y=y||T.inRange(r.x,r.y,d))}),c&&!y?[]:p}var ghe={evaluateInteractionItems:$v,modes:{index(n,r,s,c){const d=jp(r,n),p=s.axis||"x",g=s.includeInvisible||!1,y=s.intersect?qA(n,d,p,c,g):YA(n,d,p,!1,c,g),T=[];return y.length?(n.getSortedVisibleDatasetMetas().forEach(R=>{const N=y[0].index,D=R.data[N];D&&!D.skip&&T.push({element:D,datasetIndex:R.index,index:N})}),T):[]},dataset(n,r,s,c){const d=jp(r,n),p=s.axis||"xy",g=s.includeInvisible||!1;let y=s.intersect?qA(n,d,p,c,g):YA(n,d,p,!1,c,g);if(y.length>0){const T=y[0].datasetIndex,R=n.getDatasetMeta(T).data;y=[];for(let N=0;N<R.length;++N)y.push({element:R[N],datasetIndex:T,index:N})}return y},point(n,r,s,c){const d=jp(r,n),p=s.axis||"xy",g=s.includeInvisible||!1;return qA(n,d,p,c,g)},nearest(n,r,s,c){const d=jp(r,n),p=s.axis||"xy",g=s.includeInvisible||!1;return YA(n,d,p,s.intersect,c,g)},x(n,r,s,c){const d=jp(r,n);return J4(n,d,"x",s.intersect,c)},y(n,r,s,c){const d=jp(r,n);return J4(n,d,"y",s.intersect,c)}}};const CG=["left","top","right","bottom"];function UE(n,r){return n.filter(s=>s.pos===r)}function Z4(n,r){return n.filter(s=>CG.indexOf(s.pos)===-1&&s.box.axis===r)}function jE(n,r){return n.sort((s,c)=>{const d=r?c:s,p=r?s:c;return d.weight===p.weight?d.index-p.index:d.weight-p.weight})}function _he(n){const r=[];let s,c,d,p,g,y;for(s=0,c=(n||[]).length;s<c;++s)d=n[s],{position:p,options:{stack:g,stackWeight:y=1}}=d,r.push({index:s,box:d,pos:p,horizontal:d.isHorizontal(),weight:d.weight,stack:g&&p+g,stackWeight:y});return r}function Ehe(n){const r={};for(const s of n){const{stack:c,pos:d,stackWeight:p}=s;if(!c||!CG.includes(d))continue;const g=r[c]||(r[c]={count:0,placed:0,weight:0,size:0});g.count++,g.weight+=p}return r}function vhe(n,r){const s=Ehe(n),{vBoxMaxWidth:c,hBoxMaxHeight:d}=r;let p,g,y;for(p=0,g=n.length;p<g;++p){y=n[p];const{fullSize:T}=y.box,R=s[y.stack],N=R&&y.stackWeight/R.weight;y.horizontal?(y.width=N?N*c:T&&r.availableWidth,y.height=d):(y.width=c,y.height=N?N*d:T&&r.availableHeight)}return s}function yhe(n){const r=_he(n),s=jE(r.filter(R=>R.box.fullSize),!0),c=jE(UE(r,"left"),!0),d=jE(UE(r,"right")),p=jE(UE(r,"top"),!0),g=jE(UE(r,"bottom")),y=Z4(r,"x"),T=Z4(r,"y");return{fullSize:s,leftAndTop:c.concat(p),rightAndBottom:d.concat(T).concat(g).concat(y),chartArea:UE(r,"chartArea"),vertical:c.concat(d).concat(T),horizontal:p.concat(g).concat(y)}}function Q4(n,r,s,c){return Math.max(n[s],r[s])+Math.max(n[c],r[c])}function bG(n,r){n.top=Math.max(n.top,r.top),n.left=Math.max(n.left,r.left),n.bottom=Math.max(n.bottom,r.bottom),n.right=Math.max(n.right,r.right)}function She(n,r,s,c){const{pos:d,box:p}=s,g=n.maxPadding;if(!Wi(d)){s.size&&(n[d]-=s.size);const D=c[s.stack]||{size:0,count:1};D.size=Math.max(D.size,s.horizontal?p.height:p.width),s.size=D.size/D.count,n[d]+=s.size}p.getPadding&&bG(g,p.getPadding());const y=Math.max(0,r.outerWidth-Q4(g,n,"left","right")),T=Math.max(0,r.outerHeight-Q4(g,n,"top","bottom")),R=y!==n.w,N=T!==n.h;return n.w=y,n.h=T,s.horizontal?{same:R,other:N}:{same:N,other:R}}function The(n){const r=n.maxPadding;function s(c){const d=Math.max(r[c]-n[c],0);return n[c]+=d,d}n.y+=s("top"),n.x+=s("left"),s("right"),s("bottom")}function whe(n,r){const s=r.maxPadding;function c(d){const p={left:0,top:0,right:0,bottom:0};return d.forEach(g=>{p[g]=Math.max(r[g],s[g])}),p}return c(n?["left","right"]:["top","bottom"])}function qE(n,r,s,c){const d=[];let p,g,y,T,R,N;for(p=0,g=n.length,R=0;p<g;++p){y=n[p],T=y.box,T.update(y.width||r.w,y.height||r.h,whe(y.horizontal,r));const{same:D,other:B}=She(r,s,y,c);R|=D&&d.length,N=N||B,T.fullSize||d.push(y)}return R&&qE(d,r,s,c)||N}function zS(n,r,s,c,d){n.top=s,n.left=r,n.right=r+c,n.bottom=s+d,n.width=c,n.height=d}function eW(n,r,s,c){const d=s.padding;let{x:p,y:g}=r;for(const y of n){const T=y.box,R=c[y.stack]||{count:1,placed:0,weight:1},N=y.stackWeight/R.weight||1;if(y.horizontal){const D=r.w*N,B=R.size||T.height;Lv(R.start)&&(g=R.start),T.fullSize?zS(T,d.left,g,s.outerWidth-d.right-d.left,B):zS(T,r.left+R.placed,g,D,B),R.start=g,R.placed+=D,g=T.bottom}else{const D=r.h*N,B=R.size||T.width;Lv(R.start)&&(p=R.start),T.fullSize?zS(T,p,d.top,B,s.outerHeight-d.bottom-d.top):zS(T,p,r.top+R.placed,B,D),R.start=p,R.placed+=D,p=T.right}}r.x=p,r.y=g}var Gu={addBox(n,r){n.boxes||(n.boxes=[]),r.fullSize=r.fullSize||!1,r.position=r.position||"top",r.weight=r.weight||0,r._layers=r._layers||function(){return[{z:0,draw(s){r.draw(s)}}]},n.boxes.push(r)},removeBox(n,r){const s=n.boxes?n.boxes.indexOf(r):-1;s!==-1&&n.boxes.splice(s,1)},configure(n,r,s){r.fullSize=s.fullSize,r.position=s.position,r.weight=s.weight},update(n,r,s,c){if(!n)return;const d=qo(n.options.layout.padding),p=Math.max(r-d.width,0),g=Math.max(s-d.height,0),y=yhe(n.boxes),T=y.vertical,R=y.horizontal;an(n.boxes,Y=>{typeof Y.beforeLayout=="function"&&Y.beforeLayout()});const N=T.reduce((Y,te)=>te.box.options&&te.box.options.display===!1?Y:Y+1,0)||1,D=Object.freeze({outerWidth:r,outerHeight:s,padding:d,availableWidth:p,availableHeight:g,vBoxMaxWidth:p/2/N,hBoxMaxHeight:g/2}),B=Object.assign({},d);bG(B,qo(c));const q=Object.assign({maxPadding:B,w:p,h:g,x:d.left,y:d.top},d),J=vhe(T.concat(R),D);qE(y.fullSize,q,D,J),qE(T,q,D,J),qE(R,q,D,J)&&qE(T,q,D,J),The(q),eW(y.leftAndTop,q,D,J),q.x+=q.w,q.y+=q.h,eW(y.rightAndBottom,q,D,J),n.chartArea={left:q.left,top:q.top,right:q.left+q.w,bottom:q.top+q.h,height:q.h,width:q.w},an(y.chartArea,Y=>{const te=Y.box;Object.assign(te,n.chartArea),te.update(q.w,q.h,{left:0,top:0,right:0,bottom:0})})}};class RG{acquireContext(r,s){}releaseContext(r){return!1}addEventListener(r,s,c){}removeEventListener(r,s,c){}getDevicePixelRatio(){return 1}getMaximumSize(r,s,c,d){return s=Math.max(0,s||r.width),c=c||r.height,{width:s,height:Math.max(0,d?Math.floor(s/d):c)}}isAttached(r){return!0}updateConfig(r){}}class Che extends RG{acquireContext(r){return r&&r.getContext&&r.getContext("2d")||null}updateConfig(r){r.options.animation=!1}}const _T="$chartjs",bhe={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},tW=n=>n===null||n==="";function Rhe(n,r){const s=n.style,c=n.getAttribute("height"),d=n.getAttribute("width");if(n[_T]={initial:{height:c,width:d,style:{display:s.display,height:s.height,width:s.width}}},s.display=s.display||"block",s.boxSizing=s.boxSizing||"border-box",tW(d)){const p=F4(n,"width");p!==void 0&&(n.width=p)}if(tW(c))if(n.style.height==="")n.height=n.width/(r||2);else{const p=F4(n,"height");p!==void 0&&(n.height=p)}return n}const IG=jue?{passive:!0}:!1;function Ihe(n,r,s){n&&n.addEventListener(r,s,IG)}function Ahe(n,r,s){n&&n.canvas&&n.canvas.removeEventListener(r,s,IG)}function Ohe(n,r){const s=bhe[n.type]||n.type,{x:c,y:d}=jp(n,r);return{type:s,chart:r,native:n,x:c!==void 0?c:null,y:d!==void 0?d:null}}function sw(n,r){for(const s of n)if(s===r||s.contains(r))return!0}function Phe(n,r,s){const c=n.canvas,d=new MutationObserver(p=>{let g=!1;for(const y of p)g=g||sw(y.addedNodes,c),g=g&&!sw(y.removedNodes,c);g&&s()});return d.observe(document,{childList:!0,subtree:!0}),d}function Nhe(n,r,s){const c=n.canvas,d=new MutationObserver(p=>{let g=!1;for(const y of p)g=g||sw(y.removedNodes,c),g=g&&!sw(y.addedNodes,c);g&&s()});return d.observe(document,{childList:!0,subtree:!0}),d}const Uv=new Map;let iW=0;function AG(){const n=window.devicePixelRatio;n!==iW&&(iW=n,Uv.forEach((r,s)=>{s.currentDevicePixelRatio!==n&&r()}))}function xhe(n,r){Uv.size||window.addEventListener("resize",AG),Uv.set(n,r)}function Dhe(n){Uv.delete(n),Uv.size||window.removeEventListener("resize",AG)}function khe(n,r,s){const c=n.canvas,d=c&&FN(c);if(!d)return;const p=cG((y,T)=>{const R=d.clientWidth;s(y,T),R<d.clientWidth&&s()},window),g=new ResizeObserver(y=>{const T=y[0],R=T.contentRect.width,N=T.contentRect.height;R===0&&N===0||p(R,N)});return g.observe(d),xhe(n,p),g}function $A(n,r,s){s&&s.disconnect(),r==="resize"&&Dhe(n)}function Lhe(n,r,s){const c=n.canvas,d=cG(p=>{n.ctx!==null&&s(Ohe(p,n))},n);return Ihe(c,r,d),d}class Mhe extends RG{acquireContext(r,s){const c=r&&r.getContext&&r.getContext("2d");return c&&c.canvas===r?(Rhe(r,s),c):null}releaseContext(r){const s=r.canvas;if(!s[_T])return!1;const c=s[_T].initial;["height","width"].forEach(p=>{const g=c[p];mn(g)?s.removeAttribute(p):s.setAttribute(p,g)});const d=c.style||{};return Object.keys(d).forEach(p=>{s.style[p]=d[p]}),s.width=s.width,delete s[_T],!0}addEventListener(r,s,c){this.removeEventListener(r,s);const d=r.$proxies||(r.$proxies={}),g={attach:Phe,detach:Nhe,resize:khe}[s]||Lhe;d[s]=g(r,s,c)}removeEventListener(r,s){const c=r.$proxies||(r.$proxies={}),d=c[s];if(!d)return;({attach:$A,detach:$A,resize:$A}[s]||Ahe)(r,s,d),c[s]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(r,s,c,d){return Uue(r,s,c,d)}isAttached(r){const s=r&&FN(r);return!!(s&&s.isConnected)}}function Uhe(n){return!VN()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Che:Mhe}var JS;let Xv=(JS=class{constructor(){ri(this,"x");ri(this,"y");ri(this,"active",!1);ri(this,"options");ri(this,"$animations")}tooltipPosition(r){const{x:s,y:c}=this.getProps(["x","y"],r);return{x:s,y:c}}hasValue(){return nw(this.x)&&nw(this.y)}getProps(r,s){const c=this.$animations;if(!s||!c)return this;const d={};return r.forEach(p=>{d[p]=c[p]&&c[p].active()?c[p]._to:this[p]}),d}},ri(JS,"defaults",{}),ri(JS,"defaultRoutes"),JS);function jhe(n,r){const s=n.options.ticks,c=Vhe(n),d=Math.min(s.maxTicksLimit||c,c),p=s.major.enabled?Bhe(r):[],g=p.length,y=p[0],T=p[g-1],R=[];if(g>d)return Whe(r,R,p,g/d),R;const N=Fhe(p,r,d);if(g>0){let D,B;const q=g>1?Math.round((T-y)/(g-1)):null;for(HS(r,R,N,mn(q)?0:y-q,y),D=0,B=g-1;D<B;D++)HS(r,R,N,p[D],p[D+1]);return HS(r,R,N,T,mn(q)?r.length:T+q),R}return HS(r,R,N),R}function Vhe(n){const r=n.options.offset,s=n._tickSize(),c=n._length/s+(r?0:1),d=n._maxLength/s;return Math.floor(Math.min(c,d))}function Fhe(n,r,s){const c=zhe(n),d=r.length/s;if(!c)return Math.max(d,1);const p=Yde(c);for(let g=0,y=p.length-1;g<y;g++){const T=p[g];if(T>d)return T}return Math.max(d,1)}function Bhe(n){const r=[];let s,c;for(s=0,c=n.length;s<c;s++)n[s].major&&r.push(s);return r}function Whe(n,r,s,c){let d=0,p=s[0],g;for(c=Math.ceil(c),g=0;g<n.length;g++)g===p&&(r.push(n[g]),d++,p=s[d*c])}function HS(n,r,s,c,d){const p=en(c,0),g=Math.min(en(d,n.length),n.length);let y=0,T,R,N;for(s=Math.ceil(s),d&&(T=d-c,s=T/Math.floor(T/s)),N=p;N<0;)y++,N=Math.round(p+y*s);for(R=Math.max(p,0);R<g;R++)R===N&&(r.push(n[R]),y++,N=Math.round(p+y*s))}function zhe(n){const r=n.length;let s,c;if(r<2)return!1;for(c=n[0],s=1;s<r;++s)if(n[s]-n[s-1]!==c)return!1;return c}const Hhe=n=>n==="left"?"right":n==="right"?"left":n,nW=(n,r,s)=>r==="top"||r==="left"?n[r]+s:n[r]-s,rW=(n,r)=>Math.min(r||n,n);function oW(n,r){const s=[],c=n.length/r,d=n.length;let p=0;for(;p<d;p+=c)s.push(n[Math.floor(p)]);return s}function Ghe(n,r,s){const c=n.ticks.length,d=Math.min(r,c-1),p=n._startPixel,g=n._endPixel,y=1e-6;let T=n.getPixelForTick(d),R;if(!(s&&(c===1?R=Math.max(T-p,g-T):r===0?R=(n.getPixelForTick(1)-T)/2:R=(T-n.getPixelForTick(d-1))/2,T+=d<r?R:-R,T<p-y||T>g+y)))return T}function Khe(n,r){an(n,s=>{const c=s.gc,d=c.length/2;let p;if(d>r){for(p=0;p<d;++p)delete s.data[c[p]];c.splice(0,d)}})}function VE(n){return n.drawTicks?n.tickLength:0}function sW(n,r){if(!n.display)return 0;const s=so(n.font,r),c=qo(n.padding);return(Yn(n.text)?n.text.length:1)*s.lineHeight+c.height}function qhe(n,r){return sf(n,{scale:r,type:"scale"})}function Yhe(n,r,s){return sf(n,{tick:s,index:r,type:"tick"})}function $he(n,r,s){let c=lG(n);return(s&&r!=="right"||!s&&r==="right")&&(c=Hhe(c)),c}function Xhe(n,r,s,c){const{top:d,left:p,bottom:g,right:y,chart:T}=n,{chartArea:R,scales:N}=T;let D=0,B,q,J;const Y=g-d,te=y-p;if(n.isHorizontal()){if(q=Fs(c,p,y),Wi(s)){const Z=Object.keys(s)[0],ee=s[Z];J=N[Z].getPixelForValue(ee)+Y-r}else s==="center"?J=(R.bottom+R.top)/2+Y-r:J=nW(n,s,r);B=y-p}else{if(Wi(s)){const Z=Object.keys(s)[0],ee=s[Z];q=N[Z].getPixelForValue(ee)-te+r}else s==="center"?q=(R.left+R.right)/2-te+r:q=nW(n,s,r);J=Fs(c,g,d),D=s==="left"?-Hs:Hs}return{titleX:q,titleY:J,maxWidth:B,rotation:D}}class af extends Xv{constructor(r){super(),this.id=r.id,this.type=r.type,this.options=void 0,this.ctx=r.ctx,this.chart=r.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(r){this.options=r.setContext(this.getContext()),this.axis=r.axis,this._userMin=this.parse(r.min),this._userMax=this.parse(r.max),this._suggestedMin=this.parse(r.suggestedMin),this._suggestedMax=this.parse(r.suggestedMax)}parse(r,s){return r}getUserBounds(){let{_userMin:r,_userMax:s,_suggestedMin:c,_suggestedMax:d}=this;return r=Bs(r,Number.POSITIVE_INFINITY),s=Bs(s,Number.NEGATIVE_INFINITY),c=Bs(c,Number.POSITIVE_INFINITY),d=Bs(d,Number.NEGATIVE_INFINITY),{min:Bs(r,c),max:Bs(s,d),minDefined:Gr(r),maxDefined:Gr(s)}}getMinMax(r){let{min:s,max:c,minDefined:d,maxDefined:p}=this.getUserBounds(),g;if(d&&p)return{min:s,max:c};const y=this.getMatchingVisibleMetas();for(let T=0,R=y.length;T<R;++T)g=y[T].controller.getMinMax(this,r),d||(s=Math.min(s,g.min)),p||(c=Math.max(c,g.max));return s=p&&s>c?c:s,c=d&&s>c?s:c,{min:Bs(s,Bs(c,s)),max:Bs(c,Bs(s,c))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const r=this.chart.data;return this.options.labels||(this.isHorizontal()?r.xLabels:r.yLabels)||r.labels||[]}getLabelItems(r=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(r))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Rn(this.options.beforeUpdate,[this])}update(r,s,c){const{beginAtZero:d,grace:p,ticks:g}=this.options,y=g.sampleSize;this.beforeUpdate(),this.maxWidth=r,this.maxHeight=s,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Tue(this,p,d),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const T=y<this.ticks.length;this._convertTicksToLabels(T?oW(this.ticks,y):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),g.display&&(g.autoSkip||g.source==="auto")&&(this.ticks=jhe(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),T&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let r=this.options.reverse,s,c;this.isHorizontal()?(s=this.left,c=this.right):(s=this.top,c=this.bottom,r=!r),this._startPixel=s,this._endPixel=c,this._reversePixels=r,this._length=c-s,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Rn(this.options.afterUpdate,[this])}beforeSetDimensions(){Rn(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Rn(this.options.afterSetDimensions,[this])}_callHooks(r){this.chart.notifyPlugins(r,this.getContext()),Rn(this.options[r],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Rn(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(r){const s=this.options.ticks;let c,d,p;for(c=0,d=r.length;c<d;c++)p=r[c],p.label=Rn(s.callback,[p.value,c,r],this)}afterTickToLabelConversion(){Rn(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Rn(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const r=this.options,s=r.ticks,c=rW(this.ticks.length,r.ticks.maxTicksLimit),d=s.minRotation||0,p=s.maxRotation;let g=d,y,T,R;if(!this._isVisible()||!s.display||d>=p||c<=1||!this.isHorizontal()){this.labelRotation=d;return}const N=this._getLabelSizes(),D=N.widest.width,B=N.highest.height,q=Tc(this.chart.width-D,0,this.maxWidth);y=r.offset?this.maxWidth/c:q/(c-1),D+6>y&&(y=q/(c-(r.offset?.5:1)),T=this.maxHeight-VE(r.grid)-s.padding-sW(r.title,this.chart.options.font),R=Math.sqrt(D*D+B*B),g=NN(Math.min(Math.asin(Tc((N.highest.height+6)/y,-1,1)),Math.asin(Tc(T/R,-1,1))-Math.asin(Tc(B/R,-1,1)))),g=Math.max(d,Math.min(p,g))),this.labelRotation=g}afterCalculateLabelRotation(){Rn(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Rn(this.options.beforeFit,[this])}fit(){const r={width:0,height:0},{chart:s,options:{ticks:c,title:d,grid:p}}=this,g=this._isVisible(),y=this.isHorizontal();if(g){const T=sW(d,s.options.font);if(y?(r.width=this.maxWidth,r.height=VE(p)+T):(r.height=this.maxHeight,r.width=VE(p)+T),c.display&&this.ticks.length){const{first:R,last:N,widest:D,highest:B}=this._getLabelSizes(),q=c.padding*2,J=Hu(this.labelRotation),Y=Math.cos(J),te=Math.sin(J);if(y){const Z=c.mirror?0:te*D.width+Y*B.height;r.height=Math.min(this.maxHeight,r.height+Z+q)}else{const Z=c.mirror?0:Y*D.width+te*B.height;r.width=Math.min(this.maxWidth,r.width+Z+q)}this._calculatePadding(R,N,te,Y)}}this._handleMargins(),y?(this.width=this._length=s.width-this._margins.left-this._margins.right,this.height=r.height):(this.width=r.width,this.height=this._length=s.height-this._margins.top-this._margins.bottom)}_calculatePadding(r,s,c,d){const{ticks:{align:p,padding:g},position:y}=this.options,T=this.labelRotation!==0,R=y!=="top"&&this.axis==="x";if(this.isHorizontal()){const N=this.getPixelForTick(0)-this.left,D=this.right-this.getPixelForTick(this.ticks.length-1);let B=0,q=0;T?R?(B=d*r.width,q=c*s.height):(B=c*r.height,q=d*s.width):p==="start"?q=s.width:p==="end"?B=r.width:p!=="inner"&&(B=r.width/2,q=s.width/2),this.paddingLeft=Math.max((B-N+g)*this.width/(this.width-N),0),this.paddingRight=Math.max((q-D+g)*this.width/(this.width-D),0)}else{let N=s.height/2,D=r.height/2;p==="start"?(N=0,D=r.height):p==="end"&&(N=s.height,D=0),this.paddingTop=N+g,this.paddingBottom=D+g}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Rn(this.options.afterFit,[this])}isHorizontal(){const{axis:r,position:s}=this.options;return s==="top"||s==="bottom"||r==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(r){this.beforeTickToLabelConversion(),this.generateTickLabels(r);let s,c;for(s=0,c=r.length;s<c;s++)mn(r[s].label)&&(r.splice(s,1),c--,s--);this.afterTickToLabelConversion()}_getLabelSizes(){let r=this._labelSizes;if(!r){const s=this.options.ticks.sampleSize;let c=this.ticks;s<c.length&&(c=oW(c,s)),this._labelSizes=r=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return r}_computeLabelSizes(r,s,c){const{ctx:d,_longestTextCache:p}=this,g=[],y=[],T=Math.floor(s/rW(s,c));let R=0,N=0,D,B,q,J,Y,te,Z,ee,re,pe,ve;for(D=0;D<s;D+=T){if(J=r[D].label,Y=this._resolveTickFontOptions(D),d.font=te=Y.string,Z=p[te]=p[te]||{data:{},gc:[]},ee=Y.lineHeight,re=pe=0,!mn(J)&&!Yn(J))re=rw(d,Z.data,Z.gc,re,J),pe=ee;else if(Yn(J))for(B=0,q=J.length;B<q;++B)ve=J[B],!mn(ve)&&!Yn(ve)&&(re=rw(d,Z.data,Z.gc,re,ve),pe+=ee);g.push(re),y.push(pe),R=Math.max(re,R),N=Math.max(pe,N)}Khe(p,s);const Oe=g.indexOf(R),Se=y.indexOf(N),je=ot=>({width:g[ot]||0,height:y[ot]||0});return{first:je(0),last:je(s-1),widest:je(Oe),highest:je(Se),widths:g,heights:y}}getLabelForValue(r){return r}getPixelForValue(r,s){return NaN}getValueForPixel(r){}getPixelForTick(r){const s=this.ticks;return r<0||r>s.length-1?null:this.getPixelForValue(s[r].value)}getPixelForDecimal(r){this._reversePixels&&(r=1-r);const s=this._startPixel+r*this._length;return Qde(this._alignToPixels?Dp(this.chart,s,0):s)}getDecimalForPixel(r){const s=(r-this._startPixel)/this._length;return this._reversePixels?1-s:s}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:r,max:s}=this;return r<0&&s<0?s:r>0&&s>0?r:0}getContext(r){const s=this.ticks||[];if(r>=0&&r<s.length){const c=s[r];return c.$context||(c.$context=Yhe(this.getContext(),r,c))}return this.$context||(this.$context=qhe(this.chart.getContext(),this))}_tickSize(){const r=this.options.ticks,s=Hu(this.labelRotation),c=Math.abs(Math.cos(s)),d=Math.abs(Math.sin(s)),p=this._getLabelSizes(),g=r.autoSkipPadding||0,y=p?p.widest.width+g:0,T=p?p.highest.height+g:0;return this.isHorizontal()?T*c>y*d?y/c:T/d:T*d<y*c?T/c:y/d}_isVisible(){const r=this.options.display;return r!=="auto"?!!r:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(r){const s=this.axis,c=this.chart,d=this.options,{grid:p,position:g,border:y}=d,T=p.offset,R=this.isHorizontal(),D=this.ticks.length+(T?1:0),B=VE(p),q=[],J=y.setContext(this.getContext()),Y=J.display?J.width:0,te=Y/2,Z=function(yt){return Dp(c,yt,Y)};let ee,re,pe,ve,Oe,Se,je,ot,Qe,st,ut,Ni;if(g==="top")ee=Z(this.bottom),Se=this.bottom-B,ot=ee-te,st=Z(r.top)+te,Ni=r.bottom;else if(g==="bottom")ee=Z(this.top),st=r.top,Ni=Z(r.bottom)-te,Se=ee+te,ot=this.top+B;else if(g==="left")ee=Z(this.right),Oe=this.right-B,je=ee-te,Qe=Z(r.left)+te,ut=r.right;else if(g==="right")ee=Z(this.left),Qe=r.left,ut=Z(r.right)-te,Oe=ee+te,je=this.left+B;else if(s==="x"){if(g==="center")ee=Z((r.top+r.bottom)/2+.5);else if(Wi(g)){const yt=Object.keys(g)[0],Lt=g[yt];ee=Z(this.chart.scales[yt].getPixelForValue(Lt))}st=r.top,Ni=r.bottom,Se=ee+te,ot=Se+B}else if(s==="y"){if(g==="center")ee=Z((r.left+r.right)/2);else if(Wi(g)){const yt=Object.keys(g)[0],Lt=g[yt];ee=Z(this.chart.scales[yt].getPixelForValue(Lt))}Oe=ee-te,je=Oe-B,Qe=r.left,ut=r.right}const gt=en(d.ticks.maxTicksLimit,D),At=Math.max(1,Math.ceil(D/gt));for(re=0;re<D;re+=At){const yt=this.getContext(re),Lt=p.setContext(yt),Ue=y.setContext(yt),Je=Lt.lineWidth,Ie=Lt.color,pt=Ue.dash||[],St=Ue.dashOffset,yi=Lt.tickWidth,Ot=Lt.tickColor,ge=Lt.tickBorderDash||[],lt=Lt.tickBorderDashOffset;pe=Ghe(this,re,T),pe!==void 0&&(ve=Dp(c,pe,Je),R?Oe=je=Qe=ut=ve:Se=ot=st=Ni=ve,q.push({tx1:Oe,ty1:Se,tx2:je,ty2:ot,x1:Qe,y1:st,x2:ut,y2:Ni,width:Je,color:Ie,borderDash:pt,borderDashOffset:St,tickWidth:yi,tickColor:Ot,tickBorderDash:ge,tickBorderDashOffset:lt}))}return this._ticksLength=D,this._borderValue=ee,q}_computeLabelItems(r){const s=this.axis,c=this.options,{position:d,ticks:p}=c,g=this.isHorizontal(),y=this.ticks,{align:T,crossAlign:R,padding:N,mirror:D}=p,B=VE(c.grid),q=B+N,J=D?-N:q,Y=-Hu(this.labelRotation),te=[];let Z,ee,re,pe,ve,Oe,Se,je,ot,Qe,st,ut,Ni="middle";if(d==="top")Oe=this.bottom-J,Se=this._getXAxisLabelAlignment();else if(d==="bottom")Oe=this.top+J,Se=this._getXAxisLabelAlignment();else if(d==="left"){const At=this._getYAxisLabelAlignment(B);Se=At.textAlign,ve=At.x}else if(d==="right"){const At=this._getYAxisLabelAlignment(B);Se=At.textAlign,ve=At.x}else if(s==="x"){if(d==="center")Oe=(r.top+r.bottom)/2+q;else if(Wi(d)){const At=Object.keys(d)[0],yt=d[At];Oe=this.chart.scales[At].getPixelForValue(yt)+q}Se=this._getXAxisLabelAlignment()}else if(s==="y"){if(d==="center")ve=(r.left+r.right)/2-q;else if(Wi(d)){const At=Object.keys(d)[0],yt=d[At];ve=this.chart.scales[At].getPixelForValue(yt)}Se=this._getYAxisLabelAlignment(B).textAlign}s==="y"&&(T==="start"?Ni="top":T==="end"&&(Ni="bottom"));const gt=this._getLabelSizes();for(Z=0,ee=y.length;Z<ee;++Z){re=y[Z],pe=re.label;const At=p.setContext(this.getContext(Z));je=this.getPixelForTick(Z)+p.labelOffset,ot=this._resolveTickFontOptions(Z),Qe=ot.lineHeight,st=Yn(pe)?pe.length:1;const yt=st/2,Lt=At.color,Ue=At.textStrokeColor,Je=At.textStrokeWidth;let Ie=Se;g?(ve=je,Se==="inner"&&(Z===ee-1?Ie=this.options.reverse?"left":"right":Z===0?Ie=this.options.reverse?"right":"left":Ie="center"),d==="top"?R==="near"||Y!==0?ut=-st*Qe+Qe/2:R==="center"?ut=-gt.highest.height/2-yt*Qe+Qe:ut=-gt.highest.height+Qe/2:R==="near"||Y!==0?ut=Qe/2:R==="center"?ut=gt.highest.height/2-yt*Qe:ut=gt.highest.height-st*Qe,D&&(ut*=-1),Y!==0&&!At.showLabelBackdrop&&(ve+=Qe/2*Math.sin(Y))):(Oe=je,ut=(1-st)*Qe/2);let pt;if(At.showLabelBackdrop){const St=qo(At.backdropPadding),yi=gt.heights[Z],Ot=gt.widths[Z];let ge=ut-St.top,lt=0-St.left;switch(Ni){case"middle":ge-=yi/2;break;case"bottom":ge-=yi;break}switch(Se){case"center":lt-=Ot/2;break;case"right":lt-=Ot;break;case"inner":Z===ee-1?lt-=Ot:Z>0&&(lt-=Ot/2);break}pt={left:lt,top:ge,width:Ot+St.width,height:yi+St.height,color:At.backdropColor}}te.push({label:pe,font:ot,textOffset:ut,options:{rotation:Y,color:Lt,strokeColor:Ue,strokeWidth:Je,textAlign:Ie,textBaseline:Ni,translation:[ve,Oe],backdrop:pt}})}return te}_getXAxisLabelAlignment(){const{position:r,ticks:s}=this.options;if(-Hu(this.labelRotation))return r==="top"?"left":"right";let d="center";return s.align==="start"?d="left":s.align==="end"?d="right":s.align==="inner"&&(d="inner"),d}_getYAxisLabelAlignment(r){const{position:s,ticks:{crossAlign:c,mirror:d,padding:p}}=this.options,g=this._getLabelSizes(),y=r+p,T=g.widest.width;let R,N;return s==="left"?d?(N=this.right+p,c==="near"?R="left":c==="center"?(R="center",N+=T/2):(R="right",N+=T)):(N=this.right-y,c==="near"?R="right":c==="center"?(R="center",N-=T/2):(R="left",N=this.left)):s==="right"?d?(N=this.left+p,c==="near"?R="right":c==="center"?(R="center",N-=T/2):(R="left",N-=T)):(N=this.left+y,c==="near"?R="left":c==="center"?(R="center",N+=T/2):(R="right",N=this.right)):R="right",{textAlign:R,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;const r=this.chart,s=this.options.position;if(s==="left"||s==="right")return{top:0,left:this.left,bottom:r.height,right:this.right};if(s==="top"||s==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:r.width}}drawBackground(){const{ctx:r,options:{backgroundColor:s},left:c,top:d,width:p,height:g}=this;s&&(r.save(),r.fillStyle=s,r.fillRect(c,d,p,g),r.restore())}getLineWidthForValue(r){const s=this.options.grid;if(!this._isVisible()||!s.display)return 0;const d=this.ticks.findIndex(p=>p.value===r);return d>=0?s.setContext(this.getContext(d)).lineWidth:0}drawGrid(r){const s=this.options.grid,c=this.ctx,d=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(r));let p,g;const y=(T,R,N)=>{!N.width||!N.color||(c.save(),c.lineWidth=N.width,c.strokeStyle=N.color,c.setLineDash(N.borderDash||[]),c.lineDashOffset=N.borderDashOffset,c.beginPath(),c.moveTo(T.x,T.y),c.lineTo(R.x,R.y),c.stroke(),c.restore())};if(s.display)for(p=0,g=d.length;p<g;++p){const T=d[p];s.drawOnChartArea&&y({x:T.x1,y:T.y1},{x:T.x2,y:T.y2},T),s.drawTicks&&y({x:T.tx1,y:T.ty1},{x:T.tx2,y:T.ty2},{color:T.tickColor,width:T.tickWidth,borderDash:T.tickBorderDash,borderDashOffset:T.tickBorderDashOffset})}}drawBorder(){const{chart:r,ctx:s,options:{border:c,grid:d}}=this,p=c.setContext(this.getContext()),g=c.display?p.width:0;if(!g)return;const y=d.setContext(this.getContext(0)).lineWidth,T=this._borderValue;let R,N,D,B;this.isHorizontal()?(R=Dp(r,this.left,g)-g/2,N=Dp(r,this.right,y)+y/2,D=B=T):(D=Dp(r,this.top,g)-g/2,B=Dp(r,this.bottom,y)+y/2,R=N=T),s.save(),s.lineWidth=p.width,s.strokeStyle=p.color,s.beginPath(),s.moveTo(R,D),s.lineTo(N,B),s.stroke(),s.restore()}drawLabels(r){if(!this.options.ticks.display)return;const c=this.ctx,d=this._computeLabelArea();d&&kN(c,d);const p=this.getLabelItems(r);for(const g of p){const y=g.options,T=g.font,R=g.label,N=g.textOffset;Lg(c,R,0,N,T,y)}d&&LN(c)}drawTitle(){const{ctx:r,options:{position:s,title:c,reverse:d}}=this;if(!c.display)return;const p=so(c.font),g=qo(c.padding),y=c.align;let T=p.lineHeight/2;s==="bottom"||s==="center"||Wi(s)?(T+=g.bottom,Yn(c.text)&&(T+=p.lineHeight*(c.text.length-1))):T+=g.top;const{titleX:R,titleY:N,maxWidth:D,rotation:B}=Xhe(this,T,s,y);Lg(r,c.text,0,0,p,{color:c.color,maxWidth:D,rotation:B,textAlign:$he(y,s,d),textBaseline:"middle",translation:[R,N]})}draw(r){this._isVisible()&&(this.drawBackground(),this.drawGrid(r),this.drawBorder(),this.drawTitle(),this.drawLabels(r))}_layers(){const r=this.options,s=r.ticks&&r.ticks.z||0,c=en(r.grid&&r.grid.z,-1),d=en(r.border&&r.border.z,0);return!this._isVisible()||this.draw!==af.prototype.draw?[{z:s,draw:p=>{this.draw(p)}}]:[{z:c,draw:p=>{this.drawBackground(),this.drawGrid(p),this.drawTitle()}},{z:d,draw:()=>{this.drawBorder()}},{z:s,draw:p=>{this.drawLabels(p)}}]}getMatchingVisibleMetas(r){const s=this.chart.getSortedVisibleDatasetMetas(),c=this.axis+"AxisID",d=[];let p,g;for(p=0,g=s.length;p<g;++p){const y=s[p];y[c]===this.id&&(!r||y.type===r)&&d.push(y)}return d}_resolveTickFontOptions(r){const s=this.options.ticks.setContext(this.getContext(r));return so(s.font)}_maxDigits(){const r=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/r}}class GS{constructor(r,s,c){this.type=r,this.scope=s,this.override=c,this.items=Object.create(null)}isForType(r){return Object.prototype.isPrototypeOf.call(this.type.prototype,r.prototype)}register(r){const s=Object.getPrototypeOf(r);let c;Qhe(s)&&(c=this.register(s));const d=this.items,p=r.id,g=this.scope+"."+p;if(!p)throw new Error("class does not have id: "+r);return p in d||(d[p]=r,Jhe(r,g,c),this.override&&cr.override(r.id,r.overrides)),g}get(r){return this.items[r]}unregister(r){const s=this.items,c=r.id,d=this.scope;c in s&&delete s[c],d&&c in cr[d]&&(delete cr[d][c],this.override&&delete ef[c])}}function Jhe(n,r,s){const c=kv(Object.create(null),[s?cr.get(s):{},cr.get(r),n.defaults]);cr.set(r,c),n.defaultRoutes&&Zhe(r,n.defaultRoutes),n.descriptors&&cr.describe(r,n.descriptors)}function Zhe(n,r){Object.keys(r).forEach(s=>{const c=s.split("."),d=c.pop(),p=[n].concat(c).join("."),g=r[s].split("."),y=g.pop(),T=g.join(".");cr.route(p,d,T,y)})}function Qhe(n){return"id"in n&&"defaults"in n}class epe{constructor(){this.controllers=new GS(dv,"datasets",!0),this.elements=new GS(Xv,"elements"),this.plugins=new GS(Object,"plugins"),this.scales=new GS(af,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...r){this._each("register",r)}remove(...r){this._each("unregister",r)}addControllers(...r){this._each("register",r,this.controllers)}addElements(...r){this._each("register",r,this.elements)}addPlugins(...r){this._each("register",r,this.plugins)}addScales(...r){this._each("register",r,this.scales)}getController(r){return this._get(r,this.controllers,"controller")}getElement(r){return this._get(r,this.elements,"element")}getPlugin(r){return this._get(r,this.plugins,"plugin")}getScale(r){return this._get(r,this.scales,"scale")}removeControllers(...r){this._each("unregister",r,this.controllers)}removeElements(...r){this._each("unregister",r,this.elements)}removePlugins(...r){this._each("unregister",r,this.plugins)}removeScales(...r){this._each("unregister",r,this.scales)}_each(r,s,c){[...s].forEach(d=>{const p=c||this._getRegistryForType(d);c||p.isForType(d)||p===this.plugins&&d.id?this._exec(r,p,d):an(d,g=>{const y=c||this._getRegistryForType(g);this._exec(r,y,g)})})}_exec(r,s,c){const d=PN(r);Rn(c["before"+d],[],c),s[r](c),Rn(c["after"+d],[],c)}_getRegistryForType(r){for(let s=0;s<this._typedRegistries.length;s++){const c=this._typedRegistries[s];if(c.isForType(r))return c}return this.plugins}_get(r,s,c){const d=s.get(r);if(d===void 0)throw new Error('"'+r+'" is not a registered '+c+".");return d}}var ml=new epe;class tpe{constructor(){this._init=[]}notify(r,s,c,d){s==="beforeInit"&&(this._init=this._createDescriptors(r,!0),this._notify(this._init,r,"install"));const p=d?this._descriptors(r).filter(d):this._descriptors(r),g=this._notify(p,r,s,c);return s==="afterDestroy"&&(this._notify(p,r,"stop"),this._notify(this._init,r,"uninstall")),g}_notify(r,s,c,d){d=d||{};for(const p of r){const g=p.plugin,y=g[c],T=[s,d,p.options];if(Rn(y,T,g)===!1&&d.cancelable)return!1}return!0}invalidate(){mn(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(r){if(this._cache)return this._cache;const s=this._cache=this._createDescriptors(r);return this._notifyStateChanges(r),s}_createDescriptors(r,s){const c=r&&r.config,d=en(c.options&&c.options.plugins,{}),p=ipe(c);return d===!1&&!s?[]:rpe(r,p,d,s)}_notifyStateChanges(r){const s=this._oldCache||[],c=this._cache,d=(p,g)=>p.filter(y=>!g.some(T=>y.plugin.id===T.plugin.id));this._notify(d(s,c),r,"stop"),this._notify(d(c,s),r,"start")}}function ipe(n){const r={},s=[],c=Object.keys(ml.plugins.items);for(let p=0;p<c.length;p++)s.push(ml.getPlugin(c[p]));const d=n.plugins||[];for(let p=0;p<d.length;p++){const g=d[p];s.indexOf(g)===-1&&(s.push(g),r[g.id]=!0)}return{plugins:s,localIds:r}}function npe(n,r){return!r&&n===!1?null:n===!0?{}:n}function rpe(n,{plugins:r,localIds:s},c,d){const p=[],g=n.getContext();for(const y of r){const T=y.id,R=npe(c[T],d);R!==null&&p.push({plugin:y,options:ope(n.config,{plugin:y,local:s[T]},R,g)})}return p}function ope(n,{plugin:r,local:s},c,d){const p=n.pluginScopeKeys(r),g=n.getOptionScopes(c,p);return s&&r.defaults&&g.push(r.defaults),n.createResolver(g,d,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function aP(n,r){const s=cr.datasets[n]||{};return((r.datasets||{})[n]||{}).indexAxis||r.indexAxis||s.indexAxis||"x"}function spe(n,r){let s=n;return n==="_index_"?s=r:n==="_value_"&&(s=r==="x"?"y":"x"),s}function ape(n,r){return n===r?"_index_":"_value_"}function aW(n){if(n==="x"||n==="y"||n==="r")return n}function cpe(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function cP(n,...r){if(aW(n))return n;for(const s of r){const c=s.axis||cpe(s.position)||n.length>1&&aW(n[0].toLowerCase());if(c)return c}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function cW(n,r,s){if(s[r+"AxisID"]===n)return{axis:r}}function lpe(n,r){if(r.data&&r.data.datasets){const s=r.data.datasets.filter(c=>c.xAxisID===n||c.yAxisID===n);if(s.length)return cW(n,"x",s[0])||cW(n,"y",s[0])}return{}}function dpe(n,r){const s=ef[n.type]||{scales:{}},c=r.scales||{},d=aP(n.type,r),p=Object.create(null);return Object.keys(c).forEach(g=>{const y=c[g];if(!Wi(y))return console.error(`Invalid scale configuration for scale: ${g}`);if(y._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${g}`);const T=cP(g,y,lpe(g,n),cr.scales[y.type]),R=ape(T,d),N=s.scales||{};p[g]=av(Object.create(null),[{axis:T},y,N[T],N[R]])}),n.data.datasets.forEach(g=>{const y=g.type||n.type,T=g.indexAxis||aP(y,r),N=(ef[y]||{}).scales||{};Object.keys(N).forEach(D=>{const B=spe(D,T),q=g[B+"AxisID"]||B;p[q]=p[q]||Object.create(null),av(p[q],[{axis:B},c[q],N[D]])})}),Object.keys(p).forEach(g=>{const y=p[g];av(y,[cr.scales[y.type],cr.scale])}),p}function OG(n){const r=n.options||(n.options={});r.plugins=en(r.plugins,{}),r.scales=dpe(n,r)}function PG(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function upe(n){return n=n||{},n.data=PG(n.data),OG(n),n}const lW=new Map,NG=new Set;function KS(n,r){let s=lW.get(n);return s||(s=r(),lW.set(n,s),NG.add(s)),s}const FE=(n,r,s)=>{const c=kg(r,s);c!==void 0&&n.add(c)};class hpe{constructor(r){this._config=upe(r),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(r){this._config.type=r}get data(){return this._config.data}set data(r){this._config.data=PG(r)}get options(){return this._config.options}set options(r){this._config.options=r}get plugins(){return this._config.plugins}update(){const r=this._config;this.clearCache(),OG(r)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(r){return KS(r,()=>[[`datasets.${r}`,""]])}datasetAnimationScopeKeys(r,s){return KS(`${r}.transition.${s}`,()=>[[`datasets.${r}.transitions.${s}`,`transitions.${s}`],[`datasets.${r}`,""]])}datasetElementScopeKeys(r,s){return KS(`${r}-${s}`,()=>[[`datasets.${r}.elements.${s}`,`datasets.${r}`,`elements.${s}`,""]])}pluginScopeKeys(r){const s=r.id,c=this.type;return KS(`${c}-plugin-${s}`,()=>[[`plugins.${s}`,...r.additionalOptionScopes||[]]])}_cachedScopes(r,s){const c=this._scopeCache;let d=c.get(r);return(!d||s)&&(d=new Map,c.set(r,d)),d}getOptionScopes(r,s,c){const{options:d,type:p}=this,g=this._cachedScopes(r,c),y=g.get(s);if(y)return y;const T=new Set;s.forEach(N=>{r&&(T.add(r),N.forEach(D=>FE(T,r,D))),N.forEach(D=>FE(T,d,D)),N.forEach(D=>FE(T,ef[p]||{},D)),N.forEach(D=>FE(T,cr,D)),N.forEach(D=>FE(T,sP,D))});const R=Array.from(T);return R.length===0&&R.push(Object.create(null)),NG.has(s)&&g.set(s,R),R}chartOptionScopes(){const{options:r,type:s}=this;return[r,ef[s]||{},cr.datasets[s]||{},{type:s},cr,sP]}resolveNamedOptions(r,s,c,d=[""]){const p={$shared:!0},{resolver:g,subPrefixes:y}=dW(this._resolverCache,r,d);let T=g;if(fpe(g,s)){p.$shared=!1,c=ah(c)?c():c;const R=this.createResolver(r,c,y);T=Mg(g,c,R)}for(const R of s)p[R]=T[R];return p}createResolver(r,s,c=[""],d){const{resolver:p}=dW(this._resolverCache,r,c);return Wi(s)?Mg(p,s,void 0,d):p}}function dW(n,r,s){let c=n.get(r);c||(c=new Map,n.set(r,c));const d=s.join();let p=c.get(d);return p||(p={resolver:MN(r,s),subPrefixes:s.filter(y=>!y.toLowerCase().includes("hover"))},c.set(d,p)),p}const ppe=n=>Wi(n)&&Object.getOwnPropertyNames(n).some(r=>ah(n[r]));function fpe(n,r){const{isScriptable:s,isIndexable:c}=mG(n);for(const d of r){const p=s(d),g=c(d),y=(g||p)&&n[d];if(p&&(ah(y)||ppe(y))||g&&Yn(y))return!0}return!1}var mpe="4.4.3";const gpe=["top","bottom","left","right","chartArea"];function uW(n,r){return n==="top"||n==="bottom"||gpe.indexOf(n)===-1&&r==="x"}function hW(n,r){return function(s,c){return s[n]===c[n]?s[r]-c[r]:s[n]-c[n]}}function pW(n){const r=n.chart,s=r.options.animation;r.notifyPlugins("afterRender"),Rn(s&&s.onComplete,[n],r)}function _pe(n){const r=n.chart,s=r.options.animation;Rn(s&&s.onProgress,[n],r)}function xG(n){return VN()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const ET={},fW=n=>{const r=xG(n);return Object.values(ET).filter(s=>s.canvas===r).pop()};function Epe(n,r,s){const c=Object.keys(n);for(const d of c){const p=+d;if(p>=r){const g=n[d];delete n[d],(s>0||p>r)&&(n[p+s]=g)}}}function vpe(n,r,s,c){return!s||n.type==="mouseout"?null:c?r:n}function qS(n,r,s){return n.options.clip?n[s]:r[s]}function ype(n,r){const{xScale:s,yScale:c}=n;return s&&c?{left:qS(s,r,"left"),right:qS(s,r,"right"),top:qS(c,r,"top"),bottom:qS(c,r,"bottom")}:r}var Du;let jw=(Du=class{static register(...r){ml.add(...r),mW()}static unregister(...r){ml.remove(...r),mW()}constructor(r,s){const c=this.config=new hpe(s),d=xG(r),p=fW(d);if(p)throw new Error("Canvas is already in use. Chart with ID '"+p.id+"' must be destroyed before the canvas with ID '"+p.canvas.id+"' can be reused.");const g=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||Uhe(d)),this.platform.updateConfig(c);const y=this.platform.acquireContext(d,g.aspectRatio),T=y&&y.canvas,R=T&&T.height,N=T&&T.width;if(this.id=Fde(),this.ctx=y,this.canvas=T,this.width=N,this.height=R,this._options=g,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new tpe,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=nue(D=>this.update(D),g.resizeDelay||0),this._dataChanges=[],ET[this.id]=this,!y||!T){console.error("Failed to create chart: can't acquire context from the given item");return}ad.listen(this,"complete",pW),ad.listen(this,"progress",_pe),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:r,maintainAspectRatio:s},width:c,height:d,_aspectRatio:p}=this;return mn(r)?s&&p?p:d?c/d:null:r}get data(){return this.config.data}set data(r){this.config.data=r}get options(){return this._options}set options(r){this.config.options=r}get registry(){return ml}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():V4(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return L4(this.canvas,this.ctx),this}stop(){return ad.stop(this),this}resize(r,s){ad.running(this)?this._resizeBeforeDraw={width:r,height:s}:this._resize(r,s)}_resize(r,s){const c=this.options,d=this.canvas,p=c.maintainAspectRatio&&this.aspectRatio,g=this.platform.getMaximumSize(d,r,s,p),y=c.devicePixelRatio||this.platform.getDevicePixelRatio(),T=this.width?"resize":"attach";this.width=g.width,this.height=g.height,this._aspectRatio=this.aspectRatio,V4(this,y,!0)&&(this.notifyPlugins("resize",{size:g}),Rn(c.onResize,[this,g],this),this.attached&&this._doResize(T)&&this.render())}ensureScalesHaveIDs(){const s=this.options.scales||{};an(s,(c,d)=>{c.id=d})}buildOrUpdateScales(){const r=this.options,s=r.scales,c=this.scales,d=Object.keys(c).reduce((g,y)=>(g[y]=!1,g),{});let p=[];s&&(p=p.concat(Object.keys(s).map(g=>{const y=s[g],T=cP(g,y),R=T==="r",N=T==="x";return{options:y,dposition:R?"chartArea":N?"bottom":"left",dtype:R?"radialLinear":N?"category":"linear"}}))),an(p,g=>{const y=g.options,T=y.id,R=cP(T,y),N=en(y.type,g.dtype);(y.position===void 0||uW(y.position,R)!==uW(g.dposition))&&(y.position=g.dposition),d[T]=!0;let D=null;if(T in c&&c[T].type===N)D=c[T];else{const B=ml.getScale(N);D=new B({id:T,type:N,ctx:this.ctx,chart:this}),c[D.id]=D}D.init(y,r)}),an(d,(g,y)=>{g||delete c[y]}),an(c,g=>{Gu.configure(this,g,g.options),Gu.addBox(this,g)})}_updateMetasets(){const r=this._metasets,s=this.data.datasets.length,c=r.length;if(r.sort((d,p)=>d.index-p.index),c>s){for(let d=s;d<c;++d)this._destroyDatasetMeta(d);r.splice(s,c-s)}this._sortedMetasets=r.slice(0).sort(hW("order","index"))}_removeUnreferencedMetasets(){const{_metasets:r,data:{datasets:s}}=this;r.length>s.length&&delete this._stacks,r.forEach((c,d)=>{s.filter(p=>p===c._dataset).length===0&&this._destroyDatasetMeta(d)})}buildOrUpdateControllers(){const r=[],s=this.data.datasets;let c,d;for(this._removeUnreferencedMetasets(),c=0,d=s.length;c<d;c++){const p=s[c];let g=this.getDatasetMeta(c);const y=p.type||this.config.type;if(g.type&&g.type!==y&&(this._destroyDatasetMeta(c),g=this.getDatasetMeta(c)),g.type=y,g.indexAxis=p.indexAxis||aP(y,this.options),g.order=p.order||0,g.index=c,g.label=""+p.label,g.visible=this.isDatasetVisible(c),g.controller)g.controller.updateIndex(c),g.controller.linkScales();else{const T=ml.getController(y),{datasetElementType:R,dataElementType:N}=cr.datasets[y];Object.assign(T,{dataElementType:ml.getElement(N),datasetElementType:R&&ml.getElement(R)}),g.controller=new T(this,c),r.push(g.controller)}}return this._updateMetasets(),r}_resetElements(){an(this.data.datasets,(r,s)=>{this.getDatasetMeta(s).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(r){const s=this.config;s.update();const c=this._options=s.createResolver(s.chartOptionScopes(),this.getContext()),d=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:r,cancelable:!0})===!1)return;const p=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let g=0;for(let R=0,N=this.data.datasets.length;R<N;R++){const{controller:D}=this.getDatasetMeta(R),B=!d&&p.indexOf(D)===-1;D.buildOrUpdateElements(B),g=Math.max(+D.getMaxOverflow(),g)}g=this._minPadding=c.layout.autoPadding?g:0,this._updateLayout(g),d||an(p,R=>{R.reset()}),this._updateDatasets(r),this.notifyPlugins("afterUpdate",{mode:r}),this._layers.sort(hW("z","_idx"));const{_active:y,_lastEvent:T}=this;T?this._eventHandler(T,!0):y.length&&this._updateHoverStyles(y,y,!0),this.render()}_updateScales(){an(this.scales,r=>{Gu.removeBox(this,r)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const r=this.options,s=new Set(Object.keys(this._listeners)),c=new Set(r.events);(!R4(s,c)||!!this._responsiveListeners!==r.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:r}=this,s=this._getUniformDataChanges()||[];for(const{method:c,start:d,count:p}of s){const g=c==="_removeElements"?-p:p;Epe(r,d,g)}}_getUniformDataChanges(){const r=this._dataChanges;if(!r||!r.length)return;this._dataChanges=[];const s=this.data.datasets.length,c=p=>new Set(r.filter(g=>g[0]===p).map((g,y)=>y+","+g.splice(1).join(","))),d=c(0);for(let p=1;p<s;p++)if(!R4(d,c(p)))return;return Array.from(d).map(p=>p.split(",")).map(p=>({method:p[1],start:+p[2],count:+p[3]}))}_updateLayout(r){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Gu.update(this,this.width,this.height,r);const s=this.chartArea,c=s.width<=0||s.height<=0;this._layers=[],an(this.boxes,d=>{c&&d.position==="chartArea"||(d.configure&&d.configure(),this._layers.push(...d._layers()))},this),this._layers.forEach((d,p)=>{d._idx=p}),this.notifyPlugins("afterLayout")}_updateDatasets(r){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:r,cancelable:!0})!==!1){for(let s=0,c=this.data.datasets.length;s<c;++s)this.getDatasetMeta(s).controller.configure();for(let s=0,c=this.data.datasets.length;s<c;++s)this._updateDataset(s,ah(r)?r({datasetIndex:s}):r);this.notifyPlugins("afterDatasetsUpdate",{mode:r})}}_updateDataset(r,s){const c=this.getDatasetMeta(r),d={meta:c,index:r,mode:s,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",d)!==!1&&(c.controller._update(s),d.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",d))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ad.has(this)?this.attached&&!ad.running(this)&&ad.start(this):(this.draw(),pW({chart:this})))}draw(){let r;if(this._resizeBeforeDraw){const{width:c,height:d}=this._resizeBeforeDraw;this._resize(c,d),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const s=this._layers;for(r=0;r<s.length&&s[r].z<=0;++r)s[r].draw(this.chartArea);for(this._drawDatasets();r<s.length;++r)s[r].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(r){const s=this._sortedMetasets,c=[];let d,p;for(d=0,p=s.length;d<p;++d){const g=s[d];(!r||g.visible)&&c.push(g)}return c}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const r=this.getSortedVisibleDatasetMetas();for(let s=r.length-1;s>=0;--s)this._drawDataset(r[s]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(r){const s=this.ctx,c=r._clip,d=!c.disabled,p=ype(r,this.chartArea),g={meta:r,index:r.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",g)!==!1&&(d&&kN(s,{left:c.left===!1?0:p.left-c.left,right:c.right===!1?this.width:p.right+c.right,top:c.top===!1?0:p.top-c.top,bottom:c.bottom===!1?this.height:p.bottom+c.bottom}),r.controller.draw(),d&&LN(s),g.cancelable=!1,this.notifyPlugins("afterDatasetDraw",g))}isPointInArea(r){return hg(r,this.chartArea,this._minPadding)}getElementsAtEventForMode(r,s,c,d){const p=ghe.modes[s];return typeof p=="function"?p(this,r,c,d):[]}getDatasetMeta(r){const s=this.data.datasets[r],c=this._metasets;let d=c.filter(p=>p&&p._dataset===s).pop();return d||(d={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:s&&s.order||0,index:r,_dataset:s,_parsed:[],_sorted:!1},c.push(d)),d}getContext(){return this.$context||(this.$context=sf(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(r){const s=this.data.datasets[r];if(!s)return!1;const c=this.getDatasetMeta(r);return typeof c.hidden=="boolean"?!c.hidden:!s.hidden}setDatasetVisibility(r,s){const c=this.getDatasetMeta(r);c.hidden=!s}toggleDataVisibility(r){this._hiddenIndices[r]=!this._hiddenIndices[r]}getDataVisibility(r){return!this._hiddenIndices[r]}_updateVisibility(r,s,c){const d=c?"show":"hide",p=this.getDatasetMeta(r),g=p.controller._resolveAnimations(void 0,d);Lv(s)?(p.data[s].hidden=!c,this.update()):(this.setDatasetVisibility(r,c),g.update(p,{visible:c}),this.update(y=>y.datasetIndex===r?d:void 0))}hide(r,s){this._updateVisibility(r,s,!1)}show(r,s){this._updateVisibility(r,s,!0)}_destroyDatasetMeta(r){const s=this._metasets[r];s&&s.controller&&s.controller._destroy(),delete this._metasets[r]}_stop(){let r,s;for(this.stop(),ad.remove(this),r=0,s=this.data.datasets.length;r<s;++r)this._destroyDatasetMeta(r)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:r,ctx:s}=this;this._stop(),this.config.clearCache(),r&&(this.unbindEvents(),L4(r,s),this.platform.releaseContext(s),this.canvas=null,this.ctx=null),delete ET[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...r){return this.canvas.toDataURL(...r)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const r=this._listeners,s=this.platform,c=(p,g)=>{s.addEventListener(this,p,g),r[p]=g},d=(p,g,y)=>{p.offsetX=g,p.offsetY=y,this._eventHandler(p)};an(this.options.events,p=>c(p,d))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const r=this._responsiveListeners,s=this.platform,c=(T,R)=>{s.addEventListener(this,T,R),r[T]=R},d=(T,R)=>{r[T]&&(s.removeEventListener(this,T,R),delete r[T])},p=(T,R)=>{this.canvas&&this.resize(T,R)};let g;const y=()=>{d("attach",y),this.attached=!0,this.resize(),c("resize",p),c("detach",g)};g=()=>{this.attached=!1,d("resize",p),this._stop(),this._resize(0,0),c("attach",y)},s.isAttached(this.canvas)?y():g()}unbindEvents(){an(this._listeners,(r,s)=>{this.platform.removeEventListener(this,s,r)}),this._listeners={},an(this._responsiveListeners,(r,s)=>{this.platform.removeEventListener(this,s,r)}),this._responsiveListeners=void 0}updateHoverStyle(r,s,c){const d=c?"set":"remove";let p,g,y,T;for(s==="dataset"&&(p=this.getDatasetMeta(r[0].datasetIndex),p.controller["_"+d+"DatasetHoverStyle"]()),y=0,T=r.length;y<T;++y){g=r[y];const R=g&&this.getDatasetMeta(g.datasetIndex).controller;R&&R[d+"HoverStyle"](g.element,g.datasetIndex,g.index)}}getActiveElements(){return this._active||[]}setActiveElements(r){const s=this._active||[],c=r.map(({datasetIndex:p,index:g})=>{const y=this.getDatasetMeta(p);if(!y)throw new Error("No dataset found at index "+p);return{datasetIndex:p,element:y.data[g],index:g}});!ew(c,s)&&(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,s))}notifyPlugins(r,s,c){return this._plugins.notify(this,r,s,c)}isPluginEnabled(r){return this._plugins._cache.filter(s=>s.plugin.id===r).length===1}_updateHoverStyles(r,s,c){const d=this.options.hover,p=(T,R)=>T.filter(N=>!R.some(D=>N.datasetIndex===D.datasetIndex&&N.index===D.index)),g=p(s,r),y=c?r:p(r,s);g.length&&this.updateHoverStyle(g,d.mode,!1),y.length&&d.mode&&this.updateHoverStyle(y,d.mode,!0)}_eventHandler(r,s){const c={event:r,replay:s,cancelable:!0,inChartArea:this.isPointInArea(r)},d=g=>(g.options.events||this.options.events).includes(r.native.type);if(this.notifyPlugins("beforeEvent",c,d)===!1)return;const p=this._handleEvent(r,s,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,d),(p||c.changed)&&this.render(),this}_handleEvent(r,s,c){const{_active:d=[],options:p}=this,g=s,y=this._getActiveElements(r,d,c,g),T=Kde(r),R=vpe(r,this._lastEvent,c,T);c&&(this._lastEvent=null,Rn(p.onHover,[r,y,this],this),T&&Rn(p.onClick,[r,y,this],this));const N=!ew(y,d);return(N||s)&&(this._active=y,this._updateHoverStyles(y,d,s)),this._lastEvent=R,N}_getActiveElements(r,s,c,d){if(r.type==="mouseout")return[];if(!c)return s;const p=this.options.hover;return this.getElementsAtEventForMode(r,p.mode,p,d)}},ri(Du,"defaults",cr),ri(Du,"instances",ET),ri(Du,"overrides",ef),ri(Du,"registry",ml),ri(Du,"version",mpe),ri(Du,"getChart",fW),Du);function mW(){return an(jw.instances,n=>n._plugins.invalidate())}function DG(n,r){const{x:s,y:c,base:d,width:p,height:g}=n.getProps(["x","y","base","width","height"],r);let y,T,R,N,D;return n.horizontal?(D=g/2,y=Math.min(s,d),T=Math.max(s,d),R=c-D,N=c+D):(D=p/2,y=s-D,T=s+D,R=Math.min(c,d),N=Math.max(c,d)),{left:y,top:R,right:T,bottom:N}}function Ku(n,r,s,c){return n?0:Tc(r,s,c)}function Spe(n,r,s){const c=n.options.borderWidth,d=n.borderSkipped,p=fG(c);return{t:Ku(d.top,p.top,0,s),r:Ku(d.right,p.right,0,r),b:Ku(d.bottom,p.bottom,0,s),l:Ku(d.left,p.left,0,r)}}function Tpe(n,r,s){const{enableBorderRadius:c}=n.getProps(["enableBorderRadius"]),d=n.options.borderRadius,p=Kp(d),g=Math.min(r,s),y=n.borderSkipped,T=c||Wi(d);return{topLeft:Ku(!T||y.top||y.left,p.topLeft,0,g),topRight:Ku(!T||y.top||y.right,p.topRight,0,g),bottomLeft:Ku(!T||y.bottom||y.left,p.bottomLeft,0,g),bottomRight:Ku(!T||y.bottom||y.right,p.bottomRight,0,g)}}function wpe(n){const r=DG(n),s=r.right-r.left,c=r.bottom-r.top,d=Spe(n,s/2,c/2),p=Tpe(n,s/2,c/2);return{outer:{x:r.left,y:r.top,w:s,h:c,radius:p},inner:{x:r.left+d.l,y:r.top+d.t,w:s-d.l-d.r,h:c-d.t-d.b,radius:{topLeft:Math.max(0,p.topLeft-Math.max(d.t,d.l)),topRight:Math.max(0,p.topRight-Math.max(d.t,d.r)),bottomLeft:Math.max(0,p.bottomLeft-Math.max(d.b,d.l)),bottomRight:Math.max(0,p.bottomRight-Math.max(d.b,d.r))}}}}function XA(n,r,s,c){const d=r===null,p=s===null,y=n&&!(d&&p)&&DG(n,c);return y&&(d||ug(r,y.left,y.right))&&(p||ug(s,y.top,y.bottom))}function Cpe(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function bpe(n,r){n.rect(r.x,r.y,r.w,r.h)}function JA(n,r,s={}){const c=n.x!==s.x?-r:0,d=n.y!==s.y?-r:0,p=(n.x+n.w!==s.x+s.w?r:0)-c,g=(n.y+n.h!==s.y+s.h?r:0)-d;return{x:n.x+c,y:n.y+d,w:n.w+p,h:n.h+g,radius:n.radius}}class vT extends Xv{constructor(r){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,r&&Object.assign(this,r)}draw(r){const{inflateAmount:s,options:{borderColor:c,backgroundColor:d}}=this,{inner:p,outer:g}=wpe(this),y=Cpe(g.radius)?Mv:bpe;r.save(),(g.w!==p.w||g.h!==p.h)&&(r.beginPath(),y(r,JA(g,s,p)),r.clip(),y(r,JA(p,-s,g)),r.fillStyle=c,r.fill("evenodd")),r.beginPath(),y(r,JA(p,s)),r.fillStyle=d,r.fill(),r.restore()}inRange(r,s,c){return XA(this,r,s,c)}inXRange(r,s){return XA(this,r,null,s)}inYRange(r,s){return XA(this,null,r,s)}getCenterPoint(r){const{x:s,y:c,base:d,horizontal:p}=this.getProps(["x","y","base","horizontal"],r);return{x:p?(s+d)/2:s,y:p?c:(c+d)/2}}getRange(r){return r==="x"?this.width/2:this.height/2}}ri(vT,"id","bar"),ri(vT,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ri(vT,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const gW=(n,r)=>{let{boxHeight:s=r,boxWidth:c=r}=n;return n.usePointStyle&&(s=Math.min(s,r),c=n.pointStyleWidth||Math.min(c,r)),{boxWidth:c,boxHeight:s,itemHeight:Math.max(r,s)}},Rpe=(n,r)=>n!==null&&r!==null&&n.datasetIndex===r.datasetIndex&&n.index===r.index;class _W extends Xv{constructor(r){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=r.chart,this.options=r.options,this.ctx=r.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(r,s,c){this.maxWidth=r,this.maxHeight=s,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const r=this.options.labels||{};let s=Rn(r.generateLabels,[this.chart],this)||[];r.filter&&(s=s.filter(c=>r.filter(c,this.chart.data))),r.sort&&(s=s.sort((c,d)=>r.sort(c,d,this.chart.data))),this.options.reverse&&s.reverse(),this.legendItems=s}fit(){const{options:r,ctx:s}=this;if(!r.display){this.width=this.height=0;return}const c=r.labels,d=so(c.font),p=d.size,g=this._computeTitleHeight(),{boxWidth:y,itemHeight:T}=gW(c,p);let R,N;s.font=d.string,this.isHorizontal()?(R=this.maxWidth,N=this._fitRows(g,p,y,T)+10):(N=this.maxHeight,R=this._fitCols(g,d,y,T)+10),this.width=Math.min(R,r.maxWidth||this.maxWidth),this.height=Math.min(N,r.maxHeight||this.maxHeight)}_fitRows(r,s,c,d){const{ctx:p,maxWidth:g,options:{labels:{padding:y}}}=this,T=this.legendHitBoxes=[],R=this.lineWidths=[0],N=d+y;let D=r;p.textAlign="left",p.textBaseline="middle";let B=-1,q=-N;return this.legendItems.forEach((J,Y)=>{const te=c+s/2+p.measureText(J.text).width;(Y===0||R[R.length-1]+te+2*y>g)&&(D+=N,R[R.length-(Y>0?0:1)]=0,q+=N,B++),T[Y]={left:0,top:q,row:B,width:te,height:d},R[R.length-1]+=te+y}),D}_fitCols(r,s,c,d){const{ctx:p,maxHeight:g,options:{labels:{padding:y}}}=this,T=this.legendHitBoxes=[],R=this.columnSizes=[],N=g-r;let D=y,B=0,q=0,J=0,Y=0;return this.legendItems.forEach((te,Z)=>{const{itemWidth:ee,itemHeight:re}=Ipe(c,s,p,te,d);Z>0&&q+re+2*y>N&&(D+=B+y,R.push({width:B,height:q}),J+=B+y,Y++,B=q=0),T[Z]={left:J,top:q,col:Y,width:ee,height:re},B=Math.max(B,ee),q+=re+y}),D+=B,R.push({width:B,height:q}),D}adjustHitBoxes(){if(!this.options.display)return;const r=this._computeTitleHeight(),{legendHitBoxes:s,options:{align:c,labels:{padding:d},rtl:p}}=this,g=vg(p,this.left,this.width);if(this.isHorizontal()){let y=0,T=Fs(c,this.left+d,this.right-this.lineWidths[y]);for(const R of s)y!==R.row&&(y=R.row,T=Fs(c,this.left+d,this.right-this.lineWidths[y])),R.top+=this.top+r+d,R.left=g.leftForLtr(g.x(T),R.width),T+=R.width+d}else{let y=0,T=Fs(c,this.top+r+d,this.bottom-this.columnSizes[y].height);for(const R of s)R.col!==y&&(y=R.col,T=Fs(c,this.top+r+d,this.bottom-this.columnSizes[y].height)),R.top=T,R.left+=this.left+d,R.left=g.leftForLtr(g.x(R.left),R.width),T+=R.height+d}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const r=this.ctx;kN(r,this),this._draw(),LN(r)}}_draw(){const{options:r,columnSizes:s,lineWidths:c,ctx:d}=this,{align:p,labels:g}=r,y=cr.color,T=vg(r.rtl,this.left,this.width),R=so(g.font),{padding:N}=g,D=R.size,B=D/2;let q;this.drawTitle(),d.textAlign=T.textAlign("left"),d.textBaseline="middle",d.lineWidth=.5,d.font=R.string;const{boxWidth:J,boxHeight:Y,itemHeight:te}=gW(g,D),Z=function(Oe,Se,je){if(isNaN(J)||J<=0||isNaN(Y)||Y<0)return;d.save();const ot=en(je.lineWidth,1);if(d.fillStyle=en(je.fillStyle,y),d.lineCap=en(je.lineCap,"butt"),d.lineDashOffset=en(je.lineDashOffset,0),d.lineJoin=en(je.lineJoin,"miter"),d.lineWidth=ot,d.strokeStyle=en(je.strokeStyle,y),d.setLineDash(en(je.lineDash,[])),g.usePointStyle){const Qe={radius:Y*Math.SQRT2/2,pointStyle:je.pointStyle,rotation:je.rotation,borderWidth:ot},st=T.xPlus(Oe,J/2),ut=Se+B;hG(d,Qe,st,ut,g.pointStyleWidth&&J)}else{const Qe=Se+Math.max((D-Y)/2,0),st=T.leftForLtr(Oe,J),ut=Kp(je.borderRadius);d.beginPath(),Object.values(ut).some(Ni=>Ni!==0)?Mv(d,{x:st,y:Qe,w:J,h:Y,radius:ut}):d.rect(st,Qe,J,Y),d.fill(),ot!==0&&d.stroke()}d.restore()},ee=function(Oe,Se,je){Lg(d,je.text,Oe,Se+te/2,R,{strikethrough:je.hidden,textAlign:T.textAlign(je.textAlign)})},re=this.isHorizontal(),pe=this._computeTitleHeight();re?q={x:Fs(p,this.left+N,this.right-c[0]),y:this.top+N+pe,line:0}:q={x:this.left+N,y:Fs(p,this.top+pe+N,this.bottom-s[0].height),line:0},vG(this.ctx,r.textDirection);const ve=te+N;this.legendItems.forEach((Oe,Se)=>{d.strokeStyle=Oe.fontColor,d.fillStyle=Oe.fontColor;const je=d.measureText(Oe.text).width,ot=T.textAlign(Oe.textAlign||(Oe.textAlign=g.textAlign)),Qe=J+B+je;let st=q.x,ut=q.y;T.setWidth(this.width),re?Se>0&&st+Qe+N>this.right&&(ut=q.y+=ve,q.line++,st=q.x=Fs(p,this.left+N,this.right-c[q.line])):Se>0&&ut+ve>this.bottom&&(st=q.x=st+s[q.line].width+N,q.line++,ut=q.y=Fs(p,this.top+pe+N,this.bottom-s[q.line].height));const Ni=T.x(st);if(Z(Ni,ut,Oe),st=rue(ot,st+J+B,re?st+Qe:this.right,r.rtl),ee(T.x(st),ut,Oe),re)q.x+=Qe+N;else if(typeof Oe.text!="string"){const gt=R.lineHeight;q.y+=kG(Oe,gt)+N}else q.y+=ve}),yG(this.ctx,r.textDirection)}drawTitle(){const r=this.options,s=r.title,c=so(s.font),d=qo(s.padding);if(!s.display)return;const p=vg(r.rtl,this.left,this.width),g=this.ctx,y=s.position,T=c.size/2,R=d.top+T;let N,D=this.left,B=this.width;if(this.isHorizontal())B=Math.max(...this.lineWidths),N=this.top+R,D=Fs(r.align,D,this.right-B);else{const J=this.columnSizes.reduce((Y,te)=>Math.max(Y,te.height),0);N=R+Fs(r.align,this.top,this.bottom-J-r.labels.padding-this._computeTitleHeight())}const q=Fs(y,D,D+B);g.textAlign=p.textAlign(lG(y)),g.textBaseline="middle",g.strokeStyle=s.color,g.fillStyle=s.color,g.font=c.string,Lg(g,s.text,q,N,c)}_computeTitleHeight(){const r=this.options.title,s=so(r.font),c=qo(r.padding);return r.display?s.lineHeight+c.height:0}_getLegendItemAt(r,s){let c,d,p;if(ug(r,this.left,this.right)&&ug(s,this.top,this.bottom)){for(p=this.legendHitBoxes,c=0;c<p.length;++c)if(d=p[c],ug(r,d.left,d.left+d.width)&&ug(s,d.top,d.top+d.height))return this.legendItems[c]}return null}handleEvent(r){const s=this.options;if(!Ppe(r.type,s))return;const c=this._getLegendItemAt(r.x,r.y);if(r.type==="mousemove"||r.type==="mouseout"){const d=this._hoveredItem,p=Rpe(d,c);d&&!p&&Rn(s.onLeave,[r,d,this],this),this._hoveredItem=c,c&&!p&&Rn(s.onHover,[r,c,this],this)}else c&&Rn(s.onClick,[r,c,this],this)}}function Ipe(n,r,s,c,d){const p=Ape(c,n,r,s),g=Ope(d,c,r.lineHeight);return{itemWidth:p,itemHeight:g}}function Ape(n,r,s,c){let d=n.text;return d&&typeof d!="string"&&(d=d.reduce((p,g)=>p.length>g.length?p:g)),r+s.size/2+c.measureText(d).width}function Ope(n,r,s){let c=n;return typeof r.text!="string"&&(c=kG(r,s)),c}function kG(n,r){const s=n.text?n.text.length:0;return r*s}function Ppe(n,r){return!!((n==="mousemove"||n==="mouseout")&&(r.onHover||r.onLeave)||r.onClick&&(n==="click"||n==="mouseup"))}var Npe={id:"legend",_element:_W,start(n,r,s){const c=n.legend=new _W({ctx:n.ctx,options:s,chart:n});Gu.configure(n,c,s),Gu.addBox(n,c)},stop(n){Gu.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,r,s){const c=n.legend;Gu.configure(n,c,s),c.options=s},afterUpdate(n){const r=n.legend;r.buildLabels(),r.adjustHitBoxes()},afterEvent(n,r){r.replay||n.legend.handleEvent(r.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,r,s){const c=r.datasetIndex,d=s.chart;d.isDatasetVisible(c)?(d.hide(c),r.hidden=!0):(d.show(c),r.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const r=n.data.datasets,{labels:{usePointStyle:s,pointStyle:c,textAlign:d,color:p,useBorderRadius:g,borderRadius:y}}=n.legend.options;return n._getSortedDatasetMetas().map(T=>{const R=T.controller.getStyle(s?0:void 0),N=qo(R.borderWidth);return{text:r[T.index].label,fillStyle:R.backgroundColor,fontColor:p,hidden:!T.visible,lineCap:R.borderCapStyle,lineDash:R.borderDash,lineDashOffset:R.borderDashOffset,lineJoin:R.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:R.borderColor,pointStyle:c||R.pointStyle,rotation:R.rotation,textAlign:d||R.textAlign,borderRadius:g&&(y||R.borderRadius),datasetIndex:T.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};const YE={average(n){if(!n.length)return!1;let r,s,c=new Set,d=0,p=0;for(r=0,s=n.length;r<s;++r){const y=n[r].element;if(y&&y.hasValue()){const T=y.tooltipPosition();c.add(T.x),d+=T.y,++p}}return{x:[...c].reduce((y,T)=>y+T)/c.size,y:d/p}},nearest(n,r){if(!n.length)return!1;let s=r.x,c=r.y,d=Number.POSITIVE_INFINITY,p,g,y;for(p=0,g=n.length;p<g;++p){const T=n[p].element;if(T&&T.hasValue()){const R=T.getCenterPoint(),N=Jde(r,R);N<d&&(d=N,y=T)}}if(y){const T=y.tooltipPosition();s=T.x,c=T.y}return{x:s,y:c}}};function pl(n,r){return r&&(Yn(r)?Array.prototype.push.apply(n,r):n.push(r)),n}function cd(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function xpe(n,r){const{element:s,datasetIndex:c,index:d}=r,p=n.getDatasetMeta(c).controller,{label:g,value:y}=p.getLabelAndValue(d);return{chart:n,label:g,parsed:p.getParsed(d),raw:n.data.datasets[c].data[d],formattedValue:y,dataset:p.getDataset(),dataIndex:d,datasetIndex:c,element:s}}function EW(n,r){const s=n.chart.ctx,{body:c,footer:d,title:p}=n,{boxWidth:g,boxHeight:y}=r,T=so(r.bodyFont),R=so(r.titleFont),N=so(r.footerFont),D=p.length,B=d.length,q=c.length,J=qo(r.padding);let Y=J.height,te=0,Z=c.reduce((pe,ve)=>pe+ve.before.length+ve.lines.length+ve.after.length,0);if(Z+=n.beforeBody.length+n.afterBody.length,D&&(Y+=D*R.lineHeight+(D-1)*r.titleSpacing+r.titleMarginBottom),Z){const pe=r.displayColors?Math.max(y,T.lineHeight):T.lineHeight;Y+=q*pe+(Z-q)*T.lineHeight+(Z-1)*r.bodySpacing}B&&(Y+=r.footerMarginTop+B*N.lineHeight+(B-1)*r.footerSpacing);let ee=0;const re=function(pe){te=Math.max(te,s.measureText(pe).width+ee)};return s.save(),s.font=R.string,an(n.title,re),s.font=T.string,an(n.beforeBody.concat(n.afterBody),re),ee=r.displayColors?g+2+r.boxPadding:0,an(c,pe=>{an(pe.before,re),an(pe.lines,re),an(pe.after,re)}),ee=0,s.font=N.string,an(n.footer,re),s.restore(),te+=J.width,{width:te,height:Y}}function Dpe(n,r){const{y:s,height:c}=r;return s<c/2?"top":s>n.height-c/2?"bottom":"center"}function kpe(n,r,s,c){const{x:d,width:p}=c,g=s.caretSize+s.caretPadding;if(n==="left"&&d+p+g>r.width||n==="right"&&d-p-g<0)return!0}function Lpe(n,r,s,c){const{x:d,width:p}=s,{width:g,chartArea:{left:y,right:T}}=n;let R="center";return c==="center"?R=d<=(y+T)/2?"left":"right":d<=p/2?R="left":d>=g-p/2&&(R="right"),kpe(R,n,r,s)&&(R="center"),R}function vW(n,r,s){const c=s.yAlign||r.yAlign||Dpe(n,s);return{xAlign:s.xAlign||r.xAlign||Lpe(n,r,s,c),yAlign:c}}function Mpe(n,r){let{x:s,width:c}=n;return r==="right"?s-=c:r==="center"&&(s-=c/2),s}function Upe(n,r,s){let{y:c,height:d}=n;return r==="top"?c+=s:r==="bottom"?c-=d+s:c-=d/2,c}function yW(n,r,s,c){const{caretSize:d,caretPadding:p,cornerRadius:g}=n,{xAlign:y,yAlign:T}=s,R=d+p,{topLeft:N,topRight:D,bottomLeft:B,bottomRight:q}=Kp(g);let J=Mpe(r,y);const Y=Upe(r,T,R);return T==="center"?y==="left"?J+=R:y==="right"&&(J-=R):y==="left"?J-=Math.max(N,B)+d:y==="right"&&(J+=Math.max(D,q)+d),{x:Tc(J,0,c.width-r.width),y:Tc(Y,0,c.height-r.height)}}function YS(n,r,s){const c=qo(s.padding);return r==="center"?n.x+n.width/2:r==="right"?n.x+n.width-c.right:n.x+c.left}function SW(n){return pl([],cd(n))}function jpe(n,r,s){return sf(n,{tooltip:r,tooltipItems:s,type:"tooltip"})}function TW(n,r){const s=r&&r.dataset&&r.dataset.tooltip&&r.dataset.tooltip.callbacks;return s?n.override(s):n}const LG={beforeTitle:od,title(n){if(n.length>0){const r=n[0],s=r.chart.data.labels,c=s?s.length:0;if(this&&this.options&&this.options.mode==="dataset")return r.dataset.label||"";if(r.label)return r.label;if(c>0&&r.dataIndex<c)return s[r.dataIndex]}return""},afterTitle:od,beforeBody:od,beforeLabel:od,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let r=n.dataset.label||"";r&&(r+=": ");const s=n.formattedValue;return mn(s)||(r+=s),r},labelColor(n){const s=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:s.borderColor,backgroundColor:s.backgroundColor,borderWidth:s.borderWidth,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const s=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:s.pointStyle,rotation:s.rotation}},afterLabel:od,afterBody:od,beforeFooter:od,footer:od,afterFooter:od};function vs(n,r,s,c){const d=n[r].call(s,c);return typeof d>"u"?LG[r].call(s,c):d}class lP extends Xv{constructor(r){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=r.chart,this.options=r.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(r){this.options=r,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const r=this._cachedAnimations;if(r)return r;const s=this.chart,c=this.options.setContext(this.getContext()),d=c.enabled&&s.options.animation&&c.animations,p=new SG(this.chart,d);return d._cacheable&&(this._cachedAnimations=Object.freeze(p)),p}getContext(){return this.$context||(this.$context=jpe(this.chart.getContext(),this,this._tooltipItems))}getTitle(r,s){const{callbacks:c}=s,d=vs(c,"beforeTitle",this,r),p=vs(c,"title",this,r),g=vs(c,"afterTitle",this,r);let y=[];return y=pl(y,cd(d)),y=pl(y,cd(p)),y=pl(y,cd(g)),y}getBeforeBody(r,s){return SW(vs(s.callbacks,"beforeBody",this,r))}getBody(r,s){const{callbacks:c}=s,d=[];return an(r,p=>{const g={before:[],lines:[],after:[]},y=TW(c,p);pl(g.before,cd(vs(y,"beforeLabel",this,p))),pl(g.lines,vs(y,"label",this,p)),pl(g.after,cd(vs(y,"afterLabel",this,p))),d.push(g)}),d}getAfterBody(r,s){return SW(vs(s.callbacks,"afterBody",this,r))}getFooter(r,s){const{callbacks:c}=s,d=vs(c,"beforeFooter",this,r),p=vs(c,"footer",this,r),g=vs(c,"afterFooter",this,r);let y=[];return y=pl(y,cd(d)),y=pl(y,cd(p)),y=pl(y,cd(g)),y}_createItems(r){const s=this._active,c=this.chart.data,d=[],p=[],g=[];let y=[],T,R;for(T=0,R=s.length;T<R;++T)y.push(xpe(this.chart,s[T]));return r.filter&&(y=y.filter((N,D,B)=>r.filter(N,D,B,c))),r.itemSort&&(y=y.sort((N,D)=>r.itemSort(N,D,c))),an(y,N=>{const D=TW(r.callbacks,N);d.push(vs(D,"labelColor",this,N)),p.push(vs(D,"labelPointStyle",this,N)),g.push(vs(D,"labelTextColor",this,N))}),this.labelColors=d,this.labelPointStyles=p,this.labelTextColors=g,this.dataPoints=y,y}update(r,s){const c=this.options.setContext(this.getContext()),d=this._active;let p,g=[];if(!d.length)this.opacity!==0&&(p={opacity:0});else{const y=YE[c.position].call(this,d,this._eventPosition);g=this._createItems(c),this.title=this.getTitle(g,c),this.beforeBody=this.getBeforeBody(g,c),this.body=this.getBody(g,c),this.afterBody=this.getAfterBody(g,c),this.footer=this.getFooter(g,c);const T=this._size=EW(this,c),R=Object.assign({},y,T),N=vW(this.chart,c,R),D=yW(c,R,N,this.chart);this.xAlign=N.xAlign,this.yAlign=N.yAlign,p={opacity:1,x:D.x,y:D.y,width:T.width,height:T.height,caretX:y.x,caretY:y.y}}this._tooltipItems=g,this.$context=void 0,p&&this._resolveAnimations().update(this,p),r&&c.external&&c.external.call(this,{chart:this.chart,tooltip:this,replay:s})}drawCaret(r,s,c,d){const p=this.getCaretPosition(r,c,d);s.lineTo(p.x1,p.y1),s.lineTo(p.x2,p.y2),s.lineTo(p.x3,p.y3)}getCaretPosition(r,s,c){const{xAlign:d,yAlign:p}=this,{caretSize:g,cornerRadius:y}=c,{topLeft:T,topRight:R,bottomLeft:N,bottomRight:D}=Kp(y),{x:B,y:q}=r,{width:J,height:Y}=s;let te,Z,ee,re,pe,ve;return p==="center"?(pe=q+Y/2,d==="left"?(te=B,Z=te-g,re=pe+g,ve=pe-g):(te=B+J,Z=te+g,re=pe-g,ve=pe+g),ee=te):(d==="left"?Z=B+Math.max(T,N)+g:d==="right"?Z=B+J-Math.max(R,D)-g:Z=this.caretX,p==="top"?(re=q,pe=re-g,te=Z-g,ee=Z+g):(re=q+Y,pe=re+g,te=Z+g,ee=Z-g),ve=re),{x1:te,x2:Z,x3:ee,y1:re,y2:pe,y3:ve}}drawTitle(r,s,c){const d=this.title,p=d.length;let g,y,T;if(p){const R=vg(c.rtl,this.x,this.width);for(r.x=YS(this,c.titleAlign,c),s.textAlign=R.textAlign(c.titleAlign),s.textBaseline="middle",g=so(c.titleFont),y=c.titleSpacing,s.fillStyle=c.titleColor,s.font=g.string,T=0;T<p;++T)s.fillText(d[T],R.x(r.x),r.y+g.lineHeight/2),r.y+=g.lineHeight+y,T+1===p&&(r.y+=c.titleMarginBottom-y)}}_drawColorBox(r,s,c,d,p){const g=this.labelColors[c],y=this.labelPointStyles[c],{boxHeight:T,boxWidth:R}=p,N=so(p.bodyFont),D=YS(this,"left",p),B=d.x(D),q=T<N.lineHeight?(N.lineHeight-T)/2:0,J=s.y+q;if(p.usePointStyle){const Y={radius:Math.min(R,T)/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:1},te=d.leftForLtr(B,R)+R/2,Z=J+T/2;r.strokeStyle=p.multiKeyBackground,r.fillStyle=p.multiKeyBackground,M4(r,Y,te,Z),r.strokeStyle=g.borderColor,r.fillStyle=g.backgroundColor,M4(r,Y,te,Z)}else{r.lineWidth=Wi(g.borderWidth)?Math.max(...Object.values(g.borderWidth)):g.borderWidth||1,r.strokeStyle=g.borderColor,r.setLineDash(g.borderDash||[]),r.lineDashOffset=g.borderDashOffset||0;const Y=d.leftForLtr(B,R),te=d.leftForLtr(d.xPlus(B,1),R-2),Z=Kp(g.borderRadius);Object.values(Z).some(ee=>ee!==0)?(r.beginPath(),r.fillStyle=p.multiKeyBackground,Mv(r,{x:Y,y:J,w:R,h:T,radius:Z}),r.fill(),r.stroke(),r.fillStyle=g.backgroundColor,r.beginPath(),Mv(r,{x:te,y:J+1,w:R-2,h:T-2,radius:Z}),r.fill()):(r.fillStyle=p.multiKeyBackground,r.fillRect(Y,J,R,T),r.strokeRect(Y,J,R,T),r.fillStyle=g.backgroundColor,r.fillRect(te,J+1,R-2,T-2))}r.fillStyle=this.labelTextColors[c]}drawBody(r,s,c){const{body:d}=this,{bodySpacing:p,bodyAlign:g,displayColors:y,boxHeight:T,boxWidth:R,boxPadding:N}=c,D=so(c.bodyFont);let B=D.lineHeight,q=0;const J=vg(c.rtl,this.x,this.width),Y=function(je){s.fillText(je,J.x(r.x+q),r.y+B/2),r.y+=B+p},te=J.textAlign(g);let Z,ee,re,pe,ve,Oe,Se;for(s.textAlign=g,s.textBaseline="middle",s.font=D.string,r.x=YS(this,te,c),s.fillStyle=c.bodyColor,an(this.beforeBody,Y),q=y&&te!=="right"?g==="center"?R/2+N:R+2+N:0,pe=0,Oe=d.length;pe<Oe;++pe){for(Z=d[pe],ee=this.labelTextColors[pe],s.fillStyle=ee,an(Z.before,Y),re=Z.lines,y&&re.length&&(this._drawColorBox(s,r,pe,J,c),B=Math.max(D.lineHeight,T)),ve=0,Se=re.length;ve<Se;++ve)Y(re[ve]),B=D.lineHeight;an(Z.after,Y)}q=0,B=D.lineHeight,an(this.afterBody,Y),r.y-=p}drawFooter(r,s,c){const d=this.footer,p=d.length;let g,y;if(p){const T=vg(c.rtl,this.x,this.width);for(r.x=YS(this,c.footerAlign,c),r.y+=c.footerMarginTop,s.textAlign=T.textAlign(c.footerAlign),s.textBaseline="middle",g=so(c.footerFont),s.fillStyle=c.footerColor,s.font=g.string,y=0;y<p;++y)s.fillText(d[y],T.x(r.x),r.y+g.lineHeight/2),r.y+=g.lineHeight+c.footerSpacing}}drawBackground(r,s,c,d){const{xAlign:p,yAlign:g}=this,{x:y,y:T}=r,{width:R,height:N}=c,{topLeft:D,topRight:B,bottomLeft:q,bottomRight:J}=Kp(d.cornerRadius);s.fillStyle=d.backgroundColor,s.strokeStyle=d.borderColor,s.lineWidth=d.borderWidth,s.beginPath(),s.moveTo(y+D,T),g==="top"&&this.drawCaret(r,s,c,d),s.lineTo(y+R-B,T),s.quadraticCurveTo(y+R,T,y+R,T+B),g==="center"&&p==="right"&&this.drawCaret(r,s,c,d),s.lineTo(y+R,T+N-J),s.quadraticCurveTo(y+R,T+N,y+R-J,T+N),g==="bottom"&&this.drawCaret(r,s,c,d),s.lineTo(y+q,T+N),s.quadraticCurveTo(y,T+N,y,T+N-q),g==="center"&&p==="left"&&this.drawCaret(r,s,c,d),s.lineTo(y,T+D),s.quadraticCurveTo(y,T,y+D,T),s.closePath(),s.fill(),d.borderWidth>0&&s.stroke()}_updateAnimationTarget(r){const s=this.chart,c=this.$animations,d=c&&c.x,p=c&&c.y;if(d||p){const g=YE[r.position].call(this,this._active,this._eventPosition);if(!g)return;const y=this._size=EW(this,r),T=Object.assign({},g,this._size),R=vW(s,r,T),N=yW(r,T,R,s);(d._to!==N.x||p._to!==N.y)&&(this.xAlign=R.xAlign,this.yAlign=R.yAlign,this.width=y.width,this.height=y.height,this.caretX=g.x,this.caretY=g.y,this._resolveAnimations().update(this,N))}}_willRender(){return!!this.opacity}draw(r){const s=this.options.setContext(this.getContext());let c=this.opacity;if(!c)return;this._updateAnimationTarget(s);const d={width:this.width,height:this.height},p={x:this.x,y:this.y};c=Math.abs(c)<.001?0:c;const g=qo(s.padding),y=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;s.enabled&&y&&(r.save(),r.globalAlpha=c,this.drawBackground(p,r,d,s),vG(r,s.textDirection),p.y+=g.top,this.drawTitle(p,r,s),this.drawBody(p,r,s),this.drawFooter(p,r,s),yG(r,s.textDirection),r.restore())}getActiveElements(){return this._active||[]}setActiveElements(r,s){const c=this._active,d=r.map(({datasetIndex:y,index:T})=>{const R=this.chart.getDatasetMeta(y);if(!R)throw new Error("Cannot find a dataset at index "+y);return{datasetIndex:y,element:R.data[T],index:T}}),p=!ew(c,d),g=this._positionChanged(d,s);(p||g)&&(this._active=d,this._eventPosition=s,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(r,s,c=!0){if(s&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const d=this.options,p=this._active||[],g=this._getActiveElements(r,p,s,c),y=this._positionChanged(g,r),T=s||!ew(g,p)||y;return T&&(this._active=g,(d.enabled||d.external)&&(this._eventPosition={x:r.x,y:r.y},this.update(!0,s))),T}_getActiveElements(r,s,c,d){const p=this.options;if(r.type==="mouseout")return[];if(!d)return s.filter(y=>this.chart.data.datasets[y.datasetIndex]&&this.chart.getDatasetMeta(y.datasetIndex).controller.getParsed(y.index)!==void 0);const g=this.chart.getElementsAtEventForMode(r,p.mode,p,c);return p.reverse&&g.reverse(),g}_positionChanged(r,s){const{caretX:c,caretY:d,options:p}=this,g=YE[p.position].call(this,r,s);return g!==!1&&(c!==g.x||d!==g.y)}}ri(lP,"positioners",YE);var Vpe={id:"tooltip",_element:lP,positioners:YE,afterInit(n,r,s){s&&(n.tooltip=new lP({chart:n,options:s}))},beforeUpdate(n,r,s){n.tooltip&&n.tooltip.initialize(s)},reset(n,r,s){n.tooltip&&n.tooltip.initialize(s)},afterDraw(n){const r=n.tooltip;if(r&&r._willRender()){const s={tooltip:r};if(n.notifyPlugins("beforeTooltipDraw",{...s,cancelable:!0})===!1)return;r.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",s)}},afterEvent(n,r){if(n.tooltip){const s=r.replay;n.tooltip.handleEvent(r.event,s,r.inChartArea)&&(r.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,r)=>r.bodyFont.size,boxWidth:(n,r)=>r.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:LG},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Fpe=(n,r,s,c)=>(typeof r=="string"?(s=n.push(r)-1,c.unshift({index:s,label:r})):isNaN(r)&&(s=null),s);function Bpe(n,r,s,c){const d=n.indexOf(r);if(d===-1)return Fpe(n,r,s,c);const p=n.lastIndexOf(r);return d!==p?s:d}const Wpe=(n,r)=>n===null?null:Tc(Math.round(n),0,r);function wW(n){const r=this.getLabels();return n>=0&&n<r.length?r[n]:n}class dP extends af{constructor(r){super(r),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(r){const s=this._addedLabels;if(s.length){const c=this.getLabels();for(const{index:d,label:p}of s)c[d]===p&&c.splice(d,1);this._addedLabels=[]}super.init(r)}parse(r,s){if(mn(r))return null;const c=this.getLabels();return s=isFinite(s)&&c[s]===r?s:Bpe(c,r,en(s,r),this._addedLabels),Wpe(s,c.length-1)}determineDataLimits(){const{minDefined:r,maxDefined:s}=this.getUserBounds();let{min:c,max:d}=this.getMinMax(!0);this.options.bounds==="ticks"&&(r||(c=0),s||(d=this.getLabels().length-1)),this.min=c,this.max=d}buildTicks(){const r=this.min,s=this.max,c=this.options.offset,d=[];let p=this.getLabels();p=r===0&&s===p.length-1?p:p.slice(r,s+1),this._valueRange=Math.max(p.length-(c?0:1),1),this._startValue=this.min-(c?.5:0);for(let g=r;g<=s;g++)d.push({value:g});return d}getLabelForValue(r){return wW.call(this,r)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(r){return typeof r!="number"&&(r=this.parse(r)),r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getPixelForTick(r){const s=this.ticks;return r<0||r>s.length-1?null:this.getPixelForValue(s[r].value)}getValueForPixel(r){return Math.round(this._startValue+this.getDecimalForPixel(r)*this._valueRange)}getBasePixel(){return this.bottom}}ri(dP,"id","category"),ri(dP,"defaults",{ticks:{callback:wW}});function zpe(n,r){const s=[],{bounds:d,step:p,min:g,max:y,precision:T,count:R,maxTicks:N,maxDigits:D,includeBounds:B}=n,q=p||1,J=N-1,{min:Y,max:te}=r,Z=!mn(g),ee=!mn(y),re=!mn(R),pe=(te-Y)/(D+1);let ve=A4((te-Y)/J/q)*q,Oe,Se,je,ot;if(ve<1e-14&&!Z&&!ee)return[{value:Y},{value:te}];ot=Math.ceil(te/ve)-Math.floor(Y/ve),ot>J&&(ve=A4(ot*ve/J/q)*q),mn(T)||(Oe=Math.pow(10,T),ve=Math.ceil(ve*Oe)/Oe),d==="ticks"?(Se=Math.floor(Y/ve)*ve,je=Math.ceil(te/ve)*ve):(Se=Y,je=te),Z&&ee&&p&&$de((y-g)/p,ve/1e3)?(ot=Math.round(Math.min((y-g)/ve,N)),ve=(y-g)/ot,Se=g,je=y):re?(Se=Z?g:Se,je=ee?y:je,ot=R-1,ve=(je-Se)/ot):(ot=(je-Se)/ve,mT(ot,Math.round(ot),ve/1e3)?ot=Math.round(ot):ot=Math.ceil(ot));const Qe=Math.max(O4(ve),O4(Se));Oe=Math.pow(10,mn(T)?Qe:T),Se=Math.round(Se*Oe)/Oe,je=Math.round(je*Oe)/Oe;let st=0;for(Z&&(B&&Se!==g?(s.push({value:g}),Se<g&&st++,mT(Math.round((Se+st*ve)*Oe)/Oe,g,CW(g,pe,n))&&st++):Se<g&&st++);st<ot;++st){const ut=Math.round((Se+st*ve)*Oe)/Oe;if(ee&&ut>y)break;s.push({value:ut})}return ee&&B&&je!==y?s.length&&mT(s[s.length-1].value,y,CW(y,pe,n))?s[s.length-1].value=y:s.push({value:y}):(!ee||je===y)&&s.push({value:je}),s}function CW(n,r,{horizontal:s,minRotation:c}){const d=Hu(c),p=(s?Math.sin(d):Math.cos(d))||.001,g=.75*r*(""+n).length;return Math.min(r/p,g)}class aw extends af{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(r,s){return mn(r)||(typeof r=="number"||r instanceof Number)&&!isFinite(+r)?null:+r}handleTickRangeOptions(){const{beginAtZero:r}=this.options,{minDefined:s,maxDefined:c}=this.getUserBounds();let{min:d,max:p}=this;const g=T=>d=s?d:T,y=T=>p=c?p:T;if(r){const T=rh(d),R=rh(p);T<0&&R<0?y(0):T>0&&R>0&&g(0)}if(d===p){let T=p===0?1:Math.abs(p*.05);y(p+T),r||g(d-T)}this.min=d,this.max=p}getTickLimit(){const r=this.options.ticks;let{maxTicksLimit:s,stepSize:c}=r,d;return c?(d=Math.ceil(this.max/c)-Math.floor(this.min/c)+1,d>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${d} ticks. Limiting to 1000.`),d=1e3)):(d=this.computeTickLimit(),s=s||11),s&&(d=Math.min(s,d)),d}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const r=this.options,s=r.ticks;let c=this.getTickLimit();c=Math.max(2,c);const d={maxTicks:c,bounds:r.bounds,min:r.min,max:r.max,precision:s.precision,step:s.stepSize,count:s.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:s.minRotation||0,includeBounds:s.includeBounds!==!1},p=this._range||this,g=zpe(d,p);return r.bounds==="ticks"&&rG(g,this,"value"),r.reverse?(g.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),g}configure(){const r=this.ticks;let s=this.min,c=this.max;if(super.configure(),this.options.offset&&r.length){const d=(c-s)/Math.max(r.length-1,1)/2;s-=d,c+=d}this._startValue=s,this._endValue=c,this._valueRange=c-s}getLabelForValue(r){return DN(r,this.chart.options.locale,this.options.ticks.format)}}class uP extends aw{determineDataLimits(){const{min:r,max:s}=this.getMinMax(!0);this.min=Gr(r)?r:0,this.max=Gr(s)?s:1,this.handleTickRangeOptions()}computeTickLimit(){const r=this.isHorizontal(),s=r?this.width:this.height,c=Hu(this.options.ticks.minRotation),d=(r?Math.sin(c):Math.cos(c))||.001,p=this._resolveTickFontOptions(0);return Math.ceil(s/Math.min(40,p.lineHeight/d))}getPixelForValue(r){return r===null?NaN:this.getPixelForDecimal((r-this._startValue)/this._valueRange)}getValueForPixel(r){return this._startValue+this.getDecimalForPixel(r)*this._valueRange}}ri(uP,"id","linear"),ri(uP,"defaults",{ticks:{callback:Mw.formatters.numeric}});const jv=n=>Math.floor(zu(n)),Lp=(n,r)=>Math.pow(10,jv(n)+r);function bW(n){return n/Math.pow(10,jv(n))===1}function RW(n,r,s){const c=Math.pow(10,s),d=Math.floor(n/c);return Math.ceil(r/c)-d}function Hpe(n,r){const s=r-n;let c=jv(s);for(;RW(n,r,c)>10;)c++;for(;RW(n,r,c)<10;)c--;return Math.min(c,jv(n))}function Gpe(n,{min:r,max:s}){r=Bs(n.min,r);const c=[],d=jv(r);let p=Hpe(r,s),g=p<0?Math.pow(10,Math.abs(p)):1;const y=Math.pow(10,p),T=d>p?Math.pow(10,d):0,R=Math.round((r-T)*g)/g,N=Math.floor((r-T)/y/10)*y*10;let D=Math.floor((R-N)/Math.pow(10,p)),B=Bs(n.min,Math.round((T+N+D*Math.pow(10,p))*g)/g);for(;B<s;)c.push({value:B,major:bW(B),significand:D}),D>=10?D=D<15?15:20:D++,D>=20&&(p++,D=2,g=p>=0?1:g),B=Math.round((T+N+D*Math.pow(10,p))*g)/g;const q=Bs(n.max,B);return c.push({value:q,major:bW(q),significand:D}),c}class IW extends af{constructor(r){super(r),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(r,s){const c=aw.prototype.parse.apply(this,[r,s]);if(c===0){this._zero=!0;return}return Gr(c)&&c>0?c:null}determineDataLimits(){const{min:r,max:s}=this.getMinMax(!0);this.min=Gr(r)?Math.max(0,r):null,this.max=Gr(s)?Math.max(0,s):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Gr(this._userMin)&&(this.min=r===Lp(this.min,0)?Lp(this.min,-1):Lp(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:r,maxDefined:s}=this.getUserBounds();let c=this.min,d=this.max;const p=y=>c=r?c:y,g=y=>d=s?d:y;c===d&&(c<=0?(p(1),g(10)):(p(Lp(c,-1)),g(Lp(d,1)))),c<=0&&p(Lp(d,-1)),d<=0&&g(Lp(c,1)),this.min=c,this.max=d}buildTicks(){const r=this.options,s={min:this._userMin,max:this._userMax},c=Gpe(s,this);return r.bounds==="ticks"&&rG(c,this,"value"),r.reverse?(c.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),c}getLabelForValue(r){return r===void 0?"0":DN(r,this.chart.options.locale,this.options.ticks.format)}configure(){const r=this.min;super.configure(),this._startValue=zu(r),this._valueRange=zu(this.max)-zu(r)}getPixelForValue(r){return(r===void 0||r===0)&&(r=this.min),r===null||isNaN(r)?NaN:this.getPixelForDecimal(r===this.min?0:(zu(r)-this._startValue)/this._valueRange)}getValueForPixel(r){const s=this.getDecimalForPixel(r);return Math.pow(10,this._startValue+s*this._valueRange)}}ri(IW,"id","logarithmic"),ri(IW,"defaults",{ticks:{callback:Mw.formatters.logarithmic,major:{enabled:!0}}});function hP(n){const r=n.ticks;if(r.display&&n.display){const s=qo(r.backdropPadding);return en(r.font&&r.font.size,cr.font.size)+s.height}return 0}function Kpe(n,r,s){return s=Yn(s)?s:[s],{w:fue(n,r.string,s),h:s.length*r.lineHeight}}function AW(n,r,s,c,d){return n===c||n===d?{start:r-s/2,end:r+s/2}:n<c||n>d?{start:r-s,end:r}:{start:r,end:r+s}}function qpe(n){const r={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},s=Object.assign({},r),c=[],d=[],p=n._pointLabels.length,g=n.options.pointLabels,y=g.centerPointLabels?Po/p:0;for(let T=0;T<p;T++){const R=g.setContext(n.getPointLabelContext(T));d[T]=R.padding;const N=n.getPointPosition(T,n.drawingArea+d[T],y),D=so(R.font),B=Kpe(n.ctx,D,n._pointLabels[T]);c[T]=B;const q=gl(n.getIndexAngle(T)+y),J=Math.round(NN(q)),Y=AW(J,N.x,B.w,0,180),te=AW(J,N.y,B.h,90,270);Ype(s,r,q,Y,te)}n.setCenterPoint(r.l-s.l,s.r-r.r,r.t-s.t,s.b-r.b),n._pointLabelItems=Jpe(n,c,d)}function Ype(n,r,s,c,d){const p=Math.abs(Math.sin(s)),g=Math.abs(Math.cos(s));let y=0,T=0;c.start<r.l?(y=(r.l-c.start)/p,n.l=Math.min(n.l,r.l-y)):c.end>r.r&&(y=(c.end-r.r)/p,n.r=Math.max(n.r,r.r+y)),d.start<r.t?(T=(r.t-d.start)/g,n.t=Math.min(n.t,r.t-T)):d.end>r.b&&(T=(d.end-r.b)/g,n.b=Math.max(n.b,r.b+T))}function $pe(n,r,s){const c=n.drawingArea,{extra:d,additionalAngle:p,padding:g,size:y}=s,T=n.getPointPosition(r,c+d+g,p),R=Math.round(NN(gl(T.angle+Hs))),N=efe(T.y,y.h,R),D=Zpe(R),B=Qpe(T.x,y.w,D);return{visible:!0,x:T.x,y:N,textAlign:D,left:B,top:N,right:B+y.w,bottom:N+y.h}}function Xpe(n,r){if(!r)return!0;const{left:s,top:c,right:d,bottom:p}=n;return!(hg({x:s,y:c},r)||hg({x:s,y:p},r)||hg({x:d,y:c},r)||hg({x:d,y:p},r))}function Jpe(n,r,s){const c=[],d=n._pointLabels.length,p=n.options,{centerPointLabels:g,display:y}=p.pointLabels,T={extra:hP(p)/2,additionalAngle:g?Po/d:0};let R;for(let N=0;N<d;N++){T.padding=s[N],T.size=r[N];const D=$pe(n,N,T);c.push(D),y==="auto"&&(D.visible=Xpe(D,R),D.visible&&(R=D))}return c}function Zpe(n){return n===0||n===180?"center":n<180?"left":"right"}function Qpe(n,r,s){return s==="right"?n-=r:s==="center"&&(n-=r/2),n}function efe(n,r,s){return s===90||s===270?n-=r/2:(s>270||s<90)&&(n-=r),n}function tfe(n,r,s){const{left:c,top:d,right:p,bottom:g}=s,{backdropColor:y}=r;if(!mn(y)){const T=Kp(r.borderRadius),R=qo(r.backdropPadding);n.fillStyle=y;const N=c-R.left,D=d-R.top,B=p-c+R.width,q=g-d+R.height;Object.values(T).some(J=>J!==0)?(n.beginPath(),Mv(n,{x:N,y:D,w:B,h:q,radius:T}),n.fill()):n.fillRect(N,D,B,q)}}function ife(n,r){const{ctx:s,options:{pointLabels:c}}=n;for(let d=r-1;d>=0;d--){const p=n._pointLabelItems[d];if(!p.visible)continue;const g=c.setContext(n.getPointLabelContext(d));tfe(s,g,p);const y=so(g.font),{x:T,y:R,textAlign:N}=p;Lg(s,n._pointLabels[d],T,R+y.lineHeight/2,y,{color:g.color,textAlign:N,textBaseline:"middle"})}}function MG(n,r,s,c){const{ctx:d}=n;if(s)d.arc(n.xCenter,n.yCenter,r,0,Sl);else{let p=n.getPointPosition(0,r);d.moveTo(p.x,p.y);for(let g=1;g<c;g++)p=n.getPointPosition(g,r),d.lineTo(p.x,p.y)}}function nfe(n,r,s,c,d){const p=n.ctx,g=r.circular,{color:y,lineWidth:T}=r;!g&&!c||!y||!T||s<0||(p.save(),p.strokeStyle=y,p.lineWidth=T,p.setLineDash(d.dash),p.lineDashOffset=d.dashOffset,p.beginPath(),MG(n,s,g,c),p.closePath(),p.stroke(),p.restore())}function rfe(n,r,s){return sf(n,{label:s,index:r,type:"pointLabel"})}class $S extends aw{constructor(r){super(r),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const r=this._padding=qo(hP(this.options)/2),s=this.width=this.maxWidth-r.width,c=this.height=this.maxHeight-r.height;this.xCenter=Math.floor(this.left+s/2+r.left),this.yCenter=Math.floor(this.top+c/2+r.top),this.drawingArea=Math.floor(Math.min(s,c)/2)}determineDataLimits(){const{min:r,max:s}=this.getMinMax(!1);this.min=Gr(r)&&!isNaN(r)?r:0,this.max=Gr(s)&&!isNaN(s)?s:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/hP(this.options))}generateTickLabels(r){aw.prototype.generateTickLabels.call(this,r),this._pointLabels=this.getLabels().map((s,c)=>{const d=Rn(this.options.pointLabels.callback,[s,c],this);return d||d===0?d:""}).filter((s,c)=>this.chart.getDataVisibility(c))}fit(){const r=this.options;r.display&&r.pointLabels.display?qpe(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(r,s,c,d){this.xCenter+=Math.floor((r-s)/2),this.yCenter+=Math.floor((c-d)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(r,s,c,d))}getIndexAngle(r){const s=Sl/(this._pointLabels.length||1),c=this.options.startAngle||0;return gl(r*s+Hu(c))}getDistanceFromCenterForValue(r){if(mn(r))return NaN;const s=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-r)*s:(r-this.min)*s}getValueForDistanceFromCenter(r){if(mn(r))return NaN;const s=r/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-s:this.min+s}getPointLabelContext(r){const s=this._pointLabels||[];if(r>=0&&r<s.length){const c=s[r];return rfe(this.getContext(),r,c)}}getPointPosition(r,s,c=0){const d=this.getIndexAngle(r)-Hs+c;return{x:Math.cos(d)*s+this.xCenter,y:Math.sin(d)*s+this.yCenter,angle:d}}getPointPositionForValue(r,s){return this.getPointPosition(r,this.getDistanceFromCenterForValue(s))}getBasePosition(r){return this.getPointPositionForValue(r||0,this.getBaseValue())}getPointLabelPosition(r){const{left:s,top:c,right:d,bottom:p}=this._pointLabelItems[r];return{left:s,top:c,right:d,bottom:p}}drawBackground(){const{backgroundColor:r,grid:{circular:s}}=this.options;if(r){const c=this.ctx;c.save(),c.beginPath(),MG(this,this.getDistanceFromCenterForValue(this._endValue),s,this._pointLabels.length),c.closePath(),c.fillStyle=r,c.fill(),c.restore()}}drawGrid(){const r=this.ctx,s=this.options,{angleLines:c,grid:d,border:p}=s,g=this._pointLabels.length;let y,T,R;if(s.pointLabels.display&&ife(this,g),d.display&&this.ticks.forEach((N,D)=>{if(D!==0||D===0&&this.min<0){T=this.getDistanceFromCenterForValue(N.value);const B=this.getContext(D),q=d.setContext(B),J=p.setContext(B);nfe(this,q,T,g,J)}}),c.display){for(r.save(),y=g-1;y>=0;y--){const N=c.setContext(this.getPointLabelContext(y)),{color:D,lineWidth:B}=N;!B||!D||(r.lineWidth=B,r.strokeStyle=D,r.setLineDash(N.borderDash),r.lineDashOffset=N.borderDashOffset,T=this.getDistanceFromCenterForValue(s.ticks.reverse?this.min:this.max),R=this.getPointPosition(y,T),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(R.x,R.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){const r=this.ctx,s=this.options,c=s.ticks;if(!c.display)return;const d=this.getIndexAngle(0);let p,g;r.save(),r.translate(this.xCenter,this.yCenter),r.rotate(d),r.textAlign="center",r.textBaseline="middle",this.ticks.forEach((y,T)=>{if(T===0&&this.min>=0&&!s.reverse)return;const R=c.setContext(this.getContext(T)),N=so(R.font);if(p=this.getDistanceFromCenterForValue(this.ticks[T].value),R.showLabelBackdrop){r.font=N.string,g=r.measureText(y.label).width,r.fillStyle=R.backdropColor;const D=qo(R.backdropPadding);r.fillRect(-g/2-D.left,-p-N.size/2-D.top,g+D.width,N.size+D.height)}Lg(r,y.label,0,-p,N,{color:R.color,strokeColor:R.textStrokeColor,strokeWidth:R.textStrokeWidth})}),r.restore()}drawTitle(){}}ri($S,"id","radialLinear"),ri($S,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Mw.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(r){return r},padding:5,centerPointLabels:!1}}),ri($S,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ri($S,"descriptors",{angleLines:{_fallback:"grid"}});const Vw={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Ss=Object.keys(Vw);function OW(n,r){return n-r}function PW(n,r){if(mn(r))return null;const s=n._adapter,{parser:c,round:d,isoWeekday:p}=n._parseOpts;let g=r;return typeof c=="function"&&(g=c(g)),Gr(g)||(g=typeof c=="string"?s.parse(g,c):s.parse(g)),g===null?null:(d&&(g=d==="week"&&(nw(p)||p===!0)?s.startOf(g,"isoWeek",p):s.startOf(g,d)),+g)}function NW(n,r,s,c){const d=Ss.length;for(let p=Ss.indexOf(n);p<d-1;++p){const g=Vw[Ss[p]],y=g.steps?g.steps:Number.MAX_SAFE_INTEGER;if(g.common&&Math.ceil((s-r)/(y*g.size))<=c)return Ss[p]}return Ss[d-1]}function ofe(n,r,s,c,d){for(let p=Ss.length-1;p>=Ss.indexOf(s);p--){const g=Ss[p];if(Vw[g].common&&n._adapter.diff(d,c,g)>=r-1)return g}return Ss[s?Ss.indexOf(s):0]}function sfe(n){for(let r=Ss.indexOf(n)+1,s=Ss.length;r<s;++r)if(Vw[Ss[r]].common)return Ss[r]}function xW(n,r,s){if(!s)n[r]=!0;else if(s.length){const{lo:c,hi:d}=xN(s,r),p=s[c]>=r?s[c]:s[d];n[p]=!0}}function afe(n,r,s,c){const d=n._adapter,p=+d.startOf(r[0].value,c),g=r[r.length-1].value;let y,T;for(y=p;y<=g;y=+d.add(y,1,c))T=s[y],T>=0&&(r[T].major=!0);return r}function DW(n,r,s){const c=[],d={},p=r.length;let g,y;for(g=0;g<p;++g)y=r[g],d[y]=g,c.push({value:y,major:!1});return p===0||!s?c:afe(n,c,d,s)}class cw extends af{constructor(r){super(r),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(r,s={}){const c=r.time||(r.time={}),d=this._adapter=new uhe._date(r.adapters.date);d.init(s),av(c.displayFormats,d.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(r),this._normalized=s.normalized}parse(r,s){return r===void 0?null:PW(this,r)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const r=this.options,s=this._adapter,c=r.time.unit||"day";let{min:d,max:p,minDefined:g,maxDefined:y}=this.getUserBounds();function T(R){!g&&!isNaN(R.min)&&(d=Math.min(d,R.min)),!y&&!isNaN(R.max)&&(p=Math.max(p,R.max))}(!g||!y)&&(T(this._getLabelBounds()),(r.bounds!=="ticks"||r.ticks.source!=="labels")&&T(this.getMinMax(!1))),d=Gr(d)&&!isNaN(d)?d:+s.startOf(Date.now(),c),p=Gr(p)&&!isNaN(p)?p:+s.endOf(Date.now(),c)+1,this.min=Math.min(d,p-1),this.max=Math.max(d+1,p)}_getLabelBounds(){const r=this.getLabelTimestamps();let s=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;return r.length&&(s=r[0],c=r[r.length-1]),{min:s,max:c}}buildTicks(){const r=this.options,s=r.time,c=r.ticks,d=c.source==="labels"?this.getLabelTimestamps():this._generate();r.bounds==="ticks"&&d.length&&(this.min=this._userMin||d[0],this.max=this._userMax||d[d.length-1]);const p=this.min,g=this.max,y=tue(d,p,g);return this._unit=s.unit||(c.autoSkip?NW(s.minUnit,this.min,this.max,this._getLabelCapacity(p)):ofe(this,y.length,s.minUnit,this.min,this.max)),this._majorUnit=!c.major.enabled||this._unit==="year"?void 0:sfe(this._unit),this.initOffsets(d),r.reverse&&y.reverse(),DW(this,y,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(r=>+r.value))}initOffsets(r=[]){let s=0,c=0,d,p;this.options.offset&&r.length&&(d=this.getDecimalForValue(r[0]),r.length===1?s=1-d:s=(this.getDecimalForValue(r[1])-d)/2,p=this.getDecimalForValue(r[r.length-1]),r.length===1?c=p:c=(p-this.getDecimalForValue(r[r.length-2]))/2);const g=r.length<3?.5:.25;s=Tc(s,0,g),c=Tc(c,0,g),this._offsets={start:s,end:c,factor:1/(s+1+c)}}_generate(){const r=this._adapter,s=this.min,c=this.max,d=this.options,p=d.time,g=p.unit||NW(p.minUnit,s,c,this._getLabelCapacity(s)),y=en(d.ticks.stepSize,1),T=g==="week"?p.isoWeekday:!1,R=nw(T)||T===!0,N={};let D=s,B,q;if(R&&(D=+r.startOf(D,"isoWeek",T)),D=+r.startOf(D,R?"day":g),r.diff(c,s,g)>1e5*y)throw new Error(s+" and "+c+" are too far apart with stepSize of "+y+" "+g);const J=d.ticks.source==="data"&&this.getDataTimestamps();for(B=D,q=0;B<c;B=+r.add(B,y,g),q++)xW(N,B,J);return(B===c||d.bounds==="ticks"||q===1)&&xW(N,B,J),Object.keys(N).sort(OW).map(Y=>+Y)}getLabelForValue(r){const s=this._adapter,c=this.options.time;return c.tooltipFormat?s.format(r,c.tooltipFormat):s.format(r,c.displayFormats.datetime)}format(r,s){const d=this.options.time.displayFormats,p=this._unit,g=s||d[p];return this._adapter.format(r,g)}_tickFormatFunction(r,s,c,d){const p=this.options,g=p.ticks.callback;if(g)return Rn(g,[r,s,c],this);const y=p.time.displayFormats,T=this._unit,R=this._majorUnit,N=T&&y[T],D=R&&y[R],B=c[s],q=R&&D&&B&&B.major;return this._adapter.format(r,d||(q?D:N))}generateTickLabels(r){let s,c,d;for(s=0,c=r.length;s<c;++s)d=r[s],d.label=this._tickFormatFunction(d.value,s,r)}getDecimalForValue(r){return r===null?NaN:(r-this.min)/(this.max-this.min)}getPixelForValue(r){const s=this._offsets,c=this.getDecimalForValue(r);return this.getPixelForDecimal((s.start+c)*s.factor)}getValueForPixel(r){const s=this._offsets,c=this.getDecimalForPixel(r)/s.factor-s.end;return this.min+c*(this.max-this.min)}_getLabelSize(r){const s=this.options.ticks,c=this.ctx.measureText(r).width,d=Hu(this.isHorizontal()?s.maxRotation:s.minRotation),p=Math.cos(d),g=Math.sin(d),y=this._resolveTickFontOptions(0).size;return{w:c*p+y*g,h:c*g+y*p}}_getLabelCapacity(r){const s=this.options.time,c=s.displayFormats,d=c[s.unit]||c.millisecond,p=this._tickFormatFunction(r,0,DW(this,[r],this._majorUnit),d),g=this._getLabelSize(p),y=Math.floor(this.isHorizontal()?this.width/g.w:this.height/g.h)-1;return y>0?y:1}getDataTimestamps(){let r=this._cache.data||[],s,c;if(r.length)return r;const d=this.getMatchingVisibleMetas();if(this._normalized&&d.length)return this._cache.data=d[0].controller.getAllParsedValues(this);for(s=0,c=d.length;s<c;++s)r=r.concat(d[s].controller.getAllParsedValues(this));return this._cache.data=this.normalize(r)}getLabelTimestamps(){const r=this._cache.labels||[];let s,c;if(r.length)return r;const d=this.getLabels();for(s=0,c=d.length;s<c;++s)r.push(PW(this,d[s]));return this._cache.labels=this._normalized?r:this.normalize(r)}normalize(r){return sG(r.sort(OW))}}ri(cw,"id","time"),ri(cw,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function XS(n,r,s){let c=0,d=n.length-1,p,g,y,T;s?(r>=n[c].pos&&r<=n[d].pos&&({lo:c,hi:d}=oP(n,"pos",r)),{pos:p,time:y}=n[c],{pos:g,time:T}=n[d]):(r>=n[c].time&&r<=n[d].time&&({lo:c,hi:d}=oP(n,"time",r)),{time:p,pos:y}=n[c],{time:g,pos:T}=n[d]);const R=g-p;return R?y+(T-y)*(r-p)/R:y}class kW extends cw{constructor(r){super(r),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const r=this._getTimestampsForTable(),s=this._table=this.buildLookupTable(r);this._minPos=XS(s,this.min),this._tableRange=XS(s,this.max)-this._minPos,super.initOffsets(r)}buildLookupTable(r){const{min:s,max:c}=this,d=[],p=[];let g,y,T,R,N;for(g=0,y=r.length;g<y;++g)R=r[g],R>=s&&R<=c&&d.push(R);if(d.length<2)return[{time:s,pos:0},{time:c,pos:1}];for(g=0,y=d.length;g<y;++g)N=d[g+1],T=d[g-1],R=d[g],Math.round((N+T)/2)!==R&&p.push({time:R,pos:g/(y-1)});return p}_generate(){const r=this.min,s=this.max;let c=super.getDataTimestamps();return(!c.includes(r)||!c.length)&&c.splice(0,0,r),(!c.includes(s)||c.length===1)&&c.push(s),c.sort((d,p)=>d-p)}_getTimestampsForTable(){let r=this._cache.all||[];if(r.length)return r;const s=this.getDataTimestamps(),c=this.getLabelTimestamps();return s.length&&c.length?r=this.normalize(s.concat(c)):r=s.length?s:c,r=this._cache.all=r,r}getDecimalForValue(r){return(XS(this._table,r)-this._minPos)/this._tableRange}getValueForPixel(r){const s=this._offsets,c=this.getDecimalForPixel(r)/s.factor-s.end;return XS(this._table,c*this._tableRange+this._minPos,!0)}}ri(kW,"id","timeseries"),ri(kW,"defaults",cw.defaults);const UG="label";function LW(n,r){typeof n=="function"?n(r):n&&(n.current=r)}function cfe(n,r){const s=n.options;s&&r&&Object.assign(s,r)}function jG(n,r){n.labels=r}function VG(n,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:UG;const c=[];n.datasets=r.map(d=>{const p=n.datasets.find(g=>g[s]===d[s]);return!p||!d.data||c.includes(p)?{...d}:(c.push(p),Object.assign(p,d),p)})}function lfe(n){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:UG;const s={labels:[],datasets:[]};return jG(s,n.labels),VG(s,n.datasets,r),s}function dfe(n,r){const{height:s=150,width:c=300,redraw:d=!1,datasetIdKey:p,type:g,data:y,options:T,plugins:R=[],fallbackContent:N,updateMode:D,...B}=n,q=le.useRef(null),J=le.useRef(),Y=()=>{q.current&&(J.current=new jw(q.current,{type:g,data:lfe(y,p),options:T&&{...T},plugins:R}),LW(r,J.current))},te=()=>{LW(r,null),J.current&&(J.current.destroy(),J.current=null)};return le.useEffect(()=>{!d&&J.current&&T&&cfe(J.current,T)},[d,T]),le.useEffect(()=>{!d&&J.current&&jG(J.current.config.data,y.labels)},[d,y.labels]),le.useEffect(()=>{!d&&J.current&&y.datasets&&VG(J.current.config.data,y.datasets,p)},[d,y.datasets]),le.useEffect(()=>{J.current&&(d?(te(),setTimeout(Y)):J.current.update(D))},[d,T,y.labels,y.datasets,D]),le.useEffect(()=>{J.current&&(te(),setTimeout(Y))},[g]),le.useEffect(()=>(Y(),()=>te()),[]),oo.createElement("canvas",Object.assign({ref:q,role:"img",height:s,width:c},B),N)}const ufe=le.forwardRef(dfe);function hfe(n,r){return jw.register(r),le.forwardRef((s,c)=>oo.createElement(ufe,Object.assign({},s,{ref:c,type:n})))}const pfe=hfe("bar",gT),ffe=[{backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgb(255, 99, 132)"},{backgroundColor:"rgba(255, 159, 64, 0.2)",borderColor:"rgb(255, 159, 64)"},{backgroundColor:"rgba(255, 205, 86, 0.2)",borderColor:"rgb(255, 205, 86)"},{backgroundColor:"rgba(75, 192, 192, 0.2)",borderColor:"rgb(75, 192, 192)"},{backgroundColor:"rgba(54, 162, 235, 0.2)",borderColor:"rgb(54, 162, 235)"},{backgroundColor:"rgba(153, 102, 255, 0.2)",borderColor:"rgb(153, 102, 255)"},{backgroundColor:"rgba(201, 203, 207, 0.2)",borderColor:"rgb(201, 203, 207)"}],mfe={id:"customCanvasBackgroundColor",beforeDraw:(n,r,s)=>{const{ctx:c}=n;c.save(),c.globalCompositeOperation="destination-over",c.fillStyle=s.color||"#99ffff",c.fillRect(0,0,n.width,n.height),c.restore()}};jw.register(vT,dP,uP,Vpe,Npe);const gfe=le.forwardRef(({pines:n},r)=>{const s={maintainAspectRatio:!1,animation:{duration:0},plugins:{customCanvasBackgroundColor:{color:de.primary200}}},c={labels:["Enfermedad"],datasets:n.reduce((d,p,g)=>{const y=d.find(T=>T.label===p.enfermedad);return y?y.data[0]+=1:d.push({label:p.enfermedad,data:[1],borderWidth:1,...ffe[d.length]}),d},[])};return O.jsx(_fe,{children:O.jsx(pfe,{data:c,options:s,ref:r,plugins:[mfe]})})}),_fe=be.div`
  margin-top: 20px;
  min-height: 180px;
  height: 180px;
  width: 90%;
`,Efe=({country:n,localidad:r,handleBack:s})=>{const c=le.useRef(null),[d,p]=le.useState(""),g=Tl();le.useEffect(()=>{c&&p(c.current.toBase64Image())},[c]);const y=async()=>{const R=await(await g("descargarmapa",{nombre_pais:n.pais,nombre_localidad:r.nombre},"POST",!0)).text(),N=new Blob([R],{type:"text/html"}),D=window.URL.createObjectURL(N),B=document.createElement("a");B.href=D,B.download="mapa.html",B.click(),window.URL.revokeObjectURL(D)};return O.jsxs(vfe,{children:[O.jsx(yfe,{onClick:s,children:O.jsx("i",{className:"fa-solid fa-xmark"})}),O.jsx("h2",{children:r.nombre}),O.jsx("p",{children:n.pais}),O.jsx(gfe,{ref:c,pines:r.pines.filter(T=>T.enfermedad!=="Tomate Sano")}),O.jsxs("div",{className:"buttons",children:[O.jsx(Gi,{bg:de.pastel3,size:"little",onClick:y,type:"primary",children:"Descargar mapa"}),O.jsx(Gi,{bg:de.tertiary300,htmlElement:"a",size:"little",type:"primary",download:"grfica.png",href:d,children:"Descargar grfica"}),O.jsx(Gi,{bg:de.tertiary500,size:"little",disabled:!0,type:"primary",children:"Ms reportes"})]})]})},vfe=be.div`
  padding: 20px;
  display: flex;
  height: 100%;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 10px;
  overflow: auto;

  & > h2 {
    font-size: 1.5rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }

  & > p {
    font-size: 1.3rem;
    font-family: 'Chillax';
    color: ${de.primary500};
    opacity: 1;
    font-weight: 600;
  }

  & > .buttons {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
  }
`,yfe=be.button`
  border: none;
  background-color: transparent;
  color: ${de.primary500};
  font-size: 1.2rem;
  cursor: pointer;
  transition: scale 0.3s;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  align-self: flex-start;

  &:hover {
    scale: 1.2;
  }
`,Sfe=({country:n,setCountry:r,localidad:s,setLocalidad:c,handleViewMap:d})=>{const{data:p,loading:g}=of("mapa"),y=R=>{r(p.find(N=>N.pais===R.target.value)),c(null)},T=R=>{c(n.localidades.find(N=>N.nombre===R.target.value))};return O.jsxs(Tfe,{children:[O.jsx("h2",{children:"Mapa geo-referenciado de enfermedades"}),O.jsx("p",{children:"Seleccione un pas y una localidad para ver el mapa"}),O.jsxs("div",{children:[O.jsxs(MW,{value:n==null?void 0:n.pais,onChange:y,children:[O.jsx("option",{children:g?"Cargando...":"Seleccione pas..."}),p.map((R,N)=>O.jsx("option",{value:R.pais,children:R.pais},N))]}),O.jsxs(MW,{value:s==null?void 0:s.nombre,onChange:T,children:[O.jsx("option",{children:g?"Cargando...":"Seleccione localidad..."}),n&&n.localidades.map((R,N)=>O.jsx("option",{value:R.nombre,children:R.nombre},N))]},n==null?void 0:n.pais)]}),O.jsx(Gi,{disabled:!s,onClick:d,type:"secondary",children:"Ver mapa"})]})},Tfe=be.div`
  height: 100%;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  text-align: center;
  gap: 20px;
  padding: 40px;

  & > h2 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }

  & > p {
    opacity: 0.7;
  }

  & > div {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
  }
`,MW=be.select`
  width: 300px;
  padding: 10px 15px;
  outline: none;
  border: 1px solid ${de.primary500};
`;function FG(n,r){const s=le.useRef(r);le.useEffect(function(){r!==s.current&&n.attributionControl!=null&&(s.current!=null&&n.attributionControl.removeAttribution(s.current),r!=null&&n.attributionControl.addAttribution(r)),s.current=r},[n,r])}const wfe=1;function Cfe(n){return Object.freeze({__version:wfe,map:n})}function bfe(n,r){return Object.freeze({...n,...r})}const BG=le.createContext(null),WG=BG.Provider;function WN(){const n=le.useContext(BG);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function Rfe(n){function r(s,c){const{instance:d,context:p}=n(s).current;return le.useImperativeHandle(c,()=>d),s.children==null?null:oo.createElement(WG,{value:p},s.children)}return le.forwardRef(r)}function Ife(n){function r(s,c){const[d,p]=le.useState(!1),{instance:g}=n(s,p).current;le.useImperativeHandle(c,()=>g),le.useEffect(function(){d&&g.update()},[g,d,s.children]);const y=g._contentNode;return y?hN.createPortal(s.children,y):null}return le.forwardRef(r)}function Afe(n){function r(s,c){const{instance:d}=n(s).current;return le.useImperativeHandle(c,()=>d),null}return le.forwardRef(r)}function zG(n,r){const s=le.useRef();le.useEffect(function(){return r!=null&&n.instance.on(r),s.current=r,function(){s.current!=null&&n.instance.off(s.current),s.current=null}},[n,r])}function zN(n,r){const s=n.pane??r.pane;return s?{...n,pane:s}:n}function Ofe(n,r){return function(c,d){const p=WN(),g=n(zN(c,p),p);return FG(p.map,c.attribution),zG(g.current,c.eventHandlers),r(g.current,p,c,d),g}}var pP={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,r){(function(s,c){c(r)})(ro,function(s){var c="1.9.4";function d(h){var E,w,x,z;for(w=1,x=arguments.length;w<x;w++){z=arguments[w];for(E in z)h[E]=z[E]}return h}var p=Object.create||function(){function h(){}return function(E){return h.prototype=E,new h}}();function g(h,E){var w=Array.prototype.slice;if(h.bind)return h.bind.apply(h,w.call(arguments,1));var x=w.call(arguments,2);return function(){return h.apply(E,x.length?x.concat(w.call(arguments)):arguments)}}var y=0;function T(h){return"_leaflet_id"in h||(h._leaflet_id=++y),h._leaflet_id}function R(h,E,w){var x,z,Q,ue;return ue=function(){x=!1,z&&(Q.apply(w,z),z=!1)},Q=function(){x?z=arguments:(h.apply(w,arguments),setTimeout(ue,E),x=!0)},Q}function N(h,E,w){var x=E[1],z=E[0],Q=x-z;return h===x&&w?h:((h-z)%Q+Q)%Q+z}function D(){return!1}function B(h,E){if(E===!1)return h;var w=Math.pow(10,E===void 0?6:E);return Math.round(h*w)/w}function q(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function J(h){return q(h).split(/\s+/)}function Y(h,E){Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?p(h.options):{});for(var w in E)h.options[w]=E[w];return h.options}function te(h,E,w){var x=[];for(var z in h)x.push(encodeURIComponent(w?z.toUpperCase():z)+"="+encodeURIComponent(h[z]));return(!E||E.indexOf("?")===-1?"?":"&")+x.join("&")}var Z=/\{ *([\w_ -]+) *\}/g;function ee(h,E){return h.replace(Z,function(w,x){var z=E[x];if(z===void 0)throw new Error("No value provided for variable "+w);return typeof z=="function"&&(z=z(E)),z})}var re=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"};function pe(h,E){for(var w=0;w<h.length;w++)if(h[w]===E)return w;return-1}var ve="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Oe(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var Se=0;function je(h){var E=+new Date,w=Math.max(0,16-(E-Se));return Se=E+w,window.setTimeout(h,w)}var ot=window.requestAnimationFrame||Oe("RequestAnimationFrame")||je,Qe=window.cancelAnimationFrame||Oe("CancelAnimationFrame")||Oe("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function st(h,E,w){if(w&&ot===je)h.call(E);else return ot.call(window,g(h,E))}function ut(h){h&&Qe.call(window,h)}var Ni={__proto__:null,extend:d,create:p,bind:g,get lastId(){return y},stamp:T,throttle:R,wrapNum:N,falseFn:D,formatNum:B,trim:q,splitWords:J,setOptions:Y,getParamString:te,template:ee,isArray:re,indexOf:pe,emptyImageUrl:ve,requestFn:ot,cancelFn:Qe,requestAnimFrame:st,cancelAnimFrame:ut};function gt(){}gt.extend=function(h){var E=function(){Y(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},w=E.__super__=this.prototype,x=p(w);x.constructor=E,E.prototype=x;for(var z in this)Object.prototype.hasOwnProperty.call(this,z)&&z!=="prototype"&&z!=="__super__"&&(E[z]=this[z]);return h.statics&&d(E,h.statics),h.includes&&(At(h.includes),d.apply(null,[x].concat(h.includes))),d(x,h),delete x.statics,delete x.includes,x.options&&(x.options=w.options?p(w.options):{},d(x.options,h.options)),x._initHooks=[],x.callInitHooks=function(){if(!this._initHooksCalled){w.callInitHooks&&w.callInitHooks.call(this),this._initHooksCalled=!0;for(var Q=0,ue=x._initHooks.length;Q<ue;Q++)x._initHooks[Q].call(this)}},E},gt.include=function(h){var E=this.prototype.options;return d(this.prototype,h),h.options&&(this.prototype.options=E,this.mergeOptions(h.options)),this},gt.mergeOptions=function(h){return d(this.prototype.options,h),this},gt.addInitHook=function(h){var E=Array.prototype.slice.call(arguments,1),w=typeof h=="function"?h:function(){this[h].apply(this,E)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(w),this};function At(h){if(!(typeof L>"u"||!L||!L.Mixin)){h=re(h)?h:[h];for(var E=0;E<h.length;E++)h[E]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var yt={on:function(h,E,w){if(typeof h=="object")for(var x in h)this._on(x,h[x],E);else{h=J(h);for(var z=0,Q=h.length;z<Q;z++)this._on(h[z],E,w)}return this},off:function(h,E,w){if(!arguments.length)delete this._events;else if(typeof h=="object")for(var x in h)this._off(x,h[x],E);else{h=J(h);for(var z=arguments.length===1,Q=0,ue=h.length;Q<ue;Q++)z?this._off(h[Q]):this._off(h[Q],E,w)}return this},_on:function(h,E,w,x){if(typeof E!="function"){console.warn("wrong listener type: "+typeof E);return}if(this._listens(h,E,w)===!1){w===this&&(w=void 0);var z={fn:E,ctx:w};x&&(z.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(z)}},_off:function(h,E,w){var x,z,Q;if(this._events&&(x=this._events[h],!!x)){if(arguments.length===1){if(this._firingCount)for(z=0,Q=x.length;z<Q;z++)x[z].fn=D;delete this._events[h];return}if(typeof E!="function"){console.warn("wrong listener type: "+typeof E);return}var ue=this._listens(h,E,w);if(ue!==!1){var we=x[ue];this._firingCount&&(we.fn=D,this._events[h]=x=x.slice()),x.splice(ue,1)}}},fire:function(h,E,w){if(!this.listens(h,w))return this;var x=d({},E,{type:h,target:this,sourceTarget:E&&E.sourceTarget||this});if(this._events){var z=this._events[h];if(z){this._firingCount=this._firingCount+1||1;for(var Q=0,ue=z.length;Q<ue;Q++){var we=z[Q],Ae=we.fn;we.once&&this.off(h,Ae,we.ctx),Ae.call(we.ctx||this,x)}this._firingCount--}}return w&&this._propagateEvent(x),this},listens:function(h,E,w,x){typeof h!="string"&&console.warn('"string" type argument expected');var z=E;typeof E!="function"&&(x=!!E,z=void 0,w=void 0);var Q=this._events&&this._events[h];if(Q&&Q.length&&this._listens(h,z,w)!==!1)return!0;if(x){for(var ue in this._eventParents)if(this._eventParents[ue].listens(h,E,w,x))return!0}return!1},_listens:function(h,E,w){if(!this._events)return!1;var x=this._events[h]||[];if(!E)return!!x.length;w===this&&(w=void 0);for(var z=0,Q=x.length;z<Q;z++)if(x[z].fn===E&&x[z].ctx===w)return z;return!1},once:function(h,E,w){if(typeof h=="object")for(var x in h)this._on(x,h[x],E,!0);else{h=J(h);for(var z=0,Q=h.length;z<Q;z++)this._on(h[z],E,w,!0)}return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[T(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[T(h)],this},_propagateEvent:function(h){for(var E in this._eventParents)this._eventParents[E].fire(h.type,d({layer:h.target,propagatedFrom:h.target},h),!0)}};yt.addEventListener=yt.on,yt.removeEventListener=yt.clearAllEventListeners=yt.off,yt.addOneTimeEventListener=yt.once,yt.fireEvent=yt.fire,yt.hasEventListeners=yt.listens;var Lt=gt.extend(yt);function Ue(h,E,w){this.x=w?Math.round(h):h,this.y=w?Math.round(E):E}var Je=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};Ue.prototype={clone:function(){return new Ue(this.x,this.y)},add:function(h){return this.clone()._add(Ie(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(Ie(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new Ue(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new Ue(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Je(this.x),this.y=Je(this.y),this},distanceTo:function(h){h=Ie(h);var E=h.x-this.x,w=h.y-this.y;return Math.sqrt(E*E+w*w)},equals:function(h){return h=Ie(h),h.x===this.x&&h.y===this.y},contains:function(h){return h=Ie(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+B(this.x)+", "+B(this.y)+")"}};function Ie(h,E,w){return h instanceof Ue?h:re(h)?new Ue(h[0],h[1]):h==null?h:typeof h=="object"&&"x"in h&&"y"in h?new Ue(h.x,h.y):new Ue(h,E,w)}function pt(h,E){if(h)for(var w=E?[h,E]:h,x=0,z=w.length;x<z;x++)this.extend(w[x])}pt.prototype={extend:function(h){var E,w;if(!h)return this;if(h instanceof Ue||typeof h[0]=="number"||"x"in h)E=w=Ie(h);else if(h=St(h),E=h.min,w=h.max,!E||!w)return this;return!this.min&&!this.max?(this.min=E.clone(),this.max=w.clone()):(this.min.x=Math.min(E.x,this.min.x),this.max.x=Math.max(w.x,this.max.x),this.min.y=Math.min(E.y,this.min.y),this.max.y=Math.max(w.y,this.max.y)),this},getCenter:function(h){return Ie((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return Ie(this.min.x,this.max.y)},getTopRight:function(){return Ie(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var E,w;return typeof h[0]=="number"||h instanceof Ue?h=Ie(h):h=St(h),h instanceof pt?(E=h.min,w=h.max):E=w=h,E.x>=this.min.x&&w.x<=this.max.x&&E.y>=this.min.y&&w.y<=this.max.y},intersects:function(h){h=St(h);var E=this.min,w=this.max,x=h.min,z=h.max,Q=z.x>=E.x&&x.x<=w.x,ue=z.y>=E.y&&x.y<=w.y;return Q&&ue},overlaps:function(h){h=St(h);var E=this.min,w=this.max,x=h.min,z=h.max,Q=z.x>E.x&&x.x<w.x,ue=z.y>E.y&&x.y<w.y;return Q&&ue},isValid:function(){return!!(this.min&&this.max)},pad:function(h){var E=this.min,w=this.max,x=Math.abs(E.x-w.x)*h,z=Math.abs(E.y-w.y)*h;return St(Ie(E.x-x,E.y-z),Ie(w.x+x,w.y+z))},equals:function(h){return h?(h=St(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight())):!1}};function St(h,E){return!h||h instanceof pt?h:new pt(h,E)}function yi(h,E){if(h)for(var w=E?[h,E]:h,x=0,z=w.length;x<z;x++)this.extend(w[x])}yi.prototype={extend:function(h){var E=this._southWest,w=this._northEast,x,z;if(h instanceof ge)x=h,z=h;else if(h instanceof yi){if(x=h._southWest,z=h._northEast,!x||!z)return this}else return h?this.extend(lt(h)||Ot(h)):this;return!E&&!w?(this._southWest=new ge(x.lat,x.lng),this._northEast=new ge(z.lat,z.lng)):(E.lat=Math.min(x.lat,E.lat),E.lng=Math.min(x.lng,E.lng),w.lat=Math.max(z.lat,w.lat),w.lng=Math.max(z.lng,w.lng)),this},pad:function(h){var E=this._southWest,w=this._northEast,x=Math.abs(E.lat-w.lat)*h,z=Math.abs(E.lng-w.lng)*h;return new yi(new ge(E.lat-x,E.lng-z),new ge(w.lat+x,w.lng+z))},getCenter:function(){return new ge((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ge(this.getNorth(),this.getWest())},getSouthEast:function(){return new ge(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){typeof h[0]=="number"||h instanceof ge||"lat"in h?h=lt(h):h=Ot(h);var E=this._southWest,w=this._northEast,x,z;return h instanceof yi?(x=h.getSouthWest(),z=h.getNorthEast()):x=z=h,x.lat>=E.lat&&z.lat<=w.lat&&x.lng>=E.lng&&z.lng<=w.lng},intersects:function(h){h=Ot(h);var E=this._southWest,w=this._northEast,x=h.getSouthWest(),z=h.getNorthEast(),Q=z.lat>=E.lat&&x.lat<=w.lat,ue=z.lng>=E.lng&&x.lng<=w.lng;return Q&&ue},overlaps:function(h){h=Ot(h);var E=this._southWest,w=this._northEast,x=h.getSouthWest(),z=h.getNorthEast(),Q=z.lat>E.lat&&x.lat<w.lat,ue=z.lng>E.lng&&x.lng<w.lng;return Q&&ue},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,E){return h?(h=Ot(h),this._southWest.equals(h.getSouthWest(),E)&&this._northEast.equals(h.getNorthEast(),E)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ot(h,E){return h instanceof yi?h:new yi(h,E)}function ge(h,E,w){if(isNaN(h)||isNaN(E))throw new Error("Invalid LatLng object: ("+h+", "+E+")");this.lat=+h,this.lng=+E,w!==void 0&&(this.alt=+w)}ge.prototype={equals:function(h,E){if(!h)return!1;h=lt(h);var w=Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng));return w<=(E===void 0?1e-9:E)},toString:function(h){return"LatLng("+B(this.lat,h)+", "+B(this.lng,h)+")"},distanceTo:function(h){return Jt.distance(this,lt(h))},wrap:function(){return Jt.wrapLatLng(this)},toBounds:function(h){var E=180*h/40075017,w=E/Math.cos(Math.PI/180*this.lat);return Ot([this.lat-E,this.lng-w],[this.lat+E,this.lng+w])},clone:function(){return new ge(this.lat,this.lng,this.alt)}};function lt(h,E,w){return h instanceof ge?h:re(h)&&typeof h[0]!="object"?h.length===3?new ge(h[0],h[1],h[2]):h.length===2?new ge(h[0],h[1]):null:h==null?h:typeof h=="object"&&"lat"in h?new ge(h.lat,"lng"in h?h.lng:h.lon,h.alt):E===void 0?null:new ge(h,E,w)}var vt={latLngToPoint:function(h,E){var w=this.projection.project(h),x=this.scale(E);return this.transformation._transform(w,x)},pointToLatLng:function(h,E){var w=this.scale(E),x=this.transformation.untransform(h,w);return this.projection.unproject(x)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var E=this.projection.bounds,w=this.scale(h),x=this.transformation.transform(E.min,w),z=this.transformation.transform(E.max,w);return new pt(x,z)},infinite:!1,wrapLatLng:function(h){var E=this.wrapLng?N(h.lng,this.wrapLng,!0):h.lng,w=this.wrapLat?N(h.lat,this.wrapLat,!0):h.lat,x=h.alt;return new ge(w,E,x)},wrapLatLngBounds:function(h){var E=h.getCenter(),w=this.wrapLatLng(E),x=E.lat-w.lat,z=E.lng-w.lng;if(x===0&&z===0)return h;var Q=h.getSouthWest(),ue=h.getNorthEast(),we=new ge(Q.lat-x,Q.lng-z),Ae=new ge(ue.lat-x,ue.lng-z);return new yi(we,Ae)}},Jt=d({},vt,{wrapLng:[-180,180],R:6371e3,distance:function(h,E){var w=Math.PI/180,x=h.lat*w,z=E.lat*w,Q=Math.sin((E.lat-h.lat)*w/2),ue=Math.sin((E.lng-h.lng)*w/2),we=Q*Q+Math.cos(x)*Math.cos(z)*ue*ue,Ae=2*Math.atan2(Math.sqrt(we),Math.sqrt(1-we));return this.R*Ae}}),zi=6378137,bi={R:zi,MAX_LATITUDE:85.0511287798,project:function(h){var E=Math.PI/180,w=this.MAX_LATITUDE,x=Math.max(Math.min(w,h.lat),-w),z=Math.sin(x*E);return new Ue(this.R*h.lng*E,this.R*Math.log((1+z)/(1-z))/2)},unproject:function(h){var E=180/Math.PI;return new ge((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*E,h.x*E/this.R)},bounds:function(){var h=zi*Math.PI;return new pt([-h,-h],[h,h])}()};function gn(h,E,w,x){if(re(h)){this._a=h[0],this._b=h[1],this._c=h[2],this._d=h[3];return}this._a=h,this._b=E,this._c=w,this._d=x}gn.prototype={transform:function(h,E){return this._transform(h.clone(),E)},_transform:function(h,E){return E=E||1,h.x=E*(this._a*h.x+this._b),h.y=E*(this._c*h.y+this._d),h},untransform:function(h,E){return E=E||1,new Ue((h.x/E-this._b)/this._a,(h.y/E-this._d)/this._c)}};function Tn(h,E,w,x){return new gn(h,E,w,x)}var ph=d({},Jt,{code:"EPSG:3857",projection:bi,transformation:function(){var h=.5/(Math.PI*bi.R);return Tn(h,.5,-h,.5)}()}),hf=d({},ph,{code:"EPSG:900913"});function Jo(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function Cd(h,E){var w="",x,z,Q,ue,we,Ae;for(x=0,Q=h.length;x<Q;x++){for(we=h[x],z=0,ue=we.length;z<ue;z++)Ae=we[z],w+=(z?"L":"M")+Ae.x+" "+Ae.y;w+=E?it.svg?"z":"x":""}return w||"M0 0"}var Va=document.documentElement.style,qr="ActiveXObject"in window,Cr=qr&&!document.addEventListener,Ic="msLaunchUri"in navigator&&!("documentMode"in document),Fi=Hn("webkit"),Zt=Hn("android"),Xs=Hn("android 2")||Hn("android 3"),fh=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),pf=Zt&&Hn("Google")&&fh<537&&!("AudioNode"in window),Ac=!!window.opera,lr=!Ic&&Hn("chrome"),Zo=Hn("gecko")&&!Fi&&!Ac&&!qr,wl=!lr&&Hn("safari"),Yr=Hn("phantom"),Js="OTransition"in Va,Zs=navigator.platform.indexOf("Win")===0,mh=qr&&"transition"in Va,Rs="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Xs,lo="MozPerspective"in Va,gh=!window.L_DISABLE_3D&&(mh||Rs||lo)&&!Js&&!Yr,Qs=typeof orientation<"u"||Hn("mobile"),_h=Qs&&Fi,Oc=Qs&&Rs,Cl=!window.PointerEvent&&window.MSPointerEvent,bd=!!(window.PointerEvent||Cl),bl="ontouchstart"in window||!!window.TouchEvent,zg=!window.L_NO_TOUCH&&(bl||bd),$r=Qs&&Ac,Xr=Qs&&Zo,Hg=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Zn=function(){var h=!1;try{var E=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",D,E),window.removeEventListener("testPassiveEventSupport",D,E)}catch{}return h}(),Rd=function(){return!!document.createElement("canvas").getContext}(),Id=!!(document.createElementNS&&Jo("svg").createSVGRect),ff=!!Id&&function(){var h=document.createElement("div");return h.innerHTML="<svg/>",(h.firstChild&&h.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),zt=!Id&&function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var E=h.firstChild;return E.style.behavior="url(#default#VML)",E&&typeof E.adj=="object"}catch{return!1}}(),Qo=navigator.platform.indexOf("Mac")===0,ea=navigator.platform.indexOf("Linux")===0;function Hn(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var it={ie:qr,ielt9:Cr,edge:Ic,webkit:Fi,android:Zt,android23:Xs,androidStock:pf,opera:Ac,chrome:lr,gecko:Zo,safari:wl,phantom:Yr,opera12:Js,win:Zs,ie3d:mh,webkit3d:Rs,gecko3d:lo,any3d:gh,mobile:Qs,mobileWebkit:_h,mobileWebkit3d:Oc,msPointer:Cl,pointer:bd,touch:zg,touchNative:bl,mobileOpera:$r,mobileGecko:Xr,retina:Hg,passiveEvents:Zn,canvas:Rd,svg:Id,vml:zt,inlineSvg:ff,mac:Qo,linux:ea},Qn=it.msPointer?"MSPointerDown":"pointerdown",Rl=it.msPointer?"MSPointerMove":"pointermove",Eh=it.msPointer?"MSPointerUp":"pointerup",Fa=it.msPointer?"MSPointerCancel":"pointercancel",dr={touchstart:Qn,touchmove:Rl,touchend:Eh,touchcancel:Fa},mf={touchstart:Kg,touchmove:Od,touchend:Od,touchcancel:Od},Ba={},Ad=!1;function Il(h,E,w){return E==="touchstart"&&mr(),mf[E]?(w=mf[E].bind(this,w),h.addEventListener(dr[E],w,!1),w):(console.warn("wrong event specified:",E),D)}function gf(h,E,w){if(!dr[E]){console.warn("wrong event specified:",E);return}h.removeEventListener(dr[E],w,!1)}function Wa(h){Ba[h.pointerId]=h}function Gg(h){Ba[h.pointerId]&&(Ba[h.pointerId]=h)}function _f(h){delete Ba[h.pointerId]}function mr(){Ad||(document.addEventListener(Qn,Wa,!0),document.addEventListener(Rl,Gg,!0),document.addEventListener(Eh,_f,!0),document.addEventListener(Fa,_f,!0),Ad=!0)}function Od(h,E){if(E.pointerType!==(E.MSPOINTER_TYPE_MOUSE||"mouse")){E.touches=[];for(var w in Ba)E.touches.push(Ba[w]);E.changedTouches=[E],h(E)}}function Kg(h,E){E.MSPOINTER_TYPE_TOUCH&&E.pointerType===E.MSPOINTER_TYPE_TOUCH&&er(E),Od(h,E)}function An(h){var E={},w,x;for(x in h)w=h[x],E[x]=w&&w.bind?w.bind(h):w;return h=E,E.type="dblclick",E.detail=2,E.isTrusted=!1,E._simulated=!0,E}var qg=200;function Yg(h,E){h.addEventListener("dblclick",E);var w=0,x;function z(Q){if(Q.detail!==1){x=Q.detail;return}if(!(Q.pointerType==="mouse"||Q.sourceCapabilities&&!Q.sourceCapabilities.firesTouchEvents)){var ue=$a(Q);if(!(ue.some(function(Ae){return Ae instanceof HTMLLabelElement&&Ae.attributes.for})&&!ue.some(function(Ae){return Ae instanceof HTMLInputElement||Ae instanceof HTMLSelectElement}))){var we=Date.now();we-w<=qg?(x++,x===2&&E(An(Q))):x=1,w=we}}}return h.addEventListener("click",z),{dblclick:E,simDblclick:z}}function vh(h,E){h.removeEventListener("dblclick",E.dblclick),h.removeEventListener("click",E.simDblclick)}var yh=xd(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),za=xd(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ta=za==="webkitTransition"||za==="OTransition"?za+"End":"transitionend";function Sh(h){return typeof h=="string"?document.getElementById(h):h}function Al(h,E){var w=h.style[E]||h.currentStyle&&h.currentStyle[E];if((!w||w==="auto")&&document.defaultView){var x=document.defaultView.getComputedStyle(h,null);w=x?x[E]:null}return w==="auto"?null:w}function Ti(h,E,w){var x=document.createElement(h);return x.className=E||"",w&&w.appendChild(x),x}function tn(h){var E=h.parentNode;E&&E.removeChild(h)}function Is(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function ia(h){var E=h.parentNode;E&&E.lastChild!==h&&E.appendChild(h)}function Pc(h){var E=h.parentNode;E&&E.firstChild!==h&&E.insertBefore(h,E.firstChild)}function Ri(h,E){if(h.classList!==void 0)return h.classList.contains(E);var w=Nd(h);return w.length>0&&new RegExp("(^|\\s)"+E+"(\\s|$)").test(w)}function Qt(h,E){if(h.classList!==void 0)for(var w=J(E),x=0,z=w.length;x<z;x++)h.classList.add(w[x]);else if(!Ri(h,E)){var Q=Nd(h);Pd(h,(Q?Q+" ":"")+E)}}function Mt(h,E){h.classList!==void 0?h.classList.remove(E):Pd(h,q((" "+Nd(h)+" ").replace(" "+E+" "," ")))}function Pd(h,E){h.className.baseVal===void 0?h.className=E:h.className.baseVal=E}function Nd(h){return h.correspondingElement&&(h=h.correspondingElement),h.className.baseVal===void 0?h.className:h.className.baseVal}function uo(h,E){"opacity"in h.style?h.style.opacity=E:"filter"in h.style&&$g(h,E)}function $g(h,E){var w=!1,x="DXImageTransform.Microsoft.Alpha";try{w=h.filters.item(x)}catch{if(E===1)return}E=Math.round(E*100),w?(w.Enabled=E!==100,w.Opacity=E):h.style.filter+=" progid:"+x+"(opacity="+E+")"}function xd(h){for(var E=document.documentElement.style,w=0;w<h.length;w++)if(h[w]in E)return h[w];return!1}function Ha(h,E,w){var x=E||new Ue(0,0);h.style[yh]=(it.ie3d?"translate("+x.x+"px,"+x.y+"px)":"translate3d("+x.x+"px,"+x.y+"px,0)")+(w?" scale("+w+")":"")}function wn(h,E){h._leaflet_pos=E,it.any3d?Ha(h,E):(h.style.left=E.x+"px",h.style.top=E.y+"px")}function Dr(h){return h._leaflet_pos||new Ue(0,0)}var Ga,es,_n;if("onselectstart"in document)Ga=function(){Gt(window,"selectstart",er)},es=function(){Ki(window,"selectstart",er)};else{var Ka=xd(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Ga=function(){if(Ka){var h=document.documentElement.style;_n=h[Ka],h[Ka]="none"}},es=function(){Ka&&(document.documentElement.style[Ka]=_n,_n=void 0)}}function Th(){Gt(window,"dragstart",er)}function Dd(){Ki(window,"dragstart",er)}var Ol,wh;function Ch(h){for(;h.tabIndex===-1;)h=h.parentNode;h.style&&(kd(),Ol=h,wh=h.style.outlineStyle,h.style.outlineStyle="none",Gt(window,"keydown",kd))}function kd(){Ol&&(Ol.style.outlineStyle=wh,Ol=void 0,wh=void 0,Ki(window,"keydown",kd))}function bh(h){do h=h.parentNode;while((!h.offsetWidth||!h.offsetHeight)&&h!==document.body);return h}function Rh(h){var E=h.getBoundingClientRect();return{x:E.width/h.offsetWidth||1,y:E.height/h.offsetHeight||1,boundingClientRect:E}}var Ef={__proto__:null,TRANSFORM:yh,TRANSITION:za,TRANSITION_END:ta,get:Sh,getStyle:Al,create:Ti,remove:tn,empty:Is,toFront:ia,toBack:Pc,hasClass:Ri,addClass:Qt,removeClass:Mt,setClass:Pd,getClass:Nd,setOpacity:uo,testProp:xd,setTransform:Ha,setPosition:wn,getPosition:Dr,get disableTextSelection(){return Ga},get enableTextSelection(){return es},disableImageDrag:Th,enableImageDrag:Dd,preventOutline:Ch,restoreOutline:kd,getSizedParentNode:bh,getScale:Rh};function Gt(h,E,w,x){if(E&&typeof E=="object")for(var z in E)qa(h,z,E[z],w);else{E=J(E);for(var Q=0,ue=E.length;Q<ue;Q++)qa(h,E[Q],w,x)}return this}var xo="_leaflet_events";function Ki(h,E,w,x){if(arguments.length===1)vf(h),delete h[xo];else if(E&&typeof E=="object")for(var z in E)Ah(h,z,E[z],w);else if(E=J(E),arguments.length===2)vf(h,function(we){return pe(E,we)!==-1});else for(var Q=0,ue=E.length;Q<ue;Q++)Ah(h,E[Q],w,x);return this}function vf(h,E){for(var w in h[xo]){var x=w.split(/\d/)[0];(!E||E(x))&&Ah(h,x,null,null,w)}}var Ih={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function qa(h,E,w,x){var z=E+T(w)+(x?"_"+T(x):"");if(h[xo]&&h[xo][z])return this;var Q=function(we){return w.call(x||h,we||window.event)},ue=Q;!it.touchNative&&it.pointer&&E.indexOf("touch")===0?Q=Il(h,E,Q):it.touch&&E==="dblclick"?Q=Yg(h,Q):"addEventListener"in h?E==="touchstart"||E==="touchmove"||E==="wheel"||E==="mousewheel"?h.addEventListener(Ih[E]||E,Q,it.passiveEvents?{passive:!1}:!1):E==="mouseenter"||E==="mouseleave"?(Q=function(we){we=we||window.event,Pl(h,we)&&ue(we)},h.addEventListener(Ih[E],Q,!1)):h.addEventListener(E,ue,!1):h.attachEvent("on"+E,Q),h[xo]=h[xo]||{},h[xo][z]=Q}function Ah(h,E,w,x,z){z=z||E+T(w)+(x?"_"+T(x):"");var Q=h[xo]&&h[xo][z];if(!Q)return this;!it.touchNative&&it.pointer&&E.indexOf("touch")===0?gf(h,E,Q):it.touch&&E==="dblclick"?vh(h,Q):"removeEventListener"in h?h.removeEventListener(Ih[E]||E,Q,!1):h.detachEvent("on"+E,Q),h[xo][z]=null}function na(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function Oh(h){return qa(h,"wheel",na),this}function Nc(h){return Gt(h,"mousedown touchstart dblclick contextmenu",na),h._leaflet_disable_click=!0,this}function er(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function Ya(h){return er(h),na(h),this}function $a(h){if(h.composedPath)return h.composedPath();for(var E=[],w=h.target;w;)E.push(w),w=w.parentNode;return E}function Ph(h,E){if(!E)return new Ue(h.clientX,h.clientY);var w=Rh(E),x=w.boundingClientRect;return new Ue((h.clientX-x.left)/w.x-E.clientLeft,(h.clientY-x.top)/w.y-E.clientTop)}var ra=it.linux&&it.chrome?window.devicePixelRatio:it.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function br(h){return it.edge?h.wheelDeltaY/2:h.deltaY&&h.deltaMode===0?-h.deltaY/ra:h.deltaY&&h.deltaMode===1?-h.deltaY*20:h.deltaY&&h.deltaMode===2?-h.deltaY*60:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?-h.detail*20:h.detail?h.detail/-32765*60:0}function Pl(h,E){var w=E.relatedTarget;if(!w)return!0;try{for(;w&&w!==h;)w=w.parentNode}catch{return!1}return w!==h}var Xg={__proto__:null,on:Gt,off:Ki,stopPropagation:na,disableScrollPropagation:Oh,disableClickPropagation:Nc,preventDefault:er,stop:Ya,getPropagationPath:$a,getMousePosition:Ph,getWheelDelta:br,isExternalTarget:Pl,addListener:Gt,removeListener:Ki},yf=Lt.extend({run:function(h,E,w,x){this.stop(),this._el=h,this._inProgress=!0,this._duration=w||.25,this._easeOutPower=1/Math.max(x||.5,.2),this._startPos=Dr(h),this._offset=E.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=st(this._animate,this),this._step()},_step:function(h){var E=+new Date-this._startTime,w=this._duration*1e3;E<w?this._runFrame(this._easeOut(E/w),h):(this._runFrame(1),this._complete())},_runFrame:function(h,E){var w=this._startPos.add(this._offset.multiplyBy(h));E&&w._round(),wn(this._el,w),this.fire("step")},_complete:function(){ut(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),Ei=Lt.extend({options:{crs:ph,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,E){E=Y(this,E),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=g(this._onResize,this),this._initEvents(),E.maxBounds&&this.setMaxBounds(E.maxBounds),E.zoom!==void 0&&(this._zoom=this._limitZoom(E.zoom)),E.center&&E.zoom!==void 0&&this.setView(lt(E.center),E.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=za&&it.any3d&&!it.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Gt(this._proxy,ta,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,E,w){if(E=E===void 0?this._zoom:this._limitZoom(E),h=this._limitCenter(lt(h),E,this.options.maxBounds),w=w||{},this._stop(),this._loaded&&!w.reset&&w!==!0){w.animate!==void 0&&(w.zoom=d({animate:w.animate},w.zoom),w.pan=d({animate:w.animate,duration:w.duration},w.pan));var x=this._zoom!==E?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,E,w.zoom):this._tryAnimatedPan(h,w.pan);if(x)return clearTimeout(this._sizeTimer),this}return this._resetView(h,E,w.pan&&w.pan.noMoveStart),this},setZoom:function(h,E){return this._loaded?this.setView(this.getCenter(),h,{zoom:E}):(this._zoom=h,this)},zoomIn:function(h,E){return h=h||(it.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+h,E)},zoomOut:function(h,E){return h=h||(it.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-h,E)},setZoomAround:function(h,E,w){var x=this.getZoomScale(E),z=this.getSize().divideBy(2),Q=h instanceof Ue?h:this.latLngToContainerPoint(h),ue=Q.subtract(z).multiplyBy(1-1/x),we=this.containerPointToLatLng(z.add(ue));return this.setView(we,E,{zoom:w})},_getBoundsCenterZoom:function(h,E){E=E||{},h=h.getBounds?h.getBounds():Ot(h);var w=Ie(E.paddingTopLeft||E.padding||[0,0]),x=Ie(E.paddingBottomRight||E.padding||[0,0]),z=this.getBoundsZoom(h,!1,w.add(x));if(z=typeof E.maxZoom=="number"?Math.min(E.maxZoom,z):z,z===1/0)return{center:h.getCenter(),zoom:z};var Q=x.subtract(w).divideBy(2),ue=this.project(h.getSouthWest(),z),we=this.project(h.getNorthEast(),z),Ae=this.unproject(ue.add(we).divideBy(2).add(Q),z);return{center:Ae,zoom:z}},fitBounds:function(h,E){if(h=Ot(h),!h.isValid())throw new Error("Bounds are not valid.");var w=this._getBoundsCenterZoom(h,E);return this.setView(w.center,w.zoom,E)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,E){return this.setView(h,this._zoom,{pan:E})},panBy:function(h,E){if(h=Ie(h).round(),E=E||{},!h.x&&!h.y)return this.fire("moveend");if(E.animate!==!0&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new yf,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),E.noMoveStart||this.fire("movestart"),E.animate!==!1){Qt(this._mapPane,"leaflet-pan-anim");var w=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,w,E.duration||.25,E.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,E,w){if(w=w||{},w.animate===!1||!it.any3d)return this.setView(h,E,w);this._stop();var x=this.project(this.getCenter()),z=this.project(h),Q=this.getSize(),ue=this._zoom;h=lt(h),E=E===void 0?ue:E;var we=Math.max(Q.x,Q.y),Ae=we*this.getZoomScale(ue,E),Ke=z.distanceTo(x)||1,nt=1.42,Pt=nt*nt;function Nt(En){var ic=En?-1:1,K=En?Ae:we,A=Ae*Ae-we*we+ic*Pt*Pt*Ke*Ke,j=2*K*Pt*Ke,G=A/j,ce=Math.sqrt(G*G+1)-G,Pe=ce<1e-9?-18:Math.log(ce);return Pe}function tr(En){return(Math.exp(En)-Math.exp(-En))/2}function oi(En){return(Math.exp(En)+Math.exp(-En))/2}function mo(En){return tr(En)/oi(En)}var Lr=Nt(0);function Wc(En){return we*(oi(Lr)/oi(Lr+nt*En))}function s_(En){return we*(oi(Lr)*mo(Lr+nt*En)-tr(Lr))/Pt}function a_(En){return 1-Math.pow(1-En,1.5)}var c_=Date.now(),Vf=(Nt(1)-Lr)/nt,Xd=w.duration?1e3*w.duration:1e3*Vf*.8;function zc(){var En=(Date.now()-c_)/Xd,ic=a_(En)*Vf;En<=1?(this._flyToFrame=st(zc,this),this._move(this.unproject(x.add(z.subtract(x).multiplyBy(s_(ic)/Ke)),ue),this.getScaleZoom(we/Wc(ic),ue),{flyTo:!0})):this._move(h,E)._moveEnd(!0)}return this._moveStart(!0,w.noMoveStart),zc.call(this),this},flyToBounds:function(h,E){var w=this._getBoundsCenterZoom(h,E);return this.flyTo(w.center,w.zoom,E)},setMaxBounds:function(h){return h=Ot(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var E=this.options.minZoom;return this.options.minZoom=h,this._loaded&&E!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var E=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&E!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,E){this._enforcingBounds=!0;var w=this.getCenter(),x=this._limitCenter(w,this._zoom,Ot(h));return w.equals(x)||this.panTo(x,E),this._enforcingBounds=!1,this},panInside:function(h,E){E=E||{};var w=Ie(E.paddingTopLeft||E.padding||[0,0]),x=Ie(E.paddingBottomRight||E.padding||[0,0]),z=this.project(this.getCenter()),Q=this.project(h),ue=this.getPixelBounds(),we=St([ue.min.add(w),ue.max.subtract(x)]),Ae=we.getSize();if(!we.contains(Q)){this._enforcingBounds=!0;var Ke=Q.subtract(we.getCenter()),nt=we.extend(Q).getSize().subtract(Ae);z.x+=Ke.x<0?-nt.x:nt.x,z.y+=Ke.y<0?-nt.y:nt.y,this.panTo(this.unproject(z),E),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=d({animate:!1,pan:!0},h===!0?{animate:!0}:h);var E=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var w=this.getSize(),x=E.divideBy(2).round(),z=w.divideBy(2).round(),Q=x.subtract(z);return!Q.x&&!Q.y?this:(h.animate&&h.pan?this.panBy(Q):(h.pan&&this._rawPanBy(Q),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(g(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:E,newSize:w}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=d({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var E=g(this._handleGeolocationResponse,this),w=g(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(E,w,h):navigator.geolocation.getCurrentPosition(E,w,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var E=h.code,w=h.message||(E===1?"permission denied":E===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:E,message:"Geolocation error: "+w+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var E=h.coords.latitude,w=h.coords.longitude,x=new ge(E,w),z=x.toBounds(h.coords.accuracy*2),Q=this._locateOptions;if(Q.setView){var ue=this.getBoundsZoom(z);this.setView(x,Q.maxZoom?Math.min(ue,Q.maxZoom):ue)}var we={latlng:x,bounds:z,timestamp:h.timestamp};for(var Ae in h.coords)typeof h.coords[Ae]=="number"&&(we[Ae]=h.coords[Ae]);this.fire("locationfound",we)}},addHandler:function(h,E){if(!E)return this;var w=this[h]=new E(this);return this._handlers.push(w),this.options[h]&&w.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),tn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(ut(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var h;for(h in this._layers)this._layers[h].remove();for(h in this._panes)tn(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,E){var w="leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),x=Ti("div",w,E||this._mapPane);return h&&(this._panes[h]=x),x},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds(),E=this.unproject(h.getBottomLeft()),w=this.unproject(h.getTopRight());return new yi(E,w)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,E,w){h=Ot(h),w=Ie(w||[0,0]);var x=this.getZoom()||0,z=this.getMinZoom(),Q=this.getMaxZoom(),ue=h.getNorthWest(),we=h.getSouthEast(),Ae=this.getSize().subtract(w),Ke=St(this.project(we,x),this.project(ue,x)).getSize(),nt=it.any3d?this.options.zoomSnap:1,Pt=Ae.x/Ke.x,Nt=Ae.y/Ke.y,tr=E?Math.max(Pt,Nt):Math.min(Pt,Nt);return x=this.getScaleZoom(tr,x),nt&&(x=Math.round(x/(nt/100))*(nt/100),x=E?Math.ceil(x/nt)*nt:Math.floor(x/nt)*nt),Math.max(z,Math.min(Q,x))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Ue(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,E){var w=this._getTopLeftPoint(h,E);return new pt(w,w.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(h===void 0?this.getZoom():h)},getPane:function(h){return typeof h=="string"?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,E){var w=this.options.crs;return E=E===void 0?this._zoom:E,w.scale(h)/w.scale(E)},getScaleZoom:function(h,E){var w=this.options.crs;E=E===void 0?this._zoom:E;var x=w.zoom(h*w.scale(E));return isNaN(x)?1/0:x},project:function(h,E){return E=E===void 0?this._zoom:E,this.options.crs.latLngToPoint(lt(h),E)},unproject:function(h,E){return E=E===void 0?this._zoom:E,this.options.crs.pointToLatLng(Ie(h),E)},layerPointToLatLng:function(h){var E=Ie(h).add(this.getPixelOrigin());return this.unproject(E)},latLngToLayerPoint:function(h){var E=this.project(lt(h))._round();return E._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(lt(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(Ot(h))},distance:function(h,E){return this.options.crs.distance(lt(h),lt(E))},containerPointToLayerPoint:function(h){return Ie(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return Ie(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var E=this.containerPointToLayerPoint(Ie(h));return this.layerPointToLatLng(E)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(lt(h)))},mouseEventToContainerPoint:function(h){return Ph(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var E=this._container=Sh(h);if(E){if(E._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Gt(E,"scroll",this._onScroll,this),this._containerId=T(E)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&it.any3d,Qt(h,"leaflet-container"+(it.touch?" leaflet-touch":"")+(it.retina?" leaflet-retina":"")+(it.ielt9?" leaflet-oldie":"")+(it.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var E=Al(h,"position");E!=="absolute"&&E!=="relative"&&E!=="fixed"&&E!=="sticky"&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),wn(this._mapPane,new Ue(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Qt(h.markerPane,"leaflet-zoom-hide"),Qt(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,E,w){wn(this._mapPane,new Ue(0,0));var x=!this._loaded;this._loaded=!0,E=this._limitZoom(E),this.fire("viewprereset");var z=this._zoom!==E;this._moveStart(z,w)._move(h,E)._moveEnd(z),this.fire("viewreset"),x&&this.fire("load")},_moveStart:function(h,E){return h&&this.fire("zoomstart"),E||this.fire("movestart"),this},_move:function(h,E,w,x){E===void 0&&(E=this._zoom);var z=this._zoom!==E;return this._zoom=E,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),x?w&&w.pinch&&this.fire("zoom",w):((z||w&&w.pinch)&&this.fire("zoom",w),this.fire("move",w)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return ut(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){wn(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[T(this._container)]=this;var E=h?Ki:Gt;E(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&E(window,"resize",this._onResize,this),it.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){ut(this._resizeRequest),this._resizeRequest=st(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,E){for(var w=[],x,z=E==="mouseout"||E==="mouseover",Q=h.target||h.srcElement,ue=!1;Q;){if(x=this._targets[T(Q)],x&&(E==="click"||E==="preclick")&&this._draggableMoved(x)){ue=!0;break}if(x&&x.listens(E,!0)&&(z&&!Pl(Q,h)||(w.push(x),z))||Q===this._container)break;Q=Q.parentNode}return!w.length&&!ue&&!z&&this.listens(E,!0)&&(w=[this]),w},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var E=h.target||h.srcElement;if(!(!this._loaded||E._leaflet_disable_events||h.type==="click"&&this._isClickDisabled(E))){var w=h.type;w==="mousedown"&&Ch(E),this._fireDOMEvent(h,w)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,E,w){if(h.type==="click"){var x=d({},h);x.type="preclick",this._fireDOMEvent(x,x.type,w)}var z=this._findEventTargets(h,E);if(w){for(var Q=[],ue=0;ue<w.length;ue++)w[ue].listens(E,!0)&&Q.push(w[ue]);z=Q.concat(z)}if(z.length){E==="contextmenu"&&er(h);var we=z[0],Ae={originalEvent:h};if(h.type!=="keypress"&&h.type!=="keydown"&&h.type!=="keyup"){var Ke=we.getLatLng&&(!we._radius||we._radius<=10);Ae.containerPoint=Ke?this.latLngToContainerPoint(we.getLatLng()):this.mouseEventToContainerPoint(h),Ae.layerPoint=this.containerPointToLayerPoint(Ae.containerPoint),Ae.latlng=Ke?we.getLatLng():this.layerPointToLatLng(Ae.layerPoint)}for(ue=0;ue<z.length;ue++)if(z[ue].fire(E,Ae,!0),Ae.originalEvent._stopped||z[ue].options.bubblingMouseEvents===!1&&pe(this._mouseEvents,E)!==-1)return}},_draggableMoved:function(h){return h=h.dragging&&h.dragging.enabled()?h:this,h.dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,E=this._handlers.length;h<E;h++)this._handlers[h].disable()},whenReady:function(h,E){return this._loaded?h.call(E||this,{target:this}):this.on("load",h,E),this},_getMapPanePos:function(){return Dr(this._mapPane)||new Ue(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,E){var w=h&&E!==void 0?this._getNewPixelOrigin(h,E):this.getPixelOrigin();return w.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,E){var w=this.getSize()._divideBy(2);return this.project(h,E)._subtract(w)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,E,w){var x=this._getNewPixelOrigin(w,E);return this.project(h,E)._subtract(x)},_latLngBoundsToNewLayerBounds:function(h,E,w){var x=this._getNewPixelOrigin(w,E);return St([this.project(h.getSouthWest(),E)._subtract(x),this.project(h.getNorthWest(),E)._subtract(x),this.project(h.getSouthEast(),E)._subtract(x),this.project(h.getNorthEast(),E)._subtract(x)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,E,w){if(!w)return h;var x=this.project(h,E),z=this.getSize().divideBy(2),Q=new pt(x.subtract(z),x.add(z)),ue=this._getBoundsOffset(Q,w,E);return Math.abs(ue.x)<=1&&Math.abs(ue.y)<=1?h:this.unproject(x.add(ue),E)},_limitOffset:function(h,E){if(!E)return h;var w=this.getPixelBounds(),x=new pt(w.min.add(h),w.max.add(h));return h.add(this._getBoundsOffset(x,E))},_getBoundsOffset:function(h,E,w){var x=St(this.project(E.getNorthEast(),w),this.project(E.getSouthWest(),w)),z=x.min.subtract(h.min),Q=x.max.subtract(h.max),ue=this._rebound(z.x,-Q.x),we=this._rebound(z.y,-Q.y);return new Ue(ue,we)},_rebound:function(h,E){return h+E>0?Math.round(h-E)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(E))},_limitZoom:function(h){var E=this.getMinZoom(),w=this.getMaxZoom(),x=it.any3d?this.options.zoomSnap:1;return x&&(h=Math.round(h/x)*x),Math.max(E,Math.min(w,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Mt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,E){var w=this._getCenterOffset(h)._trunc();return(E&&E.animate)!==!0&&!this.getSize().contains(w)?!1:(this.panBy(w,E),!0)},_createAnimProxy:function(){var h=this._proxy=Ti("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(E){var w=yh,x=this._proxy.style[w];Ha(this._proxy,this.project(E.center,E.zoom),this.getZoomScale(E.zoom,1)),x===this._proxy.style[w]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){tn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),E=this.getZoom();Ha(this._proxy,this.project(h,E),this.getZoomScale(E,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,E,w){if(this._animatingZoom)return!0;if(w=w||{},!this._zoomAnimated||w.animate===!1||this._nothingToAnimate()||Math.abs(E-this._zoom)>this.options.zoomAnimationThreshold)return!1;var x=this.getZoomScale(E),z=this._getCenterOffset(h)._divideBy(1-1/x);return w.animate!==!0&&!this.getSize().contains(z)?!1:(st(function(){this._moveStart(!0,w.noMoveStart||!1)._animateZoom(h,E,!0)},this),!0)},_animateZoom:function(h,E,w,x){this._mapPane&&(w&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=E,Qt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:E,noUpdate:x}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(g(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Mt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function gr(h,E){return new Ei(h,E)}var Do=gt.extend({options:{position:"topright"},initialize:function(h){Y(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var E=this._map;return E&&E.removeControl(this),this.options.position=h,E&&E.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var E=this._container=this.onAdd(h),w=this.getPosition(),x=h._controlCorners[w];return Qt(E,"leaflet-control"),w.indexOf("bottom")!==-1?x.insertBefore(E,x.firstChild):x.appendChild(E),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(tn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),Nl=function(h){return new Do(h)};Ei.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},E="leaflet-",w=this._controlContainer=Ti("div",E+"control-container",this._container);function x(z,Q){var ue=E+z+" "+E+Q;h[z+Q]=Ti("div",ue,w)}x("top","left"),x("top","right"),x("bottom","left"),x("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)tn(this._controlCorners[h]);tn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Xa=Do.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,E,w,x){return w<x?-1:x<w?1:0}},initialize:function(h,E,w){Y(this,w),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var x in h)this._addLayer(h[x],x);for(x in E)this._addLayer(E[x],x,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var E=0;E<this._layers.length;E++)this._layers[E].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return Do.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,E){return this._addLayer(h,E),this._map?this._update():this},addOverlay:function(h,E){return this._addLayer(h,E,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var E=this._getLayer(T(h));return E&&this._layers.splice(this._layers.indexOf(E),1),this._map?this._update():this},expand:function(){Qt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(Qt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):Mt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Mt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",E=this._container=Ti("div",h),w=this.options.collapsed;E.setAttribute("aria-haspopup",!0),Nc(E),Oh(E);var x=this._section=Ti("section",h+"-list");w&&(this._map.on("click",this.collapse,this),Gt(E,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var z=this._layersLink=Ti("a",h+"-toggle",E);z.href="#",z.title="Layers",z.setAttribute("role","button"),Gt(z,{keydown:function(Q){Q.keyCode===13&&this._expandSafely()},click:function(Q){er(Q),this._expandSafely()}},this),w||this.expand(),this._baseLayersList=Ti("div",h+"-base",x),this._separator=Ti("div",h+"-separator",x),this._overlaysList=Ti("div",h+"-overlays",x),E.appendChild(x)},_getLayer:function(h){for(var E=0;E<this._layers.length;E++)if(this._layers[E]&&T(this._layers[E].layer)===h)return this._layers[E]},_addLayer:function(h,E,w){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:E,overlay:w}),this.options.sortLayers&&this._layers.sort(g(function(x,z){return this.options.sortFunction(x.layer,z.layer,x.name,z.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Is(this._baseLayersList),Is(this._overlaysList),this._layerControlInputs=[];var h,E,w,x,z=0;for(w=0;w<this._layers.length;w++)x=this._layers[w],this._addItem(x),E=E||x.overlay,h=h||!x.overlay,z+=x.overlay?0:1;return this.options.hideSingleBase&&(h=h&&z>1,this._baseLayersList.style.display=h?"":"none"),this._separator.style.display=E&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var E=this._getLayer(T(h.target)),w=E.overlay?h.type==="add"?"overlayadd":"overlayremove":h.type==="add"?"baselayerchange":null;w&&this._map.fire(w,E)},_createRadioElement:function(h,E){var w='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(E?' checked="checked"':"")+"/>",x=document.createElement("div");return x.innerHTML=w,x.firstChild},_addItem:function(h){var E=document.createElement("label"),w=this._map.hasLayer(h.layer),x;h.overlay?(x=document.createElement("input"),x.type="checkbox",x.className="leaflet-control-layers-selector",x.defaultChecked=w):x=this._createRadioElement("leaflet-base-layers_"+T(this),w),this._layerControlInputs.push(x),x.layerId=T(h.layer),Gt(x,"click",this._onInputClick,this);var z=document.createElement("span");z.innerHTML=" "+h.name;var Q=document.createElement("span");E.appendChild(Q),Q.appendChild(x),Q.appendChild(z);var ue=h.overlay?this._overlaysList:this._baseLayersList;return ue.appendChild(E),this._checkDisabledLayers(),E},_onInputClick:function(){if(!this._preventClick){var h=this._layerControlInputs,E,w,x=[],z=[];this._handlingClick=!0;for(var Q=h.length-1;Q>=0;Q--)E=h[Q],w=this._getLayer(E.layerId).layer,E.checked?x.push(w):E.checked||z.push(w);for(Q=0;Q<z.length;Q++)this._map.hasLayer(z[Q])&&this._map.removeLayer(z[Q]);for(Q=0;Q<x.length;Q++)this._map.hasLayer(x[Q])||this._map.addLayer(x[Q]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var h=this._layerControlInputs,E,w,x=this._map.getZoom(),z=h.length-1;z>=0;z--)E=h[z],w=this._getLayer(E.layerId).layer,E.disabled=w.options.minZoom!==void 0&&x<w.options.minZoom||w.options.maxZoom!==void 0&&x>w.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,Gt(h,"click",er),this.expand();var E=this;setTimeout(function(){Ki(h,"click",er),E._preventClick=!1})}}),Ld=function(h,E,w){return new Xa(h,E,w)},xl=Do.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var E="leaflet-control-zoom",w=Ti("div",E+" leaflet-bar"),x=this.options;return this._zoomInButton=this._createButton(x.zoomInText,x.zoomInTitle,E+"-in",w,this._zoomIn),this._zoomOutButton=this._createButton(x.zoomOutText,x.zoomOutTitle,E+"-out",w,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),w},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,E,w,x,z){var Q=Ti("a",w,x);return Q.innerHTML=h,Q.href="#",Q.title=E,Q.setAttribute("role","button"),Q.setAttribute("aria-label",E),Nc(Q),Gt(Q,"click",Ya),Gt(Q,"click",z,this),Gt(Q,"click",this._refocusOnMap,this),Q},_updateDisabled:function(){var h=this._map,E="leaflet-disabled";Mt(this._zoomInButton,E),Mt(this._zoomOutButton,E),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(Qt(this._zoomOutButton,E),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(Qt(this._zoomInButton,E),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ei.mergeOptions({zoomControl:!0}),Ei.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new xl,this.addControl(this.zoomControl))});var Sf=function(h){return new xl(h)},Md=Do.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var E="leaflet-control-scale",w=Ti("div",E),x=this.options;return this._addScales(x,E+"-line",w),h.on(x.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),w},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,E,w){h.metric&&(this._mScale=Ti("div",E,w)),h.imperial&&(this._iScale=Ti("div",E,w))},_update:function(){var h=this._map,E=h.getSize().y/2,w=h.distance(h.containerPointToLatLng([0,E]),h.containerPointToLatLng([this.options.maxWidth,E]));this._updateScales(w)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var E=this._getRoundNum(h),w=E<1e3?E+" m":E/1e3+" km";this._updateScale(this._mScale,w,E/h)},_updateImperial:function(h){var E=h*3.2808399,w,x,z;E>5280?(w=E/5280,x=this._getRoundNum(w),this._updateScale(this._iScale,x+" mi",x/w)):(z=this._getRoundNum(E),this._updateScale(this._iScale,z+" ft",z/E))},_updateScale:function(h,E,w){h.style.width=Math.round(this.options.maxWidth*w)+"px",h.innerHTML=E},_getRoundNum:function(h){var E=Math.pow(10,(Math.floor(h)+"").length-1),w=h/E;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:1,E*w}}),Jg=function(h){return new Md(h)},Nh='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Dl=Do.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(it.inlineSvg?Nh+" ":"")+"Leaflet</a>"},initialize:function(h){Y(this,h),this._attributions={}},onAdd:function(h){h.attributionControl=this,this._container=Ti("div","leaflet-control-attribution"),Nc(this._container);for(var E in h._layers)h._layers[E].getAttribution&&this.addAttribution(h._layers[E].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var E in this._attributions)this._attributions[E]&&h.push(E);var w=[];this.options.prefix&&w.push(this.options.prefix),h.length&&w.push(h.join(", ")),this._container.innerHTML=w.join(' <span aria-hidden="true">|</span> ')}}});Ei.mergeOptions({attributionControl:!0}),Ei.addInitHook(function(){this.options.attributionControl&&new Dl().addTo(this)});var xh=function(h){return new Dl(h)};Do.Layers=Xa,Do.Zoom=xl,Do.Scale=Md,Do.Attribution=Dl,Nl.layers=Ld,Nl.zoom=Sf,Nl.scale=Jg,Nl.attribution=xh;var ts=gt.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ts.addTo=function(h,E){return h.addHandler(E,this),this};var Zg={Events:yt},kr=it.touch?"touchstart mousedown":"mousedown",ko=Lt.extend({options:{clickTolerance:3},initialize:function(h,E,w,x){Y(this,x),this._element=h,this._dragStartTarget=E||h,this._preventOutline=w},enable:function(){this._enabled||(Gt(this._dragStartTarget,kr,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ko._dragging===this&&this.finishDrag(!0),Ki(this._dragStartTarget,kr,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!Ri(this._element,"leaflet-zoom-anim"))){if(h.touches&&h.touches.length!==1){ko._dragging===this&&this.finishDrag();return}if(!(ko._dragging||h.shiftKey||h.which!==1&&h.button!==1&&!h.touches)&&(ko._dragging=this,this._preventOutline&&Ch(this._element),Th(),Ga(),!this._moving)){this.fire("down");var E=h.touches?h.touches[0]:h,w=bh(this._element);this._startPoint=new Ue(E.clientX,E.clientY),this._startPos=Dr(this._element),this._parentScale=Rh(w);var x=h.type==="mousedown";Gt(document,x?"mousemove":"touchmove",this._onMove,this),Gt(document,x?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1){this._moved=!0;return}var E=h.touches&&h.touches.length===1?h.touches[0]:h,w=new Ue(E.clientX,E.clientY)._subtract(this._startPoint);!w.x&&!w.y||Math.abs(w.x)+Math.abs(w.y)<this.options.clickTolerance||(w.x/=this._parentScale.x,w.y/=this._parentScale.y,er(h),this._moved||(this.fire("dragstart"),this._moved=!0,Qt(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Qt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(w),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),wn(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){Mt(document.body,"leaflet-dragging"),this._lastTarget&&(Mt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ki(document,"mousemove touchmove",this._onMove,this),Ki(document,"mouseup touchend touchcancel",this._onUp,this),Dd(),es();var E=this._moved&&this._moving;this._moving=!1,ko._dragging=!1,E&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function Tf(h,E,w){var x,z=[1,4,2,8],Q,ue,we,Ae,Ke,nt,Pt,Nt;for(Q=0,nt=h.length;Q<nt;Q++)h[Q]._code=Za(h[Q],E);for(we=0;we<4;we++){for(Pt=z[we],x=[],Q=0,nt=h.length,ue=nt-1;Q<nt;ue=Q++)Ae=h[Q],Ke=h[ue],Ae._code&Pt?Ke._code&Pt||(Nt=jd(Ke,Ae,Pt,E,w),Nt._code=Za(Nt,E),x.push(Nt)):(Ke._code&Pt&&(Nt=jd(Ke,Ae,Pt,E,w),Nt._code=Za(Nt,E),x.push(Nt)),x.push(Ae));h=x}return h}function Dh(h,E){var w,x,z,Q,ue,we,Ae,Ke,nt;if(!h||h.length===0)throw new Error("latlngs not passed");ho(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var Pt=lt([0,0]),Nt=Ot(h),tr=Nt.getNorthWest().distanceTo(Nt.getSouthWest())*Nt.getNorthEast().distanceTo(Nt.getNorthWest());tr<1700&&(Pt=kh(h));var oi=h.length,mo=[];for(w=0;w<oi;w++){var Lr=lt(h[w]);mo.push(E.project(lt([Lr.lat-Pt.lat,Lr.lng-Pt.lng])))}for(we=Ae=Ke=0,w=0,x=oi-1;w<oi;x=w++)z=mo[w],Q=mo[x],ue=z.y*Q.x-Q.y*z.x,Ae+=(z.x+Q.x)*ue,Ke+=(z.y+Q.y)*ue,we+=ue*3;we===0?nt=mo[0]:nt=[Ae/we,Ke/we];var Wc=E.unproject(Ie(nt));return lt([Wc.lat+Pt.lat,Wc.lng+Pt.lng])}function kh(h){for(var E=0,w=0,x=0,z=0;z<h.length;z++){var Q=lt(h[z]);E+=Q.lat,w+=Q.lng,x++}return lt([E/x,w/x])}var oa={__proto__:null,clipPolygon:Tf,polygonCenter:Dh,centroid:kh};function wf(h,E){if(!E||!h.length)return h.slice();var w=E*E;return h=Qg(h,w),h=xc(h,w),h}function sa(h,E,w){return Math.sqrt(Qa(h,E,w,!0))}function kl(h,E,w){return Qa(h,E,w)}function xc(h,E){var w=h.length,x=typeof Uint8Array!=void 0+""?Uint8Array:Array,z=new x(w);z[0]=z[w-1]=1,Ud(h,z,E,0,w-1);var Q,ue=[];for(Q=0;Q<w;Q++)z[Q]&&ue.push(h[Q]);return ue}function Ud(h,E,w,x,z){var Q=0,ue,we,Ae;for(we=x+1;we<=z-1;we++)Ae=Qa(h[we],h[x],h[z],!0),Ae>Q&&(ue=we,Q=Ae);Q>w&&(E[ue]=1,Ud(h,E,w,x,ue),Ud(h,E,w,ue,z))}function Qg(h,E){for(var w=[h[0]],x=1,z=0,Q=h.length;x<Q;x++)e_(h[x],h[z])>E&&(w.push(h[x]),z=x);return z<Q-1&&w.push(h[Q-1]),w}var qt;function Ja(h,E,w,x,z){var Q=x?qt:Za(h,w),ue=Za(E,w),we,Ae,Ke;for(qt=ue;;){if(!(Q|ue))return[h,E];if(Q&ue)return!1;we=Q||ue,Ae=jd(h,E,we,w,z),Ke=Za(Ae,w),we===Q?(h=Ae,Q=Ke):(E=Ae,ue=Ke)}}function jd(h,E,w,x,z){var Q=E.x-h.x,ue=E.y-h.y,we=x.min,Ae=x.max,Ke,nt;return w&8?(Ke=h.x+Q*(Ae.y-h.y)/ue,nt=Ae.y):w&4?(Ke=h.x+Q*(we.y-h.y)/ue,nt=we.y):w&2?(Ke=Ae.x,nt=h.y+ue*(Ae.x-h.x)/Q):w&1&&(Ke=we.x,nt=h.y+ue*(we.x-h.x)/Q),new Ue(Ke,nt,z)}function Za(h,E){var w=0;return h.x<E.min.x?w|=1:h.x>E.max.x&&(w|=2),h.y<E.min.y?w|=4:h.y>E.max.y&&(w|=8),w}function e_(h,E){var w=E.x-h.x,x=E.y-h.y;return w*w+x*x}function Qa(h,E,w,x){var z=E.x,Q=E.y,ue=w.x-z,we=w.y-Q,Ae=ue*ue+we*we,Ke;return Ae>0&&(Ke=((h.x-z)*ue+(h.y-Q)*we)/Ae,Ke>1?(z=w.x,Q=w.y):Ke>0&&(z+=ue*Ke,Q+=we*Ke)),ue=h.x-z,we=h.y-Q,x?ue*ue+we*we:new Ue(z,Q)}function ho(h){return!re(h[0])||typeof h[0][0]!="object"&&typeof h[0][0]<"u"}function Cf(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ho(h)}function bf(h,E){var w,x,z,Q,ue,we,Ae,Ke;if(!h||h.length===0)throw new Error("latlngs not passed");ho(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var nt=lt([0,0]),Pt=Ot(h),Nt=Pt.getNorthWest().distanceTo(Pt.getSouthWest())*Pt.getNorthEast().distanceTo(Pt.getNorthWest());Nt<1700&&(nt=kh(h));var tr=h.length,oi=[];for(w=0;w<tr;w++){var mo=lt(h[w]);oi.push(E.project(lt([mo.lat-nt.lat,mo.lng-nt.lng])))}for(w=0,x=0;w<tr-1;w++)x+=oi[w].distanceTo(oi[w+1])/2;if(x===0)Ke=oi[0];else for(w=0,Q=0;w<tr-1;w++)if(ue=oi[w],we=oi[w+1],z=ue.distanceTo(we),Q+=z,Q>x){Ae=(Q-x)/z,Ke=[we.x-Ae*(we.x-ue.x),we.y-Ae*(we.y-ue.y)];break}var Lr=E.unproject(Ie(Ke));return lt([Lr.lat+nt.lat,Lr.lng+nt.lng])}var Lh={__proto__:null,simplify:wf,pointToSegmentDistance:sa,closestPointOnSegment:kl,clipSegment:Ja,_getEdgeIntersection:jd,_getBitCode:Za,_sqClosestPointOnSegment:Qa,isFlat:ho,_flat:Cf,polylineCenter:bf},Mh={project:function(h){return new Ue(h.lng,h.lat)},unproject:function(h){return new ge(h.y,h.x)},bounds:new pt([-180,-90],[180,90])},Uh={R:6378137,R_MINOR:6356752314245179e-9,bounds:new pt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(h){var E=Math.PI/180,w=this.R,x=h.lat*E,z=this.R_MINOR/w,Q=Math.sqrt(1-z*z),ue=Q*Math.sin(x),we=Math.tan(Math.PI/4-x/2)/Math.pow((1-ue)/(1+ue),Q/2);return x=-w*Math.log(Math.max(we,1e-10)),new Ue(h.lng*E*w,x)},unproject:function(h){for(var E=180/Math.PI,w=this.R,x=this.R_MINOR/w,z=Math.sqrt(1-x*x),Q=Math.exp(-h.y/w),ue=Math.PI/2-2*Math.atan(Q),we=0,Ae=.1,Ke;we<15&&Math.abs(Ae)>1e-7;we++)Ke=z*Math.sin(ue),Ke=Math.pow((1-Ke)/(1+Ke),z/2),Ae=Math.PI/2-2*Math.atan(Q*Ke)-ue,ue+=Ae;return new ge(ue*E,h.x*E/w)}},Ll={__proto__:null,LonLat:Mh,Mercator:Uh,SphericalMercator:bi},Rf=d({},Jt,{code:"EPSG:3395",projection:Uh,transformation:function(){var h=.5/(Math.PI*Uh.R);return Tn(h,.5,-h,.5)}()}),Jr=d({},Jt,{code:"EPSG:4326",projection:Mh,transformation:Tn(1/180,1,-1/180,.5)}),t_=d({},vt,{projection:Mh,transformation:Tn(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,E){var w=E.lng-h.lng,x=E.lat-h.lat;return Math.sqrt(w*w+x*x)},infinite:!0});vt.Earth=Jt,vt.EPSG3395=Rf,vt.EPSG3857=ph,vt.EPSG900913=hf,vt.EPSG4326=Jr,vt.Simple=t_;var Lo=Lt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[T(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[T(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var E=h.target;if(E.hasLayer(this)){if(this._map=E,this._zoomAnimated=E._zoomAnimated,this.getEvents){var w=this.getEvents();E.on(w,this),this.once("remove",function(){E.off(w,this)},this)}this.onAdd(E),this.fire("add"),E.fire("layeradd",{layer:this})}}});Ei.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var E=T(h);return this._layers[E]?this:(this._layers[E]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h),this)},removeLayer:function(h){var E=T(h);return this._layers[E]?(this._loaded&&h.onRemove(this),delete this._layers[E],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return T(h)in this._layers},eachLayer:function(h,E){for(var w in this._layers)h.call(E,this._layers[w]);return this},_addLayers:function(h){h=h?re(h)?h:[h]:[];for(var E=0,w=h.length;E<w;E++)this.addLayer(h[E])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[T(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var E=T(h);this._zoomBoundLayers[E]&&(delete this._zoomBoundLayers[E],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,E=-1/0,w=this._getZoomSpan();for(var x in this._zoomBoundLayers){var z=this._zoomBoundLayers[x].options;h=z.minZoom===void 0?h:Math.min(h,z.minZoom),E=z.maxZoom===void 0?E:Math.max(E,z.maxZoom)}this._layersMaxZoom=E===-1/0?void 0:E,this._layersMinZoom=h===1/0?void 0:h,w!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Dc=Lo.extend({initialize:function(h,E){Y(this,E),this._layers={};var w,x;if(h)for(w=0,x=h.length;w<x;w++)this.addLayer(h[w])},addLayer:function(h){var E=this.getLayerId(h);return this._layers[E]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var E=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[E]&&this._map.removeLayer(this._layers[E]),delete this._layers[E],this},hasLayer:function(h){var E=typeof h=="number"?h:this.getLayerId(h);return E in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var E=Array.prototype.slice.call(arguments,1),w,x;for(w in this._layers)x=this._layers[w],x[h]&&x[h].apply(x,E);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,E){for(var w in this._layers)h.call(E,this._layers[w]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return T(h)}}),jh=function(h,E){return new Dc(h,E)},Mo=Dc.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),Dc.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),Dc.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new yi;for(var E in this._layers){var w=this._layers[E];h.extend(w.getBounds?w.getBounds():w.getLatLng())}return h}}),Vh=function(h,E){return new Mo(h,E)},ec=gt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){Y(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,E){var w=this._getIconUrl(h);if(!w){if(h==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var x=this._createImg(w,E&&E.tagName==="IMG"?E:null);return this._setIconStyles(x,h),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),x},_setIconStyles:function(h,E){var w=this.options,x=w[E+"Size"];typeof x=="number"&&(x=[x,x]);var z=Ie(x),Q=Ie(E==="shadow"&&w.shadowAnchor||w.iconAnchor||z&&z.divideBy(2,!0));h.className="leaflet-marker-"+E+" "+(w.className||""),Q&&(h.style.marginLeft=-Q.x+"px",h.style.marginTop=-Q.y+"px"),z&&(h.style.width=z.x+"px",h.style.height=z.y+"px")},_createImg:function(h,E){return E=E||document.createElement("img"),E.src=h,E},_getIconUrl:function(h){return it.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});function Zr(h){return new ec(h)}var tc=ec.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return typeof tc.imagePath!="string"&&(tc.imagePath=this._detectIconPath()),(this.options.imagePath||tc.imagePath)+ec.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var E=function(w,x,z){var Q=x.exec(w);return Q&&Q[z]};return h=E(h,/^url\((['"])?(.+)\1\)$/,2),h&&E(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=Ti("div","leaflet-default-icon-path",document.body),E=Al(h,"background-image")||Al(h,"backgroundImage");if(document.body.removeChild(h),E=this._stripUrl(E),E)return E;var w=document.querySelector('link[href$="leaflet.css"]');return w?w.href.substring(0,w.href.length-11-1):""}}),Ml=ts.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new ko(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Qt(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Mt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var E=this._marker,w=E._map,x=this._marker.options.autoPanSpeed,z=this._marker.options.autoPanPadding,Q=Dr(E._icon),ue=w.getPixelBounds(),we=w.getPixelOrigin(),Ae=St(ue.min._subtract(we).add(z),ue.max._subtract(we).subtract(z));if(!Ae.contains(Q)){var Ke=Ie((Math.max(Ae.max.x,Q.x)-Ae.max.x)/(ue.max.x-Ae.max.x)-(Math.min(Ae.min.x,Q.x)-Ae.min.x)/(ue.min.x-Ae.min.x),(Math.max(Ae.max.y,Q.y)-Ae.max.y)/(ue.max.y-Ae.max.y)-(Math.min(Ae.min.y,Q.y)-Ae.min.y)/(ue.min.y-Ae.min.y)).multiplyBy(x);w.panBy(Ke,{animate:!1}),this._draggable._newPos._add(Ke),this._draggable._startPos._add(Ke),wn(E._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=st(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(ut(this._panRequest),this._panRequest=st(this._adjustPan.bind(this,h)))},_onDrag:function(h){var E=this._marker,w=E._shadow,x=Dr(E._icon),z=E._map.layerPointToLatLng(x);w&&wn(w,x),E._latlng=z,h.latlng=z,h.oldLatLng=this._oldLatLng,E.fire("move",h).fire("drag",h)},_onDragEnd:function(h){ut(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),Vd=Lo.extend({options:{icon:new tc,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,E){Y(this,E),this._latlng=lt(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var E=this._latlng;return this._latlng=lt(h),this.update(),this.fire("move",{oldLatLng:E,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,E="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),w=h.icon.createIcon(this._icon),x=!1;w!==this._icon&&(this._icon&&this._removeIcon(),x=!0,h.title&&(w.title=h.title),w.tagName==="IMG"&&(w.alt=h.alt||"")),Qt(w,E),h.keyboard&&(w.tabIndex="0",w.setAttribute("role","button")),this._icon=w,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Gt(w,"focus",this._panOnFocus,this);var z=h.icon.createShadow(this._shadow),Q=!1;z!==this._shadow&&(this._removeShadow(),Q=!0),z&&(Qt(z,E),z.alt=""),this._shadow=z,h.opacity<1&&this._updateOpacity(),x&&this.getPane().appendChild(this._icon),this._initInteraction(),z&&Q&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ki(this._icon,"focus",this._panOnFocus,this),tn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&tn(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&wn(this._icon,h),this._shadow&&wn(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var E=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(E)},_initInteraction:function(){if(this.options.interactive&&(Qt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Ml)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Ml(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&uo(this._icon,h),this._shadow&&uo(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var E=this.options.icon.options,w=E.iconSize?Ie(E.iconSize):Ie(0,0),x=E.iconAnchor?Ie(E.iconAnchor):Ie(0,0);h.panInside(this._latlng,{paddingTopLeft:x,paddingBottomRight:w.subtract(x)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function If(h,E){return new Vd(h,E)}var is=Lo.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return Y(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ul=is.extend({options:{fill:!0,radius:10},initialize:function(h,E){Y(this,E),this._latlng=lt(h),this._radius=this.options.radius},setLatLng:function(h){var E=this._latlng;return this._latlng=lt(h),this.redraw(),this.fire("move",{oldLatLng:E,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var E=h&&h.radius||this._radius;return is.prototype.setStyle.call(this,h),this.setRadius(E),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,E=this._radiusY||h,w=this._clickTolerance(),x=[h+w,E+w];this._pxBounds=new pt(this._point.subtract(x),this._point.add(x))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Af(h,E){return new Ul(h,E)}var jl=Ul.extend({initialize:function(h,E,w){if(typeof E=="number"&&(E=d({},w,{radius:E})),Y(this,E),this._latlng=lt(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new yi(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:is.prototype.setStyle,_project:function(){var h=this._latlng.lng,E=this._latlng.lat,w=this._map,x=w.options.crs;if(x.distance===Jt.distance){var z=Math.PI/180,Q=this._mRadius/Jt.R/z,ue=w.project([E+Q,h]),we=w.project([E-Q,h]),Ae=ue.add(we).divideBy(2),Ke=w.unproject(Ae).lat,nt=Math.acos((Math.cos(Q*z)-Math.sin(E*z)*Math.sin(Ke*z))/(Math.cos(E*z)*Math.cos(Ke*z)))/z;(isNaN(nt)||nt===0)&&(nt=Q/Math.cos(Math.PI/180*E)),this._point=Ae.subtract(w.getPixelOrigin()),this._radius=isNaN(nt)?0:Ae.x-w.project([Ke,h-nt]).x,this._radiusY=Ae.y-ue.y}else{var Pt=x.unproject(x.project(this._latlng).subtract([this._mRadius,0]));this._point=w.latLngToLayerPoint(this._latlng),this._radius=this._point.x-w.latLngToLayerPoint(Pt).x}this._updateBounds()}});function Fd(h,E,w){return new jl(h,E,w)}var ns=is.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,E){Y(this,E),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var E=1/0,w=null,x=Qa,z,Q,ue=0,we=this._parts.length;ue<we;ue++)for(var Ae=this._parts[ue],Ke=1,nt=Ae.length;Ke<nt;Ke++){z=Ae[Ke-1],Q=Ae[Ke];var Pt=x(h,z,Q,!0);Pt<E&&(E=Pt,w=x(h,z,Q))}return w&&(w.distance=Math.sqrt(E)),w},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bf(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,E){return E=E||this._defaultShape(),h=lt(h),E.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new yi,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return ho(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var E=[],w=ho(h),x=0,z=h.length;x<z;x++)w?(E[x]=lt(h[x]),this._bounds.extend(E[x])):E[x]=this._convertLatLngs(h[x]);return E},_project:function(){var h=new pt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),E=new Ue(h,h);this._rawPxBounds&&(this._pxBounds=new pt([this._rawPxBounds.min.subtract(E),this._rawPxBounds.max.add(E)]))},_projectLatlngs:function(h,E,w){var x=h[0]instanceof ge,z=h.length,Q,ue;if(x){for(ue=[],Q=0;Q<z;Q++)ue[Q]=this._map.latLngToLayerPoint(h[Q]),w.extend(ue[Q]);E.push(ue)}else for(Q=0;Q<z;Q++)this._projectLatlngs(h[Q],E,w)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}var E=this._parts,w,x,z,Q,ue,we,Ae;for(w=0,z=0,Q=this._rings.length;w<Q;w++)for(Ae=this._rings[w],x=0,ue=Ae.length;x<ue-1;x++)we=Ja(Ae[x],Ae[x+1],h,x,!0),we&&(E[z]=E[z]||[],E[z].push(we[0]),(we[1]!==Ae[x+1]||x===ue-2)&&(E[z].push(we[1]),z++))}},_simplifyPoints:function(){for(var h=this._parts,E=this.options.smoothFactor,w=0,x=h.length;w<x;w++)h[w]=wf(h[w],E)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,E){var w,x,z,Q,ue,we,Ae=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(w=0,Q=this._parts.length;w<Q;w++)for(we=this._parts[w],x=0,ue=we.length,z=ue-1;x<ue;z=x++)if(!(!E&&x===0)&&sa(h,we[z],we[x])<=Ae)return!0;return!1}});function Of(h,E){return new ns(h,E)}ns._flat=Cf;var rs=ns.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Dh(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var E=ns.prototype._convertLatLngs.call(this,h),w=E.length;return w>=2&&E[0]instanceof ge&&E[0].equals(E[w-1])&&E.pop(),E},_setLatLngs:function(h){ns.prototype._setLatLngs.call(this,h),ho(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ho(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,E=this.options.weight,w=new Ue(E,E);if(h=new pt(h.min.subtract(w),h.max.add(w)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}for(var x=0,z=this._rings.length,Q;x<z;x++)Q=Tf(this._rings[x],h,!0),Q.length&&this._parts.push(Q)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var E=!1,w,x,z,Q,ue,we,Ae,Ke;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(Q=0,Ae=this._parts.length;Q<Ae;Q++)for(w=this._parts[Q],ue=0,Ke=w.length,we=Ke-1;ue<Ke;we=ue++)x=w[ue],z=w[we],x.y>h.y!=z.y>h.y&&h.x<(z.x-x.x)*(h.y-x.y)/(z.y-x.y)+x.x&&(E=!E);return E||ns.prototype._containsPoint.call(this,h,!0)}});function kc(h,E){return new rs(h,E)}var As=Mo.extend({initialize:function(h,E){Y(this,E),this._layers={},h&&this.addData(h)},addData:function(h){var E=re(h)?h:h.features,w,x,z;if(E){for(w=0,x=E.length;w<x;w++)z=E[w],(z.geometries||z.geometry||z.features||z.coordinates)&&this.addData(z);return this}var Q=this.options;if(Q.filter&&!Q.filter(h))return this;var ue=Bd(h,Q);return ue?(ue.feature=Hd(h),ue.defaultOptions=ue.options,this.resetStyle(ue),Q.onEachFeature&&Q.onEachFeature(h,ue),this.addLayer(ue)):this},resetStyle:function(h){return h===void 0?this.eachLayer(this.resetStyle,this):(h.options=d({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(E){this._setLayerStyle(E,h)},this)},_setLayerStyle:function(h,E){h.setStyle&&(typeof E=="function"&&(E=E(h.feature)),h.setStyle(E))}});function Bd(h,E){var w=h.type==="Feature"?h.geometry:h,x=w?w.coordinates:null,z=[],Q=E&&E.pointToLayer,ue=E&&E.coordsToLatLng||Wd,we,Ae,Ke,nt;if(!x&&!w)return null;switch(w.type){case"Point":return we=ue(x),Uo(Q,h,we,E);case"MultiPoint":for(Ke=0,nt=x.length;Ke<nt;Ke++)we=ue(x[Ke]),z.push(Uo(Q,h,we,E));return new Mo(z);case"LineString":case"MultiLineString":return Ae=Vl(x,w.type==="LineString"?0:1,ue),new ns(Ae,E);case"Polygon":case"MultiPolygon":return Ae=Vl(x,w.type==="Polygon"?1:2,ue),new rs(Ae,E);case"GeometryCollection":for(Ke=0,nt=w.geometries.length;Ke<nt;Ke++){var Pt=Bd({geometry:w.geometries[Ke],type:"Feature",properties:h.properties},E);Pt&&z.push(Pt)}return new Mo(z);case"FeatureCollection":for(Ke=0,nt=w.features.length;Ke<nt;Ke++){var Nt=Bd(w.features[Ke],E);Nt&&z.push(Nt)}return new Mo(z);default:throw new Error("Invalid GeoJSON object.")}}function Uo(h,E,w,x){return h?h(E,w):new Vd(w,x&&x.markersInheritOptions&&x)}function Wd(h){return new ge(h[1],h[0],h[2])}function Vl(h,E,w){for(var x=[],z=0,Q=h.length,ue;z<Q;z++)ue=E?Vl(h[z],E-1,w):(w||Wd)(h[z]),x.push(ue);return x}function _r(h,E){return h=lt(h),h.alt!==void 0?[B(h.lng,E),B(h.lat,E),B(h.alt,E)]:[B(h.lng,E),B(h.lat,E)]}function zd(h,E,w,x){for(var z=[],Q=0,ue=h.length;Q<ue;Q++)z.push(E?zd(h[Q],ho(h[Q])?0:E-1,w,x):_r(h[Q],x));return!E&&w&&z.length>0&&z.push(z[0].slice()),z}function Lc(h,E){return h.feature?d({},h.feature,{geometry:E}):Hd(E)}function Hd(h){return h.type==="Feature"||h.type==="FeatureCollection"?h:{type:"Feature",properties:{},geometry:h}}var Fh={toGeoJSON:function(h){return Lc(this,{type:"Point",coordinates:_r(this.getLatLng(),h)})}};Vd.include(Fh),jl.include(Fh),Ul.include(Fh),ns.include({toGeoJSON:function(h){var E=!ho(this._latlngs),w=zd(this._latlngs,E?1:0,!1,h);return Lc(this,{type:(E?"Multi":"")+"LineString",coordinates:w})}}),rs.include({toGeoJSON:function(h){var E=!ho(this._latlngs),w=E&&!ho(this._latlngs[0]),x=zd(this._latlngs,w?2:E?1:0,!0,h);return E||(x=[x]),Lc(this,{type:(w?"Multi":"")+"Polygon",coordinates:x})}}),Dc.include({toMultiPoint:function(h){var E=[];return this.eachLayer(function(w){E.push(w.toGeoJSON(h).geometry.coordinates)}),Lc(this,{type:"MultiPoint",coordinates:E})},toGeoJSON:function(h){var E=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(E==="MultiPoint")return this.toMultiPoint(h);var w=E==="GeometryCollection",x=[];return this.eachLayer(function(z){if(z.toGeoJSON){var Q=z.toGeoJSON(h);if(w)x.push(Q.geometry);else{var ue=Hd(Q);ue.type==="FeatureCollection"?x.push.apply(x,ue.features):x.push(ue)}}}),w?Lc(this,{geometries:x,type:"GeometryCollection"}):{type:"FeatureCollection",features:x}}});function Gd(h,E){return new As(h,E)}var i_=Gd,Fl=Lo.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,E,w){this._url=h,this._bounds=Ot(E),Y(this,w)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Qt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){tn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&ia(this._image),this},bringToBack:function(){return this._map&&Pc(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=Ot(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h=this._url.tagName==="IMG",E=this._image=h?this._url:Ti("img");if(Qt(E,"leaflet-image-layer"),this._zoomAnimated&&Qt(E,"leaflet-zoom-animated"),this.options.className&&Qt(E,this.options.className),E.onselectstart=D,E.onmousemove=D,E.onload=g(this.fire,this,"load"),E.onerror=g(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(E.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h){this._url=E.src;return}E.src=this._url,E.alt=this.options.alt},_animateZoom:function(h){var E=this._map.getZoomScale(h.zoom),w=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;Ha(this._image,w,E)},_reset:function(){var h=this._image,E=new pt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),w=E.getSize();wn(h,E.min),h.style.width=w.x+"px",h.style.height=w.y+"px"},_updateOpacity:function(){uo(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),n_=function(h,E,w){return new Fl(h,E,w)},Kd=Fl.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h=this._url.tagName==="VIDEO",E=this._image=h?this._url:Ti("video");if(Qt(E,"leaflet-image-layer"),this._zoomAnimated&&Qt(E,"leaflet-zoom-animated"),this.options.className&&Qt(E,this.options.className),E.onselectstart=D,E.onmousemove=D,E.onloadeddata=g(this.fire,this,"load"),h){for(var w=E.getElementsByTagName("source"),x=[],z=0;z<w.length;z++)x.push(w[z].src);this._url=w.length>0?x:[E.src];return}re(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(E.style,"objectFit")&&(E.style.objectFit="fill"),E.autoplay=!!this.options.autoplay,E.loop=!!this.options.loop,E.muted=!!this.options.muted,E.playsInline=!!this.options.playsInline;for(var Q=0;Q<this._url.length;Q++){var ue=Ti("source");ue.src=this._url[Q],E.appendChild(ue)}}});function Bh(h,E,w){return new Kd(h,E,w)}var Pf=Fl.extend({_initImage:function(){var h=this._image=this._url;Qt(h,"leaflet-image-layer"),this._zoomAnimated&&Qt(h,"leaflet-zoom-animated"),this.options.className&&Qt(h,this.options.className),h.onselectstart=D,h.onmousemove=D}});function Wh(h,E,w){return new Pf(h,E,w)}var po=Lo.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,E){h&&(h instanceof ge||re(h))?(this._latlng=lt(h),Y(this,E)):(Y(this,h),this._source=E),this.options.content&&(this._content=this.options.content)},openOn:function(h){return h=arguments.length?h:this._source._map,h.hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&uo(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&uo(this._container,1),this.bringToFront(),this.options.interactive&&(Qt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(uo(this._container,0),this._removeTimeout=setTimeout(g(tn,void 0,this._container),200)):tn(this._container),this.options.interactive&&(Mt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=lt(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ia(this._container),this},bringToBack:function(){return this._map&&Pc(this._container),this},_prepareOpen:function(h){var E=this._source;if(!E._map)return!1;if(E instanceof Mo){E=null;var w=this._source._layers;for(var x in w)if(w[x]._map){E=w[x];break}if(!E)return!1;this._source=E}if(!h)if(E.getCenter)h=E.getCenter();else if(E.getLatLng)h=E.getLatLng();else if(E.getBounds)h=E.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,E=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof E=="string")h.innerHTML=E;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(E)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),E=Ie(this.options.offset),w=this._getAnchor();this._zoomAnimated?wn(this._container,h.add(w)):E=E.add(h).add(w);var x=this._containerBottom=-E.y,z=this._containerLeft=-Math.round(this._containerWidth/2)+E.x;this._container.style.bottom=x+"px",this._container.style.left=z+"px"}},_getAnchor:function(){return[0,0]}});Ei.include({_initOverlay:function(h,E,w,x){var z=E;return z instanceof h||(z=new h(x).setContent(E)),w&&z.setLatLng(w),z}}),Lo.include({_initOverlay:function(h,E,w,x){var z=w;return z instanceof h?(Y(z,x),z._source=this):(z=E&&!x?E:new h(x,this),z.setContent(w)),z}});var qd=po.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return h=arguments.length?h:this._source._map,!h.hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,po.prototype.openOn.call(this,h)},onAdd:function(h){po.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof is||this._source.on("preclick",na))},onRemove:function(h){po.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof is||this._source.off("preclick",na))},getEvents:function(){var h=po.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",E=this._container=Ti("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),w=this._wrapper=Ti("div",h+"-content-wrapper",E);if(this._contentNode=Ti("div",h+"-content",w),Nc(E),Oh(this._contentNode),Gt(E,"contextmenu",na),this._tipContainer=Ti("div",h+"-tip-container",E),this._tip=Ti("div",h+"-tip",this._tipContainer),this.options.closeButton){var x=this._closeButton=Ti("a",h+"-close-button",E);x.setAttribute("role","button"),x.setAttribute("aria-label","Close popup"),x.href="#close",x.innerHTML='<span aria-hidden="true">&#215;</span>',Gt(x,"click",function(z){er(z),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,E=h.style;E.width="",E.whiteSpace="nowrap";var w=h.offsetWidth;w=Math.min(w,this.options.maxWidth),w=Math.max(w,this.options.minWidth),E.width=w+1+"px",E.whiteSpace="",E.height="";var x=h.offsetHeight,z=this.options.maxHeight,Q="leaflet-popup-scrolled";z&&x>z?(E.height=z+"px",Qt(h,Q)):Mt(h,Q),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var E=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),w=this._getAnchor();wn(this._container,E.add(w))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var h=this._map,E=parseInt(Al(this._container,"marginBottom"),10)||0,w=this._container.offsetHeight+E,x=this._containerWidth,z=new Ue(this._containerLeft,-w-this._containerBottom);z._add(Dr(this._container));var Q=h.layerPointToContainerPoint(z),ue=Ie(this.options.autoPanPadding),we=Ie(this.options.autoPanPaddingTopLeft||ue),Ae=Ie(this.options.autoPanPaddingBottomRight||ue),Ke=h.getSize(),nt=0,Pt=0;Q.x+x+Ae.x>Ke.x&&(nt=Q.x+x-Ke.x+Ae.x),Q.x-nt-we.x<0&&(nt=Q.x-we.x),Q.y+w+Ae.y>Ke.y&&(Pt=Q.y+w-Ke.y+Ae.y),Q.y-Pt-we.y<0&&(Pt=Q.y-we.y),(nt||Pt)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([nt,Pt]))}},_getAnchor:function(){return Ie(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),ke=function(h,E){return new qd(h,E)};Ei.mergeOptions({closePopupOnClick:!0}),Ei.include({openPopup:function(h,E,w){return this._initOverlay(qd,h,E,w).openOn(this),this},closePopup:function(h){return h=arguments.length?h:this._popup,h&&h.close(),this}}),Lo.include({bindPopup:function(h,E){return this._popup=this._initOverlay(qd,this._popup,h,E),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof Mo||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(!(!this._popup||!this._map)){Ya(h);var E=h.layer||h.target;if(this._popup._source===E&&!(E instanceof is)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng);return}this._popup._source=E,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){h.originalEvent.keyCode===13&&this._openPopup(h)}});var Yd=po.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){po.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){po.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=po.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){var h="leaflet-tooltip",E=h+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ti("div",E),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+T(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var E,w,x=this._map,z=this._container,Q=x.latLngToContainerPoint(x.getCenter()),ue=x.layerPointToContainerPoint(h),we=this.options.direction,Ae=z.offsetWidth,Ke=z.offsetHeight,nt=Ie(this.options.offset),Pt=this._getAnchor();we==="top"?(E=Ae/2,w=Ke):we==="bottom"?(E=Ae/2,w=0):we==="center"?(E=Ae/2,w=Ke/2):we==="right"?(E=0,w=Ke/2):we==="left"?(E=Ae,w=Ke/2):ue.x<Q.x?(we="right",E=0,w=Ke/2):(we="left",E=Ae+(nt.x+Pt.x)*2,w=Ke/2),h=h.subtract(Ie(E,w,!0)).add(nt).add(Pt),Mt(z,"leaflet-tooltip-right"),Mt(z,"leaflet-tooltip-left"),Mt(z,"leaflet-tooltip-top"),Mt(z,"leaflet-tooltip-bottom"),Qt(z,"leaflet-tooltip-"+we),wn(z,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&uo(this._container,h)},_animateZoom:function(h){var E=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(E)},_getAnchor:function(){return Ie(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),r_=function(h,E){return new Yd(h,E)};Ei.include({openTooltip:function(h,E,w){return this._initOverlay(Yd,h,E,w).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Lo.include({bindTooltip:function(h,E){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Yd,this._tooltip,h,E),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(!(!h&&this._tooltipHandlersAdded)){var E=h?"off":"on",w={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?w.add=this._openTooltip:(w.mouseover=this._openTooltip,w.mouseout=this.closeTooltip,w.click=this._openTooltip,this._map?this._addFocusListeners():w.add=this._addFocusListeners),this._tooltip.options.sticky&&(w.mousemove=this._moveTooltip),this[E](w),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof Mo||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var E=typeof h.getElement=="function"&&h.getElement();E&&(Gt(E,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),Gt(E,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var E=typeof h.getElement=="function"&&h.getElement();E&&E.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var E=this;this._map.once("moveend",function(){E._openOnceFlag=!1,E._openTooltip(h)});return}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var E=h.latlng,w,x;this._tooltip.options.sticky&&h.originalEvent&&(w=this._map.mouseEventToContainerPoint(h.originalEvent),x=this._map.containerPointToLayerPoint(w),E=this._map.layerPointToLatLng(x)),this._tooltip.setLatLng(E)}});var Nf=ec.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var E=h&&h.tagName==="DIV"?h:document.createElement("div"),w=this.options;if(w.html instanceof Element?(Is(E),E.appendChild(w.html)):E.innerHTML=w.html!==!1?w.html:"",w.bgPos){var x=Ie(w.bgPos);E.style.backgroundPosition=-x.x+"px "+-x.y+"px"}return this._setIconStyles(E,"icon"),E},createShadow:function(){return null}});function o_(h){return new Nf(h)}ec.Default=tc;var Mc=Lo.extend({options:{tileSize:256,opacity:1,updateWhenIdle:it.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){Y(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),tn(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ia(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Pc(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=R(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof Ue?h:new Ue(h,h)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var E=this.getPane().children,w=-h(-1/0,1/0),x=0,z=E.length,Q;x<z;x++)Q=E[x].style.zIndex,E[x]!==this._container&&Q&&(w=h(w,+Q));isFinite(w)&&(this.options.zIndex=w+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!it.ielt9){uo(this._container,this.options.opacity);var h=+new Date,E=!1,w=!1;for(var x in this._tiles){var z=this._tiles[x];if(!(!z.current||!z.loaded)){var Q=Math.min(1,(h-z.loaded)/200);uo(z.el,Q),Q<1?E=!0:(z.active?w=!0:this._onOpaqueTile(z),z.active=!0)}}w&&!this._noPrune&&this._pruneTiles(),E&&(ut(this._fadeFrame),this._fadeFrame=st(this._updateOpacity,this))}},_onOpaqueTile:D,_initContainer:function(){this._container||(this._container=Ti("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,E=this.options.maxZoom;if(h!==void 0){for(var w in this._levels)w=Number(w),this._levels[w].el.children.length||w===h?(this._levels[w].el.style.zIndex=E-Math.abs(h-w),this._onUpdateLevel(w)):(tn(this._levels[w].el),this._removeTilesAtZoom(w),this._onRemoveLevel(w),delete this._levels[w]);var x=this._levels[h],z=this._map;return x||(x=this._levels[h]={},x.el=Ti("div","leaflet-tile-container leaflet-zoom-animated",this._container),x.el.style.zIndex=E,x.origin=z.project(z.unproject(z.getPixelOrigin()),h).round(),x.zoom=h,this._setZoomTransform(x,z.getCenter(),z.getZoom()),D(x.el.offsetWidth),this._onCreateLevel(x)),this._level=x,x}},_onUpdateLevel:D,_onRemoveLevel:D,_onCreateLevel:D,_pruneTiles:function(){if(this._map){var h,E,w=this._map.getZoom();if(w>this.options.maxZoom||w<this.options.minZoom){this._removeAllTiles();return}for(h in this._tiles)E=this._tiles[h],E.retain=E.current;for(h in this._tiles)if(E=this._tiles[h],E.current&&!E.active){var x=E.coords;this._retainParent(x.x,x.y,x.z,x.z-5)||this._retainChildren(x.x,x.y,x.z,x.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var E in this._tiles)this._tiles[E].coords.z===h&&this._removeTile(E)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)tn(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,E,w,x){var z=Math.floor(h/2),Q=Math.floor(E/2),ue=w-1,we=new Ue(+z,+Q);we.z=+ue;var Ae=this._tileCoordsToKey(we),Ke=this._tiles[Ae];return Ke&&Ke.active?(Ke.retain=!0,!0):(Ke&&Ke.loaded&&(Ke.retain=!0),ue>x?this._retainParent(z,Q,ue,x):!1)},_retainChildren:function(h,E,w,x){for(var z=2*h;z<2*h+2;z++)for(var Q=2*E;Q<2*E+2;Q++){var ue=new Ue(z,Q);ue.z=w+1;var we=this._tileCoordsToKey(ue),Ae=this._tiles[we];if(Ae&&Ae.active){Ae.retain=!0;continue}else Ae&&Ae.loaded&&(Ae.retain=!0);w+1<x&&this._retainChildren(z,Q,w+1,x)}},_resetView:function(h){var E=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),E,E)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var E=this.options;return E.minNativeZoom!==void 0&&h<E.minNativeZoom?E.minNativeZoom:E.maxNativeZoom!==void 0&&E.maxNativeZoom<h?E.maxNativeZoom:h},_setView:function(h,E,w,x){var z=Math.round(E);this.options.maxZoom!==void 0&&z>this.options.maxZoom||this.options.minZoom!==void 0&&z<this.options.minZoom?z=void 0:z=this._clampZoom(z);var Q=this.options.updateWhenZooming&&z!==this._tileZoom;(!x||Q)&&(this._tileZoom=z,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),z!==void 0&&this._update(h),w||this._pruneTiles(),this._noPrune=!!w),this._setZoomTransforms(h,E)},_setZoomTransforms:function(h,E){for(var w in this._levels)this._setZoomTransform(this._levels[w],h,E)},_setZoomTransform:function(h,E,w){var x=this._map.getZoomScale(w,h.zoom),z=h.origin.multiplyBy(x).subtract(this._map._getNewPixelOrigin(E,w)).round();it.any3d?Ha(h.el,z,x):wn(h.el,z)},_resetGrid:function(){var h=this._map,E=h.options.crs,w=this._tileSize=this.getTileSize(),x=this._tileZoom,z=this._map.getPixelWorldBounds(this._tileZoom);z&&(this._globalTileRange=this._pxBoundsToTileRange(z)),this._wrapX=E.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,E.wrapLng[0]],x).x/w.x),Math.ceil(h.project([0,E.wrapLng[1]],x).x/w.y)],this._wrapY=E.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([E.wrapLat[0],0],x).y/w.x),Math.ceil(h.project([E.wrapLat[1],0],x).y/w.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var E=this._map,w=E._animatingZoom?Math.max(E._animateToZoom,E.getZoom()):E.getZoom(),x=E.getZoomScale(w,this._tileZoom),z=E.project(h,this._tileZoom).floor(),Q=E.getSize().divideBy(x*2);return new pt(z.subtract(Q),z.add(Q))},_update:function(h){var E=this._map;if(E){var w=this._clampZoom(E.getZoom());if(h===void 0&&(h=E.getCenter()),this._tileZoom!==void 0){var x=this._getTiledPixelBounds(h),z=this._pxBoundsToTileRange(x),Q=z.getCenter(),ue=[],we=this.options.keepBuffer,Ae=new pt(z.getBottomLeft().subtract([we,-we]),z.getTopRight().add([we,-we]));if(!(isFinite(z.min.x)&&isFinite(z.min.y)&&isFinite(z.max.x)&&isFinite(z.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ke in this._tiles){var nt=this._tiles[Ke].coords;(nt.z!==this._tileZoom||!Ae.contains(new Ue(nt.x,nt.y)))&&(this._tiles[Ke].current=!1)}if(Math.abs(w-this._tileZoom)>1){this._setView(h,w);return}for(var Pt=z.min.y;Pt<=z.max.y;Pt++)for(var Nt=z.min.x;Nt<=z.max.x;Nt++){var tr=new Ue(Nt,Pt);if(tr.z=this._tileZoom,!!this._isValidTile(tr)){var oi=this._tiles[this._tileCoordsToKey(tr)];oi?oi.current=!0:ue.push(tr)}}if(ue.sort(function(Lr,Wc){return Lr.distanceTo(Q)-Wc.distanceTo(Q)}),ue.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var mo=document.createDocumentFragment();for(Nt=0;Nt<ue.length;Nt++)this._addTile(ue[Nt],mo);this._level.el.appendChild(mo)}}}},_isValidTile:function(h){var E=this._map.options.crs;if(!E.infinite){var w=this._globalTileRange;if(!E.wrapLng&&(h.x<w.min.x||h.x>w.max.x)||!E.wrapLat&&(h.y<w.min.y||h.y>w.max.y))return!1}if(!this.options.bounds)return!0;var x=this._tileCoordsToBounds(h);return Ot(this.options.bounds).overlaps(x)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var E=this._map,w=this.getTileSize(),x=h.scaleBy(w),z=x.add(w),Q=E.unproject(x,h.z),ue=E.unproject(z,h.z);return[Q,ue]},_tileCoordsToBounds:function(h){var E=this._tileCoordsToNwSe(h),w=new yi(E[0],E[1]);return this.options.noWrap||(w=this._map.wrapLatLngBounds(w)),w},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var E=h.split(":"),w=new Ue(+E[0],+E[1]);return w.z=+E[2],w},_removeTile:function(h){var E=this._tiles[h];E&&(tn(E.el),delete this._tiles[h],this.fire("tileunload",{tile:E.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){Qt(h,"leaflet-tile");var E=this.getTileSize();h.style.width=E.x+"px",h.style.height=E.y+"px",h.onselectstart=D,h.onmousemove=D,it.ielt9&&this.options.opacity<1&&uo(h,this.options.opacity)},_addTile:function(h,E){var w=this._getTilePos(h),x=this._tileCoordsToKey(h),z=this.createTile(this._wrapCoords(h),g(this._tileReady,this,h));this._initTile(z),this.createTile.length<2&&st(g(this._tileReady,this,h,null,z)),wn(z,w),this._tiles[x]={el:z,coords:h,current:!0},E.appendChild(z),this.fire("tileloadstart",{tile:z,coords:h})},_tileReady:function(h,E,w){E&&this.fire("tileerror",{error:E,tile:w,coords:h});var x=this._tileCoordsToKey(h);w=this._tiles[x],w&&(w.loaded=+new Date,this._map._fadeAnimated?(uo(w.el,0),ut(this._fadeFrame),this._fadeFrame=st(this._updateOpacity,this)):(w.active=!0,this._pruneTiles()),E||(Qt(w.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:w.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),it.ielt9||!this._map._fadeAnimated?st(this._pruneTiles,this):setTimeout(g(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var E=new Ue(this._wrapX?N(h.x,this._wrapX):h.x,this._wrapY?N(h.y,this._wrapY):h.y);return E.z=h.z,E},_pxBoundsToTileRange:function(h){var E=this.getTileSize();return new pt(h.min.unscaleBy(E).floor(),h.max.unscaleBy(E).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});function xf(h){return new Mc(h)}var Uc=Mc.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,E){this._url=h,E=Y(this,E),E.detectRetina&&it.retina&&E.maxZoom>0?(E.tileSize=Math.floor(E.tileSize/2),E.zoomReverse?(E.zoomOffset--,E.minZoom=Math.min(E.maxZoom,E.minZoom+1)):(E.zoomOffset++,E.maxZoom=Math.max(E.minZoom,E.maxZoom-1)),E.minZoom=Math.max(0,E.minZoom)):E.zoomReverse?E.minZoom=Math.min(E.maxZoom,E.minZoom):E.maxZoom=Math.max(E.minZoom,E.maxZoom),typeof E.subdomains=="string"&&(E.subdomains=E.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,E){return this._url===h&&E===void 0&&(E=!0),this._url=h,E||this.redraw(),this},createTile:function(h,E){var w=document.createElement("img");return Gt(w,"load",g(this._tileOnLoad,this,E,w)),Gt(w,"error",g(this._tileOnError,this,E,w)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(w.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(w.referrerPolicy=this.options.referrerPolicy),w.alt="",w.src=this.getTileUrl(h),w},getTileUrl:function(h){var E={r:it.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var w=this._globalTileRange.max.y-h.y;this.options.tms&&(E.y=w),E["-y"]=w}return ee(this._url,d(E,this.options))},_tileOnLoad:function(h,E){it.ielt9?setTimeout(g(h,this,null,E),0):h(null,E)},_tileOnError:function(h,E,w){var x=this.options.errorTileUrl;x&&E.getAttribute("src")!==x&&(E.src=x),h(w,E)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom,E=this.options.maxZoom,w=this.options.zoomReverse,x=this.options.zoomOffset;return w&&(h=E-h),h+x},_getSubdomain:function(h){var E=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[E]},_abortLoading:function(){var h,E;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&(E=this._tiles[h].el,E.onload=D,E.onerror=D,!E.complete)){E.src=ve;var w=this._tiles[h].coords;tn(E),delete this._tiles[h],this.fire("tileabort",{tile:E,coords:w})}},_removeTile:function(h){var E=this._tiles[h];if(E)return E.el.setAttribute("src",ve),Mc.prototype._removeTile.call(this,h)},_tileReady:function(h,E,w){if(!(!this._map||w&&w.getAttribute("src")===ve))return Mc.prototype._tileReady.call(this,h,E,w)}});function Df(h,E){return new Uc(h,E)}var Bl=Uc.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,E){this._url=h;var w=d({},this.defaultWmsParams);for(var x in E)x in this.options||(w[x]=E[x]);E=Y(this,E);var z=E.detectRetina&&it.retina?2:1,Q=this.getTileSize();w.width=Q.x*z,w.height=Q.y*z,this.wmsParams=w},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var E=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[E]=this._crs.code,Uc.prototype.onAdd.call(this,h)},getTileUrl:function(h){var E=this._tileCoordsToNwSe(h),w=this._crs,x=St(w.project(E[0]),w.project(E[1])),z=x.min,Q=x.max,ue=(this._wmsVersion>=1.3&&this._crs===Jr?[z.y,z.x,Q.y,Q.x]:[z.x,z.y,Q.x,Q.y]).join(","),we=Uc.prototype.getTileUrl.call(this,h);return we+te(this.wmsParams,we,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+ue},setParams:function(h,E){return d(this.wmsParams,h),E||this.redraw(),this}});function jc(h,E){return new Bl(h,E)}Uc.WMS=Bl,Df.wms=jc;var os=Lo.extend({options:{padding:.1},initialize:function(h){Y(this,h),T(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Qt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,E){var w=this._map.getZoomScale(E,this._zoom),x=this._map.getSize().multiplyBy(.5+this.options.padding),z=this._map.project(this._center,E),Q=x.multiplyBy(-w).add(z).subtract(this._map._getNewPixelOrigin(h,E));it.any3d?Ha(this._container,Q,w):wn(this._container,Q)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var h in this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,E=this._map.getSize(),w=this._map.containerPointToLayerPoint(E.multiplyBy(-h)).round();this._bounds=new pt(w,w.add(E.multiplyBy(1+h*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),kf=os.extend({options:{tolerance:0},getEvents:function(){var h=os.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){os.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");Gt(h,"mousemove",this._onMouseMove,this),Gt(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Gt(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){ut(this._redrawRequest),delete this._ctx,tn(this._container),Ki(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var h;this._redrawBounds=null;for(var E in this._layers)h=this._layers[E],h._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){os.prototype._update.call(this);var h=this._bounds,E=this._container,w=h.getSize(),x=it.retina?2:1;wn(E,h.min),E.width=x*w.x,E.height=x*w.y,E.style.width=w.x+"px",E.style.height=w.y+"px",it.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){os.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[T(h)]=h;var E=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=E),this._drawLast=E,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var E=h._order,w=E.next,x=E.prev;w?w.prev=x:this._drawLast=x,x?x.next=w:this._drawFirst=w,delete h._order,delete this._layers[T(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if(typeof h.options.dashArray=="string"){var E=h.options.dashArray.split(/[, ]+/),w=[],x,z;for(z=0;z<E.length;z++){if(x=Number(E[z]),isNaN(x))return;w.push(x)}h.options._dashArray=w}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||st(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var E=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new pt,this._redrawBounds.extend(h._pxBounds.min.subtract([E,E])),this._redrawBounds.extend(h._pxBounds.max.add([E,E]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var E=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,E.x,E.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,E=this._redrawBounds;if(this._ctx.save(),E){var w=E.getSize();this._ctx.beginPath(),this._ctx.rect(E.min.x,E.min.y,w.x,w.y),this._ctx.clip()}this._drawing=!0;for(var x=this._drawFirst;x;x=x.next)h=x.layer,(!E||h._pxBounds&&h._pxBounds.intersects(E))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,E){if(this._drawing){var w,x,z,Q,ue=h._parts,we=ue.length,Ae=this._ctx;if(we){for(Ae.beginPath(),w=0;w<we;w++){for(x=0,z=ue[w].length;x<z;x++)Q=ue[w][x],Ae[x?"lineTo":"moveTo"](Q.x,Q.y);E&&Ae.closePath()}this._fillStroke(Ae,h)}}},_updateCircle:function(h){if(!(!this._drawing||h._empty())){var E=h._point,w=this._ctx,x=Math.max(Math.round(h._radius),1),z=(Math.max(Math.round(h._radiusY),1)||x)/x;z!==1&&(w.save(),w.scale(1,z)),w.beginPath(),w.arc(E.x,E.y/z,x,0,Math.PI*2,!1),z!==1&&w.restore(),this._fillStroke(w,h)}},_fillStroke:function(h,E){var w=E.options;w.fill&&(h.globalAlpha=w.fillOpacity,h.fillStyle=w.fillColor||w.color,h.fill(w.fillRule||"evenodd")),w.stroke&&w.weight!==0&&(h.setLineDash&&h.setLineDash(E.options&&E.options._dashArray||[]),h.globalAlpha=w.opacity,h.lineWidth=w.weight,h.strokeStyle=w.color,h.lineCap=w.lineCap,h.lineJoin=w.lineJoin,h.stroke())},_onClick:function(h){for(var E=this._map.mouseEventToLayerPoint(h),w,x,z=this._drawFirst;z;z=z.next)w=z.layer,w.options.interactive&&w._containsPoint(E)&&(!(h.type==="click"||h.type==="preclick")||!this._map._draggableMoved(w))&&(x=w);this._fireEvent(x?[x]:!1,h)},_onMouseMove:function(h){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var E=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,E)}},_handleMouseOut:function(h){var E=this._hoveredLayer;E&&(Mt(this._container,"leaflet-interactive"),this._fireEvent([E],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,E){if(!this._mouseHoverThrottled){for(var w,x,z=this._drawFirst;z;z=z.next)w=z.layer,w.options.interactive&&w._containsPoint(E)&&(x=w);x!==this._hoveredLayer&&(this._handleMouseOut(h),x&&(Qt(this._container,"leaflet-interactive"),this._fireEvent([x],h,"mouseover"),this._hoveredLayer=x)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,h),this._mouseHoverThrottled=!0,setTimeout(g(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,E,w){this._map._fireDOMEvent(E,w||E.type,h)},_bringToFront:function(h){var E=h._order;if(E){var w=E.next,x=E.prev;if(w)w.prev=x;else return;x?x.next=w:w&&(this._drawFirst=w),E.prev=this._drawLast,this._drawLast.next=E,E.next=null,this._drawLast=E,this._requestRedraw(h)}},_bringToBack:function(h){var E=h._order;if(E){var w=E.next,x=E.prev;if(x)x.next=w;else return;w?w.prev=x:x&&(this._drawLast=x),E.prev=null,E.next=this._drawFirst,this._drawFirst.prev=E,this._drawFirst=E,this._requestRedraw(h)}}});function Lf(h){return it.canvas?new kf(h):null}var Wl=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),$d={_initContainer:function(){this._container=Ti("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(os.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var E=h._container=Wl("shape");Qt(E,"leaflet-vml-shape "+(this.options.className||"")),E.coordsize="1 1",h._path=Wl("path"),E.appendChild(h._path),this._updateStyle(h),this._layers[T(h)]=h},_addPath:function(h){var E=h._container;this._container.appendChild(E),h.options.interactive&&h.addInteractiveTarget(E)},_removePath:function(h){var E=h._container;tn(E),h.removeInteractiveTarget(E),delete this._layers[T(h)]},_updateStyle:function(h){var E=h._stroke,w=h._fill,x=h.options,z=h._container;z.stroked=!!x.stroke,z.filled=!!x.fill,x.stroke?(E||(E=h._stroke=Wl("stroke")),z.appendChild(E),E.weight=x.weight+"px",E.color=x.color,E.opacity=x.opacity,x.dashArray?E.dashStyle=re(x.dashArray)?x.dashArray.join(" "):x.dashArray.replace(/( *, *)/g," "):E.dashStyle="",E.endcap=x.lineCap.replace("butt","flat"),E.joinstyle=x.lineJoin):E&&(z.removeChild(E),h._stroke=null),x.fill?(w||(w=h._fill=Wl("fill")),z.appendChild(w),w.color=x.fillColor||x.color,w.opacity=x.fillOpacity):w&&(z.removeChild(w),h._fill=null)},_updateCircle:function(h){var E=h._point.round(),w=Math.round(h._radius),x=Math.round(h._radiusY||w);this._setPath(h,h._empty()?"M0 0":"AL "+E.x+","+E.y+" "+w+","+x+" 0,"+65535*360)},_setPath:function(h,E){h._path.v=E},_bringToFront:function(h){ia(h._container)},_bringToBack:function(h){Pc(h._container)}},Vc=it.vml?Wl:Jo,Fc=os.extend({_initContainer:function(){this._container=Vc("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Vc("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){tn(this._container),Ki(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){os.prototype._update.call(this);var h=this._bounds,E=h.getSize(),w=this._container;(!this._svgSize||!this._svgSize.equals(E))&&(this._svgSize=E,w.setAttribute("width",E.x),w.setAttribute("height",E.y)),wn(w,h.min),w.setAttribute("viewBox",[h.min.x,h.min.y,E.x,E.y].join(" ")),this.fire("update")}},_initPath:function(h){var E=h._path=Vc("path");h.options.className&&Qt(E,h.options.className),h.options.interactive&&Qt(E,"leaflet-interactive"),this._updateStyle(h),this._layers[T(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){tn(h._path),h.removeInteractiveTarget(h._path),delete this._layers[T(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var E=h._path,w=h.options;E&&(w.stroke?(E.setAttribute("stroke",w.color),E.setAttribute("stroke-opacity",w.opacity),E.setAttribute("stroke-width",w.weight),E.setAttribute("stroke-linecap",w.lineCap),E.setAttribute("stroke-linejoin",w.lineJoin),w.dashArray?E.setAttribute("stroke-dasharray",w.dashArray):E.removeAttribute("stroke-dasharray"),w.dashOffset?E.setAttribute("stroke-dashoffset",w.dashOffset):E.removeAttribute("stroke-dashoffset")):E.setAttribute("stroke","none"),w.fill?(E.setAttribute("fill",w.fillColor||w.color),E.setAttribute("fill-opacity",w.fillOpacity),E.setAttribute("fill-rule",w.fillRule||"evenodd")):E.setAttribute("fill","none"))},_updatePoly:function(h,E){this._setPath(h,Cd(h._parts,E))},_updateCircle:function(h){var E=h._point,w=Math.max(Math.round(h._radius),1),x=Math.max(Math.round(h._radiusY),1)||w,z="a"+w+","+x+" 0 1,0 ",Q=h._empty()?"M0 0":"M"+(E.x-w)+","+E.y+z+w*2+",0 "+z+-w*2+",0 ";this._setPath(h,Q)},_setPath:function(h,E){h._path.setAttribute("d",E)},_bringToFront:function(h){ia(h._path)},_bringToBack:function(h){Pc(h._path)}});it.vml&&Fc.include($d);function fo(h){return it.svg||it.vml?new Fc(h):null}Ei.include({getRenderer:function(h){var E=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return E||(E=this._renderer=this._createRenderer()),this.hasLayer(E)||this.addLayer(E),E},_getPaneRenderer:function(h){if(h==="overlayPane"||h===void 0)return!1;var E=this._paneRenderers[h];return E===void 0&&(E=this._createRenderer({pane:h}),this._paneRenderers[h]=E),E},_createRenderer:function(h){return this.options.preferCanvas&&Lf(h)||fo(h)}});var zh=rs.extend({initialize:function(h,E){rs.prototype.initialize.call(this,this._boundsToLatLngs(h),E)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return h=Ot(h),[h.getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});function Mf(h,E){return new zh(h,E)}Fc.create=Vc,Fc.pointsToPath=Cd,As.geometryToLayer=Bd,As.coordsToLatLng=Wd,As.coordsToLatLngs=Vl,As.latLngToCoords=_r,As.latLngsToCoords=zd,As.getFeature=Lc,As.asFeature=Hd,Ei.mergeOptions({boxZoom:!0});var Bc=ts.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){Gt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ki(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){tn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||h.which!==1&&h.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Ga(),Th(),this._startPoint=this._map.mouseEventToContainerPoint(h),Gt(document,{contextmenu:Ya,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=Ti("div","leaflet-zoom-box",this._container),Qt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var E=new pt(this._point,this._startPoint),w=E.getSize();wn(this._box,E.min),this._box.style.width=w.x+"px",this._box.style.height=w.y+"px"},_finish:function(){this._moved&&(tn(this._box),Mt(this._container,"leaflet-crosshair")),es(),Dd(),Ki(document,{contextmenu:Ya,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if(!(h.which!==1&&h.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(g(this._resetState,this),0);var E=new yi(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(E).fire("boxzoomend",{boxZoomBounds:E})}},_onKeyDown:function(h){h.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ei.addInitHook("addHandler","boxZoom",Bc),Ei.mergeOptions({doubleClickZoom:!0});var aa=ts.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var E=this._map,w=E.getZoom(),x=E.options.zoomDelta,z=h.originalEvent.shiftKey?w-x:w+x;E.options.doubleClickZoom==="center"?E.setZoom(z):E.setZoomAround(h.containerPoint,z)}});Ei.addInitHook("addHandler","doubleClickZoom",aa),Ei.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Uf=ts.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new ko(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}Qt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Mt(this._map._container,"leaflet-grab"),Mt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var E=Ot(this._map.options.maxBounds);this._offsetLimit=St(this._map.latLngToContainerPoint(E.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(E.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var E=this._lastTime=+new Date,w=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(w),this._times.push(E),this._prunePositions(E)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),E=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=E.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,E){return h-(h-E)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var h=this._draggable._newPos.subtract(this._draggable._startPos),E=this._offsetLimit;h.x<E.min.x&&(h.x=this._viscousLimit(h.x,E.min.x)),h.y<E.min.y&&(h.y=this._viscousLimit(h.y,E.min.y)),h.x>E.max.x&&(h.x=this._viscousLimit(h.x,E.max.x)),h.y>E.max.y&&(h.y=this._viscousLimit(h.y,E.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,E=Math.round(h/2),w=this._initialWorldOffset,x=this._draggable._newPos.x,z=(x-E+w)%h+E-w,Q=(x+E+w)%h-E-w,ue=Math.abs(z+w)<Math.abs(Q+w)?z:Q;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=ue},_onDragEnd:function(h){var E=this._map,w=E.options,x=!w.inertia||h.noInertia||this._times.length<2;if(E.fire("dragend",h),x)E.fire("moveend");else{this._prunePositions(+new Date);var z=this._lastPos.subtract(this._positions[0]),Q=(this._lastTime-this._times[0])/1e3,ue=w.easeLinearity,we=z.multiplyBy(ue/Q),Ae=we.distanceTo([0,0]),Ke=Math.min(w.inertiaMaxSpeed,Ae),nt=we.multiplyBy(Ke/Ae),Pt=Ke/(w.inertiaDeceleration*ue),Nt=nt.multiplyBy(-Pt/2).round();!Nt.x&&!Nt.y?E.fire("moveend"):(Nt=E._limitOffset(Nt,E.options.maxBounds),st(function(){E.panBy(Nt,{duration:Pt,easeLinearity:ue,noMoveStart:!0,animate:!0})}))}}});Ei.addInitHook("addHandler","dragging",Uf),Ei.mergeOptions({keyboard:!0,keyboardPanDelta:80});var jf=ts.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),Gt(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ki(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,E=document.documentElement,w=h.scrollTop||E.scrollTop,x=h.scrollLeft||E.scrollLeft;this._map._container.focus(),window.scrollTo(x,w)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var E=this._panKeys={},w=this.keyCodes,x,z;for(x=0,z=w.left.length;x<z;x++)E[w.left[x]]=[-1*h,0];for(x=0,z=w.right.length;x<z;x++)E[w.right[x]]=[h,0];for(x=0,z=w.down.length;x<z;x++)E[w.down[x]]=[0,h];for(x=0,z=w.up.length;x<z;x++)E[w.up[x]]=[0,-1*h]},_setZoomDelta:function(h){var E=this._zoomKeys={},w=this.keyCodes,x,z;for(x=0,z=w.zoomIn.length;x<z;x++)E[w.zoomIn[x]]=h;for(x=0,z=w.zoomOut.length;x<z;x++)E[w.zoomOut[x]]=-h},_addHooks:function(){Gt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ki(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var E=h.keyCode,w=this._map,x;if(E in this._panKeys){if(!w._panAnim||!w._panAnim._inProgress)if(x=this._panKeys[E],h.shiftKey&&(x=Ie(x).multiplyBy(3)),w.options.maxBounds&&(x=w._limitOffset(Ie(x),w.options.maxBounds)),w.options.worldCopyJump){var z=w.wrapLatLng(w.unproject(w.project(w.getCenter()).add(x)));w.panTo(z)}else w.panBy(x)}else if(E in this._zoomKeys)w.setZoom(w.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[E]);else if(E===27&&w._popup&&w._popup.options.closeOnEscapeKey)w.closePopup();else return;Ya(h)}}});Ei.addInitHook("addHandler","keyboard",jf),Ei.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Hh=ts.extend({addHooks:function(){Gt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ki(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var E=br(h),w=this._map.options.wheelDebounceTime;this._delta+=E,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var x=Math.max(w-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(g(this._performZoom,this),x),Ya(h)},_performZoom:function(){var h=this._map,E=h.getZoom(),w=this._map.options.zoomSnap||0;h._stop();var x=this._delta/(this._map.options.wheelPxPerZoomLevel*4),z=4*Math.log(2/(1+Math.exp(-Math.abs(x))))/Math.LN2,Q=w?Math.ceil(z/w)*w:z,ue=h._limitZoom(E+(this._delta>0?Q:-Q))-E;this._delta=0,this._startTime=null,ue&&(h.options.scrollWheelZoom==="center"?h.setZoom(E+ue):h.setZoomAround(this._lastMousePos,E+ue))}});Ei.addInitHook("addHandler","scrollWheelZoom",Hh);var Gh=600;Ei.mergeOptions({tapHold:it.touchNative&&it.safari&&it.mobile,tapTolerance:15});var Kh=ts.extend({addHooks:function(){Gt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ki(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),h.touches.length===1){var E=h.touches[0];this._startPos=this._newPos=new Ue(E.clientX,E.clientY),this._holdTimeout=setTimeout(g(function(){this._cancel(),this._isTapValid()&&(Gt(document,"touchend",er),Gt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",E))},this),Gh),Gt(document,"touchend touchcancel contextmenu",this._cancel,this),Gt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){Ki(document,"touchend",er),Ki(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),Ki(document,"touchend touchcancel contextmenu",this._cancel,this),Ki(document,"touchmove",this._onMove,this)},_onMove:function(h){var E=h.touches[0];this._newPos=new Ue(E.clientX,E.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,E){var w=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:E.screenX,screenY:E.screenY,clientX:E.clientX,clientY:E.clientY});w._simulated=!0,E.target.dispatchEvent(w)}});Ei.addInitHook("addHandler","tapHold",Kh),Ei.mergeOptions({touchZoom:it.touch,bounceAtZoomLimits:!0});var qh=ts.extend({addHooks:function(){Qt(this._map._container,"leaflet-touch-zoom"),Gt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Mt(this._map._container,"leaflet-touch-zoom"),Ki(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var E=this._map;if(!(!h.touches||h.touches.length!==2||E._animatingZoom||this._zooming)){var w=E.mouseEventToContainerPoint(h.touches[0]),x=E.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=E.getSize()._divideBy(2),this._startLatLng=E.containerPointToLatLng(this._centerPoint),E.options.touchZoom!=="center"&&(this._pinchStartLatLng=E.containerPointToLatLng(w.add(x)._divideBy(2))),this._startDist=w.distanceTo(x),this._startZoom=E.getZoom(),this._moved=!1,this._zooming=!0,E._stop(),Gt(document,"touchmove",this._onTouchMove,this),Gt(document,"touchend touchcancel",this._onTouchEnd,this),er(h)}},_onTouchMove:function(h){if(!(!h.touches||h.touches.length!==2||!this._zooming)){var E=this._map,w=E.mouseEventToContainerPoint(h.touches[0]),x=E.mouseEventToContainerPoint(h.touches[1]),z=w.distanceTo(x)/this._startDist;if(this._zoom=E.getScaleZoom(z,this._startZoom),!E.options.bounceAtZoomLimits&&(this._zoom<E.getMinZoom()&&z<1||this._zoom>E.getMaxZoom()&&z>1)&&(this._zoom=E._limitZoom(this._zoom)),E.options.touchZoom==="center"){if(this._center=this._startLatLng,z===1)return}else{var Q=w._add(x)._divideBy(2)._subtract(this._centerPoint);if(z===1&&Q.x===0&&Q.y===0)return;this._center=E.unproject(E.project(this._pinchStartLatLng,this._zoom).subtract(Q),this._zoom)}this._moved||(E._moveStart(!0,!1),this._moved=!0),ut(this._animRequest);var ue=g(E._move,E,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=st(ue,this,!0),er(h)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,ut(this._animRequest),Ki(document,"touchmove",this._onTouchMove,this),Ki(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ei.addInitHook("addHandler","touchZoom",qh),Ei.BoxZoom=Bc,Ei.DoubleClickZoom=aa,Ei.Drag=Uf,Ei.Keyboard=jf,Ei.ScrollWheelZoom=Hh,Ei.TapHold=Kh,Ei.TouchZoom=qh,s.Bounds=pt,s.Browser=it,s.CRS=vt,s.Canvas=kf,s.Circle=jl,s.CircleMarker=Ul,s.Class=gt,s.Control=Do,s.DivIcon=Nf,s.DivOverlay=po,s.DomEvent=Xg,s.DomUtil=Ef,s.Draggable=ko,s.Evented=Lt,s.FeatureGroup=Mo,s.GeoJSON=As,s.GridLayer=Mc,s.Handler=ts,s.Icon=ec,s.ImageOverlay=Fl,s.LatLng=ge,s.LatLngBounds=yi,s.Layer=Lo,s.LayerGroup=Dc,s.LineUtil=Lh,s.Map=Ei,s.Marker=Vd,s.Mixin=Zg,s.Path=is,s.Point=Ue,s.PolyUtil=oa,s.Polygon=rs,s.Polyline=ns,s.Popup=qd,s.PosAnimation=yf,s.Projection=Ll,s.Rectangle=zh,s.Renderer=os,s.SVG=Fc,s.SVGOverlay=Pf,s.TileLayer=Uc,s.Tooltip=Yd,s.Transformation=gn,s.Util=Ni,s.VideoOverlay=Kd,s.bind=g,s.bounds=St,s.canvas=Lf,s.circle=Fd,s.circleMarker=Af,s.control=Nl,s.divIcon=o_,s.extend=d,s.featureGroup=Vh,s.geoJSON=Gd,s.geoJson=i_,s.gridLayer=xf,s.icon=Zr,s.imageOverlay=n_,s.latLng=lt,s.latLngBounds=Ot,s.layerGroup=jh,s.map=gr,s.marker=If,s.point=Ie,s.polygon=kc,s.polyline=Of,s.popup=ke,s.rectangle=Mf,s.setOptions=Y,s.stamp=T,s.svg=fo,s.svgOverlay=Wh,s.tileLayer=Df,s.tooltip=r_,s.transformation=Tn,s.version=c,s.videoOverlay=Bh;var Yh=window.L;s.noConflict=function(){return window.L=Yh,this},window.L=s})})(pP,pP.exports);var Jv=pP.exports;const Pfe=Vv(Jv);function HN(n,r,s){return Object.freeze({instance:n,context:r,container:s})}function GN(n,r){return r==null?function(c,d){const p=le.useRef();return p.current||(p.current=n(c,d)),p}:function(c,d){const p=le.useRef();p.current||(p.current=n(c,d));const g=le.useRef(c),{instance:y}=p.current;return le.useEffect(function(){g.current!==c&&(r(y,c,g.current),g.current=c)},[y,c,d]),p}}function Nfe(n,r){le.useEffect(function(){return(r.layerContainer??r.map).addLayer(n.instance),function(){var p;(p=r.layerContainer)==null||p.removeLayer(n.instance),r.map.removeLayer(n.instance)}},[r,n])}function HG(n){return function(s){const c=WN(),d=n(zN(s,c),c);return FG(c.map,s.attribution),zG(d.current,s.eventHandlers),Nfe(d.current,c),d}}function xfe(n,r){const s=GN(n,r),c=HG(s);return Rfe(c)}function Dfe(n,r){const s=GN(n),c=Ofe(s,r);return Ife(c)}function kfe(n,r){const s=GN(n,r),c=HG(s);return Afe(c)}function Lfe(n,r,s){const{opacity:c,zIndex:d}=r;c!=null&&c!==s.opacity&&n.setOpacity(c),d!=null&&d!==s.zIndex&&n.setZIndex(d)}function Mfe(){return WN().map}function fP(){return fP=Object.assign||function(n){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(n[c]=s[c])}return n},fP.apply(this,arguments)}function Ufe({bounds:n,boundsOptions:r,center:s,children:c,className:d,id:p,placeholder:g,style:y,whenReady:T,zoom:R,...N},D){const[B]=le.useState({className:d,id:p,style:y}),[q,J]=le.useState(null);le.useImperativeHandle(D,()=>(q==null?void 0:q.map)??null,[q]);const Y=le.useCallback(Z=>{if(Z!==null&&q===null){const ee=new Jv.Map(Z,N);s!=null&&R!=null?ee.setView(s,R):n!=null&&ee.fitBounds(n,r),T!=null&&ee.whenReady(T),J(Cfe(ee))}},[]);le.useEffect(()=>()=>{q==null||q.map.remove()},[q]);const te=q?oo.createElement(WG,{value:q},c):g??null;return oo.createElement("div",fP({},B,{ref:Y}),te)}const jfe=le.forwardRef(Ufe),Vfe=xfe(function({position:r,...s},c){const d=new Jv.Marker(r,s);return HN(d,bfe(c,{overlayContainer:d}))},function(r,s,c){s.position!==c.position&&r.setLatLng(s.position),s.icon!=null&&s.icon!==c.icon&&r.setIcon(s.icon),s.zIndexOffset!=null&&s.zIndexOffset!==c.zIndexOffset&&r.setZIndexOffset(s.zIndexOffset),s.opacity!=null&&s.opacity!==c.opacity&&r.setOpacity(s.opacity),r.dragging!=null&&s.draggable!==c.draggable&&(s.draggable===!0?r.dragging.enable():r.dragging.disable())}),Ffe=Dfe(function(r,s){const c=new Jv.Popup(r,s.overlayContainer);return HN(c,s)},function(r,s,{position:c},d){le.useEffect(function(){const{instance:g}=r;function y(R){R.popup===g&&(g.update(),d(!0))}function T(R){R.popup===g&&d(!1)}return s.map.on({popupopen:y,popupclose:T}),s.overlayContainer==null?(c!=null&&g.setLatLng(c),g.openOn(s.map)):s.overlayContainer.bindPopup(g),function(){var N;s.map.off({popupopen:y,popupclose:T}),(N=s.overlayContainer)==null||N.unbindPopup(),s.map.removeLayer(g)}},[r,s,d,c])}),Bfe=kfe(function({url:r,...s},c){const d=new Jv.TileLayer(r,zN(s,c));return HN(d,c)},function(r,s,c){Lfe(r,s,c);const{url:d}=s;d!=null&&d!==c.url&&r.setUrl(d)}),Wfe="/assets/markershadow-e9f8fd42.png",zfe="/assets/marker1-19938355.png",Hfe="/assets/marker2-876cee13.png",Gfe=({pin:n,country:r,localidad:s})=>{const c={"Mancha Bacteriana":zfe,"Tizon Temprano":Hfe},[d,p]=le.useState(null);return le.useEffect(()=>{const y=new Pfe.icon({iconUrl:c[n.enfermedad],iconSize:[26.4,35.943599999999996],shadowUrl:Wfe,shadowSize:[34,35],iconAnchor:[13.2,33.943599999999996],popupAnchor:[0,-32.349239999999995]});p(y)},[]),d?O.jsx(Vfe,{position:n.coordenadas,icon:d,children:O.jsx(Ffe,{children:O.jsx(Kfe,{children:O.jsxs("tbody",{children:[O.jsxs("tr",{children:[O.jsx("th",{children:"Pas"}),O.jsx("td",{children:r})]}),O.jsxs("tr",{children:[O.jsx("th",{children:"Localidad"}),O.jsx("td",{children:s})]}),O.jsxs("tr",{children:[O.jsx("th",{children:"Enfermedad"}),O.jsx("td",{children:n.enfermedad})]}),O.jsxs("tr",{children:[O.jsx("th",{children:"Fecha"}),O.jsx("td",{children:n.fecha})]})]})})})}):O.jsx(O.Fragment,{})},Kfe=be.table`
  table-layout: fixed;
  border-collapse: collapse;
  & th, & td {
    border: 1px solid ${de.primary600};
    padding: 2px 5px;
  }
  & th {
    background-color: ${de.primary400};
    color: ${de.white};
  }
  & td {
    background-color: ${de.primary300};
  }
`,qfe=({localidad:n})=>{const r=Mfe();return le.useEffect(()=>{const s=n.pines.map(c=>c.coordenadas);r.fitBounds(s),r.setZoom(14)},[n]),null},Yfe=({localidad:n,country:r})=>O.jsxs(jfe,{zoom:14,scrollWheelZoom:!0,children:[O.jsx(qfe,{localidad:n}),O.jsx(Bfe,{attribution:' <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),n.pines.filter(s=>s.enfermedad!=="Tomate Sano").map((s,c)=>O.jsx(Gfe,{pin:s,country:r,localidad:n.nombre},c))]}),$fe=()=>{const[n,r]=le.useState(!0),[s,c]=le.useState(null),[d,p]=le.useState(null),[g,y]=le.useState(!1);return Xo(de.primary500),O.jsx(Xfe,{children:O.jsxs(Jfe,{children:[d&&O.jsx(Yfe,{country:s.pais,localidad:d}),O.jsxs(Zfe,{open:n,children:[O.jsx(Qfe,{onClick:()=>r(!1),open:n}),O.jsxs(eme,{selected:g,open:n,children:[O.jsx(tme,{onClick:()=>r(!n),children:O.jsx("i",{className:`fa-solid fa-chevron-${n?"right":"left"}`})}),g?O.jsx(Efe,{country:s,localidad:d,handleBack:()=>y(!1)}):O.jsx(Sfe,{country:s,localidad:d,setCountry:c,setLocalidad:p,handleViewMap:()=>y(!0)})]})]})]})})},Xfe=be.section`
  height: calc(100dvh - 32px);
  padding: 85px 140px 0;
  display: flex;
  justify-content: space-around;
  align-items: center;

  @media screen and (max-width: 750px) {
    padding: 85px 0 0;
  }
`,Jfe=be.div`
  width: 100%;
  height: 90%;
  overflow: hidden;
  position: relative;
  border: 8px solid ${de.primary400};
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.3);

  & > div:first-child {
    height: 100%;
    width: 100%;
  }
`,Zfe=be.div`
  z-index: 1000;
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: end;
  pointer-events: ${n=>!n.open&&"none"};
`,Qfe=be.div`
  background-color: ${n=>n.open?"rgba(0, 0, 0, 0.3)":"transparent"};
  transition: all 0.5s;
  position: absolute;
  inset: 0;
`,eme=be.div`
  width: 100%;
  border-left: 4px solid ${de.primary400};
  background-color: ${de.primary200};
  transform: translateX(${n=>n.selected?n.open?"calc(100% - 400px)":"100%":"-4px"});
  transition: transform 0.5s ease;
  position: relative;
  padding-right: ${n=>n.selected&&"calc(100% - 400px)"};
  
  @media screen and (max-width: 470px) {
    width: 100%;
    transform: translateX(${n=>n.selected?n.open?"50px":"100%":"-4px"});
    padding-right: ${n=>n.selected&&"50px"};
  }
`,tme=be.button`
  position: absolute;
  z-index: 1000;
  top: 20%;
  background-color: ${de.primary500};
  border: none;
  left: -40px;
  transition: all 0.5s ease;
  width: 40px;
  height: 80px;
  border-radius: 20px 0 0 20px;
  cursor: pointer;
  font-size: 20px;
  color: ${de.primary200};
  pointer-events: all;
`,ime=()=>O.jsx(nme,{children:O.jsxs("p",{children:["Desarrollado con  para una mejor alimentacin",O.jsx("span",{children:" | TecnPolis.Ai Deep Learning Projects"})]})}),nme=be.div`
  height: 32px !important;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: .8rem;
  width: 100%;
  position: sticky;
  bottom: 0;
  background-color: ${de.primary600};
  color: ${de.white};

  @media screen and (max-width: 670px) {
    & span {
      display: none;
    }
  }
`,rme="/assets/1-a52d65c4.png",ome="/assets/2-68212ef2.png",sme="/assets/3-41cfa508.png",ame="/assets/4-2d6dad45.png",cme="/assets/5-8d6f68b5.png",lme="/assets/6-2e444ae3.png",dme=()=>{Xo(de.primary500);const n=[{text:"Ingresar a Analizar Imagen",img:rme},{text:"Seleccionar una foto JPG",img:ome},{text:"Click al botn 'Subir foto'",img:sme},{text:"Revisar el diagnstico",img:ame},{text:"Observar un ejemplo de la enfermedad",img:lme},{text:"Revisar los sntomas, prevencin y tratamiento",img:cme}];return O.jsx(ume,{children:O.jsx(hme,{children:O.jsx(Q6,{data:n,component:(r,s)=>O.jsxs(pme,{children:[O.jsx("img",{src:r.img}),O.jsxs("div",{className:"paso",children:[O.jsxs("h3",{children:["Paso ",s+1]}),O.jsx("p",{children:r.text})]})]}),borderWidth:8,borderColor:de.primary400})})})},ume=be.section`
  height: calc(100dvh - 32px);
  padding: 145px 140px 60px;
  display: flex;
  justify-content: center;
  gap: 270px;
  align-items: center;

  @media screen and (max-width: 870px) {
    padding: 145px 40px 60px;
  }
`,hme=be.div`
  width: 100%;
  aspect-ratio: 1.573 / 1; /* 1290 820 */
  max-width: 916px;

  @media screen and (max-width: 700px) {
    margin-bottom: 160px;
  }
`,pme=be.div`
  & > img {
    width: 100%;
    height: 100%;
  }

  & > .paso {
    position: absolute;
    right: 5%;
    bottom: 10%;
    padding: 16px 24px;
    width: 250px;
    background-color: ${de.tertiary500opacity};
    display: flex;
    flex-direction: column;
    gap: 8px;
    backdrop-filter: blur(4px);

    @media screen and (max-width: 700px) {
      bottom: -130px;
      right: 50%;
      transform: translateX(50%);
    }

    & > h3 {
      font-size: 1.2rem;
      font-weight: 600;
      font-family: 'Chillax';
      color: ${de.white};
    }
    & > p {
      font-size: .9rem;
      color: ${de.white};
      opacity: 0.8;
    }
  }
`;be.div`
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 6px 0;
  background-color: ${de.primary500opacity};
  backdrop-filter: blur(4px);
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 4px;
`;be.button`
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: none;
  border: 2px solid ${de.white};
  background-color: ${n=>n.active&&de.primary500};
  cursor: pointer;
  transition: background-color 1s;
`;const fme=()=>{const n=Tl();Xo(de.primary500);const{user:r,setUser:s}=$s(),[c,d]=le.useState({email:"",password:""}),p=async y=>{y.preventDefault();const T=await n("login",c);if(T){if(T.error){Oo.fire({title:"Error",text:T.error,icon:"error"});return}Oo.fire({title:"xito!",text:"Inicio de sesin correcto",icon:"success"}),s(T.usuario),Qce(T.token),d({email:"",password:""});return}},g=()=>{s(null),bN(),Oo.fire({title:"xito!",text:"Cierre de sesin correcto",icon:"success"})};return O.jsx(mme,{children:r?O.jsxs(gme,{children:[O.jsxs("h2",{children:["Bienvenido ",r.nombre,"!"]}),O.jsxs("p",{children:["Muchas gracias por utilizar ",O.jsx("b",{children:"Doctor Tomatto"}),", disfrute de las funcionalidades que le ofrecemos"]}),O.jsxs("div",{children:[r.rol.includes("a")&&O.jsx(Qp,{to:"/analizar",children:"Analice sus hojas de tomate"}),r.rol.includes("m")&&O.jsx(Qp,{to:"/mapa",children:"Vea el mapa de enfermedades"})]}),O.jsx(Gi,{onClick:g,type:"secondary",children:"Cierre sesin"})]}):O.jsxs(_me,{children:[O.jsx("div",{children:O.jsx(vme,{src:wN})}),O.jsx(fn,{error:!1,text:"Email",value:c.email,onChange:y=>d(T=>({...T,email:y.target.value}))}),O.jsx(fn,{error:!1,text:"Contrasea",value:c.password,onChange:y=>d(T=>({...T,password:y.target.value})),type:"password"}),O.jsx(Gi,{type:"secondary",onClick:p,children:"Inicie sesin"}),O.jsxs("p",{children:["An no tiene cuenta?"," ",O.jsx(Eme,{to:"/register",children:"Regstrese"})]})]})})},mme=be.section`
  min-height: calc(100dvh - 32px);
  padding: 100px 40px 65px;
  display: flex;
  justify-content: space-evenly;
  align-items: center;
`,gme=be.div`
  padding: 40px;
  width: 360px;
  background-color: ${de.primary200};
  border: 8px solid ${de.primary400};
  box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.3);
  gap: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;

  & > div {
    display: flex;
    flex-direction: column;
  }

  & > h2 {
    font-size: 18px;
    font-weight: 700;
    color: ${de.primary500};
    text-align: center;
  }

  & > p {
    font-size: 14px;
    text-align: center;
    line-height: 24px;
    & > b {
      color: ${de.primary500};
    }
  }

  & > div {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  & a {
    color: ${de.tertiary300};
    transition: color 0.3s;
    text-align: center;
    &:hover {
      color: ${de.tertiary600};
    }
  }
`,_me=be.form`
  padding: 40px;
  background-color: ${de.primary200};
  border: 8px solid ${de.primary400};
  box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.3);
  gap: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;

  & > div {
    display: flex;
    flex-direction: column;
  }

  & > h2 {
    font-size: 18px;
    font-weight: 700;
    color: ${de.primary500};
  }

  & > p {
    font-size: 14px;
    text-align: center;
  }
`,Eme=be(Qp)`
  color: ${de.primary500};
  text-decoration: none;
  transition: all 0.3s;

  &:hover {
    opacity: 0.7;
  }
`,vme=be.img`
  width: 100px;
`,yme="/assets/analizar-0a7ad757.png",Sme="/assets/mapa-4d9c62af.png",Tme="/assets/combo-db1b3bbf.png",Ug=[{id:"a",disables:["am"],name:"Analizar imagen",description:"Analice fotos de su hoja de tomate segn su enfermedad o plaga y reciba informacin acerca de sus sntomas, prevenciones y tratamiento adecuados.",precio:2,img:yme},{id:"m",disables:["am"],name:"Mapa enfermedades",description:"Reciba informacin geoespacial, grficos detallados y reportes de enfermedades cercanas a su rea de cultivo.",precio:4,img:Sme},{id:"am",disables:["a","m"],name:"Analizar imagen + Mapa enfermedades",description:"Analice fotos de su hoja de tomate, reciba recomendaciones, informacin geoespacial, grficos detallados y reportes de enfermedades cercanas a su rea de cultivo.",precio:5,img:Tme}],GG=({text:n="Seleccione los productos que desea adquirir",icon:r,type:s="primary"})=>O.jsxs(wme,{other:!!r,children:[O.jsx(Cme,{type:s,children:r?O.jsx("i",{className:r}):O.jsxs(O.Fragment,{children:[O.jsx("i",{className:"move fa-regular fa-square"}),O.jsx("i",{className:"dontmove fa-solid fa-hand-pointer"})]})}),O.jsx("p",{children:n})]}),wme=be.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: ${n=>n.other?"8px":"5rem"};

  & > p {
    max-width: 60%;
    text-align: center;
    color: ${de.gray500};
    font-size: 1rem;
  }
`,Cme=be.div`
  position: relative;
  font-size: 10rem;
  color: ${n=>n.type==="primary"?de.pastel3:de.tertiary400};

  & > .move {
    animation: move 5s linear infinite;

    @keyframes move {
      0% {
        transform: translateX(-.5rem);
      }
      50% {
        transform: translateX(.5rem);
      }
      100% {
        transform: translateX(-.5rem);
      }
    }
  }

  & > .move {
    opacity: 0.7;
  }

  & > .dontmove {
    position: absolute;
    top: 45%;
    left: 20%;
  }
`;be.div`
  width: 450px;
  padding: 24px 48px;
  display: flex;
  flex-direction: column;
  gap: 24px;
  overflow: auto;
  & > h2 {
    font-size: 1.4rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }
`;be.div`
  display: flex;
  align-items: center;
  flex-direction: column;
  gap: 16px;
  & > .img-container {
    width: 150px;
    height: 80px;
  }
  & > b {
    color: ${de.primary500};
    text-align: center;
  }
  & > .description {
    font-size: 0.9rem;
    opacity: 0.8;
    text-align: justify;
  }
  & > .total {
    color: ${de.primary500};
  }
`;be.div`
  display: flex;
  align-self: center;
  gap: 20px;
`;const bme="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAZtQTFRFAAAAyMjIoaGhfX19WlpaYFJOhFpP1nddqWZUgFlPVFRUbW1tj4+PuLi4iYmJh1tP9IRma2trsbGxlpaWsWhVZ2dneXl5alROxMTEnZ2dzc3NzXNbhoaGnJycfFhOvb29oqKi6n9jmZmZo6Ojs7Oz4HtgyHFazs7OqKio0XVcw29Z5H1hurq67oJkwMDAkpKSdVZOblVObGxsk5OTxcXFoKCgU1NTv7+/lF9QY1NOg4ODj11QwsLCmpqan5+fnp6em5ubl5eXpKSky8vLra2tpqamtra2gYGBU1BQZWVlycnJtmpWrKysXV1drq6uX19fpaWlkJCQumxXh4eHaGhoZmZmpGRTcXFxYWFhZGRkb29vYGBg23lftLS0WFhYXl5eampqWVFPWVlZY2NjaWlprWdUV1dXsLCwgICAlZWVYmJiqampeFdOgoKCp6enZ1NOXFxcUVFRXFFPVlZWVVVVUlJSW1tbvLy8oGNSfn5+srKyenp6cVVOzMzMvr6+dXV1UFBQr6+vioqKiIiIhYWFbm5uvm1YdnZ2tbW1z8HGdwAAAIl0Uk5TAC3//////////////5P/////wP//////R/8N/////3P/////s///B/n///+G/2D//////0D//2b/////U////////xrZ/6D///8n/+D/0///////////////////rf///////////8b////z//////////////96//+5//8Ubf//zf///////6apnRwbAAAL/klEQVR4nO3dCYMcZRHG8RGICYlAA0KMim4WgYgKEiEElLCACFFOFUVRUNCgBgEP8D7A82O7h7tsNjPTVz1dVVP/3wdI3urqo553emdmMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMPvQFVdedejDh49cffTYR67xXgwmdu11zQHX3+C9Jkzlxo8e7P6Om7wXhincPL/7245/zHt1EDuxpP3bp4D3AqH08U+09H/TJ70XCZlb2tu/6VPey4TI0U793/Rp75VC4UjX/jfNmvdaYe9k9/43zbr3amHtcJ/+N82t3uuFrV7X/5bPeK8Ylvq2f5P3kmHotgEnwO3ei4aZAe3fdLP3smFkWP+b5g7vhcPEkPv/tqu9Vw4LQ9u/6ZT32jHeZ0ecAHd6Lx6jfW5E/5vm897Lx0ij2t80h7zXj3EGz3+7vAvAKF8Y238+FEptdPtJgqmNm//+z7sIDNbz898F7vIuAwOZtL9p7vauA8P0/vx/Af5YJCej9jfNF70rwRDj898e71IwgNX9nxMgJ8P2cwIkZNp/ToB0DJ//nAAJjf78hxMgNeP2Nye9C0Iv1v1v7vGuCH2YfP5zidPeJaEH8/Y3zZe8a0J3gv4393oXhc4s9//2eBeFzhTt5zuj8hjz/v9i93mXhY7s5/9t3mWhI037mzPedaEb6/3fXfd7F4ZOjD//2XPWuzB0Imp/0/At8imI5r+mecC7MnRh8/7/PN6VoQtZ+5sHvUtDB7L7f/Nl79LQgaz9PABSUOX/TV/xrg3tVPl/Ez8hlYCu/c0t3rWhnW7+o/8ZCO//D3nXhnbC+e+cd21oJ7z+T3jXhna69jcPe9eGdsL7/4Z3bWgnnP8f8a4N7XTtb67wrg3thNc/818Cwvl/w7s2tBPOf1z/CQivf/JfArr20/8MuP/XRv6vTdd+8n8G5P/ahPM/738kIJz/mP8T4PP/2nTtp/8ZkP9rI//Xpms/+T8D8n9t5P/ayP+1kf9r07Wf/mdA/q+N/F+brv3k/wzI/7WR/2sj/9dG/q9N1376nwH5vzbyf2269pP/MyD/10b+r438Xxv5vzZd++l/BuT/2sj/tenaT/7PgPxfG/m/NvJ/beT/2nTtp/8ZkP9rI//Xpms/+T8D8n9t5P/ayP+1kf9r07Wf/mdA/q+N/F+brv3k/wzI/7WR/2sj/9dG/q9N1376nwH5vzbyf2269pP/MyD/10b+r438Xxv5vzZd++l/BuT/2sj/tenaT/7PgPxfG/m/NvJ/beT/2nTtp/8ZkP9rI//Xpms/+T8D8n9t5P/ayP+1kf9r07Wf/mdA/q+N/F+brv3k/wzI/7UJ5/8179rQTjj/PepdG9oJr3/2fxLQtb+5z7s2tCP/10b+r03XfvJ/BuT/2sj/tZH/ayP/16ZrP/k/A/J/beT/2nTtJ/9nQP6vjfxfG/m/NvJ/bbr2k/8zIP/XRv6vTdd+8n8G5P/amP9rE85/zP8JCPu/4V0b2unan+L6f+yrG3dfu/7417zX4abw/u+9Tzy5f7mHz1ccWHXtD/79T18/PW/N39jwXtfEhP0Pff0/dWThup/2XtuUTur6v+Fd2xLPLF/6s97rm4yu/c1z3rUtcbx19c97L3Eawv2/x71rW2yjy/rv9F7lFIT93/CubbEzHUs45b1QOV37I89/3+xcxLe8lyomvP4f8q5tsT5lfNt7sVLC+T/w5//9CnnBe7lCmtZvC/z5/+GepazuGVDz8//v9C5mVZ8Cgr7vCpz/vjugnBe9Fy3R907Yw63etS12zaCCVvEpUPT934Elfc973eZMO36pyPu/3x9a1Ko9BYTX/43etS3x2PCyjnmv3ZTw/c/A+W82e2FEYS95L96QWbcvF/v931Glrc4k+AOjZs8R+/2/wRPAjpu812/EptVzBc7/W8aWd967ABPC/B/6+T+b/XB0gaswBxTN/1teHl/iK941jDb+GCwU/P5vU3v2M0B4/a9719bKpMzcO0Klf//5hE2hP/KuYwSbIzBX4Pe/do0MgXvy7gcI7//xr//Z7MdWxWZ9Cgj3f9a8a+vidrNyr/cuZRDh8z/8/L/NsOCMfzhW8/2v/SxLftW7mN4sqz8g+P7fHtOis+0KC6//c961dWVbdq5JUPj83/CurTPjwl/zrqcH49L3S/L832Jd+k+8C+pMeP0n2P/Z81Pr4rN8LlD1/a+DLpiXn2MOKPz9T5e60v4AZJgDhNd/mvl/x+uCQxD/KSAoelfs9//mUByE6GdA4fd/Lif5MCT2GcD3/+/3M8mBiDwHSArekWr+36U5FHHfD+DznwNEL0RHfQoI5/+c/Z/9XHQ4Yj4FhPNf4L//X051QH7hXdgcxd//mu9B1SGJtyeoqnTTRe/aRpAdlGhnANf/fA/LDkusOUA4/wX+/scu3pAdmEifDsuKjP39L53oDk2c/QDu/0uM/xPhhaLMAcL3/5N9/jfXL3WHJ8ZTQPj8X40vT5/7M0E2InybXM3v/+6l/bdCBvPfEdLV1rzpXZuZt3QHyftzAa7/Tsz+TvRyb7sWVvP7/wf4le5AeaZBXVU5P/9f4gHdofI7A/j8v4df6w6W1xzA+/+9CM8Anx0h3v/vSTgJenwyxPv/vQn3A6Z/Cuhqyff+f2crNAfw/v8gwqfAtGcA7/8PJNwTnHIO0FWxkvP/fsJ7wHT7AeT/EVZgDiD/j5J+P4D8P1Ly/QDy/2ip9wN0a1/h/H9Q4jmA/G8i7X4A+d9I0v0A3apLzP/7pdwPIP8bSvgUEM7/a6IlRyY8AzT7AeR/Y8n2A8j/5lLtB+jWWm7++0Ci/QDh/T/2739rpZkEmf9FkuwH6FZZ+vrfkmI/QHj919n/XyTBU4D8LxV+P0A4/+X4/T+14PsBpX//eRqh/3pct7a83/9pLvAcQP6fRNgzgPw/EeFfj4+ZA3Sr4vo/4IzuUA/fDyD/T+g3uoM99ClA/p+U/c8M7hm2H0D+n9hR3QEfMgeQ/yf3W90h7/8U0K2F/L/QO7qD3vcMIP+7ED4F+p0B5H8nwizQZw7QrYLrv4XwHtB9P4D87yjAfgD535X7fgD535nzHED+d/eyrgXtTwHd/03+70z4yVDbGUD+D0E4Byw/A8j/QTh9LqD7X7n+exJOgov3A8j/gTjsB5D/Q5l8P4D8H4wwDc6bA8j/4Uz6FND9X+T/wSZ8Q4T8H9Jk9wDyf1DCe8D+OUD3v3D9jyQ8Az7YDyD/ByZ8Cuz+8jT5PzThfsDOPUA4/9X9/i9LwqfA+Zn0+c/8Z0O6J6j7t5n/zAh/e1zolPdhWyHCSVBm3fugrRTh+wEi5D9bwklQgvnPWq6nwJr34VpBwixgjs//Fa7ybmtnfP6vkeUewOf/KjnmAPZ/dDLcA5j/leKfAVz/WtHPAPZ/1GLPAWveh6eAyPcA8v8U4u4HkP+nEfUeQP6fSsw5gPl/OhHvAcz/U4p3BnD9TyvaGcD7v1OLNQeseR+OgiLdA8j/HuLsB5D/fUS5B5D/vcSYA5j//UQ4A8j/noTfI9QR178v7zmA/O/N9x6w5l0+XOcA8n8E77r1n/wfg9ccQP6PwucpwPwfh8cZQP6P5NXJ+8/1H8vUcwD5P5pp9wPWvMvFZaacA8j/EU23H0D+j2mqOYD8H9U0TwHm/7imOAPI/5Hp9wO4/mNTzwHk/+i0+wFvepeHVso54HXv4tCBbj+A6z8H1Rlw0bswdPS0pP/PeZeFzt4W9J/ff8jE/gzg+Z+L9Y4Qz/9sbH9jhPt/PqcN+3+DdzEY4Amz/v/OuxQM8ohR/73rwFAXLdr/e+8qMMLZ0f0/7V0CRvnDyP7z8U92fxzT/uPeq4eBPw3uP7/+siL+PKj9x7yXDTNP3da7/e96rxmm7nqyV/tf+ov3gmHtr91Pgb95rxUa567r0P2/v+e9TAi9/9bS7l/gz75W3/3/uGdu819Z914ZpnPHo//814vvvHHk32cPXXjtP8//13s9AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIDq/gdcXknSZ82XUgAAAABJRU5ErkJggg==",Rme="/assets/iconCarrito2-72ae9f79.png",Ime=({itemsSelected:n,addItem:r,showItems:s,disableds:c})=>O.jsx(Ame,{children:O.jsx(Ome,{children:Ug.filter(d=>s.includes(d.id)).map(d=>O.jsxs(Pme,{children:[O.jsx("div",{className:"img-container",children:O.jsx(xv,{src:d.img,border:2})}),O.jsxs("div",{className:"data-container",children:[O.jsxs("div",{className:"data",children:[O.jsx("b",{title:d.name,children:d.name}),O.jsx("small",{title:d.description,children:d.description}),O.jsxs("p",{children:["Precio: $us ",d.precio.toFixed(2)]})]}),n.includes(d.id)?O.jsxs(Nme,{children:[O.jsx(UW,{children:O.jsx("img",{src:bme})}),O.jsx(UW,{className:"button",onClick:()=>r(d.id),children:O.jsx("img",{src:Rme})})]}):O.jsx(Gi,{onClick:()=>r(d.id),size:"little",type:"secondary",disabled:c.includes(d.id),children:n.includes(d.id)?"Seleccionado":"Seleccionar"})]})]},d.id))})}),Ame=be.div`
  display: flex;
  flex-direction: column;
  height: calc(100% - 32px);
  position: relative;
  transition: padding 0.3s;
`,Ome=be.div`
  display: flex;
  flex-direction: column;
  padding: 16px 0;
  gap: 16px;
  height: 100%;
  overflow: auto;
  padding: 24px 24px;
`,Pme=be.div`
  display: flex;
  width: 100%;
  gap: 16px;
  border: 2px solid ${de.primary500};
  padding: 16px;
  background-color: ${de.primary200};
  border-radius: 8px;
  height: max-content;

  @media screen and (max-width: 490px) {
    flex-direction: column;
  }

  & > .img-container {
    min-height: 172px;
    min-width: 120px;
    height: 172px;
    width: 120px;
    @media screen and (max-width: 490px) {
      height: 100px;
      min-height: 100px;
      width: 100%;
    }
  }

  & > .data-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    
    & > .img {
      min-width: 80px;
      max-width: 80px;
      height: 80px; 
    }
    & > button {
      align-self: flex-end;
    }
    & > .data {
      display: flex;
      flex-direction: column;
      gap: 4px;

      & > small {
        opacity: 0.8;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 4;
        line-clamp: 4; 
        -webkit-box-orient: vertical;
      }
      & > b {
        font-size: .9rem;
        color: ${de.primary500};
        font-weight: 600;
        font-family: 'Chillax';
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 1;
        line-clamp: 1; 
        -webkit-box-orient: vertical;
      }
      & > p {
        font-size: .8rem;
        font-weight: 600;
        opacity: 0.8;
        align-self: flex-end;
      }
    }
  }
`,Nme=be.div`
  display: flex;
  align-items: center;
  gap: 16px;
  align-self: flex-end;
  & > i {
    color: ${de.primary500};
  }
  & > button {
    width: 40px;
  }
`,UW=be.button`
  width: 40px;
  height: 40px;
  padding: 6px;
  background-color: transparent;
  border: 2.5px solid ${de.tertiary400};
  border-radius: 4px;
  &.button {
    cursor: pointer;
    transition: opacity 0.3s;
    &:hover {
      opacity: 0.7;
    }
  }
  & > img {
    width: 100%;
    height: 100%;
  }
`;function xme(n,r=()=>{}){paypal.Buttons({style:{shape:"rect",color:"gold",layout:"vertical",label:"paypal"},createOrder:function(s,c){return c.order.create({purchase_units:[{amount:{value:n}}]})},onApprove:function(s,c){return c.order.capture().then(function(d){r(d)})},onError:function(s){console.log(s)}}).render("#paypal-button-container")}const Dme=({setPage:n,items:r,total:s,registerForm:c,page:d})=>{const p=le.useRef(!1),{user:g,setUser:y}=$s(),T=Ua(),R=Tl();return le.useEffect(()=>{const N=async D=>{const B=D.purchase_units[0].payments.captures[0].id;if(c){const q=await R("register",{order:B,total:s,items:r.map(J=>{var Y;return(Y=Ug.find(te=>te.id===J))==null?void 0:Y.name}),email:c.email,nombre:c.nombre,password:c.password,rol:r.sort((J,Y)=>J>Y?1:J<Y?-1:0).join("")});q&&y(q)}else{const q=g.rol+r.join(""),J=await R(`purchase/${g.email}`,{order:B,total:s,items:r.map(Y=>{var te;return(te=Ug.find(Z=>Z.id===Y))==null?void 0:te.name}),rol:q.split("").sort((Y,te)=>Y>te?1:Y<te?-1:0).join("")},"PUT");J&&(y(J),T("/login"))}Oo.fire({title:"Correcto!",text:"El pago fu realizado exitosamente",icon:"success"})};p.current||(xme(s,N),p.current=!0)},[]),O.jsx(kme,{children:O.jsxs("div",{className:"items",children:[O.jsxs("div",{className:"title",children:[O.jsx(Lme,{onClick:()=>n(2),children:O.jsx("i",{className:"fa-solid fa-chevron-left"})}),O.jsx("h2",{children:"Mtodos de pago"}),O.jsx("div",{className:"next",style:{width:24}})]}),O.jsx("div",{className:"container",children:O.jsx("div",{id:"paypal-button-container"})})]})})},kme=be.div`
  min-width: 450px;

  @media screen and (max-width: 1006px) {
    min-width: 0;
    min-height: 472px;
    padding: 24px 0;
  }

  & > .items {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    overflow: auto;
    & > h3 {
      font-size: 1.1rem;
      color: ${de.primary500};
      font-weight: 600;
      font-family: "Chillax";
    }
    & > .title {
      padding-left: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
      align-self: flex-start;
      @media screen and (max-width: 1006px) {
        padding-right: 24px;
        width: 100%;
        justify-content: space-between;
      }
      & > h2 {
        color: ${de.primary500};
        font-size: 1.4rem;
        font-weight: 600;
        font-family: "Chillax";
      }
      & > .next {
        display: none;
        @media screen and (max-width: 1006px) {
          display: block;
        }
      }
    }
    & > .container {
      width: 100%;
      padding: 0 24px;
    }
  }
`,Lme=be.button`
  border: none;
  background-color: transparent;
  color: ${de.primary500};
  font-size: 1.2rem;
  cursor: pointer;
  transition: scale 0.3s;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    scale: 1.2;
  }
`,Mme="/assets/metodospago-b7e57b1c.jpg",Ume=({items:n,setItems:r,total:s,setPage:c,page:d})=>{const p=()=>{r([]),c(0)};return O.jsxs(jme,{children:[O.jsxs("div",{className:"title",children:[O.jsx(Wme,{onClick:()=>c(0),children:O.jsx("i",{className:"fa-solid fa-chevron-left"})}),O.jsx("h2",{children:"Detalle"}),O.jsx("div",{className:"next",style:{width:24}})]}),n.length?O.jsxs(Vme,{children:[O.jsxs(Fme,{children:[O.jsx("div",{children:O.jsx("p",{children:"Resumen"})}),O.jsxs("div",{children:[O.jsx("p",{children:"Total Items"}),O.jsx("p",{children:n.length})]}),O.jsx("b",{className:"title",children:"Total a pagar"}),O.jsxs("b",{className:"total",children:["$us. ",s.toFixed(2)]})]}),O.jsxs(Bme,{children:[O.jsxs("div",{children:[O.jsx(Gi,{size:"little",bg:"#F89E1D",type:"secondary",onClick:p,children:"Cancelar"}),O.jsx(Gi,{size:"little",bg:"#F89E1D",type:"secondary",onClick:()=>c(d===1?0:1),children:d===1?"Seguir comprando":"Realizar pago"})]}),O.jsx("img",{src:Mme})]})]}):O.jsx(GG,{})]})},jme=be.div`
  min-width: 450px;
  padding: 0 24px;
  display: flex;
  flex-direction: column;
  gap: 24px;
  overflow: auto;

  @media screen and (max-width: 1006px) {
    min-height: 472px;
    padding: 24px 24px;
    min-width: 0;
  }

  & > .title {
    align-items: center;
    gap: 8px;
    display: none;
    @media screen and (max-width: 1006px) {
      display: flex;
      width: 100%;
      justify-content: space-between;
    }
    & > h2 {
      color: ${de.primary500};
      font-size: 1.4rem;
      font-weight: 600;
      font-family: "Chillax";
    }
  }
`,Vme=be.div`
  width: 100%;
  height: 100%;
  background-color: ${de.blue};
  border: 4px solid ${de.white};
  padding: 24px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  animation: appearCartDetails 0.3s;
  gap: 24px;

  @media screen and (max-width: 1006px) {
    overflow: auto;
    padding: 12px;
  }

  @keyframes appearCartDetails {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
`,Fme=be.div`
  background-color: ${de.white};
  border-radius: 8px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  & > div {
    display: flex;
    justify-content: space-between;
    padding: 8px 16px;
    border-bottom: 1px solid ${de.primary300};
    & > p {
      opacity: 0.8;
    }
  }
  & > b {
    align-self: center;
    padding: 12px 0 0;
  }
  & > .total {
    font-size: 24px;
  }
`,Bme=be.div`
  background-color: ${de.white};
  border-radius: 8px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  & > div {
    display: flex;
    justify-content: space-evenly;
    @media screen and (max-width: 1006px) {
      justify-content: space-between;
    }
  }
`,Wme=be.button`
  border: none;
  background-color: transparent;
  color: ${de.primary500};
  font-size: 1.2rem;
  cursor: pointer;
  transition: scale 0.3s;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    scale: 1.2;
  }
`,KG=({goBack:n,showItems:r,registerForm:s})=>{const[c,d]=le.useState(0),[p,g]=le.useState([]),{color:y}=qv(),T=B=>{p.includes(B)?g(p.filter(q=>q!==B)):(g([...p,B]),d(2))},R=p.reduce((B,q)=>{const J=Ug.find(Y=>Y.id===q);return B+(J==null?void 0:J.precio)},0),N=p.map(B=>Ug.find(q=>q.id===B).disables).flat(),D=[...new Set(N)];return O.jsx(zme,{bg:y,page:c,children:r.length===0?O.jsx(Hme,{children:O.jsx(GG,{type:"secondary",text:"Muchas gracias por adquirir los productos de Doctor Tomatto!",icon:"fa-regular fa-face-laugh-beam"})}):O.jsxs(O.Fragment,{children:[O.jsxs("div",{className:"items",children:[O.jsxs("div",{className:"title",children:[n&&O.jsx(jW,{onClick:n,children:O.jsx("i",{className:"fa-solid fa-chevron-left"})}),O.jsx("h2",{children:"Carrito"}),O.jsx(jW,{className:"next",onClick:()=>d(2),children:O.jsx("i",{className:"fa-solid fa-chevron-right"})})]}),O.jsx(Ime,{itemsSelected:p,addItem:T,showItems:r,disableds:D})]}),O.jsx(Ume,{items:p,setItems:g,total:R,setPage:d,page:c}),O.jsx(Dme,{registerForm:s,items:p,total:R,setPage:d,page:c},R)]})})},zme=be.div`
  width: 920px;
  height: 480px;
  background-color: ${de.primary300};
  border: 4px solid ${n=>n.bg===de.primary500?de.primary400:de.primary500};
  transition: transform 0.3s;
  display: flex;
  padding: 24px 0 24px;
  overflow: hidden;
  gap: 12px;

  @media screen and (max-width: 1006px) {
    flex-direction: column;
    gap: 0;
  }

  & > .items {
    min-width: 450px;
    height: 100%;

    @media screen and (max-width: 1006px) {
      min-height: 436px;
      min-width: 0;
    }

    & > .title {
      padding-left: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
      @media screen and (max-width: 1006px) {
        padding-right: 24px;
        width: 100%;
        justify-content: space-between;
      }
      & > h2 {
        color: ${de.primary500};
        font-size: 1.4rem;
        font-weight: 600;
        font-family: 'Chillax';
      }
      & > .next {
        display: none;
        @media screen and (max-width: 1006px) {
          display: block;
        }
      }
    }
  }
  
  & > div {
    transition: transform 0.3s;
    transform: ${n=>n.page===1?"translateX(-462px)":"translateX(0)"};
    @media screen and (max-width: 1006px) {
      transform: ${n=>n.page===2?"translateY(-460px)":n.page===1?"translateY(-932px)":"translateY(0)"};
    }
  }
`,jW=be.button`
  border: none;
  background-color: transparent;
  color: ${de.primary500};
  font-size: 1.2rem;
  cursor: pointer;
  transition: scale 0.3s;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    scale: 1.2;
  }
`,Hme=be.div`
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
`,Gme=()=>{const n=Tl();Xo(de.primary500);const[r,s]=le.useState(!1),[c,d]=le.useState({nombre:"",email:"",password:""}),[p,g]=le.useState(!1),[y,T]=le.useState({reseted:!0}),{user:R}=$s();le.useEffect(()=>{const D={};c.nombre.trim()||(D.nombre="El nombre es requerido"),c.email.trim()||(D.email="El email es requerido"),c.password.trim()||(D.password="La contrasea es requerida"),T(D)},[c.nombre,c.email,c.password]);const N=async D=>{if(D.preventDefault(),Object.keys(y).length){g(!0),Oo.fire({title:"Error",text:"Compruebe que no existan errores en el formulario",icon:"error"});return}const B=await n("checkmail",{email:c.email});B.status===1?s(!0):B.status===2&&Oo.fire({title:"Error",text:B.message,icon:"error"})};return R?O.jsx(h6,{to:"/login"}):O.jsx(Kme,{children:r?O.jsx(KG,{registerForm:c,goBack:()=>s(!1),showItems:["a","m","am"]}):O.jsxs(qme,{children:[O.jsx("div",{children:O.jsx($me,{src:wN})}),O.jsx(fn,{error:y.nombre,text:"Nombre",value:c.nombre,onChange:D=>d(B=>({...B,nombre:D.target.value})),trigger:p}),O.jsx(fn,{error:y.email,text:"Email",value:c.email,onChange:D=>d(B=>({...B,email:D.target.value})),trigger:p}),O.jsx(fn,{error:y.password,text:"Contrasea",value:c.password,onChange:D=>d(B=>({...B,password:D.target.value})),type:"password",trigger:p}),O.jsx(Gi,{type:"secondary",onClick:N,children:"Regstrese"}),O.jsxs("p",{children:["Ya tiene una cuenta? ",O.jsx(Yme,{to:"/login",children:"Inicie sesin"})]})]})})},Kme=be.section`
  min-height: calc(100dvh - 32px);
  padding: 100px 40px 65px;
  display: flex;
  justify-content: space-evenly;
  align-items: center;
`,qme=be.form`
  padding: 40px;
  background-color: ${de.primary200};
  border: 8px solid ${de.primary400};
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.3);
  gap: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;

  & > div {
    display: flex;
    flex-direction: column;
  }

  & > h2 {
    font-size: 18px;
    font-weight: 700;
    color: ${de.primary500};
  }

  & > p {
    font-size: 14px;
    text-align: center;
  }
`,Yme=be(Qp)`
  color: ${de.primary500};
  text-decoration: none;
  transition: all 0.3s;

  &:hover {
    opacity: 0.7;
  }
`,$me=be.img`
  width: 100px;
`,Xme=()=>{Xo(de.primary200);const n=Tl(),r=Ua(),{data:s,getData:c}=of("publicidad",null),d=async p=>{await n(`publicidad/${p}`,null,"DELETE")&&(Oo.fire({title:"Correcto",text:"La publicidad se elimin correctamente",icon:"success"}),c())};return O.jsxs(Jme,{children:[O.jsx("h2",{children:"Publicidad"}),O.jsx(Gi,{onClick:()=>r("/crud/publicidad/agregar"),type:"secondary",children:"Crear"}),s?O.jsx(Zme,{children:O.jsxs(Qme,{children:[O.jsx("thead",{children:O.jsxs("tr",{children:[O.jsx("th",{children:"#"}),O.jsx("th",{children:"Codigo pas"}),O.jsx("th",{children:"Pas"}),O.jsx("th",{children:"Ciudad"}),O.jsx("th",{children:"Empresa"}),O.jsx("th",{children:"Foto"}),O.jsx("th",{children:"Contacto"}),O.jsx("th",{children:"Cargo"}),O.jsx("th",{children:"Direccin"}),O.jsx("th",{children:"Telfono"}),O.jsx("th",{children:"Correo"}),O.jsx("th",{children:"Web"}),O.jsx("th",{children:"Descripcin"}),O.jsx("th",{children:"Fecha de registro"}),O.jsx("th",{children:"Tipo de propaganda"}),O.jsx("th",{children:"Cobertura"}),O.jsx("th",{children:"Acciones"})]})}),O.jsx("tbody",{children:s.map((p,g)=>O.jsxs("tr",{children:[O.jsx("td",{className:"centertext",children:O.jsx("p",{children:g+1})}),O.jsx("td",{className:"centertext",children:O.jsx("p",{children:p.codigo_pais})}),O.jsx("td",{children:O.jsx("p",{children:p.pais})}),O.jsx("td",{children:O.jsx("p",{children:p.ciudad})}),O.jsx("td",{children:O.jsx("p",{children:p.empresa})}),O.jsx("td",{className:"centertext",children:O.jsx("img",{src:`/logo/${p.codigo_pais}${p.id}?v=${new Date().getTime()}`})}),O.jsx("td",{children:O.jsx("p",{children:p.contacto})}),O.jsx("td",{children:O.jsx("p",{children:p.cargo})}),O.jsx("td",{children:O.jsx("p",{children:p.direccion})}),O.jsx("td",{children:O.jsx("p",{children:p.telefono})}),O.jsx("td",{children:O.jsx("p",{className:"maxwidth",children:p.correo})}),O.jsx("td",{children:O.jsx("p",{className:"maxwidth",children:p.web})}),O.jsx("td",{children:O.jsx("p",{className:"maxlines",children:p.descripcion})}),O.jsx("td",{children:O.jsx("p",{children:p.fecha_registro})}),O.jsx("td",{className:"centertext",children:O.jsx("p",{children:p.tipo_propaganda})}),O.jsx("td",{className:"centertext",children:O.jsx("p",{children:p.cobertura})}),O.jsx("td",{children:O.jsxs("div",{className:"buttons",children:[O.jsx(Gi,{onClick:()=>r(`/crud/publicidad/editar/${p.id}`),type:"secondary",size:"little",children:"Editar"}),O.jsx(Gi,{onClick:()=>d(p.id),type:"secondary",size:"little",children:"Eliminar"})]})})]},p.id))})]})}):O.jsx("p",{children:"Cargando..."})]})},Jme=be.section`
  min-height: calc(100dvh - 32px);
  padding: 115px 140px 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;

  & > p {
    text-align: center;
  }

  @media screen and (max-width: 1260px) {
    padding: 85px 20px 60px;
  }
`,Zme=be.div`
  width: 100%;
  overflow: auto;
  border-radius: 16px;
`,Qme=be.table`
  table-layout: fixed;
  border-collapse: collapse;
  th, td {
    padding: 4px 8px;
    border: 1px solid ${de.primary400};
  }
  tr {
    background-color: ${de.primary300};
  }
  thead > tr {
    background-color: ${de.primary500};
    color: ${de.white};
    text-align: center;

    & > th {
      border: 1px solid ${de.primary500};
    }
  }
  img {
    max-width: 64px;
    max-height: 64px;
  }
  .maxlines {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 4;
    line-clamp: 2;
    overflow: hidden;
    height: 100%;
  }
  .maxwidth {
    width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .centertext {
    text-align: center;
  }
  .buttons {
    display: flex;
    gap: 12px;
  }
`,VW=()=>{const n=Tl();Xo(de.primary200);const r=Ua(),{id:s}=l6(),{data:c,loading:d}=of(`publicidad/${s}`,null,!!s),[p,g]=le.useState(null),[y,T]=le.useState({foto:void 0,codigo_pais:"",pais:"",ciudad:"",empresa:"",contacto:"",cargo:"",direccion:"",telefono:"",correo:"",web:"",descripcion:"",tipo_propaganda:"",cobertura:""}),R=async N=>{N.preventDefault();const D=new FormData;Object.keys(y).forEach(q=>{D.append(q,y[q])}),await n(s?`publicidad/${s}`:"publicidad",D,s?"PUT":"POST")&&(Oo.fire({title:"Correcto",text:`La publicidad fu ${s?"editada":"aadida"} correctamente`,icon:"success"}),r("/crud/publicidad"))};return le.useEffect(()=>{s&&c&&T({foto:null,codigo_pais:c.codigo_pais,pais:c.pais,ciudad:c.ciudad,empresa:c.empresa,contacto:c.contacto,cargo:c.cargo,direccion:c.direccion,telefono:c.telefono,correo:c.correo,web:c.web,descripcion:c.descripcion,tipo_propaganda:c.tipo_propaganda,cobertura:c.cobertura})},[c]),le.useEffect(()=>{if(y.foto){const N=new FileReader;N.readAsDataURL(y.foto),N.addEventListener("load",()=>{g(N.result)})}},[y.foto]),O.jsxs(ege,{children:[O.jsxs("h2",{children:[s?"Editar":"Aadir"," publicidad"]}),O.jsx(Gi,{onClick:()=>r("/crud/publicidad"),type:"secondary",children:"Volver"}),d?O.jsx("p",{children:"Cargando..."}):O.jsxs(tge,{children:[c&&O.jsxs(ige,{children:[O.jsx("img",{src:s?p||`/logo/${c.codigo_pais}${c.id}?v=${new Date().getTime()}`:y.foto?p:X6}),O.jsx("input",{type:"file",onChange:N=>T(D=>({...D,foto:N.target.files[0]}))})]}),O.jsx(fn,{text:"Cdigo de pas",value:y.codigo_pais,onChange:N=>T(D=>({...D,codigo_pais:N.target.value}))}),O.jsx(fn,{text:"Pas",value:y.pais,onChange:N=>T(D=>({...D,pais:N.target.value}))}),O.jsx(fn,{text:"Ciudad",value:y.ciudad,onChange:N=>T(D=>({...D,ciudad:N.target.value}))}),O.jsx(fn,{text:"Empresa",value:y.empresa,onChange:N=>T(D=>({...D,empresa:N.target.value}))}),O.jsx(fn,{text:"Contacto",value:y.contacto,onChange:N=>T(D=>({...D,contacto:N.target.value}))}),O.jsx(fn,{text:"Cargo",value:y.cargo,onChange:N=>T(D=>({...D,cargo:N.target.value}))}),O.jsx(fn,{text:"Direccin",value:y.direccion,onChange:N=>T(D=>({...D,direccion:N.target.value}))}),O.jsx(fn,{text:"Telfono",value:y.telefono,onChange:N=>T(D=>({...D,telefono:N.target.value}))}),O.jsx(fn,{text:"Correo",value:y.correo,onChange:N=>T(D=>({...D,correo:N.target.value}))}),O.jsx(fn,{text:"Web",value:y.web,onChange:N=>T(D=>({...D,web:N.target.value}))}),O.jsx(fn,{text:"Descripcin",value:y.descripcion,onChange:N=>T(D=>({...D,descripcion:N.target.value}))}),O.jsx(fn,{text:"Tipo de propaganda",value:y.tipo_propaganda,onChange:N=>T(D=>({...D,tipo_propaganda:N.target.value}))}),O.jsx(fn,{text:"Cobertura",value:y.cobertura,onChange:N=>T(D=>({...D,cobertura:N.target.value}))}),O.jsx(Gi,{onClick:R,type:"secondary",children:s?"Editar":"Agregar"})]})]})},ege=be.section`
  min-height: calc(100dvh - 32px);
  padding: 115px 140px 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;

  & > p {
    text-align: center;
  }

  @media screen and (max-width: 1260px) {
    padding: 85px 20px 60px;
  }
`,tge=be.form`
  padding: 40px;
  background-color: ${de.primary200};
  border: 8px solid ${de.primary500};
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.3);
  gap: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;
`,ige=be.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  & > img {
    height: 140px;
    width: 140px;
    object-fit: cover;
    border: 2px solid ${de.primary500};
  }
  & > input {
    width: 300px;
  }
`,nge=()=>{const n=Tl();Xo(de.primary200);const r=Ua(),{data:s,getData:c}=of("usuario",null),d=async p=>{await n(`usuario/${p}`,null,"DELETE")&&(Oo.fire({title:"Correcto",text:"El usuario se elimin correctamente",icon:"success"}),c())};return O.jsxs(rge,{children:[O.jsx("h2",{children:"Usuarios"}),O.jsx(Gi,{onClick:()=>r("/crud/usuario/agregar"),type:"secondary",children:"Crear"}),s?O.jsx(oge,{children:O.jsxs(sge,{children:[O.jsx("thead",{children:O.jsxs("tr",{children:[O.jsx("th",{children:"#"}),O.jsx("th",{children:"Email"}),O.jsx("th",{children:"Nombre"}),O.jsx("th",{children:"Rol"}),O.jsx("th",{children:"Pas"}),O.jsx("th",{children:"Ciudad"}),O.jsx("th",{children:"Acciones"})]})}),O.jsx("tbody",{children:s.map((p,g)=>O.jsxs("tr",{children:[O.jsx("td",{className:"centertext",children:O.jsx("p",{children:g+1})}),O.jsx("td",{children:O.jsx("p",{className:"maxwidth",children:p.email})}),O.jsx("td",{children:O.jsx("p",{children:p.nombre})}),O.jsx("td",{className:"centertext",children:O.jsx("p",{children:p.rol})}),O.jsx("td",{children:O.jsx("p",{className:"maxwidth",children:p.pais})}),O.jsx("td",{children:O.jsx("p",{className:"maxwidth",children:p.ciudad})}),O.jsx("td",{children:O.jsxs("div",{className:"buttons",children:[O.jsx(Gi,{onClick:()=>r(`/crud/usuario/editar/${p.email}`),type:"secondary",size:"little",children:"Editar"}),O.jsx(Gi,{onClick:()=>d(p.email),type:"secondary",size:"little",children:"Eliminar"})]})})]},p.email))})]})}):O.jsx("p",{children:"Cargando..."})]})},rge=be.section`
  min-height: calc(100dvh - 32px);
  padding: 115px 140px 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;

  & > p {
    text-align: center;
  }

  @media screen and (max-width: 1260px) {
    padding: 85px 20px 60px;
  }
`,oge=be.div`
  width: 100%;
  overflow: auto;
  border-radius: 16px;
`,sge=be.table`
  table-layout: fixed;
  border-collapse: collapse;
  width: 100%;
  th, td {
    padding: 4px 8px;
    border: 1px solid ${de.primary400};
  }
  tr {
    background-color: ${de.primary300};
  }
  thead > tr {
    background-color: ${de.primary500};
    color: ${de.white};
    text-align: center;

    & > th {
      border: 1px solid ${de.primary500};
    }
  }
  img {
    max-width: 64px;
    max-height: 64px;
  }
  .maxlines {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 4;
    line-clamp: 2;
    overflow: hidden;
    height: 100%;
  }
  .maxwidth {
    width: 120px;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .centertext {
    text-align: center;
  }
  .buttons {
    display: flex;
    gap: 12px;
  }
`,FW=()=>{const n=Tl();Xo(de.primary200);const r=Ua(),{id:s}=l6(),{data:c,loading:d}=of(`usuario/${s}`,null,!!s),[p,g]=le.useState({email:"",nombre:"",clave:"",rol:"",pais:"",ciudad:""}),y=async T=>{T.preventDefault(),console.log(p),await n(s?`usuario/${s}`:"usuario",p,s?"PUT":"POST")&&(Oo.fire({title:"Correcto",text:`El usuario fu ${s?"editado":"aadido"} correctamente`,icon:"success"}),r("/crud/usuario"))};return le.useEffect(()=>{s&&c&&g({email:c.email,nombre:c.nombre,clave:c.clave,rol:c.rol,pais:c.pais,ciudad:c.ciudad})},[c]),O.jsxs(age,{children:[O.jsxs("h2",{children:[s?"Editar":"Aadir"," usuario"]}),O.jsx(Gi,{onClick:()=>r("/crud/usuario"),type:"secondary",children:"Volver"}),d?O.jsx("p",{children:"Cargando..."}):O.jsxs(cge,{children:[O.jsx(fn,{text:"Email",value:p.email,onChange:T=>g(R=>({...R,email:T.target.value}))}),O.jsx(fn,{text:"Nombre",value:p.nombre,onChange:T=>g(R=>({...R,nombre:T.target.value}))}),!s&&O.jsx(fn,{text:"Clave",value:p.clave,onChange:T=>g(R=>({...R,clave:T.target.value}))}),O.jsx(fn,{text:"Rol",value:p.rol,onChange:T=>g(R=>({...R,rol:T.target.value}))}),O.jsx(fn,{text:"Pas",value:p.pais,onChange:T=>g(R=>({...R,pais:T.target.value}))}),O.jsx(fn,{text:"Ciudad",value:p.ciudad,onChange:T=>g(R=>({...R,ciudad:T.target.value}))}),O.jsx(Gi,{onClick:y,type:"secondary",children:s?"Editar":"Agregar"})]})]})},age=be.section`
  min-height: calc(100dvh - 32px);
  padding: 115px 140px 60px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;

  & > p {
    text-align: center;
  }

  @media screen and (max-width: 1260px) {
    padding: 85px 20px 60px;
  }
`,cge=be.form`
  padding: 40px;
  background-color: ${de.primary200};
  border: 8px solid ${de.primary500};
  box-shadow: 0px 0px 10px 0px rgba(0,0,0,0.3);
  gap: 24px;
  display: flex;
  flex-direction: column;
  align-items: center;
`,lge=({title:n,text:r,buttonText:s,onClick:c,cart:d})=>{const p=uh(),g=J6(),{changeColor:y,color:T}=qv();return le.useEffect(()=>{p.pathname==="/mapa"&&y(de.primary500),p.pathname==="/analizar"&&(g>560?y(de.primary200):y(de.secondary500))},[p]),O.jsx(dge,{children:d||O.jsxs(uge,{bg:T,children:[n&&O.jsx("h2",{children:n}),O.jsx("p",{children:r}),O.jsx(Gi,{onClick:c,max:!0,type:"secondary",children:s})]})})},dge=be.section`
  min-height: calc(100dvh - 32px);
  padding: 145px 140px 60px;
  display: flex;
  justify-content: space-around;
  align-items: center;

  @media screen and (max-width: 560px) {
    padding: 85px 20px 85px;
  }
`,uge=be.div`
  display: flex;
  flex-direction: column;
  gap: 16px;
  align-items: center;
  background-color: ${de.primary300};
  padding: 24px;
  text-align: center;
  width: 540px;
  max-width: 100%;
  transition: all 0.2s;
  border: 4px solid ${n=>n.bg===de.primary500?de.primary400:de.primary500};

  & > h2 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
  }
`,sd=({children:n,rol:r=""})=>{const{user:s}=$s(),c=Ua();return s?s.rol.includes(r)?n:O.jsx(h6,{to:"/cart"}):O.jsx(lge,{text:"Iniciar sesin para usar esta funcionalidad",buttonText:"Iniciar sesin",onClick:()=>c("/login")})},hge=()=>{const{user:n}=$s();Xo(de.primary500);const r=Ug.filter(s=>!s.id.includes(n.rol)&&!n.rol.includes(s.id)).map(s=>s.id);return O.jsx(pge,{children:O.jsx(KG,{showItems:r})})},pge=be.section`
  min-height: calc(100dvh - 32px);
  padding: 100px 40px 65px;
  display: flex;
  justify-content: space-evenly;
  align-items: center;
`,BW=({titulo:n,autor:r,fecha:s,img:c,ruta:d})=>{const p=Ua();return O.jsxs(fge,{onClick:()=>p(d),children:[O.jsx("div",{className:"img-container",children:O.jsx("img",{src:c,alt:`blog-portrait-${d}`})}),O.jsxs("div",{className:"data-container",children:[O.jsx("h3",{children:n}),O.jsxs("div",{children:[O.jsx("p",{children:r}),O.jsx("small",{children:s})]})]})]})},fge=be.div`
  width: 360px;
  height: 340px;
  border: 4px solid ${de.primary500};
  background-color: ${de.primary300};
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s;

  &:hover {
    opacity: 0.8;
    transform: translateY(-8px);
  }

  & > .img-container {
    height: 50%;
    & > img {
      height: 100%;
      width: 100%;
      object-fit: cover;
    }
  }
  & > .data-container {
    height: 50%;
    padding: 24px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    & > h3 {
      font-size: 1.1rem;
      color: ${de.primary500};
      font-weight: 600;
      font-family: 'Chillax';
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3; 
      -webkit-box-orient: vertical;
      text-align: justify;
    }
    & > div {
      display: flex;
      justify-content: space-between;
      & > p {
        font-size: .8rem;
      }
      & > small {
        font-size: .8rem;
      }
    }
  }
`,mge="/assets/instrucciones-7198aa8b.jpeg",qG="/assets/blog1-c903e269.jpeg",gge=()=>(Xo(de.primary200),O.jsxs(_ge,{children:[O.jsx("h2",{children:"Blog"}),O.jsxs(Ege,{children:[O.jsx(BW,{titulo:"Instrucciones para el anlisis de tus hojas de tomate con Doctor Tomatto",autor:"Sergio Hernn",fecha:"Nov 29, 2023",img:mge,ruta:"instrucciones"}),O.jsx(BW,{titulo:"Cmo se desarroll Doctor Tomatto?",autor:"Mauricio Molina",fecha:"Nov 29, 2023",img:qG,ruta:"1"})]})]})),_ge=be.section`
  min-height: calc(100dvh - 32px);
  padding: 100px 160px 65px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  
  @media screen and (max-width: 1500px) {
    padding: 100px 40px 65px;
  }

  & > h2 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
    line-height: 72px;
  }
`,Ege=be.div`
  display: flex;
  flex-wrap: wrap;
  row-gap: 24px;
  column-gap: 48px;
  width: 100%;
  justify-content: center;
`,vge=({children:n})=>O.jsx(yge,{children:n}),yge=be.b`
  color: ${de.primary500};
  max-width: 100%;
  font-size: 18px;
  line-height: 32px;
`,Sge=({children:n})=>O.jsx(Tge,{children:n}),Tge=be.p`
  opacity: 0.7;
  max-width: 90%;
  font-size: 16px;
  line-height: 28px;
  text-align: justify;
`,wge=({src:n,text:r,height:s=400,width:c=60,video:d=!1})=>O.jsxs(Cge,{height:s,width:c,children:[O.jsx("div",{children:d?O.jsx("video",{src:n,controls:!0}):O.jsx(xv,{alt:"blog-picture",src:n,border:4})}),r&&O.jsx("small",{children:r})]}),Cge=be.div`
  width: ${n=>n.width}%;
  align-self: center;
  display: flex;
  flex-direction: column;
  gap: 16px;
  align-items: center;
  & > div {
    width: 100%;
    height: ${n=>n.height}px;
  }
  & video {
    height: 100%;
    width: 100%;
  }
  & > small {
    font-size: .8rem;
    opacity: 0.8;
  }
`,bo=({title:n,fecha:r,autor:s,descripcion:c,categorias:d,img:p,children:g,references:y})=>{Xo(de.primary200);const T=Ua(),R=()=>{window.scrollTo(0,0),T("/blog")};return O.jsxs(bge,{children:[O.jsxs("small",{children:["Publicado el ",O.jsx("span",{children:r})," por ",O.jsx("span",{children:s})]}),O.jsx("h2",{children:n}),c&&O.jsx("p",{className:"description",children:c}),d&&O.jsx("div",{className:"categories",children:d.map(N=>O.jsx("p",{children:N}))}),O.jsx("div",{className:"img-container",children:O.jsx(xv,{src:p,alt:"blog-portrait",border:4})}),O.jsxs("div",{className:"content",children:[O.jsx("div",{className:"content-children",children:g}),y&&O.jsx("div",{className:"buttons",children:y.map(N=>O.jsx("a",{href:N.url,target:"_blank",children:N.icon}))})]}),O.jsx("div",{className:"last-button",children:O.jsx(Gi,{onClick:R,type:"secondary",children:"Leer ms blogs"})})]})};bo.Subtitulo=vge;bo.Parrafo=Sge;bo.Imagen=wge;const bge=be.div`
  min-height: calc(100dvh - 32px);
  padding: 100px 40px 65px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  & > small {
    text-align: center;
    & > span {
      color: ${de.primary500};
      font-weight: 600;
    }
  }
  & > h2 {
    font-size: 2rem;
    color: ${de.primary500};
    font-weight: 600;
    font-family: 'Chillax';
    max-width: 800px;
    text-align: center;
  }
  & > .description {
    opacity: 0.6;
    max-width: 600px;
    text-align: center;
  }
  & > .categories {
    display: flex;
    gap: 12px;
    max-width: 600px;
    flex-wrap: wrap;
    justify-content: center;
    & > p {
      background-color: ${de.primary400};
      color: ${de.white};
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
    }
  }
  & > .img-container {
    width: 900px;
    max-width: 100%;
    height: 450px;
    & > img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }
  & > .last-button {
    width: 900px;
    max-width: 100%;
    display: flex;
    justify-content: flex-end;
    margin-top: 40px;
  }
  & > .content {
    margin-top: 20px;
    display: flex;
    justify-content: space-between;
    width: 900px;
    max-width: 100%;
    @media screen and (max-width: 650px) {
      flex-direction: column;
      gap: 24px;
    }
    & > .buttons {
      display: flex;
      flex-direction: column;
      gap: 16px;
      @media screen and (max-width: 650px) {
        flex-direction: row;
      }
    }
    & a {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 1px solid ${de.primary500};
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: ${de.primary500};
      font-size: 24px;
      transition: all 0.3s;
      &:hover {
        opacity: 0.8;
        transform: translateY(-4px);
      }
    }
    & > .content-children {
      width: 85%;
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding-left: 56px;
      @media screen and (max-width: 650px) {
        width: 100%;
        padding-left: 0;
      }
    }
  }
`,Rge="/assets/blog1_0-8753035b.jpeg",Ige=()=>O.jsxs(bo,{title:"Cmo se desarroll Doctor Tomatto?",fecha:"29 de noviembre de 2023",autor:"Mauricio Molina",descripcion:"Innovacin en la agricultura",categorias:["Tecnologa","Desarrollo","Innovacin","Curiosidad"],img:qG,references:[{icon:O.jsx("i",{className:"fa-brands fa-instagram"}),url:"https://www.instagram.com/mau_mq12"},{icon:O.jsx("i",{className:"fa-brands fa-linkedin"}),url:"https://www.linkedin.com/in/mauricio-molina-quinteros-72112925b"},{icon:O.jsx("i",{className:"fa-brands fa-whatsapp"}),url:"https://wa.me/59176407344"}],children:[O.jsx(bo.Subtitulo,{children:"La idea de crear una aplicacin web capaz de analizar fotos de hojas de tomate y diagnosticar enfermedades surgi como una forma innovadora de abordar los desafos en la agricultura."}),O.jsx(bo.Subtitulo,{children:"Frontend"}),O.jsx(bo.Parrafo,{children:"Comenc con el desarrollo del frontend utilizando React. La creacin de una interfaz de usuario intuitiva era crucial para garantizar que agricultores y entusiastas pudieran utilizar la aplicacin sin problemas. Implement componentes reutilizables, animaciones suaves y un diseo limpio para una experiencia de usuario agradable."}),O.jsx(bo.Subtitulo,{children:"Backend"}),O.jsx(bo.Parrafo,{children:"Pasemos al backend, donde la magia de la inteligencia artificial realmente toma forma. Utilic Flask para construir una API robusta que maneja las solicitudes desde el frontend y coordina el proceso de anlisis de imgenes."}),O.jsx(bo.Parrafo,{children:"Desarrollamos un modelo de aprendizaje profundo utilizando bibliotecas como TensorFlow y Keras para entrenar la IA en la deteccin y clasificacin de enfermedades en las hojas de tomate. La red neuronal convolucional resultante fue implementada en Flask y se encarga de procesar las imgenes recibidas y devolver resultados precisos."}),O.jsx(bo.Imagen,{src:Rge,text:"Ayudamos a los agricultores en la era de la Inteligencia Artificial",width:80}),O.jsx(bo.Subtitulo,{children:"Pruebas y optimizacin"}),O.jsx(bo.Parrafo,{children:"La fase de pruebas fue fundamental para garantizar la fiabilidad de la aplicacin. Trabajamos en colaboracin con agricultores locales y expertos en enfermedades de plantas para recopilar un conjunto diverso de datos de prueba. Ajustamos y optimizamos el modelo para mejorar la precisin y la velocidad de respuesta."}),O.jsx("br",{}),O.jsx(bo.Subtitulo,{children:"Conclusin"}),O.jsx(bo.Parrafo,{children:"Este proyecto ha sido una montaa rusa emocional, pero el resultado final ha valido la pena. La combinacin de React y Flask result ser una eleccin acertada, brindando una experiencia de usuario excepcional y una slida base para la inteligencia artificial."}),O.jsx(bo.Subtitulo,{children:"Espero que este blog haya proporcionado una visin fascinante del proceso detrs del desarrollo de esta aplicacin web de IA para la agricultura."})]});/**
 * @license agora-rtc-react
 * @version 2.2.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var Age=Object.create,KN=Object.defineProperty,Oge=Object.getOwnPropertyDescriptor,Pge=Object.getOwnPropertyNames,Nge=Object.getPrototypeOf,xge=Object.prototype.hasOwnProperty,Dge=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),kge=(n,r)=>{for(var s in r)KN(n,s,{get:r[s],enumerable:!0})},YG=(n,r,s,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let d of Pge(r))!xge.call(n,d)&&d!==s&&KN(n,d,{get:()=>r[d],enumerable:!(c=Oge(r,d))||c.enumerable});return n},Lge=(n,r,s)=>(YG(n,r,"default"),s),cf=(n,r,s)=>(s=n!=null?Age(Nge(n)):{},YG(!n||!n.__esModule?KN(s,"default",{value:n,enumerable:!0}):s,n)),lf=Dge((n,r)=>{(function(s,c){typeof n=="object"&&typeof r<"u"?r.exports=c():typeof define=="function"&&define.amd?define(c):(s=typeof globalThis<"u"?globalThis:s||self).AgoraRTC=c()})(n,function(){function s(e,t){return t.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var a=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,a.get?a:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var c=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function d(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var p=function(e){try{return!!e()}catch{return!0}},g=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=g,T=Function.prototype,R=T.call,N=y&&T.bind.bind(R,R),D=y?N:function(e){return function(){return R.apply(e,arguments)}},B=D({}.isPrototypeOf),q=function(e){return e&&e.Math==Math&&e},J=q(typeof globalThis=="object"&&globalThis)||q(typeof window=="object"&&window)||q(typeof self=="object"&&self)||q(typeof c=="object"&&c)||function(){return this}()||c||Function("return this")(),Y=g,te=Function.prototype,Z=te.apply,ee=te.call,re=typeof Reflect=="object"&&Reflect.apply||(Y?ee.bind(Z):function(){return ee.apply(Z,arguments)}),pe=D,ve=pe({}.toString),Oe=pe("".slice),Se=function(e){return Oe(ve(e),8,-1)},je=Se,ot=D,Qe=function(e){if(je(e)==="Function")return ot(e)},st=typeof document=="object"&&document.all,ut={all:st,IS_HTMLDDA:st===void 0&&st!==void 0},Ni=ut.all,gt=ut.IS_HTMLDDA?function(e){return typeof e=="function"||e===Ni}:function(e){return typeof e=="function"},At={},yt=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Lt=g,Ue=Function.prototype.call,Je=Lt?Ue.bind(Ue):function(){return Ue.apply(Ue,arguments)},Ie={},pt={}.propertyIsEnumerable,St=Object.getOwnPropertyDescriptor,yi=St&&!pt.call({1:2},1);Ie.f=yi?function(e){var t=St(this,e);return!!t&&t.enumerable}:pt;var Ot,ge,lt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},vt=p,Jt=Se,zi=Object,bi=D("".split),gn=vt(function(){return!zi("z").propertyIsEnumerable(0)})?function(e){return Jt(e)=="String"?bi(e,""):zi(e)}:zi,Tn=function(e){return e==null},ph=Tn,hf=TypeError,Jo=function(e){if(ph(e))throw hf("Can't call method on "+e);return e},Cd=gn,Va=Jo,qr=function(e){return Cd(Va(e))},Cr=gt,Ic=ut.all,Fi=ut.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Cr(e)||e===Ic}:function(e){return typeof e=="object"?e!==null:Cr(e)},Zt={},Xs=Zt,fh=J,pf=gt,Ac=function(e){return pf(e)?e:void 0},lr=function(e,t){return arguments.length<2?Ac(Xs[e])||Ac(fh[e]):Xs[e]&&Xs[e][t]||fh[e]&&fh[e][t]},Zo=typeof navigator<"u"&&String(navigator.userAgent)||"",wl=J,Yr=Zo,Js=wl.process,Zs=wl.Deno,mh=Js&&Js.versions||Zs&&Zs.version,Rs=mh&&mh.v8;Rs&&(ge=(Ot=Rs.split("."))[0]>0&&Ot[0]<4?1:+(Ot[0]+Ot[1])),!ge&&Yr&&(!(Ot=Yr.match(/Edge\/(\d+)/))||Ot[1]>=74)&&(Ot=Yr.match(/Chrome\/(\d+)/))&&(ge=+Ot[1]);var lo=ge,gh=lo,Qs=p,_h=J.String,Oc=!!Object.getOwnPropertySymbols&&!Qs(function(){var e=Symbol();return!_h(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&gh&&gh<41}),Cl=Oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",bd=lr,bl=gt,zg=B,$r=Object,Xr=Cl?function(e){return typeof e=="symbol"}:function(e){var t=bd("Symbol");return bl(t)&&zg(t.prototype,$r(e))},Hg=String,Zn=function(e){try{return Hg(e)}catch{return"Object"}},Rd=gt,Id=Zn,ff=TypeError,zt=function(e){if(Rd(e))return e;throw ff(Id(e)+" is not a function")},Qo=zt,ea=Tn,Hn=function(e,t){var i=e[t];return ea(i)?void 0:Qo(i)},it=Je,Qn=gt,Rl=Fi,Eh=TypeError,Fa={exports:{}},dr=J,mf=Object.defineProperty,Ba=function(e,t){try{mf(dr,e,{value:t,configurable:!0,writable:!0})}catch{dr[e]=t}return t},Ad="__core-js_shared__",Il=J[Ad]||Ba(Ad,{}),gf=Il;(Fa.exports=function(e,t){return gf[e]||(gf[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Wa=Fa.exports,Gg=Jo,_f=Object,mr=function(e){return _f(Gg(e))},Od=mr,Kg=D({}.hasOwnProperty),An=Object.hasOwn||function(e,t){return Kg(Od(e),t)},qg=D,Yg=0,vh=Math.random(),yh=qg(1 .toString),za=function(e){return"Symbol("+(e===void 0?"":e)+")_"+yh(++Yg+vh,36)},ta=Wa,Sh=An,Al=za,Ti=Oc,tn=Cl,Is=J.Symbol,ia=ta("wks"),Pc=tn?Is.for||Is:Is&&Is.withoutSetter||Al,Ri=function(e){return Sh(ia,e)||(ia[e]=Ti&&Sh(Is,e)?Is[e]:Pc("Symbol."+e)),ia[e]},Qt=Je,Mt=Fi,Pd=Xr,Nd=Hn,uo=function(e,t){var i,o;if(Qn(i=e.toString)&&!Rl(o=it(i,e))||Qn(i=e.valueOf)&&!Rl(o=it(i,e))||t!=="string")return o;throw Eh("Can't convert object to primitive value")},$g=TypeError,xd=Ri("toPrimitive"),Ha=function(e,t){if(!Mt(e)||Pd(e))return e;var i,o=Nd(e,xd);if(o){if(i=Qt(o,e,t),!Mt(i)||Pd(i))return i;throw $g("Can't convert object to primitive value")}return uo(e,t)},wn=Xr,Dr=function(e){var t=Ha(e,"string");return wn(t)?t:t+""},Ga=Fi,es=J.document,_n=Ga(es)&&Ga(es.createElement),Ka=function(e){return _n?es.createElement(e):{}},Th=Ka,Dd=!yt&&!p(function(){return Object.defineProperty(Th("div"),"a",{get:function(){return 7}}).a!=7}),Ol=yt,wh=Je,Ch=Ie,kd=lt,bh=qr,Rh=Dr,Ef=An,Gt=Dd,xo=Object.getOwnPropertyDescriptor;At.f=Ol?xo:function(e,t){if(e=bh(e),t=Rh(t),Gt)try{return xo(e,t)}catch{}if(Ef(e,t))return kd(!wh(Ch.f,e,t),e[t])};var Ki=p,vf=gt,Ih=/#|\.prototype\./,qa=function(e,t){var i=na[Ah(e)];return i==Nc||i!=Oh&&(vf(t)?Ki(t):!!t)},Ah=qa.normalize=function(e){return String(e).replace(Ih,".").toLowerCase()},na=qa.data={},Oh=qa.NATIVE="N",Nc=qa.POLYFILL="P",er=qa,Ya=zt,$a=g,Ph=Qe(Qe.bind),ra=function(e,t){return Ya(e),t===void 0?e:$a?Ph(e,t):function(){return e.apply(t,arguments)}},br={},Pl=yt&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Xg=Fi,yf=String,Ei=TypeError,gr=function(e){if(Xg(e))return e;throw Ei(yf(e)+" is not an object")},Do=yt,Nl=Dd,Xa=Pl,Ld=gr,xl=Dr,Sf=TypeError,Md=Object.defineProperty,Jg=Object.getOwnPropertyDescriptor,Nh="enumerable",Dl="configurable",xh="writable";br.f=Do?Xa?function(e,t,i){if(Ld(e),t=xl(t),Ld(i),typeof e=="function"&&t==="prototype"&&"value"in i&&xh in i&&!i[xh]){var o=Jg(e,t);o&&o[xh]&&(e[t]=i.value,i={configurable:Dl in i?i[Dl]:o[Dl],enumerable:Nh in i?i[Nh]:o[Nh],writable:!1})}return Md(e,t,i)}:Md:function(e,t,i){if(Ld(e),t=xl(t),Ld(i),Nl)try{return Md(e,t,i)}catch{}if("get"in i||"set"in i)throw Sf("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var ts=br,Zg=lt,kr=yt?function(e,t,i){return ts.f(e,t,Zg(1,i))}:function(e,t,i){return e[t]=i,e},ko=J,Tf=re,Dh=Qe,kh=gt,oa=At.f,wf=er,sa=Zt,kl=ra,xc=kr,Ud=An,Qg=function(e){var t=function(i,o,a){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,a)}return Tf(e,this,arguments)};return t.prototype=e.prototype,t},qt=function(e,t){var i,o,a,l,u,f,m,_,v,S=e.target,C=e.global,b=e.stat,V=e.proto,P=C?ko:b?ko[S]:(ko[S]||{}).prototype,k=C?sa:sa[S]||xc(sa,S,{})[S],F=k.prototype;for(l in t)o=!(i=wf(C?l:S+(b?".":"#")+l,e.forced))&&P&&Ud(P,l),f=k[l],o&&(m=e.dontCallGetSet?(v=oa(P,l))&&v.value:P[l]),u=o&&m?m:t[l],o&&typeof f==typeof u||(_=e.bind&&o?kl(u,ko):e.wrap&&o?Qg(u):V&&kh(u)?Dh(u):u,(e.sham||u&&u.sham||f&&f.sham)&&xc(_,"sham",!0),xc(k,l,_),V&&(Ud(sa,a=S+"Prototype")||xc(sa,a,{}),xc(sa[a],l,u),e.real&&F&&(i||!F[l])&&xc(F,l,u)))},Ja=Math.ceil,jd=Math.floor,Za=Math.trunc||function(e){var t=+e;return(t>0?jd:Ja)(t)},e_=Za,Qa=function(e){var t=+e;return t!=t||t===0?0:e_(t)},ho=Qa,Cf=Math.max,bf=Math.min,Lh=function(e,t){var i=ho(e);return i<0?Cf(i+t,0):bf(i,t)},Mh=Qa,Uh=Math.min,Ll=function(e){return e>0?Uh(Mh(e),9007199254740991):0},Rf=Ll,Jr=function(e){return Rf(e.length)},t_=qr,Lo=Lh,Dc=Jr,jh=function(e){return function(t,i,o){var a,l=t_(t),u=Dc(l),f=Lo(o,u);if(e&&i!=i){for(;u>f;)if((a=l[f++])!=a)return!0}else for(;u>f;f++)if((e||f in l)&&l[f]===i)return e||f||0;return!e&&-1}},Mo={includes:jh(!0),indexOf:jh(!1)},Vh=Mo.includes;qt({target:"Array",proto:!0,forced:p(function(){return!Array(1).includes()})},{includes:function(e){return Vh(this,e,arguments.length>1?arguments[1]:void 0)}});var ec=Zt,Zr=function(e){return ec[e+"Prototype"]},tc=Zr("Array").includes,Ml=Fi,Vd=Se,If=Ri("match"),is=function(e){var t;return Ml(e)&&((t=e[If])!==void 0?!!t:Vd(e)=="RegExp")},Ul=is,Af=TypeError,jl={};jl[Ri("toStringTag")]="z";var Fd=String(jl)==="[object z]",ns=Fd,Of=gt,rs=Se,kc=Ri("toStringTag"),As=Object,Bd=rs(function(){return arguments}())=="Arguments",Uo=ns?rs:function(e){var t,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(a,l){try{return a[l]}catch{}}(t=As(e),kc))=="string"?i:Bd?rs(t):(o=rs(t))=="Object"&&Of(t.callee)?"Arguments":o},Wd=Uo,Vl=String,_r=function(e){if(Wd(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Vl(e)},zd=Ri("match"),Lc=qt,Hd=function(e){if(Ul(e))throw Af("The method doesn't accept regular expressions");return e},Fh=Jo,Gd=_r,i_=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[zd]=!1,"/./"[e](t)}catch{}}return!1},Fl=D("".indexOf);Lc({target:"String",proto:!0,forced:!i_("includes")},{includes:function(e){return!!~Fl(Gd(Fh(this)),Gd(Hd(e)),arguments.length>1?arguments[1]:void 0)}});var n_=Zr("String").includes,Kd=B,Bh=tc,Pf=n_,Wh=Array.prototype,po=String.prototype,qd=function(e){var t=e.includes;return e===Wh||Kd(Wh,e)&&t===Wh.includes?Bh:typeof e=="string"||e===po||Kd(po,e)&&t===po.includes?Pf:t},ke=d(qd),Yd=zt,r_=mr,Nf=gn,o_=Jr,Mc=TypeError,xf=function(e){return function(t,i,o,a){Yd(i);var l=r_(t),u=Nf(l),f=o_(l),m=e?f-1:0,_=e?-1:1;if(o<2)for(;;){if(m in u){a=u[m],m+=_;break}if(m+=_,e?m<0:f<=m)throw Mc("Reduce of empty array with no initial value")}for(;e?m>=0:f>m;m+=_)m in u&&(a=i(a,u[m],m,l));return a}},Uc={left:xf(!1),right:xf(!0)},Df=p,Bl=function(e,t){var i=[][e];return!!i&&Df(function(){i.call(null,t||function(){return 1},1)})},jc=typeof process<"u"&&Se(process)=="process",os=Uc.left;qt({target:"Array",proto:!0,forced:!jc&&lo>79&&lo<83||!Bl("reduce")},{reduce:function(e){var t=arguments.length;return os(this,e,t,t>1?arguments[1]:void 0)}});var kf=Zr("Array").reduce,Lf=B,Wl=kf,$d=Array.prototype,Vc=function(e){var t=e.reduce;return e===$d||Lf($d,e)&&t===$d.reduce?Wl:t},Fc=Vc,fo=d(Fc);let zh=!0,Mf=!0;function Bc(e,t,i){let o=e.match(t);return o&&o.length>=i&&parseInt(o[i],10)}function aa(e,t,i){if(!e.RTCPeerConnection)return;let o=e.RTCPeerConnection.prototype,a=o.addEventListener;o.addEventListener=function(u,f){if(u!==t)return a.apply(this,arguments);let m=_=>{let v=i(_);v&&(f.handleEvent?f.handleEvent(v):f(v))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(f,m),a.apply(this,[u,m])};let l=o.removeEventListener;o.removeEventListener=function(u,f){if(u!==t||!this._eventMap||!this._eventMap[t])return l.apply(this,arguments);if(!this._eventMap[t].has(f))return l.apply(this,arguments);let m=this._eventMap[t].get(f);return this._eventMap[t].delete(f),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[u,m])},Object.defineProperty(o,"on"+t,{get(){return this["_on"+t]},set(u){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),u&&this.addEventListener(t,this["_on"+t]=u)},enumerable:!0,configurable:!0})}function Uf(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(zh=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function jf(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Mf=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Hh(){if(typeof window=="object"){if(zh)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Gh(e,t){Mf&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Kh(e){return Object.prototype.toString.call(e)==="[object Object]"}function qh(e){var t;return Kh(e)?fo(t=Object.keys(e)).call(t,function(i,o){let a=Kh(e[o]),l=a?qh(e[o]):e[o],u=a&&!Object.keys(l).length;return l===void 0||u?i:Object.assign(i,{[o]:l})},{}):e}function Yh(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach(o=>{o.endsWith("Id")?Yh(e,e.get(t[o]),i):o.endsWith("Ids")&&t[o].forEach(a=>{Yh(e,e.get(a),i)})}))}function h(e,t,i){let o=i?"outbound-rtp":"inbound-rtp",a=new Map;if(t===null)return a;let l=[];return e.forEach(u=>{u.type==="track"&&u.trackIdentifier===t.id&&l.push(u)}),l.forEach(u=>{e.forEach(f=>{f.type===o&&f.trackId===u.id&&Yh(e,f,a)})}),a}var E=za,w=Wa("keys"),x=function(e){return w[e]||(w[e]=E(e))},z=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Q=An,ue=gt,we=mr,Ae=z,Ke=x("IE_PROTO"),nt=Object,Pt=nt.prototype,Nt=Ae?nt.getPrototypeOf:function(e){var t=we(e);if(Q(t,Ke))return t[Ke];var i=t.constructor;return ue(i)&&t instanceof i?i.prototype:t instanceof nt?Pt:null},tr=D,oi=zt,mo=gt,Lr=String,Wc=TypeError,s_=function(e,t,i){try{return tr(oi(Object.getOwnPropertyDescriptor(e,t)[i]))}catch{}},a_=gr,c_=function(e){if(typeof e=="object"||mo(e))return e;throw Wc("Can't set "+Lr(e)+" as a prototype")},Vf=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=s_(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch{}return function(o,a){return a_(o),c_(a),t?e(o,a):o.__proto__=a,o}}():void 0),Xd={},zc={},En=An,ic=qr,K=Mo.indexOf,A=zc,j=D([].push),G=function(e,t){var i,o=ic(e),a=0,l=[];for(i in o)!En(A,i)&&En(o,i)&&j(l,i);for(;t.length>a;)En(o,i=t[a++])&&(~K(l,i)||j(l,i));return l},ce=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Pe=G,tt=ce.concat("length","prototype");Xd.f=Object.getOwnPropertyNames||function(e){return Pe(e,tt)};var Ht={};Ht.f=Object.getOwnPropertySymbols;var Yt=lr,Un=Xd,$h=Ht,m8=gr,g8=D([].concat),_8=Yt("Reflect","ownKeys")||function(e){var t=Un.f(m8(e)),i=$h.f;return i?g8(t,i(e)):t},QN=An,E8=_8,v8=At,y8=br,zw={},S8=G,T8=ce,Zv=Object.keys||function(e){return S8(e,T8)},w8=yt,C8=Pl,b8=br,R8=gr,I8=qr,A8=Zv;zw.f=w8&&!C8?Object.defineProperties:function(e,t){R8(e);for(var i,o=I8(t),a=A8(t),l=a.length,u=0;l>u;)b8.f(e,i=a[u++],o[i]);return e};var Qv,ex=lr("document","documentElement"),O8=gr,P8=zw,tx=ce,N8=zc,x8=ex,D8=Ka,Hw="prototype",Gw="script",ix=x("IE_PROTO"),Kw=function(){},nx=function(e){return"<"+Gw+">"+e+"</"+Gw+">"},rx=function(e){e.write(nx("")),e.close();var t=e.parentWindow.Object;return e=null,t},ey=function(){try{Qv=new ActiveXObject("htmlfile")}catch{}var e,t,i;ey=typeof document<"u"?document.domain&&Qv?rx(Qv):(t=D8("iframe"),i="java"+Gw+":",t.style.display="none",x8.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(nx("document.F=Object")),e.close(),e.F):rx(Qv);for(var o=tx.length;o--;)delete ey[Hw][tx[o]];return ey()};N8[ix]=!0;var l_=Object.create||function(e,t){var i;return e!==null?(Kw[Hw]=O8(e),i=new Kw,Kw[Hw]=null,i[ix]=e):i=ey(),t===void 0?i:P8.f(i,t)},k8=Fi,L8=kr,ox=Error,M8=D("".replace),U8=String(ox("zxcasd").stack),sx=/\n\s*at [^:]*:[^\n]*/,j8=sx.test(U8),V8=lt,F8=!p(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",V8(1,7)),e.stack!==7)}),B8=kr,W8=function(e,t){if(j8&&typeof e=="string"&&!ox.prepareStackTrace)for(;t--;)e=M8(e,sx,"");return e},z8=F8,ax=Error.captureStackTrace,Xh={},H8=Xh,G8=Ri("iterator"),K8=Array.prototype,cx=function(e){return e!==void 0&&(H8.Array===e||K8[G8]===e)},q8=Uo,lx=Hn,Y8=Tn,$8=Xh,X8=Ri("iterator"),ty=function(e){if(!Y8(e))return lx(e,X8)||lx(e,"@@iterator")||$8[q8(e)]},J8=Je,Z8=zt,Q8=gr,eK=Zn,tK=ty,iK=TypeError,qw=function(e,t){var i=arguments.length<2?tK(e):t;if(Z8(i))return Q8(J8(i,e));throw iK(eK(e)+" is not iterable")},nK=Je,dx=gr,rK=Hn,ux=function(e,t,i){var o,a;dx(e);try{if(!(o=rK(e,"return"))){if(t==="throw")throw i;return i}o=nK(o,e)}catch(l){a=!0,o=l}if(t==="throw")throw i;if(a)throw o;return dx(o),i},oK=ra,sK=Je,aK=gr,cK=Zn,lK=cx,dK=Jr,hx=B,uK=qw,hK=ty,px=ux,pK=TypeError,iy=function(e,t){this.stopped=e,this.result=t},fx=iy.prototype,d_=function(e,t,i){var o,a,l,u,f,m,_,v=i&&i.that,S=!(!i||!i.AS_ENTRIES),C=!(!i||!i.IS_RECORD),b=!(!i||!i.IS_ITERATOR),V=!(!i||!i.INTERRUPTED),P=oK(t,v),k=function(H){return o&&px(o,"normal",H),new iy(!0,H)},F=function(H){return S?(aK(H),V?P(H[0],H[1],k):P(H[0],H[1])):V?P(H,k):P(H)};if(C)o=e.iterator;else if(b)o=e;else{if(!(a=hK(e)))throw pK(cK(e)+" is not iterable");if(lK(a)){for(l=0,u=dK(e);u>l;l++)if((f=F(e[l]))&&hx(fx,f))return f;return new iy(!1)}o=uK(e,a)}for(m=C?e.next:o.next;!(_=sK(m,o)).done;){try{f=F(_.value)}catch(H){px(o,"throw",H)}if(typeof f=="object"&&f&&hx(fx,f))return f}return new iy(!1)},fK=_r,mK=qt,gK=B,_K=Nt,ny=Vf,EK=function(e,t,i){for(var o=E8(t),a=y8.f,l=v8.f,u=0;u<o.length;u++){var f=o[u];QN(e,f)||i&&QN(i,f)||a(e,f,l(t,f))}},mx=l_,Yw=kr,$w=lt,vK=function(e,t){k8(t)&&"cause"in t&&L8(e,"cause",t.cause)},yK=function(e,t,i,o){z8&&(ax?ax(e,t):B8(e,"stack",W8(i,o)))},SK=d_,TK=function(e,t){return e===void 0?arguments.length<2?"":t:fK(e)},wK=Ri("toStringTag"),ry=Error,CK=[].push,Ff=function(e,t){var i,o=gK(Xw,this);ny?i=ny(ry(),o?_K(this):Xw):(i=o?this:mx(Xw),Yw(i,wK,"Error")),t!==void 0&&Yw(i,"message",TK(t)),yK(i,Ff,i.stack,1),arguments.length>2&&vK(i,arguments[2]);var a=[];return SK(e,CK,{that:a}),Yw(i,"errors",a),i};ny?ny(Ff,ry):EK(Ff,ry,{name:!0});var Xw=Ff.prototype=mx(ry.prototype,{constructor:$w(1,Ff),message:$w(1,""),name:$w(1,"AggregateError")});mK({global:!0,constructor:!0,arity:2},{AggregateError:Ff});var oy,u_,sy,bK=gt,gx=J.WeakMap,RK=bK(gx)&&/native code/.test(String(gx)),_x=J,IK=Fi,AK=kr,Jw=An,Zw=Il,OK=x,PK=zc,Ex="Object already initialized",Qw=_x.TypeError,NK=_x.WeakMap;if(RK||Zw.state){var Hc=Zw.state||(Zw.state=new NK);Hc.get=Hc.get,Hc.has=Hc.has,Hc.set=Hc.set,oy=function(e,t){if(Hc.has(e))throw Qw(Ex);return t.facade=e,Hc.set(e,t),t},u_=function(e){return Hc.get(e)||{}},sy=function(e){return Hc.has(e)}}else{var Bf=OK("state");PK[Bf]=!0,oy=function(e,t){if(Jw(e,Bf))throw Qw(Ex);return t.facade=e,AK(e,Bf,t),t},u_=function(e){return Jw(e,Bf)?e[Bf]:{}},sy=function(e){return Jw(e,Bf)}}var Jh,vx,yx,Zh={set:oy,get:u_,has:sy,enforce:function(e){return sy(e)?u_(e):oy(e,{})},getterFor:function(e){return function(t){var i;if(!IK(t)||(i=u_(t)).type!==e)throw Qw("Incompatible receiver, "+e+" required");return i}}},eC=yt,xK=An,Sx=Function.prototype,DK=eC&&Object.getOwnPropertyDescriptor,tC=xK(Sx,"name"),Tx={EXISTS:tC,PROPER:tC&&(function(){}).name==="something",CONFIGURABLE:tC&&(!eC||eC&&DK(Sx,"name").configurable)},kK=kr,Jd=function(e,t,i,o){return o&&o.enumerable?e[t]=i:kK(e,t,i),e},LK=p,MK=gt,UK=Fi,jK=l_,wx=Nt,VK=Jd,iC=Ri("iterator"),Cx=!1;[].keys&&("next"in(yx=[].keys())?(vx=wx(wx(yx)))!==Object.prototype&&(Jh=vx):Cx=!0);var FK=!UK(Jh)||LK(function(){var e={};return Jh[iC].call(e)!==e});MK((Jh=FK?{}:jK(Jh))[iC])||VK(Jh,iC,function(){return this});var bx={IteratorPrototype:Jh,BUGGY_SAFARI_ITERATORS:Cx},BK=Uo,WK=Fd?{}.toString:function(){return"[object "+BK(this)+"]"},zK=Fd,HK=br.f,GK=kr,KK=An,qK=WK,Rx=Ri("toStringTag"),Zd=function(e,t,i,o){if(e){var a=i?e:e.prototype;KK(a,Rx)||HK(a,Rx,{configurable:!0,value:t}),o&&!zK&&GK(a,"toString",qK)}},YK=bx.IteratorPrototype,$K=l_,XK=lt,JK=Zd,ZK=Xh,QK=function(){return this},nC=function(e,t,i,o){var a=t+" Iterator";return e.prototype=$K(YK,{next:XK(+!o,i)}),JK(e,a,!1,!0),ZK[a]=QK,e},e7=qt,t7=Je,i7=Tx,n7=nC,r7=Nt,o7=Zd,Ix=Jd,Ax=Xh,s7=bx,a7=i7.PROPER,ay=s7.BUGGY_SAFARI_ITERATORS,rC=Ri("iterator"),Ox="keys",cy="values",Px="entries",c7=function(){return this},Nx=function(e,t,i,o,a,l,u){n7(i,t,o);var f,m,_,v=function(F){if(F===a&&P)return P;if(!ay&&F in b)return b[F];switch(F){case Ox:case cy:case Px:return function(){return new i(this,F)}}return function(){return new i(this)}},S=t+" Iterator",C=!1,b=e.prototype,V=b[rC]||b["@@iterator"]||a&&b[a],P=!ay&&V||v(a),k=t=="Array"&&b.entries||V;if(k&&(f=r7(k.call(new e)))!==Object.prototype&&f.next&&(o7(f,S,!0,!0),Ax[S]=c7),a7&&a==cy&&V&&V.name!==cy&&(C=!0,P=function(){return t7(V,this)}),a)if(m={values:v(cy),keys:l?P:v(Ox),entries:v(Px)},u)for(_ in m)(ay||C||!(_ in b))&&Ix(b,_,m[_]);else e7({target:t,proto:!0,forced:ay||C},m);return u&&b[rC]!==P&&Ix(b,rC,P,{name:a}),Ax[t]=P,m},oC=function(e,t){return{value:e,done:t}},l7=qr,xx=Xh,Dx=Zh;br.f;var d7=Nx,kx=oC,Lx="Array Iterator",u7=Dx.set,h7=Dx.getterFor(Lx);d7(Array,"Array",function(e,t){u7(this,{type:Lx,target:l7(e),index:0,kind:t})},function(){var e=h7(this),t=e.target,i=e.kind,o=e.index++;return!t||o>=t.length?(e.target=void 0,kx(void 0,!0)):kx(i=="keys"?o:i=="values"?t[o]:[o,t[o]],!1)},"values"),xx.Arguments=xx.Array;var p7=br,ly=function(e,t,i){return p7.f(e,t,i)},f7=lr,m7=ly,g7=yt,Mx=Ri("species"),_7=B,E7=TypeError,sC=function(e,t){if(_7(t,e))return e;throw E7("Incorrect invocation")},v7=gt,aC=Il,y7=D(Function.toString);v7(aC.inspectSource)||(aC.inspectSource=function(e){return y7(e)});var Ux=aC.inspectSource,S7=D,T7=p,jx=gt,w7=Uo,C7=Ux,Vx=function(){},b7=[],Fx=lr("Reflect","construct"),cC=/^\s*(?:class|function)\b/,R7=S7(cC.exec),I7=!cC.exec(Vx),h_=function(e){if(!jx(e))return!1;try{return Fx(Vx,b7,e),!0}catch{return!1}},Bx=function(e){if(!jx(e))return!1;switch(w7(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return I7||!!R7(cC,C7(e))}catch{return!0}};Bx.sham=!0;var p_,Wf,Wx,lC,dy=!Fx||T7(function(){var e;return h_(h_.call)||!h_(Object)||!h_(function(){e=!0})||e})?Bx:h_,A7=dy,O7=Zn,P7=TypeError,zx=gr,N7=function(e){if(A7(e))return e;throw P7(O7(e)+" is not a constructor")},x7=Tn,D7=Ri("species"),dC=function(e,t){var i,o=zx(e).constructor;return o===void 0||x7(i=zx(o)[D7])?t:N7(i)},uC=D([].slice),k7=TypeError,uy=function(e,t){if(e<t)throw k7("Not enough arguments");return e},Hx=/(?:ipad|iphone|ipod).*applewebkit/i.test(Zo),Os=J,L7=re,M7=ra,Gx=gt,U7=An,Kx=p,qx=ex,j7=uC,Yx=Ka,V7=uy,F7=Hx,B7=jc,hC=Os.setImmediate,pC=Os.clearImmediate,W7=Os.process,fC=Os.Dispatch,z7=Os.Function,$x=Os.MessageChannel,H7=Os.String,mC=0,f_={},Xx="onreadystatechange";Kx(function(){p_=Os.location});var gC=function(e){if(U7(f_,e)){var t=f_[e];delete f_[e],t()}},_C=function(e){return function(){gC(e)}},Jx=function(e){gC(e.data)},Zx=function(e){Os.postMessage(H7(e),p_.protocol+"//"+p_.host)};hC&&pC||(hC=function(e){V7(arguments.length,1);var t=Gx(e)?e:z7(e),i=j7(arguments,1);return f_[++mC]=function(){L7(t,void 0,i)},Wf(mC),mC},pC=function(e){delete f_[e]},B7?Wf=function(e){W7.nextTick(_C(e))}:fC&&fC.now?Wf=function(e){fC.now(_C(e))}:$x&&!F7?(lC=(Wx=new $x).port2,Wx.port1.onmessage=Jx,Wf=M7(lC.postMessage,lC)):Os.addEventListener&&Gx(Os.postMessage)&&!Os.importScripts&&p_&&p_.protocol!=="file:"&&!Kx(Zx)?(Wf=Zx,Os.addEventListener("message",Jx,!1)):Wf=Xx in Yx("script")?function(e){qx.appendChild(Yx("script"))[Xx]=function(){qx.removeChild(this),gC(e)}}:function(e){setTimeout(_C(e),0)});var Qx={set:hC,clear:pC},eD=function(){this.head=null,this.tail=null};eD.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var zf,EC,vC,yC,tD,iD=eD,G7=/ipad|iphone|ipod/i.test(Zo)&&typeof Pebble<"u",K7=/web0s(?!.*chrome)/i.test(Zo),Qh=J,nD=ra,q7=At.f,SC=Qx.set,Y7=iD,$7=Hx,X7=G7,J7=K7,TC=jc,rD=Qh.MutationObserver||Qh.WebKitMutationObserver,oD=Qh.document,sD=Qh.process,hy=Qh.Promise,aD=q7(Qh,"queueMicrotask"),wC=aD&&aD.value;if(!wC){var py=new Y7,fy=function(){var e,t;for(TC&&(e=sD.domain)&&e.exit();t=py.get();)try{t()}catch(i){throw py.head&&zf(),i}e&&e.enter()};$7||TC||J7||!rD||!oD?!X7&&hy&&hy.resolve?((yC=hy.resolve(void 0)).constructor=hy,tD=nD(yC.then,yC),zf=function(){tD(fy)}):TC?zf=function(){sD.nextTick(fy)}:(SC=nD(SC,Qh),zf=function(){SC(fy)}):(EC=!0,vC=oD.createTextNode(""),new rD(fy).observe(vC,{characterData:!0}),zf=function(){vC.data=EC=!EC}),wC=function(e){py.head||zf(),py.add(e)}}var Z7=wC,Hf=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},ep=J.Promise,cD=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Q7=!cD&&!jc&&typeof window=="object"&&typeof document=="object",e9=J,m_=ep,t9=gt,i9=er,n9=Ux,r9=Ri,o9=Q7,s9=cD,CC=lo,lD=m_&&m_.prototype,a9=r9("species"),dD=!1,uD=t9(e9.PromiseRejectionEvent),c9=i9("Promise",function(){var e=n9(m_),t=e!==String(m_);if(!t&&CC===66||!lD.catch||!lD.finally)return!0;if(!CC||CC<51||!/native code/.test(e)){var i=new m_(function(a){a(1)}),o=function(a){a(function(){},function(){})};if((i.constructor={})[a9]=o,!(dD=i.then(function(){})instanceof o))return!0}return!t&&(o9||s9)&&!uD}),g_={CONSTRUCTOR:c9,REJECTION_EVENT:uD,SUBCLASSING:dD},Gc={},hD=zt,l9=TypeError,d9=function(e){var t,i;this.promise=new e(function(o,a){if(t!==void 0||i!==void 0)throw l9("Bad Promise constructor");t=o,i=a}),this.resolve=hD(t),this.reject=hD(i)};Gc.f=function(e){return new d9(e)};var bC,pD,u9=qt,my=jc,Qd=J,__=Je,h9=Jd,p9=Zd,f9=function(e){var t=f7(e);g7&&t&&!t[Mx]&&m7(t,Mx,{configurable:!0,get:function(){return this}})},m9=zt,RC=gt,g9=Fi,_9=sC,E9=dC,fD=Qx.set,IC=Z7,v9=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},y9=Hf,S9=iD,mD=Zh,AC=ep,gD=g_,_D=Gc,gy="Promise",ED=gD.CONSTRUCTOR,T9=gD.REJECTION_EVENT,OC=mD.getterFor(gy),w9=mD.set,C9=AC&&AC.prototype,E_=AC,PC=C9,vD=Qd.TypeError,NC=Qd.document,xC=Qd.process,DC=_D.f,b9=DC,R9=!!(NC&&NC.createEvent&&Qd.dispatchEvent),yD="unhandledrejection",SD=function(e){var t;return!(!g9(e)||!RC(t=e.then))&&t},TD=function(e,t){var i,o,a,l=t.value,u=t.state==1,f=u?e.ok:e.fail,m=e.resolve,_=e.reject,v=e.domain;try{f?(u||(t.rejection===2&&A9(t),t.rejection=1),f===!0?i=l:(v&&v.enter(),i=f(l),v&&(v.exit(),a=!0)),i===e.promise?_(vD("Promise-chain cycle")):(o=SD(i))?__(o,i,m,_):m(i)):_(l)}catch(S){v&&!a&&v.exit(),_(S)}},wD=function(e,t){e.notified||(e.notified=!0,IC(function(){for(var i,o=e.reactions;i=o.get();)TD(i,e);e.notified=!1,t&&!e.rejection&&I9(e)}))},CD=function(e,t,i){var o,a;R9?((o=NC.createEvent("Event")).promise=t,o.reason=i,o.initEvent(e,!1,!0),Qd.dispatchEvent(o)):o={promise:t,reason:i},!T9&&(a=Qd["on"+e])?a(o):e===yD&&v9("Unhandled promise rejection",i)},I9=function(e){__(fD,Qd,function(){var t,i=e.facade,o=e.value;if(bD(e)&&(t=y9(function(){my?xC.emit("unhandledRejection",o,i):CD(yD,i,o)}),e.rejection=my||bD(e)?2:1,t.error))throw t.value})},bD=function(e){return e.rejection!==1&&!e.parent},A9=function(e){__(fD,Qd,function(){var t=e.facade;my?xC.emit("rejectionHandled",t):CD("rejectionhandled",t,e.value)})},Gf=function(e,t,i){return function(o){e(t,o,i)}},Kf=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,wD(e,!0))},kC=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw vD("Promise can't be resolved itself");var o=SD(t);o?IC(function(){var a={done:!1};try{__(o,t,Gf(kC,a,e),Gf(Kf,a,e))}catch(l){Kf(a,l,e)}}):(e.value=t,e.state=1,wD(e,!1))}catch(a){Kf({done:!1},a,e)}}};ED&&(PC=(E_=function(e){_9(this,PC),m9(e),__(bC,this);var t=OC(this);try{e(Gf(kC,t),Gf(Kf,t))}catch(i){Kf(t,i)}}).prototype,(bC=function(e){w9(this,{type:gy,done:!1,notified:!1,parent:!1,reactions:new S9,rejection:!1,state:0,value:void 0})}).prototype=h9(PC,"then",function(e,t){var i=OC(this),o=DC(E9(this,E_));return i.parent=!0,o.ok=!RC(e)||e,o.fail=RC(t)&&t,o.domain=my?xC.domain:void 0,i.state==0?i.reactions.add(o):IC(function(){TD(o,i)}),o.promise}),pD=function(){var e=new bC,t=OC(e);this.promise=e,this.resolve=Gf(kC,t),this.reject=Gf(Kf,t)},_D.f=DC=function(e){return e===E_||e===void 0?new pD(e):b9(e)}),u9({global:!0,constructor:!0,wrap:!0,forced:ED},{Promise:E_}),p9(E_,gy,!1,!0),f9(gy);var RD=Ri("iterator"),ID=!1;try{var O9=0,AD={next:function(){return{done:!!O9++}},return:function(){ID=!0}};AD[RD]=function(){return this},Array.from(AD,function(){throw 2})}catch{}var P9=ep,N9=function(e,t){if(!ID)return!1;var i=!1;try{var o={};o[RD]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},_y=g_.CONSTRUCTOR||!N9(function(e){P9.all(e).then(void 0,function(){})}),x9=Je,D9=zt,k9=Gc,L9=Hf,M9=d_;qt({target:"Promise",stat:!0,forced:_y},{all:function(e){var t=this,i=k9.f(t),o=i.resolve,a=i.reject,l=L9(function(){var u=D9(t.resolve),f=[],m=0,_=1;M9(e,function(v){var S=m++,C=!1;_++,x9(u,t,v).then(function(b){C||(C=!0,f[S]=b,--_||o(f))},a)}),--_||o(f)});return l.error&&a(l.value),i.promise}});var U9=qt,j9=g_.CONSTRUCTOR;ep&&ep.prototype,U9({target:"Promise",proto:!0,forced:j9,real:!0},{catch:function(e){return this.then(void 0,e)}});var V9=Je,F9=zt,B9=Gc,W9=Hf,z9=d_;qt({target:"Promise",stat:!0,forced:_y},{race:function(e){var t=this,i=B9.f(t),o=i.reject,a=W9(function(){var l=F9(t.resolve);z9(e,function(u){V9(l,t,u).then(i.resolve,o)})});return a.error&&o(a.value),i.promise}});var H9=Je,G9=Gc;qt({target:"Promise",stat:!0,forced:g_.CONSTRUCTOR},{reject:function(e){var t=G9.f(this);return H9(t.reject,void 0,e),t.promise}});var K9=gr,q9=Fi,Y9=Gc,OD=function(e,t){if(K9(e),q9(t)&&t.constructor===e)return t;var i=Y9.f(e);return(0,i.resolve)(t),i.promise},$9=qt,X9=ep,J9=g_.CONSTRUCTOR,Z9=OD,Q9=lr("Promise"),eq=!J9;$9({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Z9(eq&&this===Q9?X9:this,e)}});var tq=Je,iq=zt,nq=Gc,rq=Hf,oq=d_;qt({target:"Promise",stat:!0,forced:_y},{allSettled:function(e){var t=this,i=nq.f(t),o=i.resolve,a=i.reject,l=rq(function(){var u=iq(t.resolve),f=[],m=0,_=1;oq(e,function(v){var S=m++,C=!1;_++,tq(u,t,v).then(function(b){C||(C=!0,f[S]={status:"fulfilled",value:b},--_||o(f))},function(b){C||(C=!0,f[S]={status:"rejected",reason:b},--_||o(f))})}),--_||o(f)});return l.error&&a(l.value),i.promise}});var sq=Je,aq=zt,cq=lr,lq=Gc,dq=Hf,uq=d_,PD="No one promise resolved";qt({target:"Promise",stat:!0,forced:_y},{any:function(e){var t=this,i=cq("AggregateError"),o=lq.f(t),a=o.resolve,l=o.reject,u=dq(function(){var f=aq(t.resolve),m=[],_=0,v=1,S=!1;uq(e,function(C){var b=_++,V=!1;v++,sq(f,t,C).then(function(P){V||S||(S=!0,a(P))},function(P){V||S||(V=!0,m[b]=P,--v||l(new i(m,PD)))})}),--v||l(new i(m,PD))});return u.error&&l(u.value),o.promise}});var hq=qt,LC=ep,pq=p,fq=lr,mq=gt,gq=dC,ND=OD,_q=LC&&LC.prototype;hq({target:"Promise",proto:!0,real:!0,forced:!!LC&&pq(function(){_q.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=gq(this,fq("Promise")),i=mq(e);return this.then(i?function(o){return ND(t,e()).then(function(){return o})}:e,i?function(o){return ND(t,e()).then(function(){throw o})}:e)}});var MC=D,Eq=Qa,vq=_r,yq=Jo,Sq=MC("".charAt),xD=MC("".charCodeAt),Tq=MC("".slice),DD=function(e){return function(t,i){var o,a,l=vq(yq(t)),u=Eq(i),f=l.length;return u<0||u>=f?e?"":void 0:(o=xD(l,u))<55296||o>56319||u+1===f||(a=xD(l,u+1))<56320||a>57343?e?Sq(l,u):o:e?Tq(l,u,u+2):a-56320+(o-55296<<10)+65536}},UC={codeAt:DD(!1),charAt:DD(!0)},wq=UC.charAt,Cq=_r,kD=Zh,bq=Nx,LD=oC,MD="String Iterator",Rq=kD.set,Iq=kD.getterFor(MD);bq(String,"String",function(e){Rq(this,{type:MD,string:Cq(e),index:0})},function(){var e,t=Iq(this),i=t.string,o=t.index;return o>=i.length?LD(void 0,!0):(e=wq(i,o),t.index+=e.length,LD(e,!1))});var Aq=Zt.Promise,Oq={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Pq=J,Nq=Uo,xq=kr,UD=Xh,jD=Ri("toStringTag");for(var jC in Oq){var VD=Pq[jC],VC=VD&&VD.prototype;VC&&Nq(VC)!==jD&&xq(VC,jD,jC),UD[jC]=UD.Array}var FD=Aq,De=d(FD);let BD=Hh;function WD(e,t){let i=e&&e.navigator;if(!i.mediaDevices)return;let o=function(u){if(typeof u!="object"||u.mandatory||u.optional)return u;let f={};return Object.keys(u).forEach(m=>{if(m==="require"||m==="advanced"||m==="mediaSource")return;let _=typeof u[m]=="object"?u[m]:{ideal:u[m]};_.exact!==void 0&&typeof _.exact=="number"&&(_.min=_.max=_.exact);let v=function(S,C){return S?S+C.charAt(0).toUpperCase()+C.slice(1):C==="deviceId"?"sourceId":C};if(_.ideal!==void 0){f.optional=f.optional||[];let S={};typeof _.ideal=="number"?(S[v("min",m)]=_.ideal,f.optional.push(S),S={},S[v("max",m)]=_.ideal,f.optional.push(S)):(S[v("",m)]=_.ideal,f.optional.push(S))}_.exact!==void 0&&typeof _.exact!="number"?(f.mandatory=f.mandatory||{},f.mandatory[v("",m)]=_.exact):["min","max"].forEach(S=>{_[S]!==void 0&&(f.mandatory=f.mandatory||{},f.mandatory[v(S,m)]=_[S])})}),u.advanced&&(f.optional=(f.optional||[]).concat(u.advanced)),f},a=function(u,f){if(t.version>=61)return f(u);if((u=JSON.parse(JSON.stringify(u)))&&typeof u.audio=="object"){let m=function(_,v,S){v in _&&!(S in _)&&(_[S]=_[v],delete _[v])};m((u=JSON.parse(JSON.stringify(u))).audio,"autoGainControl","googAutoGainControl"),m(u.audio,"noiseSuppression","googNoiseSuppression"),u.audio=o(u.audio)}if(u&&typeof u.video=="object"){let m=u.video.facingMode;m=m&&(typeof m=="object"?m:{ideal:m});let _=t.version<66;if(m&&(m.exact==="user"||m.exact==="environment"||m.ideal==="user"||m.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||_)){let v;if(delete u.video.facingMode,m.exact==="environment"||m.ideal==="environment"?v=["back","rear"]:m.exact!=="user"&&m.ideal!=="user"||(v=["front"]),v)return i.mediaDevices.enumerateDevices().then(S=>{let C=(S=S.filter(b=>b.kind==="videoinput")).find(b=>v.some(V=>{var P;return ke(P=b.label.toLowerCase()).call(P,V)}));return!C&&S.length&&ke(v).call(v,"back")&&(C=S[S.length-1]),C&&(u.video.deviceId=m.exact?{exact:C.deviceId}:{ideal:C.deviceId}),u.video=o(u.video),BD("chrome: "+JSON.stringify(u)),f(u)})}u.video=o(u.video)}return BD("chrome: "+JSON.stringify(u)),f(u)},l=function(u){return t.version>=64?u:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[u.name]||u.name,message:u.message,constraint:u.constraint||u.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(u,f,m){a(u,_=>{i.webkitGetUserMedia(_,f,v=>{m&&m(l(v))})})}).bind(i),i.mediaDevices.getUserMedia){let u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(f){return a(f,m=>u(m).then(_=>{if(m.audio&&!_.getAudioTracks().length||m.video&&!_.getVideoTracks().length)throw _.getTracks().forEach(v=>{v.stop()}),new DOMException("","NotFoundError");return _},_=>De.reject(l(_))))}}}function zD(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function HD(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===o.track.id):{track:o.track};let l=new Event("track");l.track=o.track,l.receiver=a,l.transceiver={receiver:a},l.streams=[i.stream],this.dispatchEvent(l)}),i.stream.getTracks().forEach(o=>{let a;a=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(u=>u.track&&u.track.id===o.id):{track:o};let l=new Event("track");l.track=o,l.receiver=a,l.transceiver={receiver:a},l.streams=[i.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else aa(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function GD(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(a,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=a.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:a}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,f){let m=a.apply(this,arguments);return m||(m=t(this,u),this._senders.push(m)),m};let l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){l.apply(this,arguments);let f=this._senders.indexOf(u);f!==-1&&this._senders.splice(f,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._senders=this._senders||[],i.apply(this,[a]),a.getTracks().forEach(l=>{this._senders.push(t(this,l))})};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){this._senders=this._senders||[],o.apply(this,[a]),a.getTracks().forEach(l=>{let u=this._senders.find(f=>f.track===l);u&&this._senders.splice(this._senders.indexOf(u),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function KD(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,o,a]=arguments;if(arguments.length>0&&typeof i=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof i!="function"))return t.apply(this,[]);let l=function(f){let m={};return f.result().forEach(_=>{let v={id:_.id,timestamp:_.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_.type]||_.type};_.names().forEach(S=>{v[S]=_.stat(S)}),m[v.id]=v}),m},u=function(f){return new Map(Object.keys(f).map(m=>[m,f[m]]))};if(arguments.length>=2){let f=function(m){o(u(l(m)))};return t.apply(this,[f,i])}return new De((f,m)=>{t.apply(this,[function(_){f(u(l(_)))},m])}).then(o,a)}}function qD(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let a=i.apply(this,[]);return a.forEach(l=>l._pc=this),a});let o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){let a=o.apply(this,arguments);return a._pc=this,a}),e.RTCRtpSender.prototype.getStats=function(){let a=this;return this._pc.getStats().then(l=>h(l,a.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let o=i.apply(this,[]);return o.forEach(a=>a._pc=this),o}),aa(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){let o=this;return this._pc.getStats().then(a=>h(a,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],o,a,l;return this.getSenders().forEach(u=>{u.track===i&&(o?l=!0:o=u)}),this.getReceivers().forEach(u=>(u.track===i&&(a?l=!0:a=u),u.track===i)),l||o&&a?De.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():a?a.getStats():De.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function YD(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){if(!u)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let f=t.apply(this,arguments);return this._shimmedLocalStreams[u.id]?this._shimmedLocalStreams[u.id].indexOf(f)===-1&&this._shimmedLocalStreams[u.id].push(f):this._shimmedLocalStreams[u.id]=[u,f],f};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")});let u=this.getSenders();i.apply(this,arguments);let f=this.getSenders().filter(m=>u.indexOf(m)===-1);this._shimmedLocalStreams[l.id]=[l].concat(f)};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],o.apply(this,arguments)};let a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(u=>{let f=this._shimmedLocalStreams[u].indexOf(l);f!==-1&&this._shimmedLocalStreams[u].splice(f,1),this._shimmedLocalStreams[u].length===1&&delete this._shimmedLocalStreams[u]}),a.apply(this,arguments)}}function $D(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return YD(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let m=i.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(_=>this._reverseStreams[_.id])};let o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(_=>{if(this.getSenders().find(v=>v.track===_))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){let _=new e.MediaStream(m.getTracks());this._streams[m.id]=_,this._reverseStreams[_.id]=m,m=_}o.apply(this,[m])};let a=e.RTCPeerConnection.prototype.removeStream;function l(m,_){let v=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(S=>{let C=m._reverseStreams[S],b=m._streams[C.id];v=v.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:_.type,sdp:v})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let v=[].slice.call(arguments,1);if(v.length!==1||!v[0].getTracks().find(C=>C===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let S=this._streams[_.id];if(S)S.addTrack(m),De.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let C=new e.MediaStream([m]);this._streams[_.id]=C,this._reverseStreams[C.id]=_,this.addStream(C)}return this.getSenders().find(C=>C.track===m)},["createOffer","createAnswer"].forEach(function(m){let _=e.RTCPeerConnection.prototype[m],v={[m](){let S=arguments;return arguments.length&&typeof arguments[0]=="function"?_.apply(this,[C=>{let b=l(this,C);S[0].apply(null,[b])},C=>{S[1]&&S[1].apply(null,C)},arguments[2]]):_.apply(this,arguments).then(C=>l(this,C))}};e.RTCPeerConnection.prototype[m]=v[m]});let u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(m,_){let v=_.sdp;return Object.keys(m._reverseStreams||[]).forEach(S=>{let C=m._reverseStreams[S],b=m._streams[C.id];v=v.replace(new RegExp(C.id,"g"),b.id)}),new RTCSessionDescription({type:_.type,sdp:v})}(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};let f=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let m=f.get.apply(this);return m.type===""?m:l(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _;this._streams=this._streams||{},Object.keys(this._streams).forEach(v=>{this._streams[v].getTracks().find(S=>m.track===S)&&(_=this._streams[v])}),_&&(_.getTracks().length===1?this.removeStream(this._reverseStreams[_.id]):_.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function FC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let o=e.RTCPeerConnection.prototype[i],a={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=a[i]})}function XD(e,t){aa(e,"negotiationneeded",i=>{let o=i.target;if(!(t.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var JD=Object.freeze({__proto__:null,fixNegotiationNeeded:XD,shimAddTrackRemoveTrack:$D,shimAddTrackRemoveTrackWithNative:YD,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then(o=>{let a=i.video&&i.video.width,l=i.video&&i.video.height,u=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:u||3}},a&&(i.video.mandatory.maxWidth=a),l&&(i.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:GD,shimGetStats:KD,shimGetUserMedia:WD,shimMediaStream:zD,shimOnTrack:HD,shimPeerConnection:FC,shimSenderReceiverGetStats:qD});function ZD(e,t){let i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(a,l,u){Gh("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(a).then(l,u)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let a=function(u,f,m){f in u&&!(m in u)&&(u[m]=u[f],delete u[f])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(u){return typeof u=="object"&&typeof u.audio=="object"&&(u=JSON.parse(JSON.stringify(u)),a(u.audio,"autoGainControl","mozAutoGainControl"),a(u.audio,"noiseSuppression","mozNoiseSuppression")),l(u)},o&&o.prototype.getSettings){let u=o.prototype.getSettings;o.prototype.getSettings=function(){let f=u.apply(this,arguments);return a(f,"mozAutoGainControl","autoGainControl"),a(f,"mozNoiseSuppression","noiseSuppression"),f}}if(o&&o.prototype.applyConstraints){let u=o.prototype.applyConstraints;o.prototype.applyConstraints=function(f){return this.kind==="audio"&&typeof f=="object"&&(f=JSON.parse(JSON.stringify(f)),a(f,"autoGainControl","mozAutoGainControl"),a(f,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[f])}}}}function QD(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function BC(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){let l=e.RTCPeerConnection.prototype[a],u={[a](){return arguments[0]=new(a==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[a]=u[a]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[a,l,u]=arguments;return o.apply(this,[a||null]).then(f=>{if(t.version<53&&!l)try{f.forEach(m=>{m.type=i[m.type]||m.type})}catch(m){if(m.name!=="TypeError")throw m;f.forEach((_,v)=>{f.set(v,Object.assign({},_,{type:i[_.type]||_.type}))})}return f}).then(l,u)}}function ek(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=t.apply(this,[]);return o.forEach(a=>a._pc=this),o});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):De.resolve(new Map)}}function tk(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i}),aa(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ik(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Gh("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&ke(o=t.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function nk(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function rk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let o=i.length>0;o&&i.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let a=t.apply(this,arguments);if(o){let{sender:l}=a,u=l.getParameters();(!("encodings"in u)||u.encodings.length===1&&Object.keys(u.encodings[0]).length===0)&&(u.encodings=i,l.sendEncodings=i,this.setParametersPromises.push(l.setParameters(u).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return a})}function ok(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function sk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function ak(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var ck=Object.freeze({__proto__:null,shimAddTransceiver:rk,shimCreateAnswer:ak,shimCreateOffer:sk,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,De.reject(o)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:ok,shimGetUserMedia:ZD,shimOnTrack:QD,shimPeerConnection:BC,shimRTCDataChannel:nk,shimReceiverGetStats:tk,shimRemoveStream:ik,shimSenderGetStats:ek});function lk(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),ke(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>t.call(this,a,i)),i.getVideoTracks().forEach(a=>t.call(this,a,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return a&&a.forEach(u=>{var f;this._localStreams?ke(f=this._localStreams).call(f,u)||this._localStreams.push(u):this._localStreams=[u]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(t);if(i===-1)return;this._localStreams.splice(i,1);let o=t.getTracks();this.getSenders().forEach(a=>{ke(o).call(o,a.track)&&this.removeTrack(a)})})}}function dk(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(a=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),ke(l=this._remoteStreams).call(l,a))return;this._remoteStreams.push(a);let u=new Event("addstream");u.stream=a,this.dispatchEvent(u)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(a=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(a)>=0)return;i._remoteStreams.push(a);let l=new Event("addstream");l.stream=a,i.dispatchEvent(l)})}),t.apply(i,arguments)}}}function uk(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,i=t.createOffer,o=t.createAnswer,a=t.setLocalDescription,l=t.setRemoteDescription,u=t.addIceCandidate;t.createOffer=function(m,_){let v=arguments.length>=2?arguments[2]:arguments[0],S=i.apply(this,[v]);return _?(S.then(m,_),De.resolve()):S},t.createAnswer=function(m,_){let v=arguments.length>=2?arguments[2]:arguments[0],S=o.apply(this,[v]);return _?(S.then(m,_),De.resolve()):S};let f=function(m,_,v){let S=a.apply(this,[m]);return v?(S.then(_,v),De.resolve()):S};t.setLocalDescription=f,f=function(m,_,v){let S=l.apply(this,[m]);return v?(S.then(_,v),De.resolve()):S},t.setRemoteDescription=f,f=function(m,_,v){let S=u.apply(this,[m]);return v?(S.then(_,v),De.resolve()):S},t.addIceCandidate=f}function hk(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let i=t.mediaDevices,o=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=a=>o(pk(a))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,o,a){t.mediaDevices.getUserMedia(i).then(o,a)}).bind(t))}function pk(e){return e&&e.video!==void 0?Object.assign({},e,{video:qh(e.video)}):e}function fk(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){let a=[];for(let l=0;l<i.iceServers.length;l++){let u=i.iceServers[l];!u.hasOwnProperty("urls")&&u.hasOwnProperty("url")?(Gh("RTCIceServer.url","RTCIceServer.urls"),u=JSON.parse(JSON.stringify(u)),u.urls=u.url,delete u.url,a.push(u)):a.push(i.iceServers[l])}i.iceServers=a}return new t(i,o)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function mk(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gk(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let o=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let a=this.getTransceivers().find(l=>l.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveVideo!==!0||a||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function _k(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Ek=Object.freeze({__proto__:null,shimAudioContext:_k,shimCallbacksAPI:uk,shimConstraints:pk,shimCreateOfferLegacy:gk,shimGetUserMedia:hk,shimLocalStreamsAPI:lk,shimRTCIceServerUrls:fk,shimRemoteStreamsAPI:dk,shimTrackEventTransceiver:mk}),vk=`	
\v\f\r \u2028\u2029\uFEFF`,Dq=Jo,kq=_r,WC=vk,yk=D("".replace),Lq=RegExp("^["+WC+"]+"),Mq=RegExp("(^|[^"+WC+"])["+WC+"]+$"),zC=function(e){return function(t){var i=kq(Dq(t));return 1&e&&(i=yk(i,Lq,"")),2&e&&(i=yk(i,Mq,"$1")),i}},Uq={start:zC(1),end:zC(2),trim:zC(3)},jq=Tx.PROPER,Vq=p,Sk=vk,Fq=Uq.trim;qt({target:"String",proto:!0,forced:function(e){return Vq(function(){return!!Sk[e]()||""[e]()!==""||jq&&Sk[e].name!==e})}("trim")},{trim:function(){return Fq(this)}});var Bq=Zr("String").trim,Wq=B,zq=Bq,HC=String.prototype,Hq=function(e){var t=e.trim;return typeof e=="string"||e===HC||Wq(HC,e)&&t===HC.trim?zq:t},Rr=d(Hq),Tk={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},t.splitSections=function(i){return i.split(`
m=`).map((o,a)=>(a>0?"m="+o:o).trim()+`\r
`)},t.getDescription=function(i){let o=t.splitSections(i);return o&&o[0]},t.getMediaSections=function(i){let o=t.splitSections(i);return o.shift(),o},t.matchPrefix=function(i,o){return t.splitLines(i).filter(a=>a.indexOf(o)===0)},t.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let a={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let l=8;l<o.length;l+=2)switch(o[l]){case"raddr":a.relatedAddress=o[l+1];break;case"rport":a.relatedPort=parseInt(o[l+1],10);break;case"tcptype":a.tcpType=o[l+1];break;case"ufrag":a.ufrag=o[l+1],a.usernameFragment=o[l+1];break;default:a[o[l]]===void 0&&(a[o[l]]=o[l+1])}return a},t.writeCandidate=function(i){let o=[];o.push(i.foundation);let a=i.component;a==="rtp"?o.push(1):a==="rtcp"?o.push(2):o.push(a),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);let l=i.type;return o.push("typ"),o.push(l),l!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},t.parseIceOptions=function(i){return i.substring(14).split(" ")},t.parseRtpMap=function(i){let o=i.substring(9).split(" "),a={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),a.name=o[0],a.clockRate=parseInt(o[1],10),a.channels=o.length===3?parseInt(o[2],10):1,a.numChannels=a.channels,a},t.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);let a=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(a!==1?"/"+a:"")+`\r
`},t.parseExtmap=function(i){let o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},t.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},t.parseFmtp=function(i){let o={},a,l=i.substring(i.indexOf(" ")+1).split(";");for(let u=0;u<l.length;u++)a=l[u].trim().split("="),o[a[0].trim()]=a[1];return o},t.writeFmtp=function(i){let o="",a=i.payloadType;if(i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let l=[];Object.keys(i.parameters).forEach(u=>{i.parameters[u]!==void 0?l.push(u+"="+i.parameters[u]):l.push(u)}),o+="a=fmtp:"+a+" "+l.join(";")+`\r
`}return o},t.parseRtcpFb=function(i){let o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},t.writeRtcpFb=function(i){let o="",a=i.payloadType;return i.preferredPayloadType!==void 0&&(a=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(l=>{o+="a=rtcp-fb:"+a+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),o},t.parseSsrcMedia=function(i){let o=i.indexOf(" "),a={ssrc:parseInt(i.substring(7,o),10)},l=i.indexOf(":",o);return l>-1?(a.attribute=i.substring(o+1,l),a.value=i.substring(l+1)):a.attribute=i.substring(o+1),a},t.parseSsrcGroup=function(i){let o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(a=>parseInt(a,10))}},t.getMid=function(i){let o=t.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},t.parseFingerprint=function(i){let o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},t.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:t.matchPrefix(i+o,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(i,o){let a="a=setup:"+o+`\r
`;return i.fingerprints.forEach(l=>{a+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),a},t.parseCryptoLine=function(i){let o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},t.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?t.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},t.getCryptoParameters=function(i,o){return t.matchPrefix(i+o,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(i,o){let a=t.matchPrefix(i+o,"a=ice-ufrag:")[0],l=t.matchPrefix(i+o,"a=ice-pwd:")[0];return a&&l?{usernameFragment:a.substring(12),password:l.substring(10)}:null},t.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},t.parseRtpParameters=function(i){let o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=t.splitLines(i)[0].split(" ");o.profile=a[2];for(let u=3;u<a.length;u++){let f=a[u],m=t.matchPrefix(i,"a=rtpmap:"+f+" ")[0];if(m){let _=t.parseRtpMap(m),v=t.matchPrefix(i,"a=fmtp:"+f+" ");switch(_.parameters=v.length?t.parseFmtp(v[0]):{},_.rtcpFeedback=t.matchPrefix(i,"a=rtcp-fb:"+f+" ").map(t.parseRtcpFb),o.codecs.push(_),_.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(_.name.toUpperCase())}}}t.matchPrefix(i,"a=extmap:").forEach(u=>{o.headerExtensions.push(t.parseExtmap(u))});let l=t.matchPrefix(i,"a=rtcp-fb:* ").map(t.parseRtcpFb);return o.codecs.forEach(u=>{l.forEach(f=>{u.rtcpFeedback.find(m=>m.type===f.type&&m.parameter===f.parameter)||u.rtcpFeedback.push(f)})}),o},t.writeRtpDescription=function(i,o){let a="";a+="m="+i+" ",a+=o.codecs.length>0?"9":"0",a+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=o.codecs.map(u=>u.preferredPayloadType!==void 0?u.preferredPayloadType:u.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(u=>{a+=t.writeRtpMap(u),a+=t.writeFmtp(u),a+=t.writeRtcpFb(u)});let l=0;return o.codecs.forEach(u=>{u.maxptime>l&&(l=u.maxptime)}),l>0&&(a+="a=maxptime:"+l+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(u=>{a+=t.writeExtmap(u)}),a},t.parseRtpEncodingParameters=function(i){let o=[],a=t.parseRtpParameters(i),l=a.fecMechanisms.indexOf("RED")!==-1,u=a.fecMechanisms.indexOf("ULPFEC")!==-1,f=t.matchPrefix(i,"a=ssrc:").map(C=>t.parseSsrcMedia(C)).filter(C=>C.attribute==="cname"),m=f.length>0&&f[0].ssrc,_,v=t.matchPrefix(i,"a=ssrc-group:FID").map(C=>C.substring(17).split(" ").map(b=>parseInt(b,10)));v.length>0&&v[0].length>1&&v[0][0]===m&&(_=v[0][1]),a.codecs.forEach(C=>{if(C.name.toUpperCase()==="RTX"&&C.parameters.apt){let b={ssrc:m,codecPayloadType:parseInt(C.parameters.apt,10)};m&&_&&(b.rtx={ssrc:_}),o.push(b),l&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:m,mechanism:u?"red+ulpfec":"red"},o.push(b))}}),o.length===0&&m&&o.push({ssrc:m});let S=t.matchPrefix(i,"b=");return S.length&&(S=S[0].indexOf("b=TIAS:")===0?parseInt(S[0].substring(7),10):S[0].indexOf("b=AS:")===0?1e3*parseInt(S[0].substring(5),10)*.95-16e3:void 0,o.forEach(C=>{C.maxBitrate=S})),o},t.parseRtcpParameters=function(i){let o={},a=t.matchPrefix(i,"a=ssrc:").map(f=>t.parseSsrcMedia(f)).filter(f=>f.attribute==="cname")[0];a&&(o.cname=a.value,o.ssrc=a.ssrc);let l=t.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=l.length>0,o.compound=l.length===0;let u=t.matchPrefix(i,"a=rtcp-mux");return o.mux=u.length>0,o},t.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},t.parseMsid=function(i){let o,a=t.matchPrefix(i,"a=msid:");if(a.length===1)return o=a[0].substring(7).split(" "),{stream:o[0],track:o[1]};let l=t.matchPrefix(i,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="msid");return l.length>0?(o=l[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},t.parseSctpDescription=function(i){let o=t.parseMLine(i),a=t.matchPrefix(i,"a=max-message-size:"),l;a.length>0&&(l=parseInt(a[0].substring(19),10)),isNaN(l)&&(l=65536);let u=t.matchPrefix(i,"a=sctp-port:");if(u.length>0)return{port:parseInt(u[0].substring(12),10),protocol:o.fmt,maxMessageSize:l};let f=t.matchPrefix(i,"a=sctpmap:");if(f.length>0){let m=f[0].substring(10).split(" ");return{port:parseInt(m[0],10),protocol:m[1],maxMessageSize:l}}},t.writeSctpDescription=function(i,o){let a=[];return a=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&a.push("a=max-message-size:"+o.maxMessageSize+`\r
`),a.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(i,o,a){let l,u=o!==void 0?o:2;return l=i||t.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+l+" "+u+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(i,o){let a=t.splitLines(i);for(let l=0;l<a.length;l++)switch(a[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[l].substring(2)}return o?t.getDirection(o):"sendrecv"},t.getKind=function(i){return t.splitLines(i)[0].split(" ")[0].substring(2)},t.isRejected=function(i){return i.split(" ",2)[1]==="0"},t.parseMLine=function(i){let o=t.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},t.parseOLine=function(i){let o=t.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},t.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let o=t.splitLines(i);for(let a=0;a<o.length;a++)if(o[a].length<2||o[a].charAt(1)!=="=")return!1;return!0},e.exports=t})(Tk);var wk=Tk.exports,qf=d(wk),Gq=s({__proto__:null,default:qf},[wk]);function Ey(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let o=new t(i),a=qf.parseCandidate(i.candidate),l=Object.assign(o,a);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,aa(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function GC(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||aa(e,"icecandidate",t=>{if(t.candidate){let i=qf.parseCandidate(t.candidate.candidate);i.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return t})}function vy(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(f){if(!f||!f.sdp)return!1;let m=qf.splitSections(f.sdp);return m.shift(),m.some(_=>{let v=qf.parseMLine(_);return v&&v.kind==="application"&&v.protocol.indexOf("SCTP")!==-1})},o=function(f){let m=f.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(m===null||m.length<2)return-1;let _=parseInt(m[1],10);return _!=_?-1:_},a=function(f){let m=65536;return t.browser==="firefox"&&(m=t.version<57?f===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),m},l=function(f,m){let _=65536;t.browser==="firefox"&&t.version===57&&(_=65535);let v=qf.matchPrefix(f.sdp,"a=max-message-size:");return v.length>0?_=parseInt(v[0].substr(19),10):t.browser==="firefox"&&m!==-1&&(_=2147483637),_},u=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:f}=this.getConfiguration();f==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let f=o(arguments[0]),m=a(f),_=l(arguments[0],f),v;v=m===0&&_===0?Number.POSITIVE_INFINITY:m===0||_===0?Math.max(m,_):Math.min(m,_);let S={};Object.defineProperty(S,"maxMessageSize",{get:()=>v}),this._sctp=S}return u.apply(this,arguments)}}function yy(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(o,a){let l=o.send;o.send=function(){let u=arguments[0],f=u.length||u.size||u.byteLength;if(o.readyState==="open"&&a.sctp&&f>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return l.apply(o,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let o=i.apply(this,arguments);return t(o,this),o},aa(e,"datachannel",o=>(t(o.channel,o.target),o))}function KC(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let o=t[i];t[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{let l=a.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;let u=new Event("connectionstatechange",a);l.dispatchEvent(u)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function qC(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let a=o.sdp.split(`
`).filter(l=>Rr(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:a}):o.sdp=a}return i.apply(this,arguments)}}function Sy(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?De.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),De.resolve())})}function Ty(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>i.apply(this,[a]))})}var Kq=Object.freeze({__proto__:null,removeExtmapAllowMixed:qC,shimAddIceCandidateNullOrEmpty:Sy,shimConnectionState:KC,shimMaxMessageSize:vy,shimParameterlessSetLocalDescription:Ty,shimRTCIceCandidate:Ey,shimRTCIceCandidateRelayProtocol:GC,shimSendThrowTypeError:yy});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=Hh,o=function(l){let u={browser:null,version:null};if(l===void 0||!l.navigator)return u.browser="Not a browser.",u;let{navigator:f}=l;if(f.mozGetUserMedia)u.browser="firefox",u.version=Bc(f.userAgent,/Firefox\/(\d+)\./,1);else if(f.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)u.browser="chrome",u.version=Bc(f.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!f.userAgent.match(/AppleWebKit\/(\d+)\./))return u.browser="Not a supported browser.",u;u.browser="safari",u.version=Bc(f.userAgent,/AppleWebKit\/(\d+)\./,1),u.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return u}(e),a={browserDetails:o,commonShim:Kq,extractVersion:Bc,disableLog:Uf,disableWarnings:jf,sdp:Gq};switch(o.browser){case"chrome":if(!JD||!FC||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),a;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),a;i("adapter.js shimming chrome."),a.browserShim=JD,Sy(e,o),Ty(e),WD(e,o),zD(e),FC(e,o),HD(e),$D(e,o),GD(e),KD(e),qD(e),XD(e,o),Ey(e),GC(e),KC(e),vy(e,o),yy(e),qC(e,o);break;case"firefox":if(!ck||!BC||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),a;i("adapter.js shimming firefox."),a.browserShim=ck,Sy(e,o),Ty(e),ZD(e,o),BC(e,o),QD(e),ik(e),ek(e),tk(e),nk(e),rk(e),ok(e),sk(e),ak(e),Ey(e),KC(e),vy(e,o),yy(e);break;case"safari":if(!Ek||!t.shimSafari)return i("Safari shim is not included in this adapter release."),a;i("adapter.js shimming safari."),a.browserShim=Ek,Sy(e,o),Ty(e),fk(e),gk(e),uk(e),lk(e),dk(e),mk(e),hk(e),_k(e),Ey(e),GC(e),vy(e,o),yy(e),qC(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var qq=Zr("Array").keys,Yq=Uo,$q=An,Xq=B,Jq=qq,YC=Array.prototype,Zq={DOMTokenList:!0,NodeList:!0},Qq=function(e){var t=e.keys;return e===YC||Xq(YC,e)&&t===YC.keys||$q(Zq,Yq(e))?Jq:t},ss=d(Qq),Ck=Zn,eY=TypeError,tY=Dr,iY=br,nY=lt,wy=function(e,t,i){var o=tY(t);o in e?iY.f(e,o,nY(0,i)):e[o]=i},bk=Lh,rY=Jr,oY=wy,sY=Array,aY=Math.max,$C=function(e,t,i){for(var o=rY(e),a=bk(t,o),l=bk(i===void 0?o:i,o),u=sY(aY(l-a,0)),f=0;a<l;a++,f++)oY(u,f,e[a]);return u.length=f,u},Rk=$C,cY=Math.floor,XC=function(e,t){var i=e.length,o=cY(i/2);return i<8?lY(e,t):dY(e,XC(Rk(e,0,o),t),XC(Rk(e,o),t),t)},lY=function(e,t){for(var i,o,a=e.length,l=1;l<a;){for(o=l,i=e[l];o&&t(e[o-1],i)>0;)e[o]=e[--o];o!==l++&&(e[o]=i)}return e},dY=function(e,t,i,o){for(var a=t.length,l=i.length,u=0,f=0;u<a||f<l;)e[u+f]=u<a&&f<l?o(t[u],i[f])<=0?t[u++]:i[f++]:u<a?t[u++]:i[f++];return e},Ik=XC,Ak=Zo.match(/firefox\/(\d+)/i),uY=!!Ak&&+Ak[1],hY=/MSIE|Trident/.test(Zo),Ok=Zo.match(/AppleWebKit\/(\d+)\./),pY=!!Ok&&+Ok[1],fY=qt,Pk=D,mY=zt,gY=mr,Nk=Jr,_Y=function(e,t){if(!delete e[t])throw eY("Cannot delete property "+Ck(t)+" of "+Ck(e))},xk=_r,JC=p,EY=Ik,vY=Bl,Dk=uY,yY=hY,kk=lo,Lk=pY,eu=[],Mk=Pk(eu.sort),SY=Pk(eu.push),TY=JC(function(){eu.sort(void 0)}),wY=JC(function(){eu.sort(null)}),CY=vY("sort"),Uk=!JC(function(){if(kk)return kk<70;if(!(Dk&&Dk>3)){if(yY)return!0;if(Lk)return Lk<603;var e,t,i,o,a="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)eu.push({k:t+o,v:i})}for(eu.sort(function(l,u){return u.v-l.v}),o=0;o<eu.length;o++)t=eu[o].k.charAt(0),a.charAt(a.length-1)!==t&&(a+=t);return a!=="DGBEFHACIJK"}});fY({target:"Array",proto:!0,forced:TY||!wY||!CY||!Uk},{sort:function(e){e!==void 0&&mY(e);var t=gY(this);if(Uk)return e===void 0?Mk(t):Mk(t,e);var i,o,a=[],l=Nk(t);for(o=0;o<l;o++)o in t&&SY(a,t[o]);for(EY(a,function(u){return function(f,m){return m===void 0?-1:f===void 0?1:u!==void 0?+u(f,m)||0:xk(f)>xk(m)?1:-1}}(e)),i=Nk(a),o=0;o<i;)t[o]=a[o++];for(;o<l;)_Y(t,o++);return t}});var bY=Zr("Array").sort,RY=B,IY=bY,ZC=Array.prototype,AY=function(e){var t=e.sort;return e===ZC||RY(ZC,e)&&t===ZC.sort?IY:t},v_=d(AY),QC={exports:{}};(function(e,t){(function(i,o){var a="function",l="undefined",u="object",f="string",m="major",_="model",v="name",S="type",C="vendor",b="version",V="architecture",P="console",k="mobile",F="tablet",H="smarttv",ie="wearable",oe="embedded",ae="Amazon",he="Apple",Ee="ASUS",ye="BlackBerry",Ce="Browser",ze="Chrome",It="Firefox",Kt="Google",_i="Huawei",sn="LG",Li="Microsoft",Aa="Motorola",_e="Opera",xe="Samsung",We="Sharp",dt="Sony",Bt="Xiaomi",Le="Zebra",M="Facebook",X="Chromium OS",ne="Mac OS",Re=function(Ji){for(var pn={},Ci=0;Ci<Ji.length;Ci++)pn[Ji[Ci].toUpperCase()]=Ji[Ci];return pn},ct=function(Ji,pn){return typeof Ji===f&&pi(pn).indexOf(pi(Ji))!==-1},pi=function(Ji){return Ji.toLowerCase()},bn=function(Ji,pn){if(typeof Ji===f)return Ji=Ji.replace(/^\s\s*/,""),typeof pn===l?Ji:Ji.substring(0,350)},So=function(Ji,pn){for(var Ci,zo,ul,Zi,Wt,To,Nu=0;Nu<pn.length&&!Wt;){var _c=pn[Nu],U5=pn[Nu+1];for(Ci=zo=0;Ci<_c.length&&!Wt&&_c[Ci];)if(Wt=_c[Ci++].exec(Ji))for(ul=0;ul<U5.length;ul++)To=Wt[++zo],typeof(Zi=U5[ul])===u&&Zi.length>0?Zi.length===2?typeof Zi[1]==a?this[Zi[0]]=Zi[1].call(this,To):this[Zi[0]]=Zi[1]:Zi.length===3?typeof Zi[1]!==a||Zi[1].exec&&Zi[1].test?this[Zi[0]]=To?To.replace(Zi[1],Zi[2]):o:this[Zi[0]]=To?Zi[1].call(this,To,Zi[2]):o:Zi.length===4&&(this[Zi[0]]=To?Zi[3].call(this,To.replace(Zi[1],Zi[2])):o):this[Zi]=To||o;Nu+=2}},rd=function(Ji,pn){for(var Ci in pn)if(typeof pn[Ci]===u&&pn[Ci].length>0){for(var zo=0;zo<pn[Ci].length;zo++)if(ct(pn[Ci][zo],Ji))return Ci==="?"?o:Ci}else if(ct(pn[Ci],Ji))return Ci==="?"?o:Ci;return Ji},gS={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},_S={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,b],[/opios[\/ ]+([\w\.]+)/i],[b,[v,_e+" Mini"]],[/\bopr\/([\w\.]+)/i],[b,[v,_e]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[v,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[v,"UC"+Ce]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[v,"IE"]],[/yabrowser\/([\w\.]+)/i],[b,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+Ce],b],[/\bfocus\/([\w\.]+)/i],[b,[v,It+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[v,_e+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[v,_e+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[v,"MIUI "+Ce]],[/fxios\/([-\w\.]+)/i],[b,[v,It]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+Ce]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+Ce],b],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,M],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[v,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[v,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[v,ze+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,ze+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[v,"Android "+Ce]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[b,rd,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[v,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[v,It+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,b],[/(cobalt)\/([\w\.]+)/i],[v,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[V,"amd64"]],[/(ia32(?=;))/i],[[V,pi]],[/((?:i[346]|x)86)[;\)]/i],[[V,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[V,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[V,"armhf"]],[/windows (ce|mobile); ppc;/i],[[V,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[V,/ower/,"",pi]],[/(sun4\w)[;\)]/i],[[V,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[V,pi]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_,[C,xe],[S,F]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_,[C,xe],[S,k]],[/\((ip(?:hone|od)[\w ]*);/i],[_,[C,he],[S,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_,[C,he],[S,F]],[/(macintosh);/i],[_,[C,he]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_,[C,We],[S,k]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_,[C,_i],[S,F]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_,[C,_i],[S,k]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_,/_/g," "],[C,Bt],[S,k]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_,/_/g," "],[C,Bt],[S,F]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_,[C,"OPPO"],[S,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_,[C,"Vivo"],[S,k]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_,[C,"Realme"],[S,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_,[C,Aa],[S,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_,[C,Aa],[S,F]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_,[C,sn],[S,F]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_,[C,sn],[S,k]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_,[C,"Lenovo"],[S,F]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_,/_/g," "],[C,"Nokia"],[S,k]],[/(pixel c)\b/i],[_,[C,Kt],[S,F]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_,[C,Kt],[S,k]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_,[C,dt],[S,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_,"Xperia Tablet"],[C,dt],[S,F]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_,[C,"OnePlus"],[S,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_,[C,ae],[S,F]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_,/(.+)/g,"Fire Phone $1"],[C,ae],[S,k]],[/(playbook);[-\w\),; ]+(rim)/i],[_,C,[S,F]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_,[C,ye],[S,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_,[C,Ee],[S,F]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_,[C,Ee],[S,k]],[/(nexus 9)/i],[_,[C,"HTC"],[S,F]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[C,[_,/_/g," "],[S,k]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_,[C,"Acer"],[S,F]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_,[C,"Meizu"],[S,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[C,_,[S,k]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[C,_,[S,F]],[/(surface duo)/i],[_,[C,Li],[S,F]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_,[C,"Fairphone"],[S,k]],[/(u304aa)/i],[_,[C,"AT&T"],[S,k]],[/\bsie-(\w*)/i],[_,[C,"Siemens"],[S,k]],[/\b(rct\w+) b/i],[_,[C,"RCA"],[S,F]],[/\b(venue[\d ]{2,7}) b/i],[_,[C,"Dell"],[S,F]],[/\b(q(?:mv|ta)\w+) b/i],[_,[C,"Verizon"],[S,F]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_,[C,"Barnes & Noble"],[S,F]],[/\b(tm\d{3}\w+) b/i],[_,[C,"NuVision"],[S,F]],[/\b(k88) b/i],[_,[C,"ZTE"],[S,F]],[/\b(nx\d{3}j) b/i],[_,[C,"ZTE"],[S,k]],[/\b(gen\d{3}) b.+49h/i],[_,[C,"Swiss"],[S,k]],[/\b(zur\d{3}) b/i],[_,[C,"Swiss"],[S,F]],[/\b((zeki)?tb.*\b) b/i],[_,[C,"Zeki"],[S,F]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[C,"Dragon Touch"],_,[S,F]],[/\b(ns-?\w{0,9}) b/i],[_,[C,"Insignia"],[S,F]],[/\b((nxa|next)-?\w{0,9}) b/i],[_,[C,"NextBook"],[S,F]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[C,"Voice"],_,[S,k]],[/\b(lvtel\-)?(v1[12]) b/i],[[C,"LvTel"],_,[S,k]],[/\b(ph-1) /i],[_,[C,"Essential"],[S,k]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_,[C,"Envizen"],[S,F]],[/\b(trio[-\w\. ]+) b/i],[_,[C,"MachSpeed"],[S,F]],[/\btu_(1491) b/i],[_,[C,"Rotor"],[S,F]],[/(shield[\w ]+) b/i],[_,[C,"Nvidia"],[S,F]],[/(sprint) (\w+)/i],[C,_,[S,k]],[/(kin\.[onetw]{3})/i],[[_,/\./g," "],[C,Li],[S,k]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_,[C,Le],[S,F]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_,[C,Le],[S,k]],[/smart-tv.+(samsung)/i],[C,[S,H]],[/hbbtv.+maple;(\d+)/i],[[_,/^/,"SmartTV"],[C,xe],[S,H]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[C,sn],[S,H]],[/(apple) ?tv/i],[C,[_,he+" TV"],[S,H]],[/crkey/i],[[_,ze+"cast"],[C,Kt],[S,H]],[/droid.+aft(\w)( bui|\))/i],[_,[C,ae],[S,H]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_,[C,We],[S,H]],[/(bravia[\w ]+)( bui|\))/i],[_,[C,dt],[S,H]],[/(mitv-\w{5}) bui/i],[_,[C,Bt],[S,H]],[/Hbbtv.*(technisat) (.*);/i],[C,_,[S,H]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[C,bn],[_,bn],[S,H]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[S,H]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[C,_,[S,P]],[/droid.+; (shield) bui/i],[_,[C,"Nvidia"],[S,P]],[/(playstation [345portablevi]+)/i],[_,[C,dt],[S,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_,[C,Li],[S,P]],[/((pebble))app/i],[C,_,[S,ie]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_,[C,he],[S,ie]],[/droid.+; (glass) \d/i],[_,[C,Kt],[S,ie]],[/droid.+; (wt63?0{2,3})\)/i],[_,[C,Le],[S,ie]],[/(quest( 2| pro)?)/i],[_,[C,M],[S,ie]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[C,[S,oe]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_,[S,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_,[S,F]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[S,F]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[S,k]],[/(android[-\w\. ]{0,9});.+buil/i],[_,[C,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[v,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[v,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[b,rd,gS]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[b,rd,gS]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,ne],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,b],[/\(bb(10);/i],[b,[v,ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[v,It+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[v,ze+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,X],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,b],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[v,b]]},Vs=function(Ji,pn){if(typeof Ji===u&&(pn=Ji,Ji=o),!(this instanceof Vs))return new Vs(Ji,pn).getResult();var Ci=typeof i!==l&&i.navigator?i.navigator:o,zo=Ji||(Ci&&Ci.userAgent?Ci.userAgent:""),ul=Ci&&Ci.userAgentData?Ci.userAgentData:o,Zi=pn?function(Wt,To){var Nu={};for(var _c in Wt)To[_c]&&To[_c].length%2==0?Nu[_c]=To[_c].concat(Wt[_c]):Nu[_c]=Wt[_c];return Nu}(_S,pn):_S;return this.getBrowser=function(){var Wt={};return Wt[v]=o,Wt[b]=o,So.call(Wt,zo,Zi.browser),Wt[m]=function(To){return typeof To===f?To.replace(/[^\d\.]/g,"").split(".")[0]:o}(Wt[b]),Ci&&Ci.brave&&typeof Ci.brave.isBrave==a&&(Wt[v]="Brave"),Wt},this.getCPU=function(){var Wt={};return Wt[V]=o,So.call(Wt,zo,Zi.cpu),Wt},this.getDevice=function(){var Wt={};return Wt[C]=o,Wt[_]=o,Wt[S]=o,So.call(Wt,zo,Zi.device),!Wt[S]&&ul&&ul.mobile&&(Wt[S]=k),Wt[_]=="Macintosh"&&Ci&&typeof Ci.standalone!==l&&Ci.maxTouchPoints&&Ci.maxTouchPoints>2&&(Wt[_]="iPad",Wt[S]=F),Wt},this.getEngine=function(){var Wt={};return Wt[v]=o,Wt[b]=o,So.call(Wt,zo,Zi.engine),Wt},this.getOS=function(){var Wt={};return Wt[v]=o,Wt[b]=o,So.call(Wt,zo,Zi.os),!Wt[v]&&ul&&ul.platform!="Unknown"&&(Wt[v]=ul.platform.replace(/chrome os/i,X).replace(/macos/i,ne)),Wt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return zo},this.setUA=function(Wt){return zo=typeof Wt===f&&Wt.length>350?bn(Wt,350):Wt,this},this.setUA(zo),this};Vs.VERSION="0.7.34",Vs.BROWSER=Re([v,b,m]),Vs.CPU=Re([V]),Vs.DEVICE=Re([_,C,S,P,k,H,F,ie,oe]),Vs.ENGINE=Vs.OS=Re([v,b]),e.exports&&(t=e.exports=Vs),t.UAParser=Vs;var Pu=typeof i!==l&&(i.jQuery||i.Zepto);if(Pu&&!Pu.ua){var Km=new Vs;Pu.ua=Km.getResult(),Pu.ua.get=function(){return Km.getUA()},Pu.ua.set=function(Ji){Km.setUA(Ji);var pn=Km.getResult();for(var Ci in pn)Pu.ua[Ci]=pn[Ci]}}})(typeof window=="object"?window:c)})(QC,QC.exports);var OY=d(QC.exports),PY=Uo,NY=An,xY=Tn,DY=Xh,kY=Ri("iterator"),LY=Object,MY=function(e){if(xY(e))return!1;var t=LY(e);return t[kY]!==void 0||"@@iterator"in t||NY(DY,PY(t))},UY=d(MY),eb=J;qt({global:!0,forced:eb.globalThis!==eb},{globalThis:eb});var jk=d(J);function Vk(e,t){return function(){return e.apply(t,arguments)}}let{toString:jY}=Object.prototype,{getPrototypeOf:tb}=Object,Cy=(ib=Object.create(null),e=>{let t=jY.call(e);return ib[t]||(ib[t]=t.slice(8,-1).toLowerCase())});var ib;let Kc=e=>(e=e.toLowerCase(),t=>Cy(t)===e),by=e=>t=>typeof t===e,{isArray:Yf}=Array,y_=by("undefined"),Fk=Kc("ArrayBuffer"),VY=by("string"),ca=by("function"),Bk=by("number"),Ry=e=>e!==null&&typeof e=="object",Iy=e=>{if(Cy(e)!=="object")return!1;let t=tb(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||UY(e))},FY=Kc("Date"),BY=Kc("File"),WY=Kc("Blob"),zY=Kc("FileList"),HY=Kc("URLSearchParams");function S_(e,t){let i,o,{allOwnKeys:a=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Yf(e))for(i=0,o=e.length;i<o;i++)t.call(null,e[i],i,e);else{let l=a?Object.getOwnPropertyNames(e):Object.keys(e),u=l.length,f;for(i=0;i<u;i++)f=l[i],t.call(null,e[f],f,e)}}function Wk(e,t){t=t.toLowerCase();let i=Object.keys(e),o,a=i.length;for(;a-- >0;)if(o=i[a],t===o.toLowerCase())return o;return null}let zk=jk!==void 0?jk:typeof self<"u"?self:typeof window<"u"?window:global,Hk=e=>!y_(e)&&e!==zk,GY=(nb=typeof Uint8Array<"u"&&tb(Uint8Array),e=>nb&&e instanceof nb);var nb;let KY=Kc("HTMLFormElement"),Gk=(e=>{let{hasOwnProperty:t}=e;return(i,o)=>t.call(i,o)})(Object.prototype),qY=Kc("RegExp"),Kk=(e,t)=>{let i=Object.getOwnPropertyDescriptors(e),o={};S_(i,(a,l)=>{let u;(u=t(a,l,e))!==!1&&(o[l]=u||a)}),Object.defineProperties(e,o)},rb="abcdefghijklmnopqrstuvwxyz",qk="0123456789",Yk={DIGIT:qk,ALPHA:rb,ALPHA_DIGIT:rb+rb.toUpperCase()+qk},YY=Kc("AsyncFunction");var Be={isArray:Yf,isArrayBuffer:Fk,isBuffer:function(e){return e!==null&&!y_(e)&&e.constructor!==null&&!y_(e.constructor)&&ca(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||ca(e.append)&&((t=Cy(e))==="formdata"||t==="object"&&ca(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Fk(e.buffer),t},isString:VY,isNumber:Bk,isBoolean:e=>e===!0||e===!1,isObject:Ry,isPlainObject:Iy,isUndefined:y_,isDate:FY,isFile:BY,isBlob:WY,isRegExp:qY,isFunction:ca,isStream:e=>Ry(e)&&ca(e.pipe),isURLSearchParams:HY,isTypedArray:GY,isFileList:zY,forEach:S_,merge:function e(){let{caseless:t}=Hk(this)&&this||{},i={},o=(a,l)=>{let u=t&&Wk(i,l)||l;Iy(i[u])&&Iy(a)?i[u]=e(i[u],a):Iy(a)?i[u]=e({},a):Yf(a)?i[u]=a.slice():i[u]=a};for(let a=0,l=arguments.length;a<l;a++)arguments[a]&&S_(arguments[a],o);return i},extend:function(e,t,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return S_(t,(a,l)=>{i&&ca(a)?e[l]=Vk(a,i):e[l]=a},{allOwnKeys:o}),e},trim:e=>Rr(e)?Rr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,i,o)=>{e.prototype=Object.create(t.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,t,i,o)=>{let a,l,u,f={};if(t=t||{},e==null)return t;do{for(a=Object.getOwnPropertyNames(e),l=a.length;l-- >0;)u=a[l],o&&!o(u,e,t)||f[u]||(t[u]=e[u],f[u]=!0);e=i!==!1&&tb(e)}while(e&&(!i||i(e,t))&&e!==Object.prototype);return t},kindOf:Cy,kindOfTest:Kc,endsWith:(e,t,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=t.length;let o=e.indexOf(t,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(Yf(e))return e;let t=e.length;if(!Bk(t))return null;let i=new Array(t);for(;t-- >0;)i[t]=e[t];return i},forEachEntry:(e,t)=>{let i=(e&&e[Symbol.iterator]).call(e),o;for(;(o=i.next())&&!o.done;){let a=o.value;t.call(e,a[0],a[1])}},matchAll:(e,t)=>{let i,o=[];for(;(i=e.exec(t))!==null;)o.push(i);return o},isHTMLForm:KY,hasOwnProperty:Gk,hasOwnProp:Gk,reduceDescriptors:Kk,freezeMethods:e=>{Kk(e,(t,i)=>{if(ca(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let o=e[i];ca(o)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,t)=>{let i={},o=a=>{a.forEach(l=>{i[l]=!0})};return Yf(e)?o(e):o(String(e).split(t)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Wk,global:zk,isContextDefined:Hk,ALPHABET:Yk,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Yk.ALPHA_DIGIT,i="",{length:o}=t;for(;e--;)i+=t[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&ca(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),i=(o,a)=>{if(Ry(o)){if(t.indexOf(o)>=0)return;if(!("toJSON"in o)){t[a]=o;let l=Yf(o)?[]:{};return S_(o,(u,f)=>{let m=i(u,a+1);!y_(m)&&(l[f]=m)}),t[a]=void 0,l}}return o};return i(e,0)},isAsyncFn:YY,isThenable:e=>e&&(Ry(e)||ca(e))&&ca(e.then)&&ca(e.catch)};function xi(e,t,i,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),i&&(this.config=i),o&&(this.request=o),a&&(this.response=a)}Be.inherits(xi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Be.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});let $k=xi.prototype,Xk={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Xk[e]={value:e}}),Object.defineProperties(xi,Xk),Object.defineProperty($k,"isAxiosError",{value:!0}),xi.from=(e,t,i,o,a,l)=>{let u=Object.create($k);return Be.toFlatObject(e,u,function(f){return f!==Error.prototype},f=>f!=="isAxiosError"),xi.call(u,e.message,t,i,o,a),u.cause=e,u.name=e.name,l&&Object.assign(u,l),u};function ob(e){return Be.isPlainObject(e)||Be.isArray(e)}function Jk(e){return Be.endsWith(e,"[]")?e.slice(0,-2):e}function Zk(e,t,i){return e?e.concat(t).map(function(o,a){return o=Jk(o),!i&&a?"["+o+"]":o}).join(i?".":""):t}let $Y=Be.toFlatObject(Be,{},null,function(e){return/^is[A-Z]/.test(e)});function Ay(e,t,i){if(!Be.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let o=(i=Be.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(C,b){return!Be.isUndefined(b[C])})).metaTokens,a=i.visitor||_,l=i.dots,u=i.indexes,f=(i.Blob||typeof Blob<"u"&&Blob)&&Be.isSpecCompliantForm(t);if(!Be.isFunction(a))throw new TypeError("visitor must be a function");function m(C){if(C===null)return"";if(Be.isDate(C))return C.toISOString();if(!f&&Be.isBlob(C))throw new xi("Blob is not supported. Use a Buffer instead.");return Be.isArrayBuffer(C)||Be.isTypedArray(C)?f&&typeof Blob=="function"?new Blob([C]):Buffer.from(C):C}function _(C,b,V){let P=C;if(C&&!V&&typeof C=="object"){if(Be.endsWith(b,"{}"))b=o?b:b.slice(0,-2),C=JSON.stringify(C);else if(Be.isArray(C)&&function(k){return Be.isArray(k)&&!k.some(ob)}(C)||(Be.isFileList(C)||Be.endsWith(b,"[]"))&&(P=Be.toArray(C)))return b=Jk(b),P.forEach(function(k,F){!Be.isUndefined(k)&&k!==null&&t.append(u===!0?Zk([b],F,l):u===null?b:b+"[]",m(k))}),!1}return!!ob(C)||(t.append(Zk(V,b,l),m(C)),!1)}let v=[],S=Object.assign($Y,{defaultVisitor:_,convertValue:m,isVisitable:ob});if(!Be.isObject(e))throw new TypeError("data must be an object");return function C(b,V){if(!Be.isUndefined(b)){if(v.indexOf(b)!==-1)throw Error("Circular reference detected in "+V.join("."));v.push(b),Be.forEach(b,function(P,k){(!(Be.isUndefined(P)||P===null)&&a.call(t,P,Be.isString(k)?Rr(k).call(k):k,V,S))===!0&&C(P,V?V.concat(k):[k])}),v.pop()}}(e),t}function Qk(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return t[i]})}function sb(e,t){this._pairs=[],e&&Ay(e,this,t)}let e1=sb.prototype;function XY(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function t1(e,t,i){if(!t)return e;let o=i&&i.encode||XY,a=i&&i.serialize,l;if(l=a?a(t,i):Be.isURLSearchParams(t)?t.toString():new sb(t,i).toString(o),l){let u=e.indexOf("#");u!==-1&&(e=e.slice(0,u)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}e1.append=function(e,t){this._pairs.push([e,t])},e1.toString=function(e){let t=e?function(i){return e.call(this,i,Qk)}:Qk;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};var i1=class{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Be.forEach(this.handlers,function(t){t!==null&&e(t)})}},n1={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},r1={exports:{}},JY=qt,ZY=yt,o1=br.f;JY({target:"Object",stat:!0,forced:Object.defineProperty!==o1,sham:!ZY},{defineProperty:o1});var s1=Zt.Object,QY=r1.exports=function(e,t,i){return s1.defineProperty(e,t,i)};s1.defineProperty.sham&&(QY.sham=!0);var a1=d(r1.exports),e$=Se,T_=Array.isArray||function(e){return e$(e)=="Array"},t$=TypeError,c1=T_,i$=dy,n$=Fi,r$=Ri("species"),l1=Array,o$=function(e){var t;return c1(e)&&(t=e.constructor,(i$(t)&&(t===l1||c1(t.prototype))||n$(t)&&(t=t[r$])===null)&&(t=void 0)),t===void 0?l1:t},d1=function(e,t){return new(o$(e))(t===0?0:t)},s$=p,a$=lo,c$=Ri("species"),u1=function(e){return a$>=51||!s$(function(){var t=[];return(t.constructor={})[c$]=function(){return{foo:1}},t[e](Boolean).foo!==1})},l$=qt,d$=p,u$=T_,h$=Fi,p$=mr,f$=Jr,h1=function(e){if(e>9007199254740991)throw t$("Maximum allowed index exceeded");return e},p1=wy,m$=d1,g$=u1,_$=lo,f1=Ri("isConcatSpreadable"),E$=_$>=51||!d$(function(){var e=[];return e[f1]=!1,e.concat()[0]!==e}),v$=function(e){if(!h$(e))return!1;var t=e[f1];return t!==void 0?!!t:u$(e)};l$({target:"Array",proto:!0,arity:1,forced:!E$||!g$("concat")},{concat:function(e){var t,i,o,a,l,u=p$(this),f=m$(u,0),m=0;for(t=-1,o=arguments.length;t<o;t++)if(v$(l=t===-1?u:arguments[t]))for(a=f$(l),h1(m+a),i=0;i<a;i++,m++)i in l&&p1(f,m,l[i]);else h1(m+1),p1(f,m++,l);return f.length=m,f}});var m1={},y$=Se,S$=qr,g1=Xd.f,T$=$C,_1=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];m1.f=function(e){return _1&&y$(e)=="Window"?function(t){try{return g1(t)}catch{return T$(_1)}}(e):g1(S$(e))};var $f={},w$=Ri;$f.f=w$;var E1=Zt,C$=An,b$=$f,R$=br.f,ir=function(e){var t=E1.Symbol||(E1.Symbol={});C$(t,e)||R$(t,e,{value:b$.f(e)})},I$=Je,A$=lr,O$=Ri,P$=Jd,v1=function(){var e=A$("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,o=O$("toPrimitive");t&&!t[o]&&P$(t,o,function(a){return I$(i,this)},{arity:1})},N$=ra,x$=gn,D$=mr,k$=Jr,L$=d1,y1=D([].push),tu=function(e){var t=e==1,i=e==2,o=e==3,a=e==4,l=e==6,u=e==7,f=e==5||l;return function(m,_,v,S){for(var C,b,V=D$(m),P=x$(V),k=N$(_,v),F=k$(P),H=0,ie=S||L$,oe=t?ie(m,F):i||u?ie(m,0):void 0;F>H;H++)if((f||H in P)&&(b=k(C=P[H],H,V),e))if(t)oe[H]=b;else if(b)switch(e){case 3:return!0;case 5:return C;case 6:return H;case 2:y1(oe,C)}else switch(e){case 4:return!1;case 7:y1(oe,C)}return l?-1:o||a?a:oe}},S1={forEach:tu(0),map:tu(1),filter:tu(2),some:tu(3),every:tu(4),find:tu(5),findIndex:tu(6),filterReject:tu(7)},Oy=qt,ab=J,cb=Je,M$=D,Xf=yt,Jf=Oc,U$=p,Mr=An,j$=B,lb=gr,Py=qr,db=Dr,V$=_r,ub=lt,w_=l_,T1=Zv,F$=Xd,w1=m1,B$=Ht,C1=At,b1=br,W$=zw,R1=Ie,I1=Jd,z$=ly,hb=Wa,A1=zc,O1=za,H$=Ri,G$=$f,K$=ir,q$=v1,Y$=Zd,P1=Zh,Ny=S1.forEach,as=x("hidden"),xy="Symbol",C_="prototype",$$=P1.set,N1=P1.getterFor(xy),nc=Object[C_],tp=ab.Symbol,Dy=tp&&tp[C_],X$=ab.TypeError,pb=ab.QObject,x1=C1.f,ip=b1.f,D1=w1.f,J$=R1.f,k1=M$([].push),zl=hb("symbols"),b_=hb("op-symbols"),Z$=hb("wks"),fb=!pb||!pb[C_]||!pb[C_].findChild,mb=Xf&&U$(function(){return w_(ip({},"a",{get:function(){return ip(this,"a",{value:7}).a}})).a!=7})?function(e,t,i){var o=x1(nc,t);o&&delete nc[t],ip(e,t,i),o&&e!==nc&&ip(nc,t,o)}:ip,gb=function(e,t){var i=zl[e]=w_(Dy);return $$(i,{type:xy,tag:e,description:t}),Xf||(i.description=t),i},ky=function(e,t,i){e===nc&&ky(b_,t,i),lb(e);var o=db(t);return lb(i),Mr(zl,o)?(i.enumerable?(Mr(e,as)&&e[as][o]&&(e[as][o]=!1),i=w_(i,{enumerable:ub(0,!1)})):(Mr(e,as)||ip(e,as,ub(1,{})),e[as][o]=!0),mb(e,o,i)):ip(e,o,i)},_b=function(e,t){lb(e);var i=Py(t),o=T1(i).concat(j1(i));return Ny(o,function(a){Xf&&!cb(L1,i,a)||ky(e,a,i[a])}),e},L1=function(e){var t=db(e),i=cb(J$,this,t);return!(this===nc&&Mr(zl,t)&&!Mr(b_,t))&&(!(i||!Mr(this,t)||!Mr(zl,t)||Mr(this,as)&&this[as][t])||i)},M1=function(e,t){var i=Py(e),o=db(t);if(i!==nc||!Mr(zl,o)||Mr(b_,o)){var a=x1(i,o);return!a||!Mr(zl,o)||Mr(i,as)&&i[as][o]||(a.enumerable=!0),a}},U1=function(e){var t=D1(Py(e)),i=[];return Ny(t,function(o){Mr(zl,o)||Mr(A1,o)||k1(i,o)}),i},j1=function(e){var t=e===nc,i=D1(t?b_:Py(e)),o=[];return Ny(i,function(a){!Mr(zl,a)||t&&!Mr(nc,a)||k1(o,zl[a])}),o};Jf||(tp=function(){if(j$(Dy,this))throw X$("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?V$(arguments[0]):void 0,t=O1(e),i=function(o){this===nc&&cb(i,b_,o),Mr(this,as)&&Mr(this[as],t)&&(this[as][t]=!1),mb(this,t,ub(1,o))};return Xf&&fb&&mb(nc,t,{configurable:!0,set:i}),gb(t,e)},I1(Dy=tp[C_],"toString",function(){return N1(this).tag}),I1(tp,"withoutSetter",function(e){return gb(O1(e),e)}),R1.f=L1,b1.f=ky,W$.f=_b,C1.f=M1,F$.f=w1.f=U1,B$.f=j1,G$.f=function(e){return gb(H$(e),e)},Xf&&z$(Dy,"description",{configurable:!0,get:function(){return N1(this).description}})),Oy({global:!0,constructor:!0,wrap:!0,forced:!Jf,sham:!Jf},{Symbol:tp}),Ny(T1(Z$),function(e){K$(e)}),Oy({target:xy,stat:!0,forced:!Jf},{useSetter:function(){fb=!0},useSimple:function(){fb=!1}}),Oy({target:"Object",stat:!0,forced:!Jf,sham:!Xf},{create:function(e,t){return t===void 0?w_(e):_b(w_(e),t)},defineProperty:ky,defineProperties:_b,getOwnPropertyDescriptor:M1}),Oy({target:"Object",stat:!0,forced:!Jf},{getOwnPropertyNames:U1}),q$(),Y$(tp,xy),A1[as]=!0;var V1=Oc&&!!Symbol.for&&!!Symbol.keyFor,Q$=qt,eX=lr,tX=An,iX=_r,F1=Wa,nX=V1,Eb=F1("string-to-symbol-registry"),rX=F1("symbol-to-string-registry");Q$({target:"Symbol",stat:!0,forced:!nX},{for:function(e){var t=iX(e);if(tX(Eb,t))return Eb[t];var i=eX("Symbol")(t);return Eb[t]=i,rX[i]=t,i}});var oX=qt,sX=An,aX=Xr,cX=Zn,lX=V1,B1=Wa("symbol-to-string-registry");oX({target:"Symbol",stat:!0,forced:!lX},{keyFor:function(e){if(!aX(e))throw TypeError(cX(e)+" is not a symbol");if(sX(B1,e))return B1[e]}});var W1=T_,dX=gt,z1=Se,uX=_r,H1=D([].push),hX=qt,G1=lr,K1=re,pX=Je,R_=D,q1=p,Y1=gt,$1=Xr,X1=uC,fX=function(e){if(dX(e))return e;if(W1(e)){for(var t=e.length,i=[],o=0;o<t;o++){var a=e[o];typeof a=="string"?H1(i,a):typeof a!="number"&&z1(a)!="Number"&&z1(a)!="String"||H1(i,uX(a))}var l=i.length,u=!0;return function(f,m){if(u)return u=!1,m;if(W1(this))return m;for(var _=0;_<l;_++)if(i[_]===f)return m}}},mX=Oc,gX=String,iu=G1("JSON","stringify"),Ly=R_(/./.exec),J1=R_("".charAt),_X=R_("".charCodeAt),EX=R_("".replace),vX=R_(1 .toString),yX=/[\uD800-\uDFFF]/g,Z1=/^[\uD800-\uDBFF]$/,Q1=/^[\uDC00-\uDFFF]$/,eL=!mX||q1(function(){var e=G1("Symbol")();return iu([e])!="[null]"||iu({a:e})!="{}"||iu(Object(e))!="{}"}),tL=q1(function(){return iu("\uDF06\uD834")!=='"\\udf06\\ud834"'||iu("\uDEAD")!=='"\\udead"'}),SX=function(e,t){var i=X1(arguments),o=fX(t);if(Y1(o)||e!==void 0&&!$1(e))return i[1]=function(a,l){if(Y1(o)&&(l=pX(o,this,gX(a),l)),!$1(l))return l},K1(iu,null,i)},TX=function(e,t,i){var o=J1(i,t-1),a=J1(i,t+1);return Ly(Z1,e)&&!Ly(Q1,a)||Ly(Q1,e)&&!Ly(Z1,o)?"\\u"+vX(_X(e,0),16):e};iu&&hX({target:"JSON",stat:!0,arity:3,forced:eL||tL},{stringify:function(e,t,i){var o=X1(arguments),a=K1(eL?SX:iu,null,o);return tL&&typeof a=="string"?EX(a,yX,TX):a}});var iL=Ht,wX=mr;qt({target:"Object",stat:!0,forced:!Oc||p(function(){iL.f(1)})},{getOwnPropertySymbols:function(e){var t=iL.f;return t?t(wX(e)):[]}}),ir("asyncIterator"),ir("hasInstance"),ir("isConcatSpreadable"),ir("iterator"),ir("match"),ir("matchAll"),ir("replace"),ir("search"),ir("species"),ir("split");var CX=v1;ir("toPrimitive"),CX();var bX=lr,RX=Zd;ir("toStringTag"),RX(bX("Symbol"),"Symbol"),ir("unscopables"),Zd(J.JSON,"JSON",!0);var IX=Zt.Symbol,AX=Ri,OX=br.f,nL=AX("metadata"),rL=Function.prototype;rL[nL]===void 0&&OX(rL,nL,{value:null}),ir("dispose"),ir("metadata");var PX=IX;ir("asyncDispose");var NX=D,vb=lr("Symbol"),xX=vb.keyFor,DX=NX(vb.prototype.valueOf),oL=vb.isRegisteredSymbol||function(e){try{return xX(DX(e))!==void 0}catch{return!1}};qt({target:"Symbol",stat:!0},{isRegisteredSymbol:oL});for(var kX=Wa,sL=lr,LX=D,MX=Xr,UX=Ri,My=sL("Symbol"),aL=My.isWellKnownSymbol,cL=sL("Object","getOwnPropertyNames"),jX=LX(My.prototype.valueOf),lL=kX("wks"),yb=0,dL=cL(My),VX=dL.length;yb<VX;yb++)try{var uL=dL[yb];MX(My[uL])&&UX(uL)}catch{}var hL=function(e){if(aL&&aL(e))return!0;try{for(var t=jX(e),i=0,o=cL(lL),a=o.length;i<a;i++)if(lL[o[i]]==t)return!0}catch{}return!1};qt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:hL}),ir("matcher"),ir("observable"),qt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:oL}),qt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:hL}),ir("metadataKey"),ir("patternMatch"),ir("replaceAll");var Zf=d(PX),pL=d($f.f("iterator"));function I_(e){return I_=typeof Zf=="function"&&typeof pL=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Zf=="function"&&t.constructor===Zf&&t!==Zf.prototype?"symbol":typeof t},I_(e)}var FX=d($f.f("toPrimitive"));function BX(e){var t=function(i,o){if(I_(i)!=="object"||i===null)return i;var a=i[FX];if(a!==void 0){var l=a.call(i,o||"default");if(I_(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return I_(t)==="symbol"?t:String(t)}function U(e,t,i){return(t=BX(t))in e?a1(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var WX=p,zX=Ri("iterator"),Sb=!WX(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",t.forEach(function(a,l){t.delete("b"),o+=l+a}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[zX]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),HX=Jd,Tb=qt,Qf=J,Uy=Je,qc=D,em=yt,fL=Sb,mL=Jd,GX=ly,KX=function(e,t,i){for(var o in t)i&&i.unsafe&&e[o]?e[o]=t[o]:HX(e,o,t[o],i);return e},qX=Zd,YX=nC,wb=Zh,gL=sC,Cb=gt,$X=An,XX=ra,JX=Uo,ZX=gr,_L=Fi,jo=_r,QX=l_,EL=lt,bb=qw,eJ=ty,tm=uy,tJ=Ik,iJ=Ri("iterator"),A_="URLSearchParams",vL=A_+"Iterator",yL=wb.set,la=wb.getterFor(A_),nJ=wb.getterFor(vL),rJ=Object.getOwnPropertyDescriptor,Rb=function(e){if(!em)return Qf[e];var t=rJ(Qf,e);return t&&t.value},SL=Rb("fetch"),jy=Rb("Request"),O_=Rb("Headers"),Ib=jy&&jy.prototype,TL=O_&&O_.prototype,oJ=Qf.RegExp,sJ=Qf.TypeError,wL=Qf.decodeURIComponent,aJ=Qf.encodeURIComponent,cJ=qc("".charAt),CL=qc([].join),np=qc([].push),Ab=qc("".replace),lJ=qc([].shift),bL=qc([].splice),RL=qc("".split),dJ=qc("".slice),uJ=/\+/g,IL=Array(4),hJ=function(e){return IL[e-1]||(IL[e-1]=oJ("((?:%[\\da-f]{2}){"+e+"})","gi"))},pJ=function(e){try{return wL(e)}catch{return e}},AL=function(e){var t=Ab(e,uJ," "),i=4;try{return wL(t)}catch{for(;i;)t=Ab(t,hJ(i--),pJ);return t}},fJ=/[!'()~]|%20/g,mJ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},gJ=function(e){return mJ[e]},OL=function(e){return Ab(aJ(e),fJ,gJ)},Ob=YX(function(e,t){yL(this,{type:vL,iterator:bb(la(e).entries),kind:t})},"Iterator",function(){var e=nJ(this),t=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=t==="keys"?o.key:t==="values"?o.value:[o.key,o.value]),i},!0),PL=function(e){this.entries=[],this.url=null,e!==void 0&&(_L(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?cJ(e,0)==="?"?dJ(e,1):e:jo(e)))};PL.prototype={type:A_,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,o,a,l,u,f,m=eJ(e);if(m)for(i=(t=bb(e,m)).next;!(o=Uy(i,t)).done;){if(l=(a=bb(ZX(o.value))).next,(u=Uy(l,a)).done||(f=Uy(l,a)).done||!Uy(l,a).done)throw sJ("Expected sequence with length 2");np(this.entries,{key:jo(u.value),value:jo(f.value)})}else for(var _ in e)$X(e,_)&&np(this.entries,{key:_,value:jo(e[_])})},parseQuery:function(e){if(e)for(var t,i,o=RL(e,"&"),a=0;a<o.length;)(t=o[a++]).length&&(i=RL(t,"="),np(this.entries,{key:AL(lJ(i)),value:AL(CL(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],o=0;o<t.length;)e=t[o++],np(i,OL(e.key)+"="+OL(e.value));return CL(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Vy=function(){gL(this,im);var e=yL(this,new PL(arguments.length>0?arguments[0]:void 0));em||(this.size=e.entries.length)},im=Vy.prototype;if(KX(im,{append:function(e,t){var i=la(this);tm(arguments.length,2),np(i.entries,{key:jo(e),value:jo(t)}),em||this.length++,i.updateURL()},delete:function(e){for(var t=la(this),i=tm(arguments.length,1),o=t.entries,a=jo(e),l=i<2?void 0:arguments[1],u=l===void 0?l:jo(l),f=0;f<o.length;){var m=o[f];if(m.key!==a||u!==void 0&&m.value!==u)f++;else if(bL(o,f,1),u!==void 0)break}em||(this.size=o.length),t.updateURL()},get:function(e){var t=la(this).entries;tm(arguments.length,1);for(var i=jo(e),o=0;o<t.length;o++)if(t[o].key===i)return t[o].value;return null},getAll:function(e){var t=la(this).entries;tm(arguments.length,1);for(var i=jo(e),o=[],a=0;a<t.length;a++)t[a].key===i&&np(o,t[a].value);return o},has:function(e){for(var t=la(this).entries,i=tm(arguments.length,1),o=jo(e),a=i<2?void 0:arguments[1],l=a===void 0?a:jo(a),u=0;u<t.length;){var f=t[u++];if(f.key===o&&(l===void 0||f.value===l))return!0}return!1},set:function(e,t){var i=la(this);tm(arguments.length,1);for(var o,a=i.entries,l=!1,u=jo(e),f=jo(t),m=0;m<a.length;m++)(o=a[m]).key===u&&(l?bL(a,m--,1):(l=!0,o.value=f));l||np(a,{key:u,value:f}),em||(this.size=a.length),i.updateURL()},sort:function(){var e=la(this);tJ(e.entries,function(t,i){return t.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,i=la(this).entries,o=XX(e,arguments.length>1?arguments[1]:void 0),a=0;a<i.length;)o((t=i[a++]).value,t.key,this)},keys:function(){return new Ob(this,"keys")},values:function(){return new Ob(this,"values")},entries:function(){return new Ob(this,"entries")}},{enumerable:!0}),mL(im,iJ,im.entries,{name:"entries"}),mL(im,"toString",function(){return la(this).serialize()},{enumerable:!0}),em&&GX(im,"size",{get:function(){return la(this).entries.length},configurable:!0,enumerable:!0}),qX(Vy,A_),Tb({global:!0,constructor:!0,forced:!fL},{URLSearchParams:Vy}),!fL&&Cb(O_)){var _J=qc(TL.has),EJ=qc(TL.set),NL=function(e){if(_L(e)){var t,i=e.body;if(JX(i)===A_)return t=e.headers?new O_(e.headers):new O_,_J(t,"content-type")||EJ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),QX(e,{body:EL(0,jo(i)),headers:EL(0,t)})}return e};if(Cb(SL)&&Tb({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return SL(e,arguments.length>1?NL(arguments[1]):{})}}),Cb(jy)){var Pb=function(e){return gL(this,Ib),new jy(e,arguments.length>1?NL(arguments[1]):{})};Ib.constructor=Pb,Pb.prototype=Ib,Tb({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Pb})}}var vJ={URLSearchParams:Vy,getState:la},xL=d(Zt.URLSearchParams),yJ={isBrowser:!0,classes:{URLSearchParams:xL!==void 0?xL:sb,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let DL=typeof window<"u"&&typeof document<"u",SJ=(kL=typeof navigator<"u"&&navigator.product,DL&&["ReactNative","NativeScript","NS"].indexOf(kL)<0);var kL;let TJ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function LL(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function ML(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?LL(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):LL(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Yc=ML(ML({},Object.freeze({__proto__:null,hasBrowserEnv:DL,hasStandardBrowserEnv:SJ,hasStandardBrowserWebWorkerEnv:TJ})),yJ),wJ=gr,CJ=Je,bJ=An,RJ=B,IJ=function(){var e=wJ(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},UL=RegExp.prototype,jL=function(e){var t=e.flags;return t!==void 0||"flags"in UL||bJ(e,"flags")||!RJ(UL,e)?t:CJ(IJ,e)},AJ=UC.charAt,VL=Je,OJ=gr,PJ=gt,NJ=Se,xJ=/./.exec,DJ=TypeError,kJ=qt,FL=Je,BL=Qe,LJ=nC,Fy=oC,WL=Jo,zL=Ll,P_=_r,MJ=gr,UJ=Tn,jJ=Se,VJ=is,HL=jL,FJ=Hn,BJ=p,WJ=dC,zJ=function(e,t,i){return t+(i?AJ(e,t).length:1)},HJ=function(e,t){var i=e.exec;if(PJ(i)){var o=VL(i,e,t);return o!==null&&OJ(o),o}if(NJ(e)==="RegExp")return VL(xJ,e,t);throw DJ("RegExp#exec called on incompatible receiver")},GL=Zh,GJ=Ri("matchAll"),KL="RegExp String",qL=KL+" Iterator",KJ=GL.set,qJ=GL.getterFor(qL),YJ=TypeError,Nb=BL("".indexOf),By=BL("".matchAll),xb=!!By&&!BJ(function(){By("a",/./)}),$J=LJ(function(e,t,i,o){KJ(this,{type:qL,regexp:e,string:t,global:i,unicode:o,done:!1})},KL,function(){var e=qJ(this);if(e.done)return Fy(void 0,!0);var t=e.regexp,i=e.string,o=HJ(t,i);return o===null?(e.done=!0,Fy(void 0,!0)):e.global?(P_(o[0])===""&&(t.lastIndex=zJ(i,zL(t.lastIndex),e.unicode)),Fy(o,!1)):(e.done=!0,Fy(o,!1))}),YL=function(e){var t,i,o,a=MJ(this),l=P_(e),u=WJ(a,RegExp),f=P_(HL(a));return t=new u(u===RegExp?a.source:a,f),i=!!~Nb(f,"g"),o=!!~Nb(f,"u"),t.lastIndex=zL(a.lastIndex),new $J(t,l,i,o)};kJ({target:"String",proto:!0,forced:xb},{matchAll:function(e){var t,i,o,a,l=WL(this);if(UJ(e)){if(xb)return By(l,e)}else{if(VJ(e)&&(t=P_(WL(HL(e))),!~Nb(t,"g")))throw YJ("`.matchAll` does not allow non-global regexes");if(xb)return By(l,e);if((o=FJ(e,GJ))===void 0&&jJ(e)=="RegExp"&&(o=YL),o)return FL(o,e,l)}return i=P_(l),a=new RegExp(e,"g"),FL(YL,a,i)}});var XJ=Zr("String").matchAll,JJ=B,ZJ=XJ,Db=String.prototype,QJ=function(e){var t=e.matchAll;return typeof e=="string"||e===Db||JJ(Db,e)&&t===Db.matchAll?ZJ:t},eZ=d(QJ);function $L(e){function t(i,o,a,l){let u=i[l++];if(u==="__proto__")return!0;let f=Number.isFinite(+u),m=l>=i.length;return u=!u&&Be.isArray(a)?a.length:u,m?(Be.hasOwnProp(a,u)?a[u]=[a[u],o]:a[u]=o,!f):(a[u]&&Be.isObject(a[u])||(a[u]=[]),t(i,o,a[u],l)&&Be.isArray(a[u])&&(a[u]=function(_){let v={},S=Object.keys(_),C,b=S.length,V;for(C=0;C<b;C++)V=S[C],v[V]=_[V];return v}(a[u])),!f)}if(Be.isFormData(e)&&Be.isFunction(e.entries)){let i={};return Be.forEachEntry(e,(o,a)=>{t(function(l){return eZ(Be).call(Be,/\w+|\[(\w*)]/g,l).map(u=>u[0]==="[]"?"":u[1]||u[0])}(o),a,i,0)}),i}return null}let kb={transitional:n1,adapter:["xhr","http"],transformRequest:[function(e,t){let i=t.getContentType()||"",o=i.indexOf("application/json")>-1,a=Be.isObject(e);if(a&&Be.isHTMLForm(e)&&(e=new FormData(e)),Be.isFormData(e))return o?JSON.stringify($L(e)):e;if(Be.isArrayBuffer(e)||Be.isBuffer(e)||Be.isStream(e)||Be.isFile(e)||Be.isBlob(e))return e;if(Be.isArrayBufferView(e))return e.buffer;if(Be.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(a){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(u,f){return Ay(u,new Yc.classes.URLSearchParams,Object.assign({visitor:function(m,_,v,S){return Yc.isNode&&Be.isBuffer(m)?(this.append(_,m.toString("base64")),!1):S.defaultVisitor.apply(this,arguments)}},f))}(e,this.formSerializer).toString();if((l=Be.isFileList(e))||i.indexOf("multipart/form-data")>-1){let u=this.env&&this.env.FormData;return Ay(l?{"files[]":e}:e,u&&new u,this.formSerializer)}}return a||o?(t.setContentType("application/json",!1),function(u,f,m){if(Be.isString(u))try{return(f||JSON.parse)(u),Rr(Be).call(Be,u)}catch(_){if(_.name!=="SyntaxError")throw _}return(0,JSON.stringify)(u)}(e)):e}],transformResponse:[function(e){let t=this.transitional||kb.transitional,i=t&&t.forcedJSONParsing,o=this.responseType==="json";if(e&&Be.isString(e)&&(i&&!this.responseType||o)){let a=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(l){if(a)throw l.name==="SyntaxError"?xi.from(l,xi.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Yc.classes.FormData,Blob:Yc.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Be.forEach(["delete","get","head","post","put","patch"],e=>{kb.headers[e]={}});var Lb=kb;let tZ=Be.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),XL=Symbol("internals");function N_(e){var t;return e&&Rr(t=String(e)).call(t).toLowerCase()}function Wy(e){return e===!1||e==null?e:Be.isArray(e)?e.map(Wy):String(e)}function Mb(e,t,i,o,a){return Be.isFunction(o)?o.call(this,t,i):(a&&(t=i),Be.isString(t)?Be.isString(o)?t.indexOf(o)!==-1:Be.isRegExp(o)?o.test(t):void 0:void 0)}class zy{constructor(t){t&&this.set(t)}set(t,i,o){let a=this;function l(m,_,v){let S=N_(_);if(!S)throw new Error("header name must be a non-empty string");let C=Be.findKey(a,S);(!C||a[C]===void 0||v===!0||v===void 0&&a[C]!==!1)&&(a[C||_]=Wy(m))}let u=(m,_)=>Be.forEach(m,(v,S)=>l(v,S,_));var f;return Be.isPlainObject(t)||t instanceof this.constructor?u(t,i):Be.isString(t)&&(t=Rr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Rr(f=t).call(f))?u((m=>{let _={},v,S,C;return m&&m.split(`
`).forEach(function(b){var V,P;C=b.indexOf(":"),v=Rr(V=b.substring(0,C)).call(V).toLowerCase(),S=Rr(P=b.substring(C+1)).call(P),!v||_[v]&&tZ[v]||(v==="set-cookie"?_[v]?_[v].push(S):_[v]=[S]:_[v]=_[v]?_[v]+", "+S:S)}),_})(t),i):t!=null&&l(i,t,o),this}get(t,i){if(t=N_(t)){let o=Be.findKey(this,t);if(o){let a=this[o];if(!i)return a;if(i===!0)return function(l){let u=Object.create(null),f=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,m;for(;m=f.exec(l);)u[m[1]]=m[2];return u}(a);if(Be.isFunction(i))return i.call(this,a,o);if(Be.isRegExp(i))return i.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,i){if(t=N_(t)){let o=Be.findKey(this,t);return!(!o||this[o]===void 0||i&&!Mb(0,this[o],o,i))}return!1}delete(t,i){let o=this,a=!1;function l(u){if(u=N_(u)){let f=Be.findKey(o,u);!f||i&&!Mb(0,o[f],f,i)||(delete o[f],a=!0)}}return Be.isArray(t)?t.forEach(l):l(t),a}clear(t){let i=Object.keys(this),o=i.length,a=!1;for(;o--;){let l=i[o];t&&!Mb(0,this[l],l,t,!0)||(delete this[l],a=!0)}return a}normalize(t){let i=this,o={};return Be.forEach(this,(a,l)=>{var u;let f=Be.findKey(o,l);if(f)return i[f]=Wy(a),void delete i[l];let m=t?function(_){return Rr(_).call(_).toLowerCase().replace(/([a-z\d])(\w*)/g,(v,S,C)=>S.toUpperCase()+C)}(l):Rr(u=String(l)).call(u);m!==l&&delete i[l],i[m]=Wy(a),o[m]=!0}),this}concat(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(t){let i=Object.create(null);return Be.forEach(this,(o,a)=>{o!=null&&o!==!1&&(i[a]=t&&Be.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[i,o]=t;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let i=new this(t);for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return a.forEach(u=>i.set(u)),i}static accessor(t){let i=(this[XL]=this[XL]={accessors:{}}).accessors,o=this.prototype;function a(l){let u=N_(l);i[u]||(function(f,m){let _=Be.toCamelCase(" "+m);["get","set","has"].forEach(v=>{Object.defineProperty(f,v+_,{value:function(S,C,b){return this[v].call(this,m,S,C,b)},configurable:!0})})}(o,l),i[u]=!0)}return Be.isArray(t)?t.forEach(a):a(t),this}}zy.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Be.reduceDescriptors(zy.prototype,(e,t)=>{let{value:i}=e,o=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(a){this[o]=a}}}),Be.freezeMethods(zy);var Hl=zy;function Ub(e,t){let i=this||Lb,o=t||i,a=Hl.from(o.headers),l=o.data;return Be.forEach(e,function(u){l=u.call(i,l,a.normalize(),t?t.status:void 0)}),a.normalize(),l}function JL(e){return!(!e||!e.__CANCEL__)}function x_(e,t,i){xi.call(this,e??"canceled",xi.ERR_CANCELED,t,i),this.name="CanceledError"}Be.inherits(x_,xi,{__CANCEL__:!0});var iZ=Yc.hasStandardBrowserEnv?{write(e,t,i,o,a,l){let u=[e+"="+encodeURIComponent(t)];Be.isNumber(i)&&u.push("expires="+new Date(i).toGMTString()),Be.isString(o)&&u.push("path="+o),Be.isString(a)&&u.push("domain="+a),l===!0&&u.push("secure"),document.cookie=u.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function ZL(e,t){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(t)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,t):t}var nZ=Yc.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),i;function o(a){let l=a;return e&&(t.setAttribute("href",l),l=t.href),t.setAttribute("href",l),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=o(window.location.href),function(a){let l=Be.isString(a)?o(a):a;return l.protocol===i.protocol&&l.host===i.host}}():function(){return!0};function QL(e,t){let i=0,o=function(a,l){a=a||10;let u=new Array(a),f=new Array(a),m,_=0,v=0;return l=l!==void 0?l:1e3,function(S){let C=Date.now(),b=f[v];m||(m=C),u[_]=S,f[_]=C;let V=v,P=0;for(;V!==_;)P+=u[V++],V%=a;if(_=(_+1)%a,_===v&&(v=(v+1)%a),C-m<l)return;let k=b&&C-b;return k?Math.round(1e3*P/k):void 0}}(50,250);return a=>{let l=a.loaded,u=a.lengthComputable?a.total:void 0,f=l-i,m=o(f);i=l;let _={loaded:l,total:u,progress:u?l/u:void 0,bytes:f,rate:m||void 0,estimated:m&&u&&l<=u?(u-l)/m:void 0,event:a};_[t?"download":"upload"]=!0,e(_)}}var rZ=typeof XMLHttpRequest<"u"&&function(e){return new De(function(t,i){let o=e.data,a=Hl.from(e.headers).normalize(),l,u,{responseType:f,withXSRFToken:m}=e;function _(){e.cancelToken&&e.cancelToken.unsubscribe(l),e.signal&&e.signal.removeEventListener("abort",l)}if(Be.isFormData(o)){if(Yc.hasStandardBrowserEnv||Yc.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((u=a.getContentType())!==!1){let[V,...P]=u?u.split(";").map(k=>Rr(k).call(k)).filter(Boolean):[];a.setContentType([V||"multipart/form-data",...P].join("; "))}}let v=new XMLHttpRequest;if(e.auth){let V=e.auth.username||"",P=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.set("Authorization","Basic "+btoa(V+":"+P))}let S=ZL(e.baseURL,e.url);function C(){if(!v)return;let V=Hl.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders());(function(P,k,F){let H=F.config.validateStatus;F.status&&H&&!H(F.status)?k(new xi("Request failed with status code "+F.status,[xi.ERR_BAD_REQUEST,xi.ERR_BAD_RESPONSE][Math.floor(F.status/100)-4],F.config,F.request,F)):P(F)})(function(P){t(P),_()},function(P){i(P),_()},{data:f&&f!=="text"&&f!=="json"?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:V,config:e,request:v}),v=null}if(v.open(e.method.toUpperCase(),t1(S,e.params,e.paramsSerializer),!0),v.timeout=e.timeout,"onloadend"in v?v.onloadend=C:v.onreadystatechange=function(){v&&v.readyState===4&&(v.status!==0||v.responseURL&&v.responseURL.indexOf("file:")===0)&&setTimeout(C)},v.onabort=function(){v&&(i(new xi("Request aborted",xi.ECONNABORTED,e,v)),v=null)},v.onerror=function(){i(new xi("Network Error",xi.ERR_NETWORK,e,v)),v=null},v.ontimeout=function(){let V=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",P=e.transitional||n1;e.timeoutErrorMessage&&(V=e.timeoutErrorMessage),i(new xi(V,P.clarifyTimeoutError?xi.ETIMEDOUT:xi.ECONNABORTED,e,v)),v=null},Yc.hasStandardBrowserEnv&&(m&&Be.isFunction(m)&&(m=m(e)),m||m!==!1&&nZ(S))){let V=e.xsrfHeaderName&&e.xsrfCookieName&&iZ.read(e.xsrfCookieName);V&&a.set(e.xsrfHeaderName,V)}o===void 0&&a.setContentType(null),"setRequestHeader"in v&&Be.forEach(a.toJSON(),function(V,P){v.setRequestHeader(P,V)}),Be.isUndefined(e.withCredentials)||(v.withCredentials=!!e.withCredentials),f&&f!=="json"&&(v.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&v.addEventListener("progress",QL(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&v.upload&&v.upload.addEventListener("progress",QL(e.onUploadProgress)),(e.cancelToken||e.signal)&&(l=V=>{v&&(i(!V||V.type?new x_(null,e,v):V),v.abort(),v=null)},e.cancelToken&&e.cancelToken.subscribe(l),e.signal&&(e.signal.aborted?l():e.signal.addEventListener("abort",l)));let b=function(V){let P=/^([-+\w]{1,25})(:?\/\/|:)/.exec(V);return P&&P[1]||""}(S);b&&Yc.protocols.indexOf(b)===-1?i(new xi("Unsupported protocol "+b+":",xi.ERR_BAD_REQUEST,e)):v.send(o||null)})};let jb={http:null,xhr:rZ};Be.forEach(jb,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let eM=e=>"- ".concat(e),oZ=e=>Be.isFunction(e)||e===null||e===!1;var tM={getAdapter:e=>{e=Be.isArray(e)?e:[e];let{length:t}=e,i,o,a={};for(let l=0;l<t;l++){let u;if(i=e[l],o=i,!oZ(i)&&(o=jb[(u=String(i)).toLowerCase()],o===void 0))throw new xi("Unknown adapter '".concat(u,"'"));if(o)break;a[u||"#"+l]=o}if(!o){let l=Object.entries(a).map(u=>{let[f,m]=u;return"adapter ".concat(f," ")+(m===!1?"is not supported by the environment":"is not available in the build")});throw new xi("There is no suitable adapter to dispatch the request "+(t?l.length>1?`since :
`+l.map(eM).join(`
`):" "+eM(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:jb};function Vb(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new x_(null,e)}function iM(e){return Vb(e),e.headers=Hl.from(e.headers),e.data=Ub.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),tM.getAdapter(e.adapter||Lb.adapter)(e).then(function(t){return Vb(e),t.data=Ub.call(e,e.transformResponse,t),t.headers=Hl.from(t.headers),t},function(t){return JL(t)||(Vb(e),t&&t.response&&(t.response.data=Ub.call(e,e.transformResponse,t.response),t.response.headers=Hl.from(t.response.headers))),De.reject(t)})}function nM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}let rM=e=>e instanceof Hl?function(t){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?nM(Object(o),!0).forEach(function(a){U(t,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):nM(Object(o)).forEach(function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(o,a))})}return t}({},e):e;function nm(e,t){t=t||{};let i={};function o(_,v,S){return Be.isPlainObject(_)&&Be.isPlainObject(v)?Be.merge.call({caseless:S},_,v):Be.isPlainObject(v)?Be.merge({},v):Be.isArray(v)?v.slice():v}function a(_,v,S){return Be.isUndefined(v)?Be.isUndefined(_)?void 0:o(void 0,_,S):o(_,v,S)}function l(_,v){if(!Be.isUndefined(v))return o(void 0,v)}function u(_,v){return Be.isUndefined(v)?Be.isUndefined(_)?void 0:o(void 0,_):o(void 0,v)}function f(_,v,S){return S in t?o(_,v):S in e?o(void 0,_):void 0}let m={url:l,method:l,data:l,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:f,headers:(_,v)=>a(rM(_),rM(v),!0)};return Be.forEach(Object.keys(Object.assign({},e,t)),function(_){let v=m[_]||a,S=v(e[_],t[_],_);Be.isUndefined(S)&&v!==f||(i[_]=S)}),i}let oM="1.6.8",Fb={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Fb[e]=function(i){return typeof i===e||"a"+(t<1?"n ":" ")+e}});let sM={};Fb.transitional=function(e,t,i){function o(a,l){return"[Axios v"+oM+"] Transitional option '"+a+"'"+l+(i?". "+i:"")}return(a,l,u)=>{if(e===!1)throw new xi(o(l," has been removed"+(t?" in "+t:"")),xi.ERR_DEPRECATED);return t&&!sM[l]&&(sM[l]=!0,console.warn(o(l," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,l,u)}};var Bb={assertOptions:function(e,t,i){if(typeof e!="object")throw new xi("options must be an object",xi.ERR_BAD_OPTION_VALUE);let o=Object.keys(e),a=o.length;for(;a-- >0;){let l=o[a],u=t[l];if(u){let f=e[l],m=f===void 0||u(f,l,e);if(m!==!0)throw new xi("option "+l+" must be "+m,xi.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new xi("Unknown option "+l,xi.ERR_BAD_OPTION)}},validators:Fb};let nu=Bb.validators,Hy=class{constructor(e){this.defaults=e,this.interceptors={request:new i1,response:new i1}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let o;Error.captureStackTrace?Error.captureStackTrace(o={}):o=new Error;let a=o.stack?o.stack.replace(/^.+\n/,""):"";i.stack?a&&!String(i.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+a):i.stack=a}throw i}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=nm(this.defaults,t);let{transitional:i,paramsSerializer:o,headers:a}=t;i!==void 0&&Bb.assertOptions(i,{silentJSONParsing:nu.transitional(nu.boolean),forcedJSONParsing:nu.transitional(nu.boolean),clarifyTimeoutError:nu.transitional(nu.boolean)},!1),o!=null&&(Be.isFunction(o)?t.paramsSerializer={serialize:o}:Bb.assertOptions(o,{encode:nu.function,serialize:nu.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=a&&Be.merge(a.common,a[t.method]);a&&Be.forEach(["delete","get","head","post","put","patch","common"],b=>{delete a[b]}),t.headers=Hl.concat(l,a);let u=[],f=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(f=f&&b.synchronous,u.unshift(b.fulfilled,b.rejected))});let m=[],_;this.interceptors.response.forEach(function(b){m.push(b.fulfilled,b.rejected)});let v,S=0;if(!f){let b=[iM.bind(this),void 0];for(b.unshift.apply(b,u),b.push.apply(b,m),v=b.length,_=De.resolve(t);S<v;)_=_.then(b[S++],b[S++]);return _}v=u.length;let C=t;for(S=0;S<v;){let b=u[S++],V=u[S++];try{C=b(C)}catch(P){V.call(this,P);break}}try{_=iM.call(this,C)}catch(b){return De.reject(b)}for(S=0,v=m.length;S<v;)_=_.then(m[S++],m[S++]);return _}getUri(e){return t1(ZL((e=nm(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Be.forEach(["delete","get","head","options"],function(e){Hy.prototype[e]=function(t,i){return this.request(nm(i||{},{method:e,url:t,data:(i||{}).data}))}}),Be.forEach(["post","put","patch"],function(e){function t(i){return function(o,a,l){return this.request(nm(l||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Hy.prototype[e]=t(),Hy.prototype[e+"Form"]=t(!0)});var Gy=Hy;class Wb{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let i;this.promise=new De(function(a){i=a});let o=this;this.promise.then(a=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](a);o._listeners=null}),this.promise.then=a=>{let l,u=new De(f=>{o.subscribe(f),l=f}).then(a);return u.cancel=function(){o.unsubscribe(l)},u},t(function(a,l,u){o.reason||(o.reason=new x_(a,l,u),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let i=this._listeners.indexOf(t);i!==-1&&this._listeners.splice(i,1)}static source(){let t;return{token:new Wb(function(i){t=i}),cancel:t}}}var sZ=Wb;let zb={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(zb).forEach(e=>{let[t,i]=e;zb[i]=t});var aZ=zb;let Er=function e(t){let i=new Gy(t),o=Vk(Gy.prototype.request,i);return Be.extend(o,Gy.prototype,i,{allOwnKeys:!0}),Be.extend(o,i,null,{allOwnKeys:!0}),o.create=function(a){return e(nm(t,a))},o}(Lb);Er.Axios=Gy,Er.CanceledError=x_,Er.CancelToken=sZ,Er.isCancel=JL,Er.VERSION=oM,Er.toFormData=Ay,Er.AxiosError=xi,Er.Cancel=Er.CanceledError,Er.all=function(e){return De.all(e)},Er.spread=function(e){return function(t){return e.apply(null,t)}},Er.isAxiosError=function(e){return Be.isObject(e)&&e.isAxiosError===!0},Er.mergeConfig=nm,Er.AxiosHeaders=Hl,Er.formToJSON=e=>$L(Be.isHTMLForm(e)?new FormData(e):e),Er.getAdapter=tM.getAdapter,Er.HttpStatusCode=aZ,Er.default=Er;var Qr=Er;let cZ=()=>{};function D_(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:cZ};return e.promise=new De((t,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}let Ky=new Map,qy=new Map,$c=new Map,On=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),$t=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),aM=new OY,rc=aM.getResult(),Hb=null;function Ut(e){if(!Hb){rc=aM.getResult();let t=function(f){if(f.engine.name==="Blink"&&f.browser.name!=="WeChat")return $t.CHROME;switch(f.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return $t.CHROME;case"Safari":case"Mobile Safari":return $t.SAFARI;case"Edge":return $t.EDGE;case"Firefox":return $t.FIREFOX;case"QQ":case"QQBrowser":return $t.QQ;case"Opera":return $t.OPERA;case"WeChat":return $t.WECHAT;default:return f.browser.name||""}}(rc),i=cM(rc),o=function(f){return f.os.name==="Windows"?f.os.version?f.os.name+" "+f.os.version:f.os.name:f.os.name||""}(rc),a=rc.os.version,l=cM(rc,!1),u=rc.device.type;if(!(t&&i&&o&&a))return{name:t,version:i,os:o,osVersion:a,browserVersion:l,deviceType:u};Hb={name:t,version:i,os:o,osVersion:a,browserVersion:l,deviceType:u}}return Hb}function cM(e){let t,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?t.split(".")[0]:t}function Yy(){return Ut().os}function lM(){let e=Ut();return"".concat(e.os," ").concat(e.osVersion)}function $y(){let e=Ut();return!!(rc.engine.name==="WebKit"&&e.os===On.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==$t.SAFARI||ur()&&e.name!==$t.SAFARI)}function ru(){return Ut().name===$t.CHROME}function Pn(){return Ut().name===$t.SAFARI}function dM(){return Ut().name===$t.EDGE}function ci(){return Ut().name===$t.FIREFOX}function ur(){return Ut().os===On.IOS}function Gb(e){let t=Ut();return!(t.name!==$t.CHROME||!t.osVersion)&&Number(t.version)>=e}function uM(e){let t=Ut();return!(t.name!==$t.EDGE||!t.osVersion)&&Number(t.version)>=e}function hM(e){let t=Ut();return!(t.name!==$t.SAFARI||!t.osVersion)&&Number(t.version)>=e}function pM(e,t,i){let o=Ut();if(o.os!==On.IOS||!o.osVersion)return!1;let a=o.osVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function fM(e,t,i){let o=Ut();if(o.name!==$t.SAFARI||!o.osVersion||!o.browserVersion)return!1;let a=o.browserVersion.split(".");return t&&Number(a[0])===e&&Number(a[1])<t||Number(a[0])<e}function mM(e){let t=Ut();return!(t.name!==$t.OPERA||!t.osVersion)&&Number(t.version)>=e}function gM(){let e=Ut();return!(e.name!==$t.CHROME||!e.osVersion)&&Number(e.version)<=90}function _M(){let e=Ut();if(e.os!==On.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function rm(){let e=Ut();if(e.os!==On.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function Kb(){let e=Ut();if(e.os!==On.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function EM(){let e=Ut();if(e.os!==On.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function da(){return Pn()&&navigator.maxTouchPoints>0}function vM(){return Ut().name===$t.WECHAT}function yM(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function qb(){let e=Yy();return function(){let{deviceType:t}=Ut();return t==="mobile"||t==="tablet"}()||e===On.ANDROID||e===On.IOS||e===On.HARMONY_OS}function ou(){let e=Ut();return e.name!==$t.EDGE&&e.name!==$t.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Xy(){return Yy()===On.ANDROID}function k_(){let e=Ut();return Xy()&&(e.name===$t.CHROME||e.name===$t.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function SM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function qe(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?SM(Object(i),!0).forEach(function(o){wi(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SM(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function wi(e,t,i){return(t=function(o){var a=function(l,u){if(typeof l!="object"||l===null)return l;var f=l[Symbol.toPrimitive];if(f!==void 0){var m=f.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(o);return typeof a=="symbol"?a:String(a)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let W=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({});class fe extends Error{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;super(i),wi(this,"code",void 0),wi(this,"message",void 0),wi(this,"data",void 0),wi(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=o}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return t==="error"&&(i||console).error(this.toString()),t==="warning"&&(i||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}}function Gl(e,t){if(typeof e!="boolean")throw new fe(W.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Cn(e,t,i){if(!ke(i).call(i,e))throw new fe(W.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(i)))}function si(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(a){return typeof a=="number"&&a%1==0}(e))throw new fe(W.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function Yb(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new fe(W.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&si(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&si(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&si(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&si(e.ideal,"".concat(t,".ideal"),1,1/0)}else si(e,t,1,1/0)}function Gn(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new fe(W.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!TM(e,i,o,a))throw new fe(W.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(a?" ASCII characters only.":""))}function Kl(e,t){if(!Array.isArray(e))throw new fe(W.INVALID_PARAMS,"".concat(t," should be an array"))}function Mi(e){return e==null}function TM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=t&&(!o||function(a){if(typeof a!="string")return!1;for(let l=0;l<a.length;l+=1){let u=a.charCodeAt(l);if(u<0||u>255)return!1}return!0}(e))}function wM(e,t,i){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,i);let o=e.getUint32(t,i),a=e.getUint32(t+4,i),l=+!!i,u=+!i;return BigInt(o*u+a*l)<<BigInt(32)|BigInt(o*l+a*u)}function CM(e,t,i,o){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,i,o);let a=Number(i>>BigInt(32)),l=Number(i&BigInt(4294967295));e.setUint32(t,a,o),e.setUint32(t+4,l,o)}var L_=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(L_||{}),$b=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}($b||{});let bM=new class{constructor(){wi(this,"_clientSize",null),wi(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),wi(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),wi(this,"getStyle",e=>window.getComputedStyle(e,null)),wi(this,"checkCssVisibleProperty",e=>{var t;let i=!0,o=this.getStyle(e),{display:a,visibility:l,opacity:u,filter:f}=o;return(a==="none"||ke(t=["hidden","collapse"]).call(t,l)||Number(u)<.1)&&(i=!1),!!i&&(f&&f.split(" ").filter(m=>{var _;let v=m.split("(")[0];return ke(_=["brightness","blur","opacity"]).call(_,v)}).map(m=>{let[_,v]=m.split(/\(|\)/);return[_,Number(v.match(/^[0-9\.]+/))]}).forEach(m=>{let[_,v]=m;switch(_){case"brightness":(v<.1||v>3)&&(i=!1);break;case"blur":v>3&&(i=!1);break;case"opacity":v<.1&&(i=!1)}}),i)}),wi(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let i=!0,o=!0,a=u=>t(u),l=e;for(;l&&o;)a(l)||(i=!1,o=!1),l=l.parentElement,l||(o=!1);return i}),wi(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),wi(this,"getSizeAboutClient",e=>{let{width:t,height:i,left:o,right:a,top:l,bottom:u}=e.getBoundingClientRect(),f=this.getClientWidth(),m=this.getClientHeight();return{width:t,height:i,left:o,right:a,top:l,bottom:u,clientWidth:f,clientHeight:m,clientMin:Math.min(f,m)}}),wi(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,t,i)}),wi(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),wi(this,"checkCoverForAPoint",(e,t,i)=>{let o=this.elementFromPoint(e,t);return o!==null&&o!==i}),wi(this,"getPointPositionList",()=>{let{width:e,height:t,left:i,top:o}=this._clientSize,a=e/6,l=t/6,u=[],f=10**6;for(let m=0;m<5;m++)for(let _=0;_<5;_++){let v=(i*f+(m===0?.1:m===4?(a*m*f-1e5)/f:a*m)*f)/f,S=(o*f+(_===0?.1:_===4?(l*_*f-1e5)/f:l*_)*f)/f;u.push({x:v,y:S})}return[...u]}),wi(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),wi(this,"checkSizeIsVisible",(e,t,i)=>(e>50||i/e<=10)&&(t>50||i/t<=10)),wi(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:i,bottom:o,clientHeight:a,clientWidth:l,clientMin:u}=this._clientSize,f,m,_,v;if(e<0)f=0;else{if(!(e<l))return!1;f=e}if(t<0)return!1;if(m=t<l?t:l,i<0)_=0;else{if(!(i<a))return!1;_=i}if(o<0)return!1;v=o<a?o:a;let S=m-f,C=v-_;return this.checkSizeIsVisible(S,C,u)}),wi(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),wi(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(L_.COVERED);{let t=this.checkActualSize(),i=this.checkSizeOfPartInClient();return t&&!i?this.returnHiddenResult(L_.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(L_.SIZE)}}return this.returnHiddenResult(L_.STYLE)}return this.returnHiddenResult($b.UNMOUNTED)}return this.returnHiddenResult($b.INVALID_HTML_ELEMENT)}),wi(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function Xb(e){return new TextEncoder().encode(e)}let RM=function(e,t){let i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i},Jb=async e=>function(t,i){let o="";return new Uint8Array(t).forEach(a=>{o+=a.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",Xb(e)),16),Ii=class{constructor(){wi(this,"_events",{}),wi(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let i=this._events[e];this._indexOfListener(i,t)===-1&&i.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let i=this._events[e],o=this._indexOfListener(i,t);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(l=>l);for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];for(let l=0;l<t.length;l+=1){let u=t[l];u.once&&this.off(e,u.listener),u.listener.apply(this,o||[])}}safeEmit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(a=>{a.once&&this.off(e,a.listener);try{a.listener.apply(this,i)}catch(l){console.error("safeEmit event:".concat(e," error ").concat(l==null?void 0:l.toString()))}})}_indexOfListener(e,t){let i=e.length;for(;i--;)if(e[i].listener===t)return i;return-1}},M_=null;function IM(){if(M_)return M_;if(window.electron)return M_=window.electron;if(!window.require)return null;try{return M_=window.require("electron"),M_}catch{return null}}let ln=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),Ui=function(e){return e.TRACER="tracer",e}({});function AM(e){return si(e.timeout,"config.timeout",0,1e5),si(e.timeoutFactor,"config.timeoutFactor",0,100,!1),si(e.maxRetryCount,"config.maxRetryConfig",0,1/0),si(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let lZ=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Ct=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function om(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function OM(e){return Gn(e.turnServerURL,"turnServerURL"),Gn(e.username,"username"),Gn(e.password,"password"),e.udpport&&si(e.udpport,"udpport",1,99999,!0),e.forceturn&&Gl(e.forceturn,"forceturn"),e.security&&Gl(e.security,"security"),e.tcpport&&si(e.tcpport,"tcpport",1,99999,!0),!0}function PM(e){return e.level!==void 0&&Cn(e.level,"level",[1,2,3]),e.delay!==void 0&&si(e.delay,"delay",0,3e3,!0),!0}let bt=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),nr=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Ur=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),rp=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function dn(e,t){for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return e.getListeners(t).length===0?De.reject(new fe(W.UNEXPECTED_ERROR,"can not emit promise")):new De((l,u)=>{e.emit(t,...o,l,u)})}function li(e,t){if(e.getListeners(t).length===0)return De.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return dn(e,t,...o)}function Vo(e,t){if(e.getListeners(t).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return op(e,t,...o)}function op(e,t){let i=null,o=null;for(var a=arguments.length,l=new Array(a>2?a-2:0),u=2;u<a;u++)l[u-2]=arguments[u];if(e.emit(t,...l,f=>{i=f},f=>{o=f}),o!==null)throw o;if(i===null)throw new fe(W.UNEXPECTED_ERROR,"handler is not sync");return i}let ji=new class extends Ii{set networkState(e){this.emit(rp.NETWORK_STATE_CHANGE,e,this._networkState),e===Ur.ONLINE?this.emit(rp.ONLINE):e===Ur.OFFLINE&&(this.onlineWaiter=new De(t=>{this.once(rp.ONLINE,()=>{this.onlineWaiter=void 0,t(Ur.ONLINE)})}),this.emit(rp.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ur.ONLINE}constructor(){super(),wi(this,"_moduleName","network-indicator"),wi(this,"_networkState",Ur.ONLINE),wi(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ur.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ur.OFFLINE})}};function Jy(e,t){let i=e.indexOf(t);i!==-1&&e.splice(i,1)}function sm(e){let t=[];return e.forEach(i=>{t.indexOf(i)===-1&&t.push(i)}),t}function Zy(e){De!==void 0?De.resolve().then(e):setTimeout(e,0)}function mi(e){return JSON.parse(JSON.stringify(e))}function sp(e){try{return mi(e)}catch{return e}}let NM={};function su(e,t){NM[t]||(NM[t]=!0,e())}function ap(e){let t=window.atob(e),i=new Uint8Array(new ArrayBuffer(t.length));for(let o=0;o<t.length;o+=1)i[o]=t.charCodeAt(o);return i}function au(e){let t="";for(let i=0;i<e.length;i+=1)t+=String.fromCharCode(e[i]);return window.btoa(t)}function xM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>t)i=i.slice(0,t);else if(i.length<t){let o=new Uint8Array(t);o.set(i),i=o}return i}function DM(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let o=fo(t).call(t,(u,f)=>u+f.length,0),a=new Uint8Array(new ArrayBuffer(o)),l=0;return t.forEach(u=>{a.set(u,l),l+=u.length}),a}function Xc(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function kM(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{t+=typeof i=="string"?Xc(i):i.size}),t+138}function dZ(e){let t=new fe(W.TIMEOUT,"timeout");return new De((i,o)=>{window.setTimeout(()=>o(t),e)})}function Nn(e){return new De(t=>{window.setTimeout(t,e)})}function di(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(t).concat(i):"".concat(t).concat(i)+di(e-i.length,"")}function U_(){return di(32,"").toUpperCase()}let Qy=()=>{},LM=new class{constructor(){wi(this,"fnMap",new Map)}throttleByKey(e,t,i,o){for(var a=arguments.length,l=new Array(a>4?a-4:0),u=4;u<a;u++)l[u-4]=arguments[u];if(this.fnMap.has(t)){let f=this.fnMap.get(t);if(f.threshold!==i){f.fn(...f.args),clearTimeout(f.timer);let m=window.setTimeout(()=>{let _=this.fnMap.get(t);_&&_.fn(..._.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:m,args:l,skipFn:o})}else f.skipFn&&f.skipFn(...f.args),this.fnMap.set(t,qe(qe({},f),{},{fn:e,args:l,skipFn:o}))}else{let f=window.setTimeout(()=>{let m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},i);this.fnMap.set(t,{fn:e,threshold:i,timer:f,args:l,skipFn:o})}}},MM=LM.throttleByKey.bind(LM);function UM(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function Zb(e,t){if(!UM(e)||!UM(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let i=[...e];for(let o=0;o<t.length;o++)i[o]=Zb(e[o],t[o]);return i}{let i=qe({},e);for(let o in t)Object.prototype.hasOwnProperty.call(t,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=Zb(e[o],t[o]):i[o]=t[o]);return i}}function jM(e,t){let i=[0];if(i=new Array(t).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==t););return i}function Qb(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function VM(e){let t="0123456789abcdef";function i(ie){let oe,ae="";for(oe=0;oe<=3;oe++)ae+=t.charAt(ie>>8*oe+4&15)+t.charAt(ie>>8*oe&15);return ae}function o(ie,oe){let ae=(65535&ie)+(65535&oe);return(ie>>16)+(oe>>16)+(ae>>16)<<16|65535&ae}function a(ie,oe,ae,he,Ee,ye){return o(function(Ce,ze){return Ce<<ze|Ce>>>32-ze}(o(o(oe,ie),o(he,ye)),Ee),ae)}function l(ie,oe,ae,he,Ee,ye,Ce){return a(oe&ae|~oe&he,ie,oe,Ee,ye,Ce)}function u(ie,oe,ae,he,Ee,ye,Ce){return a(oe&he|ae&~he,ie,oe,Ee,ye,Ce)}function f(ie,oe,ae,he,Ee,ye,Ce){return a(oe^ae^he,ie,oe,Ee,ye,Ce)}function m(ie,oe,ae,he,Ee,ye,Ce){return a(ae^(oe|~he),ie,oe,Ee,ye,Ce)}let _=function(ie){let oe,ae=1+(ie.length+8>>6),he=new Array(16*ae);for(oe=0;oe<16*ae;oe++)he[oe]=0;for(oe=0;oe<ie.length;oe++)he[oe>>2]|=ie.charCodeAt(oe)<<oe%4*8;return he[oe>>2]|=128<<oe%4*8,he[16*ae-2]=8*ie.length,he}(e),v,S,C,b,V,P=1732584193,k=-271733879,F=-1732584194,H=271733878;for(v=0;v<_.length;v+=16)S=P,C=k,b=F,V=H,P=l(P,k,F,H,_[v+0],7,-680876936),H=l(H,P,k,F,_[v+1],12,-389564586),F=l(F,H,P,k,_[v+2],17,606105819),k=l(k,F,H,P,_[v+3],22,-1044525330),P=l(P,k,F,H,_[v+4],7,-176418897),H=l(H,P,k,F,_[v+5],12,1200080426),F=l(F,H,P,k,_[v+6],17,-1473231341),k=l(k,F,H,P,_[v+7],22,-45705983),P=l(P,k,F,H,_[v+8],7,1770035416),H=l(H,P,k,F,_[v+9],12,-1958414417),F=l(F,H,P,k,_[v+10],17,-42063),k=l(k,F,H,P,_[v+11],22,-1990404162),P=l(P,k,F,H,_[v+12],7,1804603682),H=l(H,P,k,F,_[v+13],12,-40341101),F=l(F,H,P,k,_[v+14],17,-1502002290),k=l(k,F,H,P,_[v+15],22,1236535329),P=u(P,k,F,H,_[v+1],5,-165796510),H=u(H,P,k,F,_[v+6],9,-1069501632),F=u(F,H,P,k,_[v+11],14,643717713),k=u(k,F,H,P,_[v+0],20,-373897302),P=u(P,k,F,H,_[v+5],5,-701558691),H=u(H,P,k,F,_[v+10],9,38016083),F=u(F,H,P,k,_[v+15],14,-660478335),k=u(k,F,H,P,_[v+4],20,-405537848),P=u(P,k,F,H,_[v+9],5,568446438),H=u(H,P,k,F,_[v+14],9,-1019803690),F=u(F,H,P,k,_[v+3],14,-187363961),k=u(k,F,H,P,_[v+8],20,1163531501),P=u(P,k,F,H,_[v+13],5,-1444681467),H=u(H,P,k,F,_[v+2],9,-51403784),F=u(F,H,P,k,_[v+7],14,1735328473),k=u(k,F,H,P,_[v+12],20,-1926607734),P=f(P,k,F,H,_[v+5],4,-378558),H=f(H,P,k,F,_[v+8],11,-2022574463),F=f(F,H,P,k,_[v+11],16,1839030562),k=f(k,F,H,P,_[v+14],23,-35309556),P=f(P,k,F,H,_[v+1],4,-1530992060),H=f(H,P,k,F,_[v+4],11,1272893353),F=f(F,H,P,k,_[v+7],16,-155497632),k=f(k,F,H,P,_[v+10],23,-1094730640),P=f(P,k,F,H,_[v+13],4,681279174),H=f(H,P,k,F,_[v+0],11,-358537222),F=f(F,H,P,k,_[v+3],16,-722521979),k=f(k,F,H,P,_[v+6],23,76029189),P=f(P,k,F,H,_[v+9],4,-640364487),H=f(H,P,k,F,_[v+12],11,-421815835),F=f(F,H,P,k,_[v+15],16,530742520),k=f(k,F,H,P,_[v+2],23,-995338651),P=m(P,k,F,H,_[v+0],6,-198630844),H=m(H,P,k,F,_[v+7],10,1126891415),F=m(F,H,P,k,_[v+14],15,-1416354905),k=m(k,F,H,P,_[v+5],21,-57434055),P=m(P,k,F,H,_[v+12],6,1700485571),H=m(H,P,k,F,_[v+3],10,-1894986606),F=m(F,H,P,k,_[v+10],15,-1051523),k=m(k,F,H,P,_[v+1],21,-2054922799),P=m(P,k,F,H,_[v+8],6,1873313359),H=m(H,P,k,F,_[v+15],10,-30611744),F=m(F,H,P,k,_[v+6],15,-1560198380),k=m(k,F,H,P,_[v+13],21,1309151649),P=m(P,k,F,H,_[v+4],6,-145523070),H=m(H,P,k,F,_[v+11],10,-1120210379),F=m(F,H,P,k,_[v+2],15,718787259),k=m(k,F,H,P,_[v+9],21,-343485551),P=o(P,S),k=o(k,C),F=o(F,b),H=o(H,V);return i(P)+i(k)+i(F)+i(H)}let uZ=1,e0=console,jn=class{static setLogger(e){e0=e}constructor(e){wi(this,"lockingPromise",De.resolve()),wi(this,"locks",0),wi(this,"name",""),wi(this,"lockId",void 0),this.lockId=uZ++,e&&(this.name=e),e0.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,e0.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let i=new De(a=>{t=()=>{this.locks-=1,e0.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),a()}}),o=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function am(e,t){return function(i,o,a){let l=a.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){let u=this[t];if(!u)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let f=await u.lock("From ".concat(e,".").concat(o));try{for(var m=arguments.length,_=new Array(m),v=0;v<m;v++)_[v]=arguments[v];return await l.apply(this,_)}finally{f()}},a}}let nn={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function t0(e,t){let i=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,i)}function oc(e,t,i,o){let a=Object.assign({},nn,o),l=a.timeout,u=async()=>{await function(_){return new De(v=>{window.setTimeout(v,_)})}(l),l*=a.timeoutFactor,l=Math.min(a.maxRetryTimeout,l)},f=!1,m=new De(async(_,v)=>{t=t||(()=>!1),i=i||(()=>!0);for(let S=0;S<a.maxRetryCount;S+=1){if(f)return v(new fe(W.OPERATION_ABORTED));try{let C=await e();if(!t(C,S)||S+1===a.maxRetryCount)return _(C);await u()}catch(C){if(!i(C,S)||S+1===a.maxRetryCount)return v(C);await u()}}});return m.cancel=()=>f=!0,m}class eR{constructor(t){wi(this,"input",[]),wi(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:fo(t=this.input).call(t,(i,o)=>i+o)/this.input.length}}let i0,n0=0,tR=0;function iR(e,t,i,o){return new De((a,l)=>{t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),n0+=Xc(t.data)):i&&(t.data.size?n0+=t.data.size:t.data instanceof FormData?n0+=kM(t.data):n0+=Xc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Qr.request(t).then(u=>{typeof u.data=="string"?tR+=Xc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?tR+=u.data.byteLength:tR+=Xc(JSON.stringify(u.data)),a(u.data)}).catch(u=>{Qr.isCancel(u)?l(new fe(W.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new fe(W.NETWORK_TIMEOUT,u.message)):u.response?l(new fe(W.NETWORK_RESPONSE_ERROR,u.response.status)):l(new fe(W.NETWORK_ERROR,u.message))})})}async function hZ(e,t){let i=new Blob([t.data],{type:"buffer"});return await iR(e,qe(qe({},t),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}let FM=()=>window.isSecureContext!==void 0,Ps=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){let o=t[1],a=t[2];return"".concat(o,".").concat(a)}let i=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(i&&i[1]&&i[2]){let o=i[1],a=i[2];return"".concat(o,".").concat(100*(Number(a)+1))}return"4.0.0.999"}("4.21.0"),nR=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),cp=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),rR={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},oR="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",vn={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:rR,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function ai(e,t,i){var o,a,l;ke(o=Object.keys(vn)).call(o,e)&&(!i&&ke(a=Object.keys(cu)).call(a,e)||(vn[e]=t,e==="ENABLE_VIDEO_SEI"&&t===!0&&(vn.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(l=!!t,vn.USE_NEW_NETWORK_CONFIG=l,l&&(vn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],vn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],vn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],vn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],vn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",vn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",vn.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function $(e){return vn[e]}let cu={};var Tt=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Tt||{});class pZ{constructor(t,i,o,a){wi(this,"state",void 0),this.state={codec:t,audioCodec:i,mode:o,clientId:a,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:cp.Default}}dispatch(t){this.state=function(i,o){switch(o.type){case Tt.SET_SESSION_ID:return qe(qe({},i),{},{sessionId:o.sessionId});case Tt.SET_P2P_ID:return qe(qe({},i),{},{p2pId:o.p2pId});case Tt.SET_UID:return qe(qe({},i),{},{uid:o.uid});case Tt.SET_INT_UID:return qe(qe({},i),{},{intUid:o.intUid});case Tt.SET_PUB_ID:return qe(qe({},i),{},{pubId:o.pubId});case Tt.KEY_METRIC_CLIENT_CREATED:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{clientCreated:o.metric})});case Tt.KEY_METRIC_JOIN_START:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{joinStart:o.metric})});case Tt.AVOID_JOIN_START:return qe(qe({},i),{},{avoidJoinStart:o.avoidJoinStart});case Tt.KEY_METRIC_JOIN_END:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{joinEnd:o.metric})});case Tt.KEY_METRIC_REQUEST_AP_START:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{requestAPStart:o.metric})});case Tt.KEY_METRIC_REQUEST_AP_END:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{requestAPEnd:o.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_START:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{joinGatewayStart:o.metric})});case Tt.KEY_METRIC_JOIN_GATEWAY_END:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{joinGatewayEnd:o.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_START:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{peerConnectionStart:o.metric})});case Tt.KEY_METRIC_PEER_CONNECTION_END:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{peerConnectionEnd:o.metric})});case Tt.KEY_METRIC_DESCRIPTION_START:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{descriptionStart:o.metric})});case Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{signalChannelOpen:o.metric})});case Tt.KEY_METRIC_ICE_CONNECTION_END:return qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{iceConnectionEnd:o.metric})});case Tt.KEY_METRIC_PUBLISH:{let a=i.keyMetrics.publish,l=a.findIndex(u=>u.trackId===o.metric.trackId);return l!==-1?(a[l]=qe(qe({},a[l]),o.metric),qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{publish:[...a]})})):qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{publish:[...i.keyMetrics.publish,o.metric]})})}case Tt.KEY_METRIC_SUBSCRIBE:{let a=i.keyMetrics.subscribe,l=a.findIndex(u=>u.userId===o.metric.userId&&u.type===o.metric.type);return l!==-1?(a[l]=qe(qe({},a[l]),o.metric),qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{subscribe:[...a]})})):qe(qe({},i),{},{keyMetrics:qe(qe({},i.keyMetrics),{},{subscribe:[...i.keyMetrics.subscribe,o.metric]})})}case Tt.SET_CLOUD_PROXY_SERVER_MODE:return i.cloudProxyServerMode=o.mode,i;case Tt.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?i.joinChannelServiceRecords=[...i.joinChannelServiceRecords,o.record]:(i.joinChannelServiceRecords[o.index]=qe(qe({},i.joinChannelServiceRecords[o.index]),o.record),i.joinChannelServiceRecords=[...i.joinChannelServiceRecords]),i;case Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return i.joinChannelServiceRecords=[],i;case Tt.RESET_KEY_METRICS:return i.keyMetrics={publish:[],subscribe:[]},i;case Tt.SET_USE_DATACHANNEL:return qe(qe({},i),{},{useDataChannel:o.val});case Tt.SET_USE_P2P:return qe(qe({},i),{},{useP2P:o.val});case Tt.SET_TRANSPORT_TYPE:return qe(qe({},i),{},{p2pTransport:o.val});default:return i}}(this.state,t)}set sessionId(t){this.dispatch({type:Tt.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:Tt.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:Tt.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:Tt.SET_UID,uid:t})}get uid(){return this.state.uid}set intUid(t){this.dispatch({type:Tt.SET_INT_UID,intUid:t})}get intUid(){return this.state.intUid}set pubId(t){this.dispatch({type:Tt.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:Tt.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:Tt.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:Tt.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}set p2pTransport(t){this.dispatch({type:Tt.SET_TRANSPORT_TYPE,val:t})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:Tt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Tt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Tt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Tt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Tt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Tt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,i,o,a){this.dispatch({type:Tt.KEY_METRIC_PUBLISH,metric:qe(qe({trackId:t,type:i},o&&{publishStart:o}),a&&{publishEnd:a})})}subscribe(t,i,o,a,l,u,f){this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:qe(qe(qe(qe(qe({userId:t,type:i},o&&{subscribeStart:o}),a&&{subscribeEnd:a}),l&&{firstFrame:l}),u&&{streamAdded:u}),f&&{firstDecoded:f})})}massSubscribe(t,i,o,a){t.forEach(l=>{this.dispatch({type:Tt.KEY_METRIC_SUBSCRIBE,metric:qe(qe(qe({userId:l.userId,type:l.type},i&&{subscribeStart:i}),o&&{subscribeEnd:o}),a&&{firstFrame:a})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,i){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof i!="number"?(this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:qe(qe({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(i<0||i>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Tt.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:i}),i)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Tt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Tt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:Tt.AVOID_JOIN_START,avoidJoinStart:t})}}let cm=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let BM=128,fZ=96,WM=1e3,lm=10,mZ=0;function zM(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function ft(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zM(Object(i),!0).forEach(function(o){qi(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zM(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function qi(e,t,i){return(t=function(o){var a=function(l,u){if(typeof l!="object"||l===null)return l;var f=l[Symbol.toPrimitive];if(f!==void 0){var m=f.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(o);return typeof a=="symbol"?a:String(a)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let HM=new class extends Ii{constructor(){super(...arguments),qi(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class gZ{constructor(t){qi(this,"logger",void 0),qi(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function sR(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function GM(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let Ns={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},r0=Date.now(),j_=e=>{for(let t in Ns)if(Object.prototype.hasOwnProperty.call(Ns,t)&&Ns[t]===e)return t;return"DEFAULT"},I=new class{constructor(){qi(this,"proxyServerURL",void 0),qi(this,"logLevel",Ns.DEBUG),qi(this,"uploadState","collecting"),qi(this,"uploadLogWaitingList",[]),qi(this,"uploadLogUploadingList",[]),qi(this,"uploadErrorCount",0),qi(this,"currentLogID",0),qi(this,"url",void 0),qi(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let o=[Ns.DEBUG].concat(t);this.log.apply(this,o)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let o=[Ns.INFO].concat(t);this.log.apply(this,o)}warning(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let o=[Ns.WARNING].concat(t);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let o=[Ns.ERROR].concat(t);this.log.apply(this,o)}upload(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];let o=[Ns.DEBUG].concat(t);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){ai("UPLOAD_LOG",!0)}disableLogUpload(){ai("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new gZ(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-r0<100)return void setTimeout(()=>{this.log(...t)},Date.now()-r0);let o=Math.max(0,Math.min(4,t[0]));if(t[0]=sR()+" Agora-SDK [".concat(j_(o),"]:"),this.appendLogToWaitingList(o,...t),o<this.logLevel)return;let a=sR()+" %cAgora-SDK [".concat(j_(o),"]:"),l=[];if(!$("USE_NEW_LOG"))switch(o){case Ns.DEBUG:l=[a,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,l);break;case Ns.INFO:l=[a,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,l);break;case Ns.WARNING:l=[a,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,l);break;case Ns.ERROR:l=[a,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];if(Date.now()-r0<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-r0);let o=Math.max(0,Math.min(4,t[0]));t[0]=sR()+" Agora-SDK [".concat(j_(o),"]:"),this.appendLogToWaitingList(o,...t)}appendLogToWaitingList(e){if(!$("UPLOAD_LOG"))return;for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=GM()+" Agora-SDK [".concat(j_(e),"]:"):i[0]=GM()+" Agora-SDK [".concat(j_(e),"]:");let a="";i.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),a+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:a,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:Ps,process_id:$("PROCESS_ID"),payload:JSON.stringify(e)};return oc(async()=>{let i=await Qr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat($("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat($("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(i.data!=="OK"){let o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{let o={status:-1,message:i.message,errorRange:e.map(a=>a.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),HM.reportLogUploadError(o),!0},{timeout:$("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:$("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,$("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),$("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var KM;function _Z(e){return Gn(e.reportId,"params.reportId",0,100,!1),Gn(e.category,"params.category",0,100,!1),Gn(e.event,"params.event",0,100,!1),Gn(e.label,"params.label",0,100,!1),si(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(KM={}).FREE="free",KM.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let EZ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Vn=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Di=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class V_{constructor(){qi(this,"baseInfoMap",new Map),qi(this,"proxyServer",void 0),qi(this,"eventUploadTimer",void 0),qi(this,"setSessionIdTimer",void 0),qi(this,"url",void 0),qi(this,"backupUrl",void 0),qi(this,"_appId",void 0),qi(this,"keyEventUploadPendingItems",[]),qi(this,"normalEventUploadPendingItems",[]),qi(this,"apiInvokeUploadPendingItems",[]),qi(this,"apiInvokeCount",0),qi(this,"ltsList",[]),qi(this,"lastSendNormalEventTime",Date.now()),qi(this,"customReportCounterTimer",void 0),qi(this,"customReportCount",0),qi(this,"extApiInvoke",async t=>{for(let i of t){let o=ft(ft({},i),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Ui.TRACER});this.sendApiInvoke(o)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),$("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),$("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void I.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));let i=this.baseInfoMap.get(t),o=Date.now(),a=i.startTime;i.startTime=o,I.debug("rewrite session ".concat(t," startTime: ").concat(o," , ").concat(o-a,"ms")),this.baseInfoMap.set(t,i)}setAppId(t){this._appId=t}reportApiInvoke(t,i,o){i.timeout=i.timeout||6e4,i.reportResult=i.reportResult===void 0||i.reportResult;let a=Date.now();this.apiInvokeCount+=1;let l=this.apiInvokeCount,u=()=>({tag:i.tag,invokeId:l,sid:t,name:i.name,apiInvokeTime:a,options:i.options,states:i.states||null}),f=!!$("SHOW_REPORT_INVOKER_LOG");f&&I.info("".concat(i.name," start"),i.options);let m=!1;Nn(i.timeout).then(()=>{m||(this.sendApiInvoke(ft(ft({},u()),{},{error:W.API_INVOKE_TIMEOUT,success:!1})),I.debug("".concat(i.name," timeout")))});let _=new fe(W.UNEXPECTED_ERROR,"".concat(i.name,": this api invoke is end"));return{onSuccess:v=>{let S=()=>{if(m)throw _;return m=!0,this.sendApiInvoke(ft(ft({},u()),{},{success:!0},i.reportResult&&{result:v})),f&&I.info("".concat(i.name," onSuccess")),v};return o?MM(S,i.name+"Success",o,()=>m=!0):S()},onError:v=>{let S=()=>{if(m)throw v;m=!0,this.sendApiInvoke(ft(ft({},u()),{},{success:!1,error:v})),f&&I.info("".concat(i.name," onFailure"),v.toString())};return o?MM(S,i.name+"Error",o,()=>m=!0):S()}}}sessionInit(t,i){if(this.baseInfoMap.has(t))return;let o=Date.now(),a=this.createBaseInfo(t,o);a.cname=i.cname;let l=Object.assign({},{willUploadConsoleLog:$("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:nR?"global":"oversea",areas:$("AREAS")&&$("AREAS").join(",")},i.extend),{stringUid:u,channelProfile:f,channelMode:m,isABTestSuccess:_,lsid:v,clientRole:S}=i,C=Date.now(),b=ft(ft({},a),{},{eventType:Vn.SESSION_INIT,appid:i.appid,browser:navigator.userAgent,buildFormat:i.buildFormat,build:oR,lts:C,elapse:C-o,extend:JSON.stringify(l),mode:i.mode,process:$("PROCESS_ID"),appType:$("APP_TYPE"),success:!0,version:Ps,stringUid:u,channelProfile:f,channelMode:m,isABTestSuccess:_,lsid:v,clientType:20,clientRole:S,serviceId:$("PROCESS_ID"),extensionID:$("PLUGIN_INFO").join(",")||"",preload:i.preload?1:0});this.send({type:Di.SESSION,data:b},!0)}joinChooseServer(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{eventType:Vn.JOIN_CHOOSE_SERVER,lts:l,eventElapse:i.elapse||l-i.lts,chooseServerAddr:i.csAddr,errorCode:i.ec,elapse:l-o.startTime,success:i.succ,chooseServerAddrList:JSON.stringify(i.serverList),uid:i.uid?parseInt(i.uid):null,cid:i.cid?parseInt(i.cid):null,chooseServerIp:i.csIp||"",opid:i.opid,unilbsServerIds:i.unilbsServerIds,extend:i.extend||void 0,isHttp3:i.isHttp3});this.send({type:Di.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{eventType:Vn.REQ_USER_ACCOUNT,lts:l,success:i.success,serverAddress:i.serverAddr,stringUid:i.stringUid,uid:i.uid,errorCode:i.errorCode,elapse:i.elapse||l-o.startTime,eventElapse:l-i.lts,extend:JSON.stringify(i.extend)});this.send({type:Di.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info;i.vid&&(a.vid=i.vid),a.uid=i.uid,a.cid=i.cid;let l=Date.now(),{firstSuccess:u,avoidJoinStartTime:f,isProxy:m,addr:_}=i,v=l-(u&&f?f:o.startTime),S=ft(ft({},a),{},{eventType:Vn.JOIN_GATEWAY,lts:l,gatewayAddr:i.addr,success:i.succ,errorCode:i.ec,elapse:v,eventElapse:l-i.lts,firstSuccess:u,signalChannel:i.signalChannel}),C=S.success?1:0;if(i.succ&&(o.lastJoinSuccessTime=l),u)this.send({type:Di.JOIN_GATEWAY,data:S},!0);else{let b;if(_)if(m){let P=_.match(/h=(\d{1,3}-){3}\d{1,3}/g),k=_.match(/p=[0-9]{1,6}/g);b={isSuccess:C,gatewayIp:P&&P.length?P[0].split("=")[1].replace(/-/g,"."):"",port:k&&k.length?k[0].split("=")[1]:"",isProxy:m?1:0}}else{let P=_.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),k=_.match(/(:|p=)[0-9]{1,6}/g);b={isSuccess:C,gatewayIp:P&&P.length?P[0].split("//")[1].replace(/-/g,"."):"",port:k&&k.length?k[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else b={isSuccess:C,gatewayIp:"",port:"",isProxy:m?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);let V=Object.assign({},S,b,{eventType:Vn.REJOIN_GATEWAY});this.send({type:Di.RE_JOIN_GATEWAY,data:V},!0)}}joinChannelTimeout(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=Date.now(),l=ft(ft({},o.info),{},{lts:a,timeout:i,elapse:a-o.startTime});this.send({type:Di.JOIN_CHANNEL_TIMEOUT,data:l},!0)}publish(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{eventType:Vn.PUBLISH,lts:l,eventElapse:i.eventElapse,elapse:l-o.startTime,success:i.succ,errorCode:i.ec,videoName:i.videoName,audioName:i.audioName,screenName:i.screenName,screenshare:i.screenshare,audio:i.audio,video:i.video,p2pid:i.p2pid,publishRequestid:i.publishRequestid});this.send({type:Di.PUBLISH,data:u},!0)}subscribe(t,i,o){let a=this.baseInfoMap.get(t);if(!a)return;let l=a.info,u=Date.now(),f=ft(ft({},l),{},{eventType:Vn.SUBSCRIBE,lts:u,eventElapse:i.eventElapse,elapse:u-a.startTime,success:i.succ,errorCode:i.ec,video:i.video,audio:i.audio,subscribeRequestid:i.subscribeRequestid,p2pid:i.p2pid},o&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof i.peerid=="string"?f.peerSuid=i.peerid:f.peer=i.peerid,this.send({type:Di.SUBSCRIBE,data:f},!0)}wsCompressorInit(t){var i;let o=[...ss(i=this.baseInfoMap).call(i)],a=o.length?o[0]:"UnableToGetSid",l=this.baseInfoMap.get(a);if(!l)return;let u=l.info,f=Date.now(),m=ft(ft({},u),{},{eventType:Vn.WS_COMPRESSOR_INIT,lts:f,eventElapse:t.eventElapse,elapse:f-l.startTime,status:t.status?1:2});this.send({type:Di.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(t,i,o,a){let l=this.baseInfoMap.get(t);if(!l)return;let u=l.info,f=Date.now(),m=ft(ft(ft({},u),a),{},{elapse:f-l.startTime,eventType:i,lts:f,firstDecodeFrame:Math.max(f-l.startTime,0),apEnd:Math.max(a.apEnd-l.startTime,0),apStart:Math.max(a.apStart-l.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-l.startTime,0),joinGwStart:Math.max(a.joinGwStart-l.startTime,0),pcEnd:Math.max(a.pcEnd-l.startTime,0),pcStart:Math.max(a.pcStart-l.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-l.startTime,0),subscriberStart:Math.max(a.subscriberStart-l.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-l.startTime,0)});this.send({type:o,data:m},!0)}firstRemoteFrame(t,i,o,a){let l=this.baseInfoMap.get(t);if(!l)return;let u=l.info,f=Date.now(),m=ft(ft(ft({},u),a),{},{elapse:f-l.startTime,eventType:i,lts:f});this.send({type:o,data:m},!0)}pcStats(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft(ft({},a),i),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:l-o.startTime,eventType:Vn.PC_STATS,lts:l});this.send({type:Di.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(t,i){if(t){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft(ft({},a),i),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Vn.UPDATE_REMOTE_RTPCAPABILITIES,lts:l});this.send({type:Di.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(t,i,o,a){let l=this.baseInfoMap.get(t);if(!l)return;let u=l.info,f=Date.now(),m=ft(ft(ft({},u),a),{},{eventType:i,lts:f});this.send({type:o,data:m},!0)}streamSwitch(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{eventType:Vn.STREAM_SWITCH,lts:l,isDual:i.isdual,elapse:l-o.startTime,success:i.succ});this.send({type:Di.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{eventType:Vn.REQUEST_PROXY_APPCENTER,lts:l,eventElapse:l-i.lts,elapse:l-o.startTime,APAddr:i.APAddr,workerManagerList:i.workerManagerList,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Di.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{eventType:Vn.REQUEST_PROXY_WORKER_MANAGER,lts:l,eventElapse:l-i.lts,elapse:l-o.startTime,workerManagerAddr:i.workerManagerAddr,response:i.response,errorCode:i.ec,success:i.succ});this.send({type:Di.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(t){this.proxyServer=t,t?I.debug("reportProxyServerurl: ".concat(t)):I.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft({},a),{},{subscribeElapse:i.subscribeElapse,peer:i.peer,peerPublishDuration:Math.max(i.audioPublishDuration,i.videoPublishDuration),audiotag:i.audioPublishDuration>0?1:-1,videotag:i.videoPublishDuration>0?1:-1,lts:l,elapse:l-o.startTime,joinChannelSuccessElapse:l-(o.lastJoinSuccessTime||l),peerPublishDurationVideo:i.videoPublishDuration,peerPublishDurationAudio:i.audioPublishDuration});this.send({type:Di.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now();(function(u,f,m){let _=u[f];if(!_||typeof _!="string")return[u];u[f]="";let v=Xc(JSON.stringify(u)),S=0,C=[],b=0;for(let V=0;V<_.length;V++)b+=_.charCodeAt(V)<=127?1:3,b<=m-v||(C[C.length]=qe(qe({},u),{},{[f]:_.substring(S,V)}),S=V,b=_.charCodeAt(V)<=127?1:3);return S!==_.length-1&&(C[C.length]=qe(qe({},u),{},{[f]:_.substring(S)})),C})(ft(ft(ft({},a),i),{},{elapse:l-o.startTime,lts:l,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Di.WORKER_EVENT,data:u},!0))}apworkerEvent(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft(ft({},a),i),{},{elapse:l-o.startTime,lts:l});this.send({type:Di.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft(ft({},a),i),{},{elapse:l-o.startTime,lts:l,extend:i.extend||void 0});this.send({type:Di.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(t,i){let o=this.baseInfoMap.get(t);if(!o)return;let a=o.info,l=Date.now(),u=ft(ft(ft({},a),i),{},{elapse:l-o.startTime,lts:l});this.send({type:Di.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(t,i){if(this.customReportCount+=i.length,this.customReportCount>$("CUSTOM_REPORT_LIMIT"))throw new fe(W.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let o=Date.now(),a=i.map(l=>({type:Di.USER_ANALYTICS,data:ft(ft({sid:t},l),{},{lts:o})}));try{$("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(l){throw I.error("send custom report message failed",l.toString()),new fe(W.CUSTOM_REPORT_SEND_FAILED,l.message)}}sendApiInvoke(t){let i=$("NOT_REPORT_EVENT");if(t.tag&&ke(i)&&ke(i).call(i,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;let o=this.baseInfoMap.get(t.sid);if(!o)return this.apiInvokeUploadPendingItems.push(t),!1;let{cname:a,uid:l,cid:u}=o.info,f;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof fe){let{code:_,message:v}=t.error;f=_||v||t.error.toString()}else f=t.error.toString();let m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:u,uid:l,lts:t.lts,success:t.success,elapse:t.lts-o.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?f:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:Di.API_INVOKE,data:m},!1),!0}appendSessionId(){V_.__CLIENT_LIST__.forEach(t=>{if(t._sessionId){let i=this.apiInvokeUploadPendingItems.length;for(let o=0;o<i;o++){let a=this.apiInvokeUploadPendingItems.shift();a&&(a.sid=t._sessionId,this.sendApiInvoke(Object.assign({},a)))}}})}send(t,i){if(i)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,i){let o=[],a=[];for(;t.length;){let u=t.shift();o.length<20?o.push(u):a.push(u)}t.push(...a);for(let u of[...o]){var l;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),v_(l=this.ltsList).call(l,(f,m)=>f-m))}return i||(this.lastSendNormalEventTime=Date.now()),$("ENABLE_EVENT_REPORT")&&o.length&&($("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(o):this.postDataToStatsCollector(o)).catch((u=>f=>{$("EVENT_REPORT_RETRY")&&(i?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>$("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-$("NORMAL_EVENT_QUEUE_CAPACITY")),I.warning("report: drop normal events"))))})(o)),t}async postDataToStatsCollector2(t){ji.networkState===Ur.OFFLINE&&await De.race([ji.onlineWaiter,Nn(2*nn.maxRetryTimeout)]);let i=l=>{let u=new Uint8Array;return l.forEach(f=>{let m=Xb(JSON.stringify(f.data)),_=new ArrayBuffer(5),v=(C=>{let b=0;return Object.entries(Di).forEach(V=>{let[P,k]=V;k===C.type&&(b=EventNameToID[P])}),b})(f),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&v),S.setUint8(3,v>>>8&255),S.setUint8(4,v>>>16&255),u=RM(u,new Uint8Array(_)),u=RM(u,m)}),u},o="event",a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(o):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(o);for(let l=0;l<2;l+=1){l===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(o):"https://".concat($("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(o));try{await iR(a,{timeout:1e4,data:i(t),headers:ft(ft({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(l===1)throw u;continue}return}}async postDataToStatsCollector(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1],o={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(u=>JSON.stringify(u)),vid:(u=>{let f=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return f&&f.info.vid&&+f.info.vid||0})(t[0])};ji.networkState===Ur.OFFLINE&&await De.race([ji.onlineWaiter,Nn(2*nn.maxRetryTimeout)]);let a=i?"/events/proto-raws":"/events/messages",l=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat($("EVENT_REPORT_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(a));for(let u=0;u<2;u+=1){u===1&&(l=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat($("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat($("STATS_COLLECTOR_PORT"),"&d=").concat(a):"https://".concat($("EVENT_REPORT_BACKUP_DOMAIN"),":").concat($("STATS_COLLECTOR_PORT")).concat(a)));try{i?await hZ(l,{timeout:1e4,data:o}):await iR(l,{timeout:1e4,data:o})}catch(f){if(u===1)throw f;continue}return}}createBaseInfo(t,i){let o=Object.assign({},EZ);return o.sid=t,this.baseInfoMap.set(t,{info:o,startTime:i}),o}reportResourceTiming(t,i){let o=performance.getEntriesByName(t),a=o[o.length-1];a&&this.reportApiInvoke(i,{name:"Client.resourceTiming",options:a,tag:Ui.TRACER}).onSuccess()}}function Ze(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,i,o){let a=o.value;if(typeof a=="function"){let l=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);o.value=function(){for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];let _=f;if(e.argsMap)try{_=e.argsMap(this,...f)}catch(S){I.warning(S),_=[]}try{JSON.stringify(_)}catch{I.warning("arguments for method ".concat(l,".").concat(String(i)," not serializable for apiInvoke.")),_=[]}let v=(e.report||Ge).reportApiInvoke(this._sessionId||null,{name:"".concat(l,".").concat(String(i)),options:_,tag:Ui.TRACER,reportResult:e.reportResult},e.throttleTime);try{let S=a.apply(this,f);return S instanceof De?S.then(C=>(v.onSuccess(e.reportResult&&C),C)).catch(C=>{throw v.onError(C),C}):(v.onSuccess(e.reportResult&&S),S)}catch(S){throw v.onError(S),S}}}return o}}qi(V_,"__CLIENT_LIST__",[]);let Ge=new V_;HM.on("REPORT_LOG_UPLOAD",e=>{e.networkState=ji.networkState,Ge.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Ui.TRACER}).onSuccess("logUploadError")});let vZ=["CHINA","GLOBAL"],rr=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let o=i.join(""),a=[];for(let f=0;f<6;f++)a.push("1");let l=a.join(""),u={};return u[e]=o,u[t]=l,Object.assign(u,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=rr,nR||(vn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],vn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],vn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],vn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],vn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],vn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],vn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",vn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",vn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",vn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",vn.AREAS=["NORTH_AMERICA","OVERSEA"]);let qM=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],lu=[];function lp(e,t){return!!t&&lu.some(i=>i.uid===e&&i.channelName===t)}V_.__CLIENT_LIST__=lu;var yZ=S1.forEach,YM=Bl("forEach")?[].forEach:function(e){return yZ(this,e,arguments.length>1?arguments[1]:void 0)};qt({target:"Array",proto:!0,forced:[].forEach!=YM},{forEach:YM});var SZ=Zr("Array").forEach,TZ=Uo,wZ=An,CZ=B,bZ=SZ,aR=Array.prototype,RZ={DOMTokenList:!0,NodeList:!0},IZ=function(e){var t=e.forEach;return e===aR||CZ(aR,e)&&t===aR.forEach||wZ(RZ,TZ(e))?bZ:t},AZ=d(IZ),OZ=mr,$M=Zv;qt({target:"Object",stat:!0,forced:p(function(){$M(1)})},{keys:function(e){return $M(OZ(e))}});var XM=d(Zt.Object.keys),PZ=d(Fc),NZ=qt,xZ=T_,DZ=D([].reverse),JM=[1,2];NZ({target:"Array",proto:!0,forced:String(JM)===String(JM.reverse())},{reverse:function(){return xZ(this)&&(this.length=this.length),DZ(this)}});var kZ=Zr("Array").reverse,LZ=B,MZ=kZ,cR=Array.prototype,UZ=function(e){var t=e.reverse;return e===cR||LZ(cR,e)&&t===cR.reverse?MZ:t},ZM=UZ,jZ=d(ZM),VZ=qt,QM=T_,FZ=dy,BZ=Fi,e2=Lh,WZ=Jr,zZ=qr,HZ=wy,GZ=Ri,KZ=uC,qZ=u1("slice"),YZ=GZ("species"),lR=Array,$Z=Math.max;VZ({target:"Array",proto:!0,forced:!qZ},{slice:function(e,t){var i,o,a,l=zZ(this),u=WZ(l),f=e2(e,u),m=e2(t===void 0?u:t,u);if(QM(l)&&(i=l.constructor,(FZ(i)&&(i===lR||QM(i.prototype))||BZ(i)&&(i=i[YZ])===null)&&(i=void 0),i===lR||i===void 0))return KZ(l,f,m);for(o=new(i===void 0?lR:i)($Z(m-f,0)),a=0;f<m;f++,a++)f in l&&HZ(o,a,l[f]);return o.length=a,o}});var XZ=Zr("Array").slice,JZ=B,ZZ=XZ,dR=Array.prototype,QZ=function(e){var t=e.slice;return e===dR||JZ(dR,e)&&t===dR.slice?ZZ:t},eQ=d(QZ);function Ne(e,t,i,o,a){var l,u,f,m={};return AZ(l=XM(o)).call(l,function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=PZ(u=jZ(f=eQ(i).call(i)).call(f)).call(u,function(_,v){return v(e,t,_)||_},m),a&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(a):void 0,m.initializer=void 0),m.initializer===void 0&&(a1(e,t,m),m=null),m}var tQ=Zr("Array").values,iQ=Uo,nQ=An,rQ=B,oQ=tQ,uR=Array.prototype,sQ={DOMTokenList:!0,NodeList:!0},aQ=function(e){var t=e.values;return e===uR||rQ(uR,e)&&t===uR.values||nQ(sQ,iQ(e))?oQ:t},sc=d(aQ);let cQ=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),cs=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),o0=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),hR=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),ua=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),jr=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Xe=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),wt=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Fe=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e}({}),Ye=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),dp=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),at=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Vr=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),rt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});class se extends fe{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),U(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,I)}throw(){super.throw(I)}}function s0(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw I.error("Invalid Channel Name ".concat(e)),new se(W.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function a0(e){if(!function(t){return typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295}(e)&&!TM(e,1,255))throw new se(W.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&I.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Fn=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming",e}({}),dm=function(e){return e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",e}({}),lQ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},pR={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function fR(e,t){Gn(e.url,"".concat(t,".url"),1,1e3,!1),Mi(e.x)||si(e.x,"".concat(t,".x"),0,1e4),Mi(e.y)||si(e.y,"".concat(t,".y"),0,1e4),Mi(e.width)||si(e.width,"".concat(t,".width"),0,1e4),Mi(e.height)||si(e.height,"".concat(t,".height"),0,1e4),Mi(e.zOrder)||si(e.zOrder,"".concat(t,".zOrder"),0,255),Mi(e.alpha)||si(e.alpha,"".concat(t,".alpha"),0,1,!1)}let dQ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},uQ={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30},Jc=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),c0=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),yn=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function t2(e){if(!e.channelName)throw new se(W.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new se(W.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Gn(e.token,"info.token",1,2047),a0(e.uid),s0(e.channelName),!0}let Fr=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),ql=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),go=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),um=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Xt=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Yi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal",e}({}),F_=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),xn=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),i2=function(e){return e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel",e}({}),Ft=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),n2=[Ft.AFRICA,Ft.ASIA,Ft.CHINA,Ft.EUROPE,Ft.GLOBAL,Ft.INDIA,Ft.JAPAN,Ft.NORTH_AMERICA,Ft.OCEANIA,Ft.OVERSEA,Ft.SOUTH_AMERICA],hr=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),l0={CHINA:{},ASIA:{CODE:hr.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:hr.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:hr.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:hr.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:hr.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:hr.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:hr.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:hr.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:hr.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:hr.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:hr.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:hr.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:hr.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};nR&&(l0.CHINA={CODE:hr.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let mR=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class r2 extends Ii{constructor(t,i){super(),U(this,"onICEConnectionStateChange",void 0),U(this,"onConnectionStateChange",void 0),U(this,"onDTLSTransportStateChange",void 0),U(this,"onDTLSTransportError",void 0),U(this,"onICETransportStateChange",void 0),U(this,"onFirstAudioReceived",void 0),U(this,"onFirstVideoReceived",void 0),U(this,"onFirstAudioDecoded",void 0),U(this,"onFirstVideoDecoded",void 0),U(this,"onFirstVideoDecodedTimeout",void 0),U(this,"onSelectedLocalCandidateChanged",void 0),U(this,"onSelectedRemoteCandidateChanged",void 0),U(this,"getLocalVideoStats",void 0)}}class d0 extends r2{constructor(t,i){super(t,i),U(this,"establishPromise",void 0)}}let He=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Ir=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),Yl=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),Te=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),ei=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),et=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),ha=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),pa=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Bn=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),du=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),un=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e}({}),Zc=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),xs=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ac=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),hm=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),$i=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),pm=function(e){return e.ABORT="abort",e}({}),uu=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),hQ=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),pQ={[o0.ACCESS_POINT]:{[jr.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[jr.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[jr.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[jr.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[jr.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[jr.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[jr.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[o0.UNILBS]:{[ua.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ua.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ua.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ua.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ua.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ua.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ua.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ua.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ua.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ua.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ua.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ua.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[o0.STRING_UID_ALLOCATOR]:{[hR.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[hR.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[hR.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function fm(e){let t=pQ[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let i=t[e%1e4];if(!i){if(Math.floor(e/1e4)===o0.ACCESS_POINT){let o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}let fQ={[Xe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Xe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Xe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Xe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Xe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Xe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Xe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Xe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Xe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Xe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Xe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Xe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Xe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Xe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Xe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Xe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Xe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Xe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Xe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Xe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Xe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Xe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Xe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Xe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Xe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Xe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Xe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Xe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Xe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Xe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Xe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Xe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Xe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Xe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Xe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Xe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Xe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Xe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Xe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Xe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Xe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Xe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Xe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Xe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Xe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Xe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Xe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Xe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Xe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Xe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Xe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Xe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Xe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Xe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Xe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Xe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Xe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Xe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Xe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Xe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Xe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Xe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function up(e){return fQ[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function o2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function gR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?o2(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o2(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function s2(e){return e.every(t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)}function a2(e,t){if(typeof e=="string")return e;let{proxy:i,host:o,port:a}=e;if(t){let l=$("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(o,"/ws/?p=").concat(Number(a)+150):"wss://".concat(o,":").concat(l,"/ws/?p=").concat(Number(a)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(a):"wss://".concat(o,":").concat(a)}let mQ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,gQ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,_Q=/wss:\/\/(.+):([0-9]+)\/?/,EQ=/wss:\/\/(.[^\/]+)\/?/,vQ=0;class yQ{constructor(t,i){U(this,"id",0),U(this,"store",void 0),U(this,"recordIndex",void 0),U(this,"websockets",[]),U(this,"try443PortDuration",2e3),U(this,"forceCloseWSDuration",5e3),U(this,"try443PortTimeout",null),U(this,"forceCloseTimeout",null),U(this,"isTry443PortFailed",!1),U(this,"isNormalPortFailed",!1),U(this,"useDoubleDomain",!1),U(this,"useProxy",!1),U(this,"startTime",Date.now()),this.id=++vQ,this.try443PortDuration=$("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;let i=Date.now()-this.startTime;for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];I.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...a)}createWebSocket(t,i,o){this.logger("createWebSocket:",t,{isTry443Port:i,hasTimeoutDetection:o});let a=$("GATEWAY_DOMAINS"),l=Date.now(),u=[],f=a.find(v=>{var S;return ke(S=t.host).call(S,v)});f||(this.useDoubleDomain=!1);let m=[];if(this.useDoubleDomain)a.forEach(v=>{m.push(a2(gR(gR({},t),{},{host:t.host.replace(f,v)}),i))});else{let v=gR({},t);if(i&&f){let S=a.find(C=>C!==f);S&&(v.host=v.host.replace(f,S))}m.push(a2(v,i))}try{m.forEach(v=>{let S=new WebSocket(v);S.binaryType="arraybuffer",u.push(S),this.logger("ws is connecting:",S.url)})}catch(v){if(this.logger("ws create failed"),u.forEach(S=>S.close()),u.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,i,o);if(!i&&Number(t.port)!==443)return this.createWebSocket(t,!0,o);throw new se(W.WS_ERR,"init websocket failed! Error: ".concat(v.toString()))}let _=D_();return this.store&&this.store.recordJoinChannelService({urls:u.map(v=>v.url),service:"gateway"},this.recordIndex),u.forEach(v=>{v.onopen=()=>{this.logger("onopen: ws ".concat(v.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(S=>{S!==v&&(S.onopen=null,S.onclose=null,S.onmessage=null,S.close(),this.logger("close backup websocket: ".concat(S.url)))}),this.websockets.length=0,_.resolve(v)},v.onclose=S=>{this.logger("onclose: ws ".concat(v.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(v.readyState)),i?this.isTry443PortFailed=s2(u):this.isNormalPortFailed=s2(u),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(i&&this.isTry443PortFailed||!i&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(S.reason)),_.reject({code:S.code,reason:F_.A_ROUND_WS_FAILED}))},v.onmessage=S=>this.logger("".concat(v.url," onmessage: ").concat(S.data))}),this.websockets.push(...u),o||(()=>{let v=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_.isResolved),this.websockets.forEach(S=>S.readyState!==WebSocket.OPEN&&S.close())};if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_.isResolved),_.isResolved)return v();Ut().os===On.MAC_OS&&ci()&&v(),this.createWebSocket(t,!0,!0).then(S=>_.resolve(S)).catch(S=>{this.isNormalPortFailed&&_.reject(S),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(v,this.forceCloseWSDuration)},this.try443PortDuration)})(),_.promise}chooseBestWebsocket(t,i,o,a){return this.useDoubleDomain=!!i,typeof t=="string"&&(t=function(l){let u,f,m;return[,u,f,m]=l.match(mQ)||[],u||([,f,m]=l.match(gQ)||[]),f&&m||([,f,m]=l.match(_Q)||[]),f&&m||([,f]=l.match(EQ)||[]),f||I.warning("un-destructible url: ",l),{proxy:u,host:f,port:m||"443"}}(t)),this.recordIndex=a,this.useProxy=!!t.proxy,o&&this.useProxy&&(I.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(t,!!o,!1).finally(()=>this.clearTimeout())}}function c2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}class l2 extends Ii{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;ke(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(rt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(rt.CONNECTED):this._state==="closed"?this.emit(rt.CLOSED):this._state==="failed"&&this.emit(rt.FAILED))}resetReconnectCount(t){I.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],u=arguments.length>5?arguments[5]:void 0;super(),U(this,"connectionID",0),U(this,"currentURLIndex",0),U(this,"urls",[]),U(this,"_reconnectMode","tryNext"),U(this,"reconnectReason",void 0),U(this,"_initMutex",new jn("websocket")),U(this,"name",void 0),U(this,"_state","closed"),U(this,"reconnectInterrupter",void 0),U(this,"websocket",void 0),U(this,"retryConfig",void 0),U(this,"reconnectCount",0),U(this,"forceCloseTimeout",5e3),U(this,"onlineReconnectListener",void 0),U(this,"useCompress",void 0),U(this,"tryDoubleDomain",!1),U(this,"use443PortOnly",!1),U(this,"wsInflateLength",0),U(this,"wsDeflateLength",0),U(this,"closeEstablishingWs",()=>{}),U(this,"store",void 0),U(this,"joinGatewayRecordIndex",void 0),this.store=u,this.name=t,this.retryConfig=function(S){for(var C=1;C<arguments.length;C++){var b=arguments[C]!=null?arguments[C]:{};C%2?c2(Object(b),!0).forEach(function(V){U(S,V,b[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(S,Object.getOwnPropertyDescriptors(b)):c2(Object(b)).forEach(function(V){Object.defineProperty(S,V,Object.getOwnPropertyDescriptor(b,V))})}return S}({},i),this.useCompress=o,this.tryDoubleDomain=a,this.use443PortOnly=l;let{timeout:f,timeoutFactor:m}=i,_=Math.max(300,Math.floor(3*f/5)),v=Math.max(1.2,Math.floor(8*m)/10);Ur.ONLINE&&(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v),ji.on(rp.NETWORK_STATE_CHANGE,(S,C)=>{S!==C&&(this.resetReconnectCount("network state change: ".concat(C," -> ").concat(S)),S===Ur.ONLINE?(this.retryConfig.timeout=_,this.retryConfig.timeoutFactor=v):(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=m))})}getConnection(){return this.websocket||void 0}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,o=await this._initMutex.lock();this.forceCloseTimeout=i,this.urls=t,this.state="connecting";try{let a=D_(),l=this.urls[this.currentURLIndex];this.createWebSocketConnection(l).then(a.resolve).catch(a.reject),this.once(rt.CLOSED,()=>{a.reject(new fe(W.WS_DISCONNECT))}),this.once(rt.CONNECTED,a.resolve),await a.promise}catch{}finally{o()}}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,i){if(!this.websocket)return void I.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),I.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);let o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new fe(W.WS_ABORT,"websocket is not ready");try{i||(t=JSON.stringify(t)),this.websocket.send(t)}catch(o){throw new fe(W.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var i;let o=D_();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let a=v=>{var S;(S=this.store)===null||S===void 0||S.signalChannelOpen(),I.debug("[".concat(this.name,"] websocket opened:"),v),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},l=async v=>{var S;if(I.debug("[".concat(this.name,"] websocket close ").concat((S=this.websocket)===null||S===void 0?void 0:S.url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new fe(W.WS_DISCONNECT,"websocket close: ".concat(v.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let C=Vo(this,rt.WILL_RECONNECT,this.reconnectMode,v.reason)||this.reconnectMode,b=await this.reconnectWithAction(C);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!b)return o.reject(new fe(W.WS_DISCONNECT,"websocket reconnect failed: ".concat(v.code))),this.close(!0);o.resolve()}},u=v=>{this.emit(rt.ON_MESSAGE,v)},f=v=>{I.warn("[".concat(this.connectionID,"] ws open error ").concat(v))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),$("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=$("GATEWAY_WSS_ADDRESS")),I.debug("[".concat(this.name,"] start connect, url:"),t);let m=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var _;let v=await this.chooseBestWebsocketConnection(t);this.websocket=v,a&&a(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=u,this.websocket.onerror=f,(_=this.store)===null||_===void 0||_.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinGatewayRecordIndex=m}catch(v){let S=this.state==="closed",C=v instanceof fe,b=C&&v.code===W.WS_ABORT,V=C&&v.code===W.WS_ERR,P=C?v.message:v&&(v.reason||v.toString());I.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(P)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:b?"aborted":"error",errors:[v]},m),S||V?(o.reject(S?new fe(W.WS_DISCONNECT,"websocket is closed: ".concat(P)):new fe(W.WS_ERR,"init websocket failed: ".concat(P))),V&&I.error("[".concat(this.name,"] init websocket failed: ").concat(P))):l&&l(v)}return o.promise}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;I.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||ji.isOnline||!ji.onlineWaiter||(this.onlineReconnectListener=ji.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){let u=t0(this.reconnectCount,this.retryConfig);I.debug("[".concat(this.name,"] wait ").concat(u,"ms to reconnect websocket, mode: ").concat(t)),await De.race([Nn(u),this.onlineReconnectListener||new De(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;let a=async(u,f)=>{this.emit(rt.RECONNECT_CREATE_CONNECTION,f),await this.createWebSocketConnection(u)};try{if(t==="retry")this.emit(rt.RECONNECT_WAITTING_FINISH,t),await a(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);I.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(rt.RECONNECT_WAITTING_FINISH,t),await a(this.urls[this.currentURLIndex],t)}else t==="recover"&&(I.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(rt.RECONNECT_WAITTING_FINISH,t),this.urls=await dn(this,rt.REQUEST_NEW_URLS),this.currentURLIndex=0,await a(this.urls[this.currentURLIndex],t))}catch(u){var l;I.error("[".concat(this.name,"] reconnect failed ").concat(u&&u.toString()));let f=u==null||(l=u.data)===null||l===void 0?void 0:l.desc;return Array.isArray(f)&&ke(f).call(f,"dynamic key expired")?(this.emit(rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,i)}return!0}}class B_ extends l2{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){let o=D_(),a=function(u,f){return new yQ(u,f)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),a.closeAllWebsockets(),o.reject(new fe(W.WS_ABORT,"choose best websocket aborted"))};let l=$("GATEWAY_DOMAINS");return I.debug("[choose-best-ws] currentDomain: ",t,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),a.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class W_ extends l2{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,i){return new De((o,a)=>{let l=!1,u=[];this.closeEstablishingWs=()=>{I.debug("[choose-best-ws] close establishing websockets"),u.forEach(V=>{V.onclose=null,V.onopen=null,V.onmessage=null,V.close()}),a(new fe(W.WS_ABORT,"choose best websocket aborted"))};let f=$("GATEWAY_DOMAINS"),m,_=t.indexOf("?h="),v=f.find(V=>_!==-1?ke(t).call(t,V,_):ke(t).call(t,V));I.debug("[choose-best-ws] currentDomain: ",v,", domains: ",f);let S=!this.tryDoubleDomain||!v;if(!S&&v){var C;let V=Date.now();try{f.forEach(P=>{let k=_===-1?t.replace(v,P):t.substr(0,_)+t.substr(_).replace(v,P),F=new WebSocket(k);F.binaryType="arraybuffer",u.push(F),I.debug("[choose-best-ws] ws is connecting:",F.url)})}catch{for(I.debug("[choose-best-ws] ws create failed, fallback to single url"),u.forEach(P=>P.close());u.length;)u.pop();S=!0}(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:u.map(P=>P.url),service:"gateway"},i),u.forEach(P=>{P.onopen=()=>{if(l)return;let k=Date.now()-V;I.debug("[choose-best-ws] ws open cost ".concat(k,"ms")),u.filter(F=>F!==P).forEach(F=>{I.debug("[choose-best-ws]close backup websocket: ".concat(F.url)),F.close()}),l=!0,o(P)},P.onclose=k=>{m=k,!l&&(u.find(F=>!(F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING))||(I.debug("[choose-best-ws] all websocket is closed"),l=!0,a(m)))},P.onmessage=k=>{I.debug("[choose-best-ws]".concat(P.url," onmessage: ").concat(k.data))}}),Nn(this.forceCloseTimeout).then(()=>{u.forEach(P=>{P.readyState!==WebSocket.OPEN&&P.close()})})}if(S){var b;let V;I.debug("[choose-best-ws] use single url: ",t),(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:[t],service:"gateway"},i);try{V=new WebSocket(t),u.push(V),V.binaryType="arraybuffer"}catch(P){let k=new fe(W.WS_ERR,"init websocket failed! Error: ".concat(P.toString()));return I.error("[".concat(this.name,"]").concat(k)),void a(k)}V.onopen=()=>{o(V)},V.onclose=P=>{a(P)},V.onmessage=P=>{I.debug("[choose-best-ws]".concat(V.url," onmessage: ").concat(P.data))},Nn(this.forceCloseTimeout).then(()=>{V&&V.readyState!==WebSocket.OPEN&&V.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class d2 extends Ii{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===wt.CONNECTED?this.emit(Fe.WS_CONNECTED):t===wt.RECONNECTING?this.emit(Fe.WS_RECONNECTING,this._websocketReconnectReason):t===wt.CLOSED&&this.emit(Fe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",wt.CLOSED),U(this,"reconnectToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new eR(5)),U(this,"pingpongTimer",void 0),U(this,"wsInflateDataTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Fe.ON_BINARY_DATA,o.data);let a=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){let l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){if(this.emit(a._type,a._message),a._type===at.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===at.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(a._type===at.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case Xe.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case Xe.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case Xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case Xe.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case Xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Xe.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new B_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===wt.CONNECTED&&this.reconnect("retry",nr.OFFLINE)})}async request(t,i,o,a){let l=di(6,""),u={_id:l,_type:t,_message:i},f=this.websocket.connectionID,m=()=>new De((V,P)=>{if(this.connectionState===wt.CONNECTED)return V();let k=()=>{this.off(Fe.WS_CLOSED,F),V()},F=()=>{this.off(Fe.WS_CONNECTED,k),P(new se(W.WS_ABORT))};this.once(Fe.WS_CONNECTED,k),this.once(Fe.WS_CLOSED,F),t!==Ye.PUBLISH&&t!==Ye.PUBLISH_DATASTREAM&&t!==Ye.SUBSCRIBE&&t!==Ye.SUBSCRIBE_DATASTREAM&&t!==Ye.UNSUBSCRIBE&&t!==Ye.UNSUBSCRIBE_DATASTREAM&&t!==Ye.UNPUBLISH&&t!==Ye.UNPUBLISH_DATASTREAM&&t!==Ye.CONTROL&&t!==Ye.RESTART_ICE||this.once(Fe.DISCONNECT_P2P,()=>{P(new se(W.DISCONNECT_P2P))}),t!==Ye.PUBLISH&&t!==Ye.RESTART_ICE||this.once(Fe.ABORT_P2P_EXECUTION,()=>{P(new se(W.DISCONNECT_P2P))})});if(this.connectionState!==wt.CONNECTING&&this.connectionState!==wt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),this.websocket.sendMessage(u,!0),a)return;let _=new De((V,P)=>{let k=!1,F=(ie,oe)=>{k=!0,V({isSuccess:ie==="success",message:oe||{}}),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.emit(Fe.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(l),F);let H=()=>{P(new se(W.WS_ABORT,"type: ".concat(t))),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.off("res-@".concat(l),F)};this.once(Fe.WS_CLOSED,H),this.once(Fe.WS_RECONNECTING,H),Nn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||k||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Fe.REQUEST_TIMEOUT,t,i))})}),v=null;try{v=await _}catch(V){if(this.connectionState===wt.CLOSED||t===Ye.LEAVE)throw new se(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,i))}if(v.isSuccess)return v.message;let S=Number(v.message.error_code||v.message.code),C=up(S),b=new se(W.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:S,data:v.message});return C.action==="success"?v.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(S,", message: ").concat(C.desc,", action: ").concat(C.action)),S===Xe.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=b,this.close()),b.throw()):C.action==="failed"?b.throw():C.action==="quit"?(this.initError=b,this.close(),b.throw()):(S===Xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nr.MULTI_IP)):this.reconnect(C.action,nr.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new De(o=>{let a=l=>{(!i||i(l))&&(this.off(t,a),o(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(dp.WRTC_STATS,i)}upload(t,i){let o={_type:t,_message:i};try{this.websocket.sendMessage(o)}catch{let a=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==wt.CONNECTED)return;let l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let o={_type:t,_message:i};this.websocket.sendMessage(o)}init(t,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((o,a)=>{this.once(Fe.WS_CONNECTED,()=>o(this.joinResponse)),this.once(Fe.WS_CLOSED,()=>a(this.initError||new se(W.WS_ABORT))),this.connectionState=wt.CONNECTING,this.websocket.init(t).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ct.LEAVE,this.connectionState=wt.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===Ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new B_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Fe.ABORT_P2P_EXECUTION);let t=await dn(this,Fe.REQUEST_JOIN_INFO),i=await this.request(Ye.JOIN,t);if(!i)return this.emit(Fe.REPORT_JOIN_GATEWAY,F_.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Fe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new se(W.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=op(this,Fe.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let i=await this.request(Ye.REJOIN,t);return!!i&&(this.connectionState=wt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(at.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(at.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(at.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(at.MUTE_AUDIO,{uid:o.uid}):this.emit(at.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(at.MUTE_VIDEO,{uid:o.uid}):this.emit(at.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(at.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(at.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(at.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(at.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(at.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);let i=up(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(i.action,nr.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nr.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-i;this.rttRolling.add(o),$("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:i}=this.websocket.getWsInflateData();t!==0&&i!==0&&this.upload(dp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(rt.RECONNECT_WAITTING_FINISH,t=>{this.emit(Fe.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(rt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Fe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(rt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(rt.CLOSED,()=>{this.connectionState=wt.CLOSED}),this.websocket.on(rt.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=wt.CLOSED}),this.websocket.on(rt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===wt.CONNECTED?this.connectionState=wt.RECONNECTING:this.connectionState=wt.CONNECTING}),this.websocket.on(rt.WILL_RECONNECT,(t,i,o)=>{let a=op(this,Fe.IS_P2P_DISCONNECTED),l=a||t!=="retry";a&&t==="retry"&&(I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",i=F_.P2P_DISCONNECTED),l&&(I.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Fe.REPORT_JOIN_GATEWAY,i||F_.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Fe.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":t),this.emit(Fe.DISCONNECT_P2P)),o(t)}),this.websocket.on(rt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",nr.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Fe.REPORT_JOIN_GATEWAY,t.message||t.code||F_.UNKNOWN_REASON,this.url||""),t instanceof se){if(t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Xe.ERR_NO_AUTHORIZED)return this.initError=new se(W.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nr.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nr.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(rt.REQUEST_NEW_URLS,(t,i)=>{dn(this,Fe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(at.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let rn=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function u2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function u0(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?u2(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u2(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function hu(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat($("TURN_DOMAIN")):(I.info("Unidentified as ip: ".concat(e,", use as host")),e)}function _R(e,t){e.addresses||(e.addresses=[]);let i=function(l,u){if($("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return l.map(_=>{let{ip:v,port:S}=_;return{address:"".concat(v,":").concat(S)}});let f=$("GATEWAY_DOMAINS"),m=f[1]&&ke(u).call(u,f[1])?1:0;return l.map(_=>{let{domain_prefix:v,port:S,ip:C}=_;if(v)return{address:"".concat(v,".").concat(f[m++%f.length],":").concat(S)};let b=/^[\.\:\d]+$/.test(C),V=b?"".concat(C.replace(/[^\d]/g,"-"),".").concat(f[m++%f.length],":").concat(S):"".concat(C,":").concat(S);return b||I.info("Unidentified as ip: ".concat(C,", use as host")),{ip:C,port:S,address:V}})}(e.addresses,t),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){let l=o.split(";");for(let u=0;u<l.length;u++){var a;let f=Rr(a=l[u]).call(a);i[u]&&f&&(i[u].ip6=f)}}return{gatewayAddrs:i,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function _o(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function h2(e){let t=e._encoderConfig;if(!t)return{};let i={resolution:t.width&&t.height?"".concat(_o(t.width),"x").concat(_o(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(i.maxFrameRate=t.frameRate,i.minFrameRate=t.frameRate):t.frameRate&&(i.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,i.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),i}function p2(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function z_(e,t){let i,o,a;switch(t){case rn.CHOOSE_SERVER:o=4096,a="choose server";break;case rn.CLOUD_PROXY:o=1048576,a="proxy";break;case rn.CLOUD_PROXY_5:o=4194304,a="proxy5";break;case rn.CLOUD_PROXY_FALLBACK:o=4194310,a="proxy fallback";break;default:throw new se(W.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===o&&(i={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(u=>u0(u0({},u),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:u0(u0({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!i)throw new se(W.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(a," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function f2(e,t){return await De.all(e.addresses.map(async i=>({address:hu(i.ip),tcpport:i.port,udpport:i.port,username:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():rr.username,password:t&&$("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Jb(t.toString()):rr.password})))}function ER(e,t){let i=t.getMediaStreamTrack(!0).getSettings(),o=t.videoHeight||i.height,a=t.videoWidth||i.width;return o&&a?Math.max(Math.min(o,a)/Math.min(_o(e.height),_o(e.width)),1):(I.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function pu(e){let{candidateType:t,relayProtocol:i,type:o,address:a,port:l,protocol:u}=e;return o==="local-candidate"?{candidateType:t,relayProtocol:i,protocol:u}:{candidateType:t,relayProtocol:i,address:a,port:l,protocol:u}}function m2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}class SQ extends Ii{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var i;ke(i=["tryNext","recover"]).call(i,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(un.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(un.CONNECTED):this._state==="closed"?this.emit(un.CLOSED):this._state==="failed"&&this.emit(un.FAILED))}constructor(t,i,o,a){super(),U(this,"connectionID",0),U(this,"currentURLIndex",0),U(this,"reconnectReason",void 0),U(this,"_reconnectMode","tryNext"),U(this,"_initMutex",void 0),U(this,"_name",void 0),U(this,"_state","closed"),U(this,"_reconnectInterrupter",void 0),U(this,"_url",void 0),U(this,"_retryConfig",void 0),U(this,"_reconnectCount",0),U(this,"_forceCloseTimeout",5e3),U(this,"_onlineReconnectListener",void 0),U(this,"_closeEstablishingTransmitter",()=>{}),U(this,"_store",void 0),U(this,"_joinChannelServiceRecordIndex",void 0),U(this,"_transmitter",void 0),U(this,"_useCompress",void 0),U(this,"_inflateLength",0),U(this,"_deflateLength",0),this._store=a,this._name=t,this._retryConfig=function(l){for(var u=1;u<arguments.length;u++){var f=arguments[u]!=null?arguments[u]:{};u%2?m2(Object(f),!0).forEach(function(m){U(l,m,f[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(f)):m2(Object(f)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(f,m))})}return l}({},i),this._useCompress=o}resetReconnectCount(t){I.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;let o=this._transmitter;i?setTimeout(()=>o.close(),500):o.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,i){if(!this._transmitter)return void I.warning("[".concat(this._name,"] can not reconnect, no websocket"));var o;t!==void 0&&(this.reconnectMode=t),I.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((o=this._store)===null||o===void 0||o.recordJoinChannelService({status:"error",errors:[new Error(i)]},this._joinChannelServiceRecordIndex));let a=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),a&&a.bind(this._transmitter)({code:9999,reason:i})}getInflateData(){let t=this._inflateLength,i=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:i}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let cc=function(e){return e[e.Default=0]="Default",e[e.Ack=1]="Ack",e}({});class TQ{constructor(t,i,o){U(this,"version",1),U(this,"initialRTO",void 0),U(this,"maxBatchAckCount",void 0),U(this,"maxRTO",void 0),U(this,"initialRTT",void 0),U(this,"ID",void 0),U(this,"rtt",void 0),U(this,"packetNumber",1),U(this,"rtoRatioMap",new Map),U(this,"timeoutMap",new Map),U(this,"unorderedPacketQueue",[]),U(this,"batchAckPacketQueue",[]),U(this,"lastOrderedPacketNumber",0),U(this,"batchAckTimer",void 0),U(this,"sendImpl",void 0),U(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=i,this.ID=di(7,"transmitter-"),this.initialRTO=(o==null?void 0:o.initialRTO)!==void 0?o.initialRTO:$("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(o==null?void 0:o.initialRTT)!==void 0?o.initialRTT:$("TRANSMITTER_INITIAL_RTT"),this.rtt=(o==null?void 0:o.initialRTT)!==void 0?o.initialRTT:$("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(o==null?void 0:o.maxBatchAckCount)!==void 0?o.maxBatchAckCount:$("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(o==null?void 0:o.maxRTO)!==void 0?o.maxRTO:$("TRANSMITTER_MAX_RTO")}packetize(t,i){return{type:cc.Default,version:this.version,packetNumber:i,payload:t}}serialize(t){switch(t.type){case cc.Default:{let i;typeof t.payload=="string"?i=new TextEncoder().encode(t.payload):i=t.payload;let o=new ArrayBuffer(i.length+15),a=new DataView(o);return a.setUint16(0,t.version),a.setUint8(2,t.type),a.setUint32(3,t.packetNumber),CM(a,7,BigInt(t.sendTs)),new Uint8Array(a.buffer).set(i,15),o}case cc.Ack:{let i=new ArrayBuffer(16),o=new DataView(i);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.maxAckPacketNumber),o.setUint8(7,t.shift),CM(o,8,BigInt(t.ackSendTs)),i}}}deserialize(t){let i=new DataView(t),o=i.getUint16(0),a=i.getUint8(2);switch(a){case cc.Default:{let l=i.getUint32(3),u=wM(i,7),f=t.slice(15),m=new TextDecoder().decode(f);return{version:o,type:a,packetNumber:l,sendTs:Number(u),payload:m}}case cc.Ack:{let l=i.getUint32(3),u=i.getUint8(7),f=wM(i,8);return{version:o,type:a,maxAckPacketNumber:l,shift:u,ackSendTs:Number(f)}}default:throw I.error("[".concat(this.ID,"] Unrecognized packet type ").concat(a)),new Error("Unrecognized packet type ".concat(a))}}sendMessage(t){let i=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;let o=this.calculateRTO(i),a=window.setTimeout(()=>{this.resendMessage(i)},o);this.timeoutMap.set(i.packetNumber,a),this.sendPacket(i)}onData(t){let i=this.deserialize(t);i.type===cc.Default?this.ack(i):i.type===cc.Ack&&(this.updateRTT(i,Math.round(performance.now())),this.clearRTO(i))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[i,o]=t;window.clearTimeout(o)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){let i=this.calculateRTO(t),o=window.setTimeout(()=>{this.resendMessage(t)},i);this.timeoutMap.set(t.packetNumber,o),this.sendPacket(t)}calculateRTO(t){let i=this.rtoRatioMap.get(t.packetNumber);if(i===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{let o=9*this.rtt/8*i;return this.rtoRatioMap.set(t.packetNumber,i+1),o>this.maxRTO?this.maxRTO:o}}updateRTT(t,i){let o=t.ackSendTs;this.rtt=this.rtt*(7/8)+(i-o-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){let i=this.unorderedPacketQueue[0];if(!i){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(i.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){let i={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:cc.Ack,version:this.version};this.sendPacket(i)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;let i={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:cc.Ack,version:this.version};this.sendPacket(i)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;let t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:cc.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===cc.Default&&(t.sendTs=Math.round(performance.now()));let i=this.serialize(t);this.sendImpl(i)}clearRTO(t){for(let i=t.maxAckPacketNumber-t.shift;i<=t.maxAckPacketNumber;i++){let o=this.timeoutMap.get(i);o!==void 0&&window.clearTimeout(o),this.timeoutMap.delete(i),this.rtoRatioMap.delete(i)}}}class g2 extends SQ{constructor(t,i){super(t,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),U(this,"_initMutex",void 0),U(this,"_reconnectInterrupter",void 0),U(this,"_url",void 0),U(this,"_transmitter",void 0),U(this,"_addresses",void 0),U(this,"_reliableTransmission",void 0),this._initMutex=new jn("datachannel");let{timeout:o,timeoutFactor:a}=i,l=Math.max(300,Math.floor(3*o/5)),u=Math.max(1.2,Math.floor(8*a)/10);Ur.ONLINE&&(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=u),ji.on(rp.NETWORK_STATE_CHANGE,(f,m)=>{f!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(f)),f===Ur.ONLINE?(this._retryConfig.timeout=l,this._retryConfig.timeoutFactor=u):(this._retryConfig.timeout=o,this._retryConfig.timeoutFactor=a))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=i;let o=(a,l)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(f=>f.fingerprint||$("FINGERPRINT"));let u=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(u).then(a).catch(l),this.once(un.CLOSED,()=>l(new se(W.WS_DISCONNECT))),this.once(un.CONNECTED,()=>a())};return this._initMutex.lock().then(a=>new De((l,u)=>{o(l,u)}).then(()=>{a()}).catch(()=>{a()}))}sendMessage(t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new se(W.WS_ABORT,"datachannel is not ready");try{i||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(o){throw new se(W.WS_ERR,"send datachannel signal message error"+o.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){let i=JSON.stringify(t);return{compressed:i,compressedLength:i.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new De((i,o)=>{var a;let l=()=>{I.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i()},u=async v=>{var S;if((S=this._closeEstablishingTransmitter)===null||S===void 0||S.call(this),I.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(v.code,", reason: ").concat(v.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=v.reason,this.state="reconnecting");let C=Vo(this,un.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,b=await this.reconnectWithAction(C);if(this.state==="closed")return void I.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!b)return o(new se(W.WS_DISCONNECT,"datachannel reconnect failed: ".concat(v.code))),void this.close(!0);i()}else o(new se(W.WS_DISCONNECT,"datachannel close: ".concat(v.code))),this.close()},f=v=>{var S;(S=this._reliableTransmission)===null||S===void 0||S.onData(v.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),I.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));let m=(a=this._store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),_=Date.now();dn(this,un.TO_CONNECT_DATACHANNEL,t).then(v=>{var S,C;if(!v)throw new Error("transmissonInfo not exist yet");let{transmitter:b,close:V}=v;this._transmitter=b,(S=this._store)===null||S===void 0||S.signalChannelOpen();let P=Date.now()-_;I.debug("[choose dc] dc open cost ".concat(P,"ms")),this._reliableTransmission=new TQ(k=>{var F;this._transmitter&&this._transmitter.readyState==="open"&&((F=this._transmitter)===null||F===void 0||F.send(k))},k=>{typeof k=="string"&&this.emit(un.ON_MESSAGE,k)}),this._closeEstablishingTransmitter=()=>{var k;(k=this._reliableTransmission)===null||k===void 0||k.close(),this._reliableTransmission=void 0,V()},l&&l(),b.onclose=u,b.onmessage=f,(C=this._store)===null||C===void 0||C.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this._joinChannelServiceRecordIndex=m}).catch(v=>{var S;if((S=this._store)===null||S===void 0||S.recordJoinChannelService({endTs:Date.now(),status:v instanceof se&&v.code===W.WS_ABORT?"aborted":"error",errors:[v]},m),this.state!=="closed"){if(v instanceof se&&v.code===W.WS_ERR){let C=new se(W.WS_ERR,"init datachannel failed! Error: ".concat(v.toString()));return I.error("[".concat(this._name,"]").concat(C)),void o(C)}u&&u(v)}else o(new se(W.WS_DISCONNECT,"datachannel is closed: ".concat(v.toString())))})})}async reconnectWithAction(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||ji.networkState!==Ur.OFFLINE||(this._onlineReconnectListener=ji.onlineWaiter&&ji.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let o=!0;if(this._reconnectInterrupter=()=>{o=!1},i){let f=t0(this._reconnectCount,this._retryConfig);I.debug("[".concat(this._name,"] wait ").concat(f,"ms to reconnect datachannel, mode: ").concat(t)),await De.race([Nn(f),this._onlineReconnectListener||new De(()=>{})])}if(this.state==="closed"||!o)return!1;this._reconnectCount+=1;let a=async(f,m)=>{this.emit(un.RECONNECT_CREATE_CONNECTION,m),await this.createTransmitterConnection(f)};try{if(t==="retry"){let f=this._addresses[this.currentURLIndex];this.emit(un.RECONNECT_WAITTING_FINISH,t),await a(f,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let m=this.currentURLIndex;m<this._addresses.length;m++){if(this._addresses[m].fingerprint||$("FINGERPRINT")){this.currentURLIndex=m;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return I.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);I.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));let f=this._addresses[this.currentURLIndex];this.emit(un.RECONNECT_WAITTING_FINISH,t),await a(f,t)}else t==="recover"&&(I.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(un.RECONNECT_WAITTING_FINISH,t),this.emit(un.FAILBACK));return!0}catch(f){var l,u;return I.error("[".concat(this._name,"] reconnect failed"),f.toString()),f!=null&&(l=f.data)!==null&&l!==void 0&&l.desc&&Array.isArray(f.data.desc)&&f.data.desc.length&&ke(u=f.data.desc).call(u,"dynamic key expired")?(this.emit(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,i)}}}class $l extends Ii{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===wt.CONNECTED?this.emit(Fe.WS_CONNECTED):t===wt.RECONNECTING?this.emit(Fe.WS_RECONNECTING,this._websocketReconnectReason):t===wt.CLOSED&&this.emit(Fe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",wt.CLOSED),U(this,"reconnectToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new eR(5)),U(this,"pingpongTimer",void 0),U(this,"inflateDataTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"onWebsocketMessage",o=>{if(o instanceof ArrayBuffer)return void this.emit(Fe.ON_BINARY_DATA,o);let a=JSON.parse(o);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){let l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")&&(this.emit(a._type,a._message),a._type===at.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===at.ON_USER_BANNED))switch(a._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new g2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===wt.CONNECTED&&this.reconnect("retry",du.OFFLINE)})}async request(t,i,o,a){let l=di(6,""),u={_id:l,_type:t,_message:i},f=this.websocket.connectionID,m=()=>new De((V,P)=>{if(this.connectionState===wt.CONNECTED)return V();let k=()=>{this.off(Fe.WS_CLOSED,F),V()},F=()=>{this.off(Fe.WS_CONNECTED,k),P(new se(W.WS_ABORT))};this.once(Fe.WS_CONNECTED,k),this.once(Fe.WS_CLOSED,F),t!==Ye.PUBLISH&&t!==Ye.SUBSCRIBE&&t!==Ye.UNSUBSCRIBE&&t!==Ye.UNPUBLISH&&t!==Ye.CONTROL&&t!==Ye.RESTART_ICE||this.once(Fe.DISCONNECT_P2P,()=>{P(new se(W.DISCONNECT_P2P))}),t!==Ye.PUBLISH&&t!==Ye.RESTART_ICE||this.once(Fe.ABORT_P2P_EXECUTION,()=>{P(new se(W.DISCONNECT_P2P))})});if(this.connectionState!==wt.CONNECTING&&this.connectionState!==wt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),t===Ye.LEAVE&&(this.websocket.unbindDcCloseEventListener(),a=!0),this.websocket.sendMessage(u,!0,!1),a)return;let _=new De((V,P)=>{let k=!1,F=(ie,oe)=>{k=!0,V({isSuccess:ie==="success",message:oe||{}}),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.emit(Fe.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(l),F);let H=()=>{P(new se(W.WS_ABORT,"type: ".concat(t))),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.off("res-@".concat(l),F)};this.once(Fe.WS_CLOSED,H),this.once(Fe.WS_RECONNECTING,H),Nn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||k||(I.warning("dc request timeout, type: ".concat(t)),this.emit(Fe.REQUEST_TIMEOUT,t,i))})}),v=null;try{v=await _}catch(V){if(this.connectionState===wt.CLOSED||t===Ye.LEAVE)throw new se(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,i))}if(v.isSuccess)return v.message;let S=Number(v.message.error_code||v.message.code),C=up(S),b=new se(W.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:S,data:v.message});return C.action==="success"?v.message:(I.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(S,", message: ").concat(C.desc,", action: ").concat(C.action)),S===Xe.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=b,this.close()),b.throw()):C.action==="failed"?b.throw():C.action==="quit"?(this.initError=b,this.close(),b.throw()):(S===Xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",du.MULTI_IP)):this.reconnect(C.action,du.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new De(o=>{let a=l=>{(!i||i(l))&&(this.off(t,a),o(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(dp.WRTC_STATS,i)}upload(t,i){let o={_type:t,_message:i};try{this.websocket.sendMessage(o)}catch{let a=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==wt.CONNECTED)return;let l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let o={_type:t,_message:i};this.websocket.sendMessage(o)}init(t,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((o,a)=>{this.once(Fe.WS_CONNECTED,()=>o(this.joinResponse)),this.once(Fe.WS_CLOSED,()=>a(this.initError||new se(W.WS_ABORT))),this.connectionState=wt.CONNECTING,this.websocket.init(t).catch(a),this.websocket.once(un.FAILBACK,()=>{this.openConnectionTime===void 0&&a(new se(W.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{i&&this.openConnectionTime===void 0&&(I.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),a(new se(W.INIT_DATACHANNEL_TIMEOUT)))},$("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ct.LEAVE,this.connectionState=wt.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new g2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Fe.ABORT_P2P_EXECUTION);let t=await dn(this,Fe.DATACHANNEL_CONNECTING),i=await this.request(Ye.JOIN,t);if(!i)return this.emit(Fe.REPORT_JOIN_GATEWAY,W.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Fe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new se(W.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=op(this,Fe.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let i=await this.request(Ye.REJOIN,t);return!!i&&(this.connectionState=wt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(at.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(at.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(at.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(at.MUTE_AUDIO,{uid:o.uid}):this.emit(at.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(at.MUTE_VIDEO,{uid:o.uid}):this.emit(at.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(at.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(at.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(at.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(at.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(at.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);let i=up(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(i.action,du.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("PINGPONG Timeout. Last Socket Message: ".concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",du.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-i;this.rttRolling.add(o),$("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleInflateData(){let{inflateLength:t,deflateLength:i}=this.websocket.getInflateData();t!==0&&i!==0&&this.upload(dp.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(un.RECONNECT_WAITTING_FINISH,t=>{this.emit(Fe.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(un.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Fe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(un.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(un.CLOSED,()=>{this.connectionState=wt.CLOSED}),this.websocket.on(un.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=wt.CLOSED}),this.websocket.on(un.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===wt.CONNECTED?this.connectionState=wt.RECONNECTING:this.connectionState=wt.CONNECTING}),this.websocket.on(un.WILL_RECONNECT,(t,i)=>{if(op(this,Fe.IS_P2P_DISCONNECTED)&&t==="retry")return I.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Fe.NEED_RENEW_SESSION),this.emit(Fe.DISCONNECT_P2P),i("tryNext");t!=="retry"&&(I.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Fe.NEED_RENEW_SESSION),this.emit(Fe.DISCONNECT_P2P)),i(t)}),this.websocket.on(un.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{I.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",du.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Fe.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof se&&t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Xe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",du.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",du.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(un.REQUEST_NEW_URLS,(t,i)=>{dn(this,Fe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(un.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(at.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(un.TO_CONNECT_DATACHANNEL,async(t,i,o)=>dn(this,Fe.DATACHANNEL_PRECONNECT,t).then(i).catch(o)),this.websocket.on(un.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Fe.DATACHANNEL_FAILBACK)})}}class hp extends Ii{constructor(t,i){super(),U(this,"signal",void 0),U(this,"token",void 0),U(this,"tokenTimeout",void 0),U(this,"tokenInterval",void 0),U(this,"_sequence",0),U(this,"userMap",new Map),U(this,"encoder",new TextEncoder),this.signal=t,this.token=i;let o=()=>{this.signal.connectionState===wt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*$("P2P_TOKEN_INTERVAL"))};o()}async send(t,i,o,a,l){var u,f,m;if(this.userMap.size===0)return;let _=Array.from(sc(u=this.userMap).call(u))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),a=(f=a)!==null&&f!==void 0?f:di(6,""),l=(m=l)!==null&&m!==void 0?m:this._sequence++;let v={_id:a,_type:t,_seq:l,_message:i,token:"".concat(this.token,"_").concat(_)};$("SHOW_P2P_LOG")&&I.debug("send message",v,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(v)).forEach(C=>{this.signal.request(Ye.DATA_STREAM,{payload:au(this.encoder.encode(C))})});let S=new De((C,b)=>{let V=window.setTimeout(()=>{this.off("res-@".concat(a,"_ack"),P),this.off("res-@".concat(a),F),this.off(pm.ABORT,k),I.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(a)),this.userMap.size===0?b(new fe(W.INVALID_REMOTE_USER)):b(new fe(W.TIMEOUT))},$("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),P=()=>{V&&window.clearTimeout(V),this.off(pm.ABORT,k),o&&C()},k=()=>{V&&window.clearTimeout(V),this.off("res-@".concat(a,"_ack"),P),this.off("res-@".concat(a),F),b(new fe(W.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(a)))};this.once(pm.ABORT,k),this.once("res-@".concat(a,"_ack"),P);let F=(ie,oe)=>{H=!0,V&&window.clearTimeout(V),this.off("res-@".concat(a,"_ack"),P),this.off(pm.ABORT,k),ie==="success"?C(oe):b(new fe(W.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(a)))},H=!1;o||(this.once("res-@".concat(a),F),Nn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{H||I.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(a,", ").concat(v))}))});try{return await S}catch(C){if(C.code===W.TIMEOUT)return await this.send(t,i,o,a,l);throw C}}onMessage(t){var i;let{_uid:o}=t,a,l=this.userMap.get(o);if(l)a=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==$i.CHECK)return;let{token:_}=t;a=new Map,l={uid:o,isStart:!0,token:_,splitMessageMap:a,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,l),this.signal.emit(at.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in t&&"total"in t){var u;let{id:_,total:v}=t,S=(u=a.get(_))!==null&&u!==void 0?u:[];if(S.push(t),a.has(_)||a.set(_,S),S.length!==v)return;{let C=v_(S).call(S,(b,V)=>b.index-V.index).map(b=>b.payload).join("");a.delete(_),(t=JSON.parse(C))._uid=o}}let{_type:f,token:m}=t;if(ke(i=[$i.ACK,$i.CHECK]).call(i,f))return f===$i.CHECK&&this.handleCheckToken(l,m),void this.receiveMessage(t);m==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(t):I.debug('Receive unexpected message", '.concat(m,", cur_token: ").concat(l.token,"_").concat(this.token),t)}check(){let t={_id:di(6,""),token:this.token,_type:$i.CHECK};$("SHOW_P2P_LOG")&&I.debug("send message",t),this.signal.request(Ye.DATA_STREAM,{payload:au(this.encoder.encode(JSON.stringify(t)))})}ack(t){let i={_id:t,_type:$i.ACK,token:this.token};$("SHOW_P2P_LOG")&&I.debug("send message",i),this.signal.request(Ye.DATA_STREAM,{payload:au(this.encoder.encode(JSON.stringify(i)))})}response(t,i,o){this.send($i.RESPONSE,JSON.stringify({success:!o,message:i}),!0,t)}handleReceivedMessage(t){let i=()=>{this.userMap.forEach(_=>{let{receivedMessagesMap:v,nextExpectedSequenceNumber:S}=_;for(;v.has(S);){let C=v.get(S);v.delete(S),this.receiveMessage(C),_.nextExpectedSequenceNumber++}})};if(!t)return void i();let{_uid:o,_seq:a}=t,l=this.userMap.get(o),{receivedMessagesMap:u,isStart:f,nextExpectedSequenceNumber:m}=l;if(a<m)return this.ack(t._id),void I.debug("[external-signal] receive old message, seq: ".concat(a,", ").concat(t._message));u.set(a,t),f&&a===m&&(this.receiveMessage(t),u.delete(m),l.nextExpectedSequenceNumber++,i())}receiveMessage(t){let{_id:i,_type:o,_message:a,_uid:l}=t;if($("SHOW_P2P_LOG")&&I.debug("receive message",t),i){let u;switch(t._type!==$i.ACK&&(a&&(u=JSON.parse(a)),this.ack(t._id)),t._type){case $i.CANDIDATE:case $i.CONTROL:this.signal.emit(o,u,l);break;case $i.PUBLISH:case $i.UNPUBLISH:case $i.RESTART_ICE:case $i.CALL:u.uid=l,dn(this.signal,o,u).then(f=>{this.response(t._id,f)}).catch(()=>{this.response(t._id,void 0,!0)});break;case $i.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case $i.RESPONSE:{let{success:f,message:m}=u;this.emit("res-@".concat(i),f?"success":"failed",m);break}}}}splitMessage(t){if(t.length<hp.MAX_MESSAGE_SIZE)return[t];let i=[],{remoteToken:o}=JSON.parse(t),a=di(6,""),l=0,u=800,f=Math.ceil(t.length/u);for(;t.length>0;){l++;let m={id:a,index:l,total:f,payload:t.slice(0,u),token:"".concat(this.token,"_").concat(o)};JSON.stringify(m).length>hp.MAX_MESSAGE_SIZE?u-=50:(i.push(m),t=t.slice(u))}return i.map(m=>JSON.stringify(m))}handleCheckToken(t,i){return t.token!==i?(I.debug("token changed, from ".concat(t.token," to ").concat(i)),this.reset(t.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{I.debug("token timeout, ".concat(i)),this.reset(t.uid)},$("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await dn(this.signal,$i.CALL,void 0),i=await this.send($i.CALL,t);this.signal.emit(Fe.P2P_CONNECTION,i,!0)}async reset(t,i){let o=this.userMap.get(t);o&&(this.emit(pm.ABORT),this.signal.emit(at.ON_USER_OFFLINE,{uid:o.uid,reason:hQ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(I.debug("change local token from ".concat(i," to ").concat(i)),this.token=di(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(pm.ABORT)}}U(hp,"MAX_SIZE",1),U(hp,"MAX_MESSAGE_SIZE",1024);class _2 extends Ii{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===wt.CONNECTED?this.emit(Fe.WS_CONNECTED):t===wt.RECONNECTING?this.emit(Fe.WS_RECONNECTING,this._websocketReconnectReason):t===wt.CLOSED&&this.emit(Fe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,i){super(),U(this,"_disconnectedReason",void 0),U(this,"_websocketReconnectReason",void 0),U(this,"_connectionState",wt.CLOSED),U(this,"reconnectToken",void 0),U(this,"p2pToken",void 0),U(this,"websocket",void 0),U(this,"openConnectionTime",void 0),U(this,"clientId",void 0),U(this,"lastMsgTime",Date.now()),U(this,"uploadCache",[]),U(this,"uploadCacheInterval",void 0),U(this,"rttRolling",new eR(5)),U(this,"pingpongTimer",void 0),U(this,"pingpongTimeoutCount",0),U(this,"joinResponse",void 0),U(this,"multiIpOption",void 0),U(this,"initError",void 0),U(this,"spec",void 0),U(this,"store",void 0),U(this,"_external_signal",void 0),U(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Fe.ON_BINARY_DATA,o.data);let a=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(a,"_id")){let l="res-@".concat(a._id);this.emit(l,a._result,a._message)}else if(Object.prototype.hasOwnProperty.call(a,"_type")){switch(a._type){case at.ON_DATA_STREAM:return void this.handleDataStream(a._message);case at.MUTE_AUDIO:case at.MUTE_VIDEO:case at.ON_P2P_LOST:case at.ON_USER_ONLINE:return;case at.ON_USER_OFFLINE:let{uid:l}=a._message;return I.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(a._type,a._message),a._type===at.ON_NOTIFICATION&&this.handleNotification(a._message),a._type===at.ON_USER_BANNED)switch(a._message.error_code){case 14:this.close(Ct.UID_BANNED);break;case 15:this.close(Ct.IP_BANNED);break;case 16:this.close(Ct.CHANNEL_BANNED)}if(a._type===at.ON_USER_LICENSE_BANNED)switch(a._message.error_code){case Xe.ERR_LICENSE_MISSING:this.close(Ct.LICENSE_MISSING);break;case Xe.ERR_LICENSE_EXPIRED:this.close(Ct.LICENSE_EXPIRED);break;case Xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ct.LICENSE_MINUTES_EXCEEDED);break;case Xe.ERR_LICENSE_PERIOD_INVALID:this.close(Ct.LICENSE_PERIOD_INVALID);break;case Xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ct.LICENSE_MULTIPLE_SDK_SERVICE);break;case Xe.ERR_LICENSE_ILLEGAL:this.close(Ct.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=i,this.websocket=new B_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===wt.CONNECTED&&this.reconnect("retry",nr.OFFLINE)}),this.p2pToken=di(6,""),this._external_signal=new hp(this,this.p2pToken)}async request(t,i,o,a){let l=di(6,""),u={_id:l,_type:t,_message:i},f=this.websocket.connectionID,m=()=>new De((V,P)=>{if(this.connectionState===wt.CONNECTED)return V();let k=()=>{this.off(Fe.WS_CLOSED,F),V()},F=()=>{this.off(Fe.WS_CONNECTED,k),P(new fe(W.WS_ABORT))};this.once(Fe.WS_CONNECTED,k),this.once(Fe.WS_CLOSED,F)});if(this.connectionState!==wt.CONNECTING&&this.connectionState!==wt.RECONNECTING||t===Ye.JOIN||t===Ye.REJOIN||await m(),this.websocket.sendMessage(u,!0),a)return;let _=new De((V,P)=>{let k=!1,F=(ie,oe)=>{k=!0,V({isSuccess:ie==="success",message:oe||{}}),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.emit(Fe.REQUEST_SUCCESS,t,i)};this.once("res-@".concat(l),F);let H=()=>{P(new fe(W.WS_ABORT,"type: ".concat(t))),this.off(Fe.WS_CLOSED,H),this.off(Fe.WS_RECONNECTING,H),this.off("res-@".concat(l),F)};this.once(Fe.WS_CLOSED,H),this.once(Fe.WS_RECONNECTING,H),Nn($("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==f||k||(I.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Fe.REQUEST_TIMEOUT,t,i))})}),v=null;try{v=await _}catch(V){if(this.connectionState===wt.CLOSED||t===Ye.LEAVE)throw new fe(W.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?V.throw():t===Ye.JOIN||t===Ye.REJOIN?null:(await m(),await this.request(t,i))}if(v.isSuccess)return v.message;let S=Number(v.message.error_code||v.message.code),C=up(S),b=new fe(W.UNEXPECTED_RESPONSE,"".concat(C.desc,": ").concat(v.message.error_str),{code:S,data:v.message});return C.action==="success"?v.message:(I.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(S,", message: ").concat(C.desc,", action: ").concat(C.action)),S===Xe.ERR_TOO_MANY_BROADCASTERS?((t===Ye.JOIN||t===Ye.REJOIN)&&(this.initError=b,this.close()),b.throw()):C.action==="failed"?b.throw():C.action==="quit"?(this.initError=b,this.close(),b.throw()):(S===Xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=v.message.option,I.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",nr.MULTI_IP)):this.reconnect(C.action,nr.SERVER_ERROR),t===Ye.JOIN||t===Ye.REJOIN?null:await this.request(t,i)))}waitMessage(t,i){return new De(o=>{let a=l=>{(!i||i(l))&&(this.off(t,a),o(l))};this.on(t,a)})}uploadWRTCStats(t){if(!this.store.sessionId)return void I.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(dp.WRTC_STATS,i)}upload(t,i){let o={_type:t,_message:i};try{this.websocket.sendMessage(o)}catch{let a=$("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==wt.CONNECTED)return;let l=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(l._type,l._message)},$("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,i){let o={_type:t,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(t,i,o){return await this._external_signal.send(t,i,o)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((i,o)=>{this.once(Fe.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Fe.WS_CLOSED,()=>o(this.initError||new fe(W.WS_ABORT))),this.connectionState=wt.CONNECTING,this.websocket.init(t).catch(o)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ct.LEAVE,this.connectionState=wt.CLOSED,I.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===Ct.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new B_("gateway-".concat(this.clientId),this.spec.retryConfig,!0,$("JOIN_GATEWAY_USE_DUAL_DOMAIN"),$("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=di(6,""),this._external_signal.clear(),this._external_signal=new hp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Fe.ABORT_P2P_EXECUTION);let t=await dn(this,Fe.REQUEST_JOIN_INFO),i=await this.request(Ye.JOIN,t);if(!i)return this.emit(Fe.REPORT_JOIN_GATEWAY,W.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Fe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=wt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,i)}handleDataStream(t){try{var i;let o=ap(t.payload),a=new TextDecoder().decode(o),l=JSON.parse(a);"total"in l&&"id"in l||ke(i=Object.values($i)).call(i,l._type)?(l._uid=t.uid,this._external_signal.onMessage(l)):this.emit(at.ON_DATA_STREAM,t)}catch{this.emit(at.ON_DATA_STREAM,t)}}handleNotification(t){I.debug("[".concat(this.clientId,"] receive notification: "),t);let i=up(t.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ct.UID_BANNED),void this.close()):void this.reconnect(i.action,nr.SERVER_ERROR);I.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=$("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=t&&(I.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>$("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",nr.TIMEOUT):this.request(Ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-i;this.rttRolling.add(o),$("REPORT_STATS")&&this.send(Ye.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(rt.RECONNECT_WAITTING_FINISH,t=>{this.emit(Fe.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(rt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Fe.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(rt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(rt.CLOSED,()=>{this.connectionState=wt.CLOSED}),this.websocket.on(rt.FAILED,()=>{this._disconnectedReason=Ct.NETWORK_ERROR,this.connectionState=wt.CLOSED}),this.websocket.on(rt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===wt.CONNECTED?this.connectionState=wt.RECONNECTING:this.connectionState=wt.CONNECTING}),this.websocket.on(rt.WILL_RECONNECT,(t,i,o)=>{t!=="retry"?(I.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Fe.NEED_RENEW_SESSION)):I.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(t)}),this.websocket.on(rt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Fe.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof fe&&t.code===W.UNEXPECTED_RESPONSE&&t.data.code===Xe.ERR_NO_AUTHORIZED)return I.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",nr.SERVER_ERROR);I.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",nr.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(rt.REQUEST_NEW_URLS,(t,i)=>{dn(this,Fe.REQUEST_RECOVER,this.multiIpOption).then(t).catch(i)}),this.websocket.on(rt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(at.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function E2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function fa(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?E2(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E2(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let vR=new Map;class wQ extends Ii{get state(){return this._state}set state(t){if(t===this._state)return;let i=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Yi.CONNECTION_STATE_CHANGE,t,i,this._disconnectedReason):this.emit(Yi.CONNECTION_STATE_CHANGE,t,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){I.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,i){super(),U(this,"store",void 0),U(this,"joinInfo",void 0),U(this,"key",void 0),U(this,"ntpOffset",0),U(this,"signal",void 0),U(this,"role",void 0),U(this,"inChannelInfo",{joinAt:null,duration:0}),U(this,"spec",void 0),U(this,"_state","DISCONNECTED"),U(this,"_statsCollector",void 0),U(this,"_disconnectedReason",void 0),U(this,"isSignalRecover",!1),U(this,"hasChangeBGPAddress",!1),U(this,"trafficStatsInterval",void 0),U(this,"networkQualityInterval",void 0),U(this,"_joinGatewayStartTime",0),U(this,"_signalTimeout",!1),U(this,"_clientRoleOptions",void 0),U(this,"_isProactiveJoin",!1),this.store=t,this.spec=i,this.signal=this.store.useP2P?new _2(fa(fa({},i),{},{retryConfig:i.websocketRetryConfig}),t):this.store.useDataChannel?new $l(fa(fa({},i),{},{retryConfig:i.websocketRetryConfig}),t):new d2(fa(fa({},i),{},{retryConfig:i.websocketRetryConfig}),t),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(t,i,o){if(this.signal instanceof $l){let m=!1;t.cloudProxyServer!=="disabled"?(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),m=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),m=!0):t.apResponse.addresses.some(_=>_.fingerprint)||$("FINGERPRINT")||(I.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),m=!0),m&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let a=Date.now(),l=vR.get(t.cname);if(l||(l=new Map,vR.set(t.cname,l)),this._isProactiveJoin=!0,l.has(t.uid)){let m=new se(W.UID_CONFLICT);throw Ge.joinGateway(t.sid,{lts:a,succ:!1,ec:m.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof $l?"1":"0"}),this._isProactiveJoin=!1,m}l.set(t.uid,!0),this.joinInfo=t,this.key=i;let u=0;this.joinGatewayStartTime=a;let f=t.proxyServer;try{let m;if(I.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof $l?"datachannel":"websocket"," join uid ").concat(u)),this.signal instanceof $l)m=await this.signal.init(t.apResponse.addresses,o);else{let _=t.gatewayAddrs.map(v=>{let{address:S}=v,[C,b]=S.split(":"),V={host:C,port:b};return t.proxyServer&&(V.proxy=t.proxyServer),V});m=await this.signal.init(_,o)}u=m.uid,I.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof $l?"datachannel":"websocket"," join uid ").concat(u," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(m){throw m&&m.code===W.INIT_WEBSOCKET_TIMEOUT?(I.warning("[".concat(this.store.clientId,"] User join failed"),m.toString()),m):m&&m.code===W.INIT_DATACHANNEL_TIMEOUT?(I.warning("[".concat(this.store.clientId,"] User join datachannel failed"),m.toString()),this.resetSignal(),m):(I.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),Ge.joinGateway(t.sid,{lts:a,succ:!1,ec:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!f,signalChannel:this.signal instanceof $l?"1":"0"}),this._isProactiveJoin=!1,l.delete(t.uid),this.signal.close(),m)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),I.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{I.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Yi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Yi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Yi.NETWORK_QUALITY,{uplinkNetworkQuality:p2(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:p2(this._statsCollector.trafficStats.B_dnq)}):this.emit(Yi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),u}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==Ct.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==wt.CONNECTED||await function(o,a){return a===1/0?o:De.race([o,dZ(a)])}(this.signal.request(Ye.LEAVE,void 0,!0),3e3)}catch(o){I.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let a={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:$("PUB_EXTEND"),twcc:!!$("PUBLISH_TWCC"),rtx:!!$("USE_PUB_RTX")};try{return(await this.signal.request(Ye.PUBLISH,a,!0))._message}catch(l){if(o&&l.data&&l.data.code===Xe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(t,i),this.publish(t,i,!1);throw l}}async publishDataChannel(t,i,o){var a;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let l={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(a=i.maxRetransmits)!==null&&a!==void 0?a:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(Ye.PUBLISH_DATASTREAM,l,!0)}catch(u){if(o&&u.data&&u.data.code===Xe.ERR_PUBLISH_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),u.toString()),await this.tryUnpubDataChannelBeforeRepub(t,i),this.publishDataChannel(t,i,!1);throw u}}async unpublish(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Ye.UNPUBLISH,{stream_id:i,ortc:t},!0)}catch(o){I.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(t.map(i=>this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){I.warning("unpublish datachannels warning: ",i)}}async presubscribe(t,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let a={stream_id:t,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX")||void 0,extend:$("SUB_EXTEND"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(Ye.PRE_SUBSCRIBE,a,!0)}catch(l){if(o&&l.data&&l.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(t,i,!1);throw l}}async subscribe(t,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let a={stream_id:t,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!$("SUBSCRIBE_TWCC"),rtx:!!$("USE_SUB_RTX"),extend:$("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return(await this.signal.request(Ye.SUBSCRIBE,a,!0))._message}catch(l){if(o&&l.data&&l.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(t,i),await this.subscribe(t,i,!1);throw l}}async subscribeDataChannel(t,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let a={uid:t,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(Ye.SUBSCRIBE_DATASTREAM,a,!0)}catch(l){if(o&&l.data&&l.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(t,i),await this.subscribeDataChannel(t,i,!1);throw l}}async subscribeAll(t,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let o={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!$("USE_SUB_RTX"),twcc:!!$("SUBSCRIBE_TWCC"),svc:Array.isArray($("SVC"))&&$("SVC").length!==0?$("SVC"):void 0};try{return await this.signal.request(Ye.SUBSCRIBE_STREAMS,o,!0)}catch(a){if(i&&a.data&&a.data.code===Xe.ERR_SUBSCRIBE_REQUEST_INVALID)return I.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),a.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw a}}async setVideoProfile(t){let i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let a=o.frameRate,l=o.width,u=o.height,f=!0;return typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(f=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(f=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,a||(f=!1)),f?{stream_type:0,width:l,height:u,fps:a,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(t);if(i)return this.signal.request(Ye.SET_VIDEO_PROFILE,i);I.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,i){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:i},!0)}catch(o){I.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(t,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(t.map(o=>this.signal.request(Ye.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){I.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(t){try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,t,!0)}catch(i){I.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(t){let{iceParameters:i,dtlsParameters:o,rtpCapabilities:a}=t;return{gatewayEstablishParams:await this.signal.request(Ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Ye.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Ye.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),this.state!=="CONNECTED")return void(this.role=t);let o,a=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,a=1):a=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:a=0,await this.signal.request(Ye.SET_CLIENT_ROLE,{role:t,level:a,delay:o,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,i){await this.signal.request(Ye.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:i})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Ye.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,i){await this.signal.request(Ye.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:i})}async pickSVCLayer(t,i){await this.signal.request(Ye.PICK_SVC_LAYER,{stream_id:t,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Ye.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,i,o){if(this.signal instanceof _2)return this.signal.sendExtensionMessage(t,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),fa({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=vR.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:rr.username,password:rr.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(fa(fa({},rr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(Ye.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(i=>{let o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(a=>a.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&Zy(()=>{this.emit(Yi.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new se(W.UNEXPECTED_ERROR,"can not generate join message, no join info");let i=Object.assign({},this.joinInfo.apResponse),o=$("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}o&&o.length>128&&(o=void 0);let a=fa({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Ps,browser:navigator.userAgent,process_id:$("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:$("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:{enablePublishedUserList:$("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:$("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof $("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?$("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof $("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?$("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof $("ENABLE_USER_LICENSE_CHECK")=="boolean"?$("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:$("USE_PUB_RTX")===!0||$("USE_SUB_RTX")===!0||void 0,disableFEC:$("DISABLE_FEC"),enableNTPReport:!!$("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!$("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof $("ENABLE_DATASTREAM_2")=="boolean"?$("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!$("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof $("USE_XR")=="boolean"?$("USE_XR"):void 0,enableLossbasedBwe:typeof $("ENABLE_LOSSBASED_BWE")=="boolean"?$("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof $("ENABLE_AUT_CC")=="boolean"?$("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof $("ENABLE_CC_FALLBACK")=="boolean"?$("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(a.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(a.aes_mode=this.joinInfo.aesmode,$("ENCRYPT_AES")?(a.aes_secret=this.joinInfo.aespassword,a.aes_encrypt=!0):a.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(a.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(a.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(a.default_video_stream=this.joinInfo.defaultVideoStream),a}getRejoinMessage(){if(!this.joinInfo)throw new se(W.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Fe.WS_RECONNECT_WAITTING_FINISH,t=>{var i;ke(i=["tryNext","recover"]).call(i,t)&&this.joinInfo&&Ge.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Fe.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Fe.WS_RECONNECTING,t=>{this.joinInfo&&Ge.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||nr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ge.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Fe.WS_CLOSED,t=>{let i;switch(t){case Ct.LEAVE:i=nr.LEAVE;break;case Ct.UID_BANNED:case Ct.IP_BANNED:case Ct.CHANNEL_BANNED:case Ct.SERVER_ERROR:i=nr.SERVER_ERROR;break;case Ct.FALLBACK:i=nr.FALLBACK;break;case Ct.LICENSE_MISSING:case Ct.LICENSE_EXPIRED:case Ct.LICENSE_MINUTES_EXCEEDED:case Ct.LICENSE_PERIOD_INVALID:case Ct.LICENSE_MULTIPLE_SDK_SERVICE:case Ct.LICENSE_ILLEGAL:case Ct.TOKEN_EXPIRE:i=t;break;default:i=nr.NETWORK_ERROR}I.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+nr.NETWORK_ERROR)),this.joinInfo&&Ge.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ct.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=t,t!==Ct.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Fe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(I.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Ge.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof $l?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void I.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));ai("EVENT_REPORT_DOMAIN",t[1]),ai("EVENT_REPORT_BACKUP_DOMAIN",t[1]),ai("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(at.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Fe.REQUEST_RECOVER,(t,i,o)=>{if(!this.joinInfo)return o(new se(W.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,dn(this,Yi.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Fe.REQUEST_JOIN_INFO,async t=>{var i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let{iceParameters:o,dtlsParameters:a,rtpCapabilities:l}=await dn(this,Yi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(i=this.joinInfo)===null||i===void 0?void 0:i.turnServer});t(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:a,rtpCapabilities:l,version:"2"}}))}),this.signal.on(Fe.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Fe.REPORT_JOIN_GATEWAY,(t,i)=>{this.joinInfo&&(Ge.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof $l?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(Fe.IS_P2P_DISCONNECTED,t=>{t(op(this,Yi.IS_P2P_DISCONNECTED))}),this.signal.on(Fe.DISCONNECT_P2P,()=>{this.emit(Yi.DISCONNECT_P2P)}),this.signal.on(Fe.NEED_RENEW_SESSION,t=>{this.emit(Yi.NEED_RENEW_SESSION,t)}),this.signal.on(Fe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Fe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Fe.JOIN_RESPONSE,t=>{let i=this.getCurrentGatewayAddress();this.emit(Yi.JOIN_RESPONSE,t,i)}),this.signal.on(Fe.DATACHANNEL_PRECONNECT,async(t,i,o)=>{this.updateTurnConfigFromSignal();let a=this.getCurrentGatewayAddress();return dn(this,Yi.DATACHANNEL_PRECONNECT,t,a).then(i).catch(o)}),this.signal.on(Fe.DATACHANNEL_CONNECTING,async t=>{let{iceParameters:i,dtlsParameters:o,rtpCapabilities:a}=await dn(this,Yi.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(Fe.DATACHANNEL_FAILBACK,()=>{I.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Yi.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,i){try{await this.signal.request(Ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[i]},!0)}catch(o){throw I.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(t,i){try{await this.signal.request(Ye.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw I.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(t,i){try{await this.signal.request(Ye.UNPUBLISH,{stream_id:t,ortc:i},!0)}catch(o){throw I.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(t,i){try{await this.signal.request(Ye.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw I.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(t){let i={users:t.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Ye.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw I.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(t,i){let o={action:t.find(a=>a.stream_type===Xt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),a),a}}async unmuteLocal(t,i){let o={action:t.find(a=>a.stream_type===Xt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:i};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),a),a}}async muteRemote(t,i){let o={action:t===He.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),a),a}}async unmuteRemote(t,i){let o={action:t===He.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(Ye.CONTROL,o,!0,!0)}catch(a){throw I.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),a),a}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,i){this.signal.upload(t,i)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Ye.RESTART_ICE,i,!0)}catch(o){throw I.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,nr.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!$("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Ye.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Ct.FALLBACK)),this.store.useDataChannel=!1,this.signal=new d2(fa(fa({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Yi.RESET_SIGNAL,i2.websocket)}}let h0=0,yR=0;function lc(e,t,i,o){return new De((a,l)=>{t.timeout=t.timeout||$("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!i?(t.data=JSON.stringify(t.data),h0+=Xc(t.data)):i&&(t.data.size?h0+=t.data.size:t.data instanceof FormData?h0+=kM(t.data):h0+=Xc(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Qr.request(t).then(u=>{typeof u.data=="string"?yR+=Xc(u.data):u.data instanceof ArrayBuffer||u.data instanceof Uint8Array?yR+=u.data.byteLength:yR+=Xc(JSON.stringify(u.data)),o&&a({data:u.data,headers:u.headers}),a(u.data)}).catch(u=>{Qr.isCancel(u)?l(new se(W.OPERATION_ABORTED,"cancel token canceled")):u.code==="ECONNABORTED"?l(new se(W.NETWORK_TIMEOUT,u.message)):u.response?l(new se(W.NETWORK_RESPONSE_ERROR,u.response.status)):l(new se(W.NETWORK_ERROR,u.message))})})}(function(){var e;function t(_e){var xe=0;return function(){return xe<_e.length?{done:!1,value:_e[xe++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(_e,xe,We){return _e==Array.prototype||_e==Object.prototype||(_e[xe]=We.value),_e},o,a=function(_e){_e=[typeof globalThis=="object"&&globalThis,_e,typeof window=="object"&&window,typeof self=="object"&&self,typeof c=="object"&&c];for(var xe=0;xe<_e.length;++xe){var We=_e[xe];if(We&&We.Math==Math)return We}throw Error("Cannot find global object")}(this);function l(_e,xe){if(xe)e:{var We=a;_e=_e.split(".");for(var dt=0;dt<_e.length-1;dt++){var Bt=_e[dt];if(!(Bt in We))break e;We=We[Bt]}(xe=xe(dt=We[_e=_e[_e.length-1]]))!=dt&&xe!=null&&i(We,_e,{configurable:!0,writable:!0,value:xe})}}function u(_e){return(_e={next:_e})[Symbol.iterator]=function(){return this},_e}function f(_e){var xe=typeof Symbol<"u"&&Symbol.iterator&&_e[Symbol.iterator];return xe?xe.call(_e):{next:t(_e)}}if(l("Symbol",function(_e){function xe(Bt,Le){this.A=Bt,i(this,"description",{configurable:!0,writable:!0,value:Le})}if(_e)return _e;xe.prototype.toString=function(){return this.A};var We="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",dt=0;return function Bt(Le){if(this instanceof Bt)throw new TypeError("Symbol is not a constructor");return new xe(We+(Le||"")+"_"+dt++,Le)}}),l("Symbol.iterator",function(_e){if(_e)return _e;_e=Symbol("Symbol.iterator");for(var xe="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),We=0;We<xe.length;We++){var dt=a[xe[We]];typeof dt=="function"&&typeof dt.prototype[_e]!="function"&&i(dt.prototype,_e,{configurable:!0,writable:!0,value:function(){return u(t(this))}})}return _e}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var m;e:{var _={};try{_.__proto__={a:!0},m=_.a;break e}catch{}m=!1}o=m?function(_e,xe){if(_e.__proto__=xe,_e.__proto__!==xe)throw new TypeError(_e+" is not extensible");return _e}:null}var v=o;function S(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function C(_e){if(_e.m)throw new TypeError("Generator is already running");_e.m=!0}function b(_e,xe){return _e.h=3,{value:xe}}function V(_e){this.g=new S,this.G=_e}function P(_e,xe,We,dt){try{var Bt=xe.call(_e.g.j,We);if(!(Bt instanceof Object))throw new TypeError("Iterator result "+Bt+" is not an object");if(!Bt.done)return _e.g.m=!1,Bt;var Le=Bt.value}catch(M){return _e.g.j=null,_e.g.s(M),k(_e)}return _e.g.j=null,dt.call(_e.g,Le),k(_e)}function k(_e){for(;_e.g.h;)try{var xe=_e.G(_e.g);if(xe)return _e.g.m=!1,{value:xe.value,done:!1}}catch(We){_e.g.v=void 0,_e.g.s(We)}if(_e.g.m=!1,_e.g.l){if(xe=_e.g.l,_e.g.l=null,xe.F)throw xe.D;return{value:xe.return,done:!0}}return{value:void 0,done:!0}}function F(_e){this.next=function(xe){return _e.o(xe)},this.throw=function(xe){return _e.s(xe)},this.return=function(xe){return function(We,dt){C(We.g);var Bt=We.g.j;return Bt?P(We,"return"in Bt?Bt.return:function(Le){return{value:Le,done:!0}},dt,We.g.return):(We.g.return(dt),k(We))}(_e,xe)},this[Symbol.iterator]=function(){return this}}function H(_e,xe){return xe=new F(new V(xe)),v&&_e.prototype&&v(xe,_e.prototype),xe}if(S.prototype.o=function(_e){this.v=_e},S.prototype.s=function(_e){this.l={D:_e,F:!0},this.h=this.C||this.u},S.prototype.return=function(_e){this.l={return:_e},this.h=this.u},V.prototype.o=function(_e){return C(this.g),this.g.j?P(this,this.g.j.next,_e,this.g.o):(this.g.o(_e),k(this))},V.prototype.s=function(_e){return C(this.g),this.g.j?P(this,this.g.j.throw,_e,this.g.o):(this.g.s(_e),k(this))},l("Array.prototype.entries",function(_e){return _e||function(){return function(xe,We){xe instanceof String&&(xe+="");var dt=0,Bt=!1,Le={next:function(){if(!Bt&&dt<xe.length){var M=dt++;return{value:We(M,xe[M]),done:!1}}return Bt=!0,{done:!0,value:void 0}}};return Le[Symbol.iterator]=function(){return Le},Le}(this,function(xe,We){return[xe,We]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ie=function(_e,xe){for(var We=0;We<_e.length;We++)xe(_e[We])},oe=function(_e){return _e.replace(/\r?\n|\r/g,`\r
`)},ae=function(_e,xe,We){return xe instanceof Blob?(We=We!==void 0?We+"":typeof xe.name=="string"?xe.name:"blob",xe.name===We&&Object.prototype.toString.call(xe)!=="[object Blob]"||(xe=new File([xe],We)),[String(_e),xe]):[String(_e),String(xe)]},he=function(_e,xe){if(_e.length<xe)throw new TypeError(xe+" argument required, but only "+_e.length+" present.")},Ee=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,ye=Ee.FormData,Ce=Ee.XMLHttpRequest&&Ee.XMLHttpRequest.prototype.send,ze=Ee.Request&&Ee.fetch,It=Ee.navigator&&Ee.navigator.sendBeacon,Kt=Ee.Element&&Ee.Element.prototype,_i=Ee.Symbol&&Symbol.toStringTag;_i&&(Blob.prototype[_i]||(Blob.prototype[_i]="Blob"),"File"in Ee&&!File.prototype[_i]&&(File.prototype[_i]="File"));try{new File([],"")}catch{Ee.File=function(_e,xe,We){return _e=new Blob(_e,We||{}),Object.defineProperties(_e,{name:{value:xe},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),_i&&Object.defineProperty(_e,_i,{value:"File"}),_e}}var sn=function(_e){return _e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Li=function(_e){this.i=[];var xe=this;_e&&ie(_e.elements,function(We){if(We.name&&!We.disabled&&We.type!=="submit"&&We.type!=="button"&&!We.matches("form fieldset[disabled] *"))if(We.type==="file"){var dt=We.files&&We.files.length?We.files:[new File([],"",{type:"application/octet-stream"})];ie(dt,function(Bt){xe.append(We.name,Bt)})}else We.type==="select-multiple"||We.type==="select-one"?ie(We.options,function(Bt){!Bt.disabled&&Bt.selected&&xe.append(We.name,Bt.value)}):We.type==="checkbox"||We.type==="radio"?We.checked&&xe.append(We.name,We.value):(dt=We.type==="textarea"?oe(We.value):We.value,xe.append(We.name,dt))})};if((e=Li.prototype).append=function(_e,xe,We){he(arguments,2),this.i.push(ae(_e,xe,We))},e.delete=function(_e){he(arguments,1);var xe=[];_e=String(_e),ie(this.i,function(We){We[0]!==_e&&xe.push(We)}),this.i=xe},e.entries=function _e(){var xe,We=this;return H(_e,function(dt){if(dt.h==1&&(xe=0),dt.h!=3)return xe<We.i.length?dt=b(dt,We.i[xe]):(dt.h=0,dt=void 0),dt;xe++,dt.h=2})},e.forEach=function(_e,xe){he(arguments,1);for(var We=f(this),dt=We.next();!dt.done;dt=We.next()){var Bt=f(dt.value);dt=Bt.next().value,Bt=Bt.next().value,_e.call(xe,Bt,dt,this)}},e.get=function(_e){he(arguments,1);var xe=this.i;_e=String(_e);for(var We=0;We<xe.length;We++)if(xe[We][0]===_e)return xe[We][1];return null},e.getAll=function(_e){he(arguments,1);var xe=[];return _e=String(_e),ie(this.i,function(We){We[0]===_e&&xe.push(We[1])}),xe},e.has=function(_e){he(arguments,1),_e=String(_e);for(var xe=0;xe<this.i.length;xe++)if(this.i[xe][0]===_e)return!0;return!1},e.keys=function _e(){var xe,We,dt,Bt,Le=this;return H(_e,function(M){if(M.h==1&&(xe=f(Le),We=xe.next()),M.h!=3)return We.done?void(M.h=0):(dt=We.value,Bt=f(dt),b(M,Bt.next().value));We=xe.next(),M.h=2})},e.set=function(_e,xe,We){he(arguments,2),_e=String(_e);var dt=[],Bt=ae(_e,xe,We),Le=!0;ie(this.i,function(M){M[0]===_e?Le&&(Le=!dt.push(Bt)):dt.push(M)}),Le&&dt.push(Bt),this.i=dt},e.values=function _e(){var xe,We,dt,Bt,Le=this;return H(_e,function(M){if(M.h==1&&(xe=f(Le),We=xe.next()),M.h!=3)return We.done?void(M.h=0):(dt=We.value,(Bt=f(dt)).next(),b(M,Bt.next().value));We=xe.next(),M.h=2})},Li.prototype._asNative=function(){for(var _e=new ye,xe=f(this),We=xe.next();!We.done;We=xe.next()){var dt=f(We.value);We=dt.next().value,dt=dt.next().value,_e.append(We,dt)}return _e},Li.prototype._blob=function(){var _e="----formdata-polyfill-"+Math.random(),xe=[],We="--"+_e+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(dt,Bt){return typeof dt=="string"?xe.push(We+sn(oe(Bt))+`"\r
\r
`+oe(dt)+`\r
`):xe.push(We+sn(oe(Bt))+'"; filename="'+sn(dt.name)+`"\r
Content-Type: `+(dt.type||"application/octet-stream")+`\r
\r
`,dt,`\r
`)}),xe.push("--"+_e+"--"),new Blob(xe,{type:"multipart/form-data; boundary="+_e})},Li.prototype[Symbol.iterator]=function(){return this.entries()},Li.prototype.toString=function(){return"[object FormData]"},Kt&&!Kt.matches&&(Kt.matches=Kt.matchesSelector||Kt.mozMatchesSelector||Kt.msMatchesSelector||Kt.oMatchesSelector||Kt.webkitMatchesSelector||function(_e){for(var xe=(_e=(this.document||this.ownerDocument).querySelectorAll(_e)).length;0<=--xe&&_e.item(xe)!==this;);return-1<xe}),_i&&(Li.prototype[_i]="FormData"),Ce){var Aa=Ee.XMLHttpRequest.prototype.setRequestHeader;Ee.XMLHttpRequest.prototype.setRequestHeader=function(_e,xe){Aa.call(this,_e,xe),_e.toLowerCase()==="content-type"&&(this.B=!0)},Ee.XMLHttpRequest.prototype.send=function(_e){_e instanceof Li?(_e=_e._blob(),this.B||this.setRequestHeader("Content-Type",_e.type),Ce.call(this,_e)):Ce.call(this,_e)}}ze&&(Ee.fetch=function(_e,xe){return xe&&xe.body&&xe.body instanceof Li&&(xe.body=xe.body._blob()),ze.call(this,_e,xe)}),It&&(Ee.navigator.sendBeacon=function(_e,xe){return xe instanceof Li&&(xe=xe._asNative()),It.call(this,_e,xe)}),Ee.FormData=Li}})();let H_=()=>{let e=$("AREAS");return e.length===0&&e.push(Ft.GLOBAL),fo(e).call(e,(t,i,o)=>{let a=v2(i);return a?o===0?a:"".concat(t,",").concat(a):t},"")},v2=e=>e===Ft.OVERSEA?"".concat(hr.ASIA,",").concat(hr.EUROPE,",").concat(hr.AFRICA,",").concat(hr.NORTH_AMERICA,",").concat(hr.SOUTH_AMERICA,",").concat(hr.OCEANIA):hr[e],CQ=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let o=l0[i],a=Object.keys(o);a&&a.map(l=>{l!=="CODE"&&(t[l]=t[l].concat(o[l]))})}),t},p0={GLOBAL:{ASIA:[Ft.CHINA,Ft.JAPAN,Ft.INDIA,Ft.KOREA,Ft.HKMC],EUROPE:[],NORTH_AMERICA:[Ft.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},f0=Object.keys(p0[Ft.GLOBAL]),SR=[Ft.CHINA,Ft.NORTH_AMERICA,Ft.EUROPE,Ft.ASIA,Ft.JAPAN,Ft.INDIA,Ft.OCEANIA,Ft.SOUTH_AMERICA,Ft.AFRICA,Ft.KOREA,Ft.HKMC,Ft.US],bQ=function(e,t){let i=[];if(ke(e).call(e,Ft.GLOBAL)){let l=[Ft.GLOBAL,Ft.OVERSEA],u=Object.keys(l0);if(t===Ft.GLOBAL)throw new se(W.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ft.CHINA)i=[Ft.OVERSEA];else if(a=t,ke(f0).call(f0,a)){let f=(o=t,p0[Ft.GLOBAL][o]||[]),m=[...l,t,...f];i=u.filter(_=>!ke(m).call(m,_))}else if(function(f){let m=!1;return f0.forEach(_=>{var v;ke(v=p0[Ft.GLOBAL][_]).call(v,f)&&(m=!0)}),m}(t)){let f=function(_){let v;return f0.forEach(S=>{var C;ke(C=p0[Ft.GLOBAL][S]).call(C,_)&&(v=S)}),v}(t),m=[...l,f,t];i=u.filter(_=>!ke(m).call(m,_))}else i=e;i=function(f){let m=[];return SR.forEach(_=>{ke(f).call(f,_)&&m.push(_)}),m.concat(f.filter(_=>!ke(SR).call(SR,_)))}(i)}else i=e;var o,a;return i};function y2(e){var t,i;if(!e&&ke(t=$("AREAS")).call(t,Ft.EXTENSIONS))return I.debug("update area from ap : reset"),void TR(vZ,!0);if(!ke(i=$("AREAS")).call(i,Ft.GLOBAL)||!e)return;let o=l0.EXTENSIONS;o&&(o={CODE:v2(Ft.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},I.debug("update area from ap success: ".concat(e,",config is "),o),ai("AREAS",[Ft.EXTENSIONS],!0),Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?ai(a,o[a][0]):ai(a,o[a])}))}function TR(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=Ge.reportApiInvoke(null,{name:ln.SET_AREA,options:e,tag:Ui.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!ke(n2).call(n2,l))throw new se(W.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:l,excludedArea:u}=e;if(!l)throw new se(W.INVALID_PARAMS,"area code is needed");let f=l;typeof l=="string"&&(f=[l]),o=u?bQ(f,u):f}if(!t){if(cu.AREAS){let l=new se(W.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(l),void I.warning("setArea is prohibited because of config-distribute")}if(ke(o).call(o,Ft.GLOBAL)&&$("AREAS")===Ft.EXTENSIONS){let l=new se(W.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(l),void I.warning("setArea is prohibited because of ap extensions")}}ai("AREAS",o,t);let a=CQ(o);Object.keys(a).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?ai(l,a[l][0]):ai(l,a[l])}),I.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function S2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function wR(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?S2(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S2(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let CR=1;function RQ(e,t,i,o,a){CR+=1;let l={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:CR,requestId:CR,version:Ps,cname:i.cname},u={service_name:t,json_body:JSON.stringify(l)},f,m,_=e[0];return oc(async()=>{f=Date.now();let v=await lc(_,{data:u,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(m=Date.now()-f,v.code!==0){let b=new se(W.UNEXPECTED_RESPONSE,"live streaming ap error, code"+v.code,{retry:!0,responseTime:m});throw I.error(b.toString()),b}let S=JSON.parse(v.json_body);if(S.code!==200){let b=new se(W.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(S.code,", reason: ").concat(S.reason),{code:S.code,responseTime:m});throw I.error(b.toString()),b}if(!S.servers||S.servers.length===0){let b=new se(W.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:S.code,responseTime:m});throw I.error(b.toString()),b}let C=function(b,V){return{addressList:b.servers.map(P=>"wss://".concat(P.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(P.wss,"?serviceName=").concat(encodeURIComponent(V))),workerToken:b.workerToken,vid:b.vid}}(S,t);return $("LIVE_STREAMING_ADDRESS")&&(C.addressList=$("LIVE_STREAMING_ADDRESS")instanceof Array?$("LIVE_STREAMING_ADDRESS"):[$("LIVE_STREAMING_ADDRESS")]),wR(wR({},C),{},{responseTime:m})},(v,S)=>(Ge.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(v.addressList),firstSuccess:S===0,responseTime:m,serverIp:e[S%e.length]}),!1),(v,S)=>(Ge.apworkerEvent(i.sid,{success:!1,sc:v.data&&v.data.code||200,serviceName:t,responseTime:m,serverIp:e[S%e.length]}),!!(v.code!==W.OPERATION_ABORTED&&v.code!==W.UNEXPECTED_RESPONSE||v.data&&v.data.retry)&&(_=e[(S+1)%e.length],!0)),a)}let bR=1;function T2(e,t,i,o){let{url:a,areaCode:l}=e,{clientId:u,sid:f}=t,m=Date.now(),_,[v,S]=IR(t,l,[rn.CHOOSE_SERVER]),C=ji.networkState;return oc(async()=>{C&&ji.networkState===Ur.OFFLINE&&ji.onlineWaiter&&await De.race([ji.onlineWaiter,Nn(o&&o.maxRetryTimeout||nn.maxRetryTimeout)]),C=ji.networkState;let{data:b,headers:V}=await lc(a,{data:v,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=V.http3==="1"?1:-1,Ge.reportResourceTiming(a,f),C2(b,a,t,m,[rn.CHOOSE_SERVER],_);let P=z_(b,rn.CHOOSE_SERVER);return RR(P),_R(P,a)},b=>(b&&Ge.joinChooseServer(f,{lts:m,succ:!0,csAddr:a,opid:S,serverList:b.gatewayAddrs.map(V=>V.address),ec:null,cid:b.cid.toString(),uid:b.uid.toString(),csIp:b.csIp,unilbsServerIds:[rn.CHOOSE_SERVER].toString(),isHttp3:_}),!1),b=>b.code!==W.OPERATION_ABORTED&&(b.code===W.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(Ge.joinChooseServer(f,{lts:m,succ:!1,csAddr:a,serverList:null,opid:S,ec:b.code,csIp:b.data&&b.data.csIp,unilbsServerIds:[rn.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:C}),isHttp3:_}),I.warning("[".concat(u||"sid-".concat(f.slice(0,6)),"] Choose server network error, retry"),b),!0)),o)}function w2(e,t,i,o){let a,{url:l,areaCode:u,serviceIds:f}=e,m=Date.now(),[_,v]=IR(t,u,f),S;return oc(async()=>{S&&ji.networkState===Ur.OFFLINE&&ji.onlineWaiter&&await De.race([ji.onlineWaiter,Nn(o&&o.maxRetryTimeout||nn.maxRetryTimeout)]),S=ji.networkState;let{data:C,headers:b}=await lc(l,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a=b.http3==="1"?1:-1,Ge.reportResourceTiming(l,t.sid),C2(C,l,t,m,f,a);let V=z_(C,rn.CHOOSE_SERVER),P=z_(C,t.cloudProxyServer==="proxy5"?rn.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?rn.CLOUD_PROXY:rn.CLOUD_PROXY_FALLBACK);return RR(V),{gatewayInfo:_R(V,l),proxyInfo:P,url:l}},C=>(C.gatewayInfo&&Ge.joinChooseServer(t.sid,{lts:m,succ:!0,csAddr:l,serverList:C.gatewayInfo.gatewayAddrs.map(b=>b.address),ec:null,opid:v,cid:C.gatewayInfo.cid.toString(),uid:C.gatewayInfo.uid.toString(),csIp:C.gatewayInfo.csIp,unilbsServerIds:f.toString(),isHttp3:a}),C.proxyInfo&&Ge.joinWebProxyAP(t.sid,{lts:m,sucess:1,apServerAddr:l,turnServerAddrList:C.proxyInfo.addresses.map(b=>b.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:f.toString()}),!1),C=>C.code!==W.OPERATION_ABORTED&&(C.code===W.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(Ge.joinWebProxyAP(t.sid,{lts:m,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:C.code,eventType:t.cloudProxyServer,unilbsServerIds:f.toString(),extend:JSON.stringify({networkState:S})}),I.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),C),!0)),o)}let C2=(e,t,i,o,a,l)=>{let{sid:u,clientId:f,cloudProxyServer:m}=i,_=[],v=S=>{S.flag===4096?Ge.joinChooseServer(u,{lts:o,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:S.error.message,csIp:S.error.data&&S.error.data.csIp,unilbsServerIds:a.toString(),isHttp3:l}):S.flag!==1048576&&S.flag!==4194304&&S.flag!==4194310||Ge.joinWebProxyAP(u,{lts:o,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:S.error.code,eventType:m,unilbsServerIds:a.toString()})};if(e.response_body.forEach(S=>{let C=S.buffer.code;if(S.uri===23&&C===0&&!S.buffer.edges_services)if(S.buffer.flag===4194310)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),S.buffer.edges_services=[];else{let b={error:new se(W.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:S.buffer.flag};_.push(b),v(b)}if(C!==0){let b=fm(C),V={error:new se(W.CAN_NOT_GET_GATEWAY_SERVER,b.desc,{desc:b.desc,retry:b.retry,csIp:e.detail[502]}),flag:S.buffer.flag};S.buffer.flag===4194310?I.warning(V.error.toString()):_.push(V),v(V)}}),_.length)throw I.warning("[".concat(f||"sid-".concat(u.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(_.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message,", retry: ").concat(S.error.data.retry)).join(" | "))),new se(W.CAN_NOT_GET_GATEWAY_SERVER,_.map(S=>"flag: ".concat(S.flag,", message: ").concat(S.error.message)).join(" | "),{retry:!!_.find(S=>S.error.data.retry),csIp:e.detail[502],desc:[...new Set(_.map(S=>{var C;return S==null||(C=S.error)===null||C===void 0||(C=C.data)===null||C===void 0?void 0:C.desc}).filter(S=>!!S))]})},RR=e=>{var t,i,o,a;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new se(W.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if($("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((a=e.detail)===null||a===void 0?void 0:a[23])=="string"?y2(e.detail[23].toLowerCase()):y2()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let u=e.detail[19],f=u==null?void 0:u.split(";");for(let m=0;m<f.length;m++){var l;let _=Rr(l=f[m]).call(l);e.addresses[m]&&f&&(e.addresses[m].fingerprint=_)}}if($("GATEWAY_ADDRESS")&&$("GATEWAY_ADDRESS").length>0){I.debug("assign gateway address to",$("GATEWAY_ADDRESS"));let u=$("GATEWAY_ADDRESS").map(f=>{var m,_;let v=(m=(_=e.addresses.find(S=>S.ip===f.ip&&S.port===f.port))===null||_===void 0?void 0:_.fingerprint)!==null&&m!==void 0?m:"";return{ip:f.ip,port:f.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:v}});e.addresses=u}},IQ=(e,t)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let o=fm(i.buffer.code);throw new se(W.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw I.debug("update ticket request received ap response without response body:",t),new se(W.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},IR=(e,t,i)=>{let o=Math.floor(Math.random()*1e12),a={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:wR({6:e.stringUid,11:t,12:$("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};a.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let l=new FormData;return l.append("request",JSON.stringify(a)),[l,o]},AQ=(e,t)=>{let i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},a=new FormData;return a.append("request",JSON.stringify(o)),[a,i]},mm=0;function gm(e){return De.all(e.map(t=>t.then(i=>{throw i},i=>i))).then(t=>{throw t},t=>t)}let G_=async e=>{let{fragementLength:t,referenceList:i,asyncMapHandler:o,allFailedhandler:a,promisesCollector:l}=e,u=0,f=t,m,_=0,v=async()=>{let S=(()=>{let C=u*f,b=C+f;return i.slice(C,b).map(o)})();l&&l.push(...S);try{m=await gm(S)}catch(C){if(_+=f,u++,!(_>=i.length))return void await v();a(C)}S.forEach(C=>C.cancel())};return await v(),m},b2=async e=>{let{referenceList:t,asyncMapHandler:i,closeFn:o}=e,a=t.length,l=0,u=async()=>{let f=i(t.shift());try{return await f}catch(m){if(l++,l>=a||o!=null&&o(m))throw m;return u()}};return u()};async function AR(e,t,i,o){return{gatewayInfo:await async function(a,l,u,f){let m=null,_=[],v=async()=>{let C=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(P=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:H_()})),b=f.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(P=>P.url)}),V=await G_({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:P=>(I.debug("[".concat(a.clientId,"] Connect to choose_server:"),P.url),T2(P,a,l,u)),allFailedhandler:P=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},b),P[0]},promisesCollector:_});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},b),V},S=async()=>{if(await Nn(1e3),m!==null)return m;let C=$("WEBCS_DOMAIN_BACKUP_LIST").map(P=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:H_()})),b=f.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(P=>P.url)}),V=await G_({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:P=>(I.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),P.url),T2(P,a,l,u)),allFailedhandler:P=>{throw f.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},b),P[0]},promisesCollector:_});return f.recordJoinChannelService({endTs:Date.now(),status:"success"},b),V};try{return m=await gm([v(),S()]),_.length&&_.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),m}catch(C){throw C[0]}}(e,t,i,o)}}async function R2(e,t,i,o,a){let l=e.cloudProxyServer;if(l==="disabled"){if(e.useLocalAccessPoint)return await AR(e,t,i,a);if($("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:C,proxyInfo:b}=await O2(e,t,i,a);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:C};let V=b.map(P=>({turnServerURL:P.address,tcpport:P.tcpport||rr.tcpport,udpport:P.udpport||rr.udpport,username:P.username||rr.username,password:P.password||rr.password,forceturn:!1,security:!0}));if(a.useP2P){var u;let P=(u=e.uid)!==null&&u!==void 0?u:C.uid,k="glb:".concat(P.toString()),F=await Jb(k),H=b.map(ie=>({turnServerURL:ie.address,tcpport:ie.tcpport||rr.tcpport,udpport:ie.udpport||rr.udpport,username:k,password:F,forceturn:!1,security:!0}));V.push(...H)}return e.turnServer={mode:"manual",servers:V},{gatewayInfo:C}}return await AR(e,t,i,a)}let{proxyInfo:f,gatewayInfo:m}=await O2(e,t,i,a),_={gatewayInfo:m},v=f.map(C=>({turnServerURL:C.address,tcpport:l==="proxy3"?void 0:C.tcpport?C.tcpport:rr.tcpport,udpport:l==="proxy4"?void 0:C.udpport?C.udpport:rr.udpport,username:C.username||rr.username,password:C.password||rr.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(a.useP2P){var S;let C=(S=e.uid)!==null&&S!==void 0?S:m.uid,b="glb:".concat(C.toString()),V=await Jb(b),P=f.map(k=>({turnServerURL:k.address,tcpport:l==="proxy3"?void 0:k.tcpport||rr.tcpport,udpport:l==="proxy4"?void 0:k.udpport||rr.udpport,username:b,password:V,forceturn:l!=="proxy4",security:l==="proxy5"}));v.push(...P)}return e.turnServer={mode:"manual",servers:v},I.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),_}async function I2(e,t,i,o,a){let l=$("ACCOUNT_REGISTER").slice(0,$("AJAX_REQUEST_CONCURRENT")),u=[];u=t.proxyServer?l.map(m=>"https://".concat(t.proxyServer,"/ap/?url=").concat(m+"/api/v1")):l.map(m=>"https://".concat(m,"/api/v1"));let f=a==null?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:u});try{let m=await async function(_,v,S,C,b){let V=Date.now(),P={sid:S.sid,opid:10,appid:S.appId,string_uid:v},k=_[0],F=await oc(()=>lc(k+"".concat(k.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(H,ie)=>{if(H.code===0){if(H.uid<=0||H.uid>=Math.pow(2,32))throw I.error("Invalid Uint Uid ".concat(v," => ").concat(H.uid),H),Ge.reqUserAccount(P.sid,{lts:V,success:!1,serverAddr:k,stringUid:P.string_uid,uid:H.uid,errorCode:W.INVALID_UINT_UID_FROM_STRING_UID,extend:P}),new se(W.INVALID_UINT_UID_FROM_STRING_UID);return Ge.reqUserAccount(P.sid,{lts:V,success:!0,serverAddr:k,stringUid:P.string_uid,uid:H.uid,errorCode:null,extend:P}),!1}let oe=fm(H.code);return oe.retry&&(k=_[(ie+1)%_.length]),Ge.reqUserAccount(P.sid,{lts:V,success:!1,serverAddr:k,stringUid:P.string_uid,uid:H.uid,errorCode:oe.desc,extend:P}),oe.retry},(H,ie)=>H.code!==W.OPERATION_ABORTED&&(Ge.reqUserAccount(P.sid,{lts:V,success:!1,serverAddr:k,stringUid:P.string_uid,uid:null,errorCode:H.code,extend:P}),k=_[(ie+1)%_.length],!0),b);if(F.code!==0){let H=fm(F.code);throw new se(W.UNEXPECTED_RESPONSE,H.desc)}return F}(u,e,t,i,o);return a==null||a.recordJoinChannelService({status:"success",endTs:Date.now()},f),m.uid}catch(m){throw a==null||a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[m]},f),m}}async function OQ(e,t,i){let o=$("ACCOUNT_REGISTER"),a=[];a=t.proxyServer?o.map(l=>"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1")):o.map(l=>"https://".concat(l,"/api/v1"));try{return await b2({referenceList:a,asyncMapHandler:l=>async function(u,f,m,_){let v=Date.now(),S={sid:m.sid,opid:10,appid:m.appId,string_uid:f};try{let C=await lc(u+"".concat(u.indexOf("?")===-1?"?":"&","action=stringuid"),{data:S,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){let b=fm(C.code);throw new se(W.UNEXPECTED_RESPONSE,"preload sua error:".concat(b.desc),b)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new se(W.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:v,url:u,req:S,uid:C.uid,elapse:Date.now()-v}}catch(C){throw C}}(l,e,t,i),closeFn:l=>l.code===W.OPERATION_ABORTED||l.code===W.UNEXPECTED_RESPONSE&&!l.data.retry})}catch(l){throw l}}async function PQ(e,t,i){let o=$("CDS_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1?action=config")),a=o.map(m=>function(_,v,S,C){let b=Ut(),V={flag:64,cipher_method:0,features:{device:b.name,system:b.os,system_general:navigator.userAgent,vendor:v.appId,version:Ps,cname:v.cname,sid:v.sid,session_id:v.sid,detail:"",proxyServer:v.proxyServer}};return oc(()=>lc(_,{data:V,timeout:1e3,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,P=>P.code!==W.OPERATION_ABORTED,C)}(m,e,t,i)),l=null,u=null,f={};try{l=await gm(a)}catch(m){if(m.code===W.OPERATION_ABORTED)throw m;u=m}if(a.forEach(m=>m.cancel()),Ge.reportApiInvoke(e.sid,{name:ln.REQUEST_CONFIG_DISTRIBUTE,options:{error:u,res:l}}).onSuccess(),l&&l.test_tags)try{f=function(m){if(!m.test_tags)return{};let _=m.test_tags,v=Object.keys(_),S={};return v.forEach(C=>{var b;let V=Rr(b=C.slice(4)).call(b),P=JSON.parse(_[C])[1];S[V]=P}),S}(l)}catch{}return f}async function A2(e,t){let i=$("WEBCS_DOMAIN").concat($("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:H_(),serviceIds:[rn.CHOOSE_SERVER,rn.CLOUD_PROXY_FALLBACK]}));try{return await b2({referenceList:i,asyncMapHandler:o=>async function(a,l,u){let f,{url:m,areaCode:_,serviceIds:v}=a,S=Date.now(),[C,b]=IR(l,_,v),V=ji.networkState;try{V&&ji.networkState===Ur.OFFLINE&&ji.onlineWaiter&&await De.race([ji.onlineWaiter,Nn(nn.maxRetryTimeout)]),V=ji.networkState;let{data:P,headers:k}=await lc(m,{data:C,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=k.http3==="1"?1:-1,(ie=>{let oe=[];if(ie.response_body.forEach(ae=>{let he=ae.buffer.code;if(ae.uri===23&&he===0&&!ae.buffer.edges_services)if(ae.buffer.flag===4194310)ae.buffer.edges_services=[];else{let Ee={error:new se(W.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ie.detail[502]}),flag:ae.buffer.flag};oe.push(Ee)}if(he!==0){let Ee=fm(he),ye={error:new se(W.CAN_NOT_GET_GATEWAY_SERVER,Ee.desc,{desc:Ee.desc,retry:Ee.retry,csIp:ie.detail[502]}),flag:ae.buffer.flag};ae.buffer.flag===4194310?I.warning(ye.error.toString()):oe.push(ye)}}),oe.length)throw new se(W.CAN_NOT_GET_GATEWAY_SERVER,oe.map(ae=>"flag: ".concat(ae.flag,", message: ").concat(ae.error.message)).join(" | "),{retry:!!oe.find(ae=>ae.error.data.retry),csIp:ie.detail[502],desc:[...new Set(oe.map(ae=>{var he;return ae==null||(he=ae.error)===null||he===void 0||(he=he.data)===null||he===void 0?void 0:he.desc}).filter(ae=>!!ae))]})})(P);let F=z_(P,rn.CHOOSE_SERVER),H=z_(P,rn.CLOUD_PROXY_FALLBACK);return RR(F),{gatewayInfo:_R(F,m),proxyInfo:H,opid:b,requestTime:S,url:m,isHttp3:f,elapse:Date.now()-S}}catch(P){throw P}}(o,e,t),closeFn:o=>o.code===W.OPERATION_ABORTED||o.code===W.CAN_NOT_GET_GATEWAY_SERVER&&!o.data.retry})}catch(o){throw o}}async function O2(e,t,i,o){let a=$("PROXY_SERVER_TYPE3"),l=(b,V,P)=>{let k=P||a;return Array.isArray(k)&&(k=V%2==0?a[1]:a[0]),"https://".concat(k,"/ap/?url=").concat(b)},u=null,f=[],m=async()=>{let b=$("WEBCS_DOMAIN").slice(0,$("AJAX_REQUEST_CONCURRENT")).map((k,F)=>{let H;return H=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(k,"/api/v2/transpond/webrtc?v=2"),F,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):l("".concat(k,"/api/v2/transpond/webrtc?v=2"),F),{url:H,areaCode:H_(),serviceIds:[rn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?rn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?rn.CLOUD_PROXY:rn.CLOUD_PROXY_FALLBACK]}}),V=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),P=await G_({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(I.debug("[".concat(e.clientId,"] Connect to choose_server:"),k.url),w2(k,e,t,i)),allFailedhandler:k=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},V),k[0]},promisesCollector:f});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},V),P},_=async()=>{if(await Nn(1e3),u!==null)return u;let b=$("WEBCS_DOMAIN_BACKUP_LIST").map((k,F)=>{let H;return H=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(k,"/api/v2/transpond/webrtc?v=2"),F,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(k,"/api/v2/transpond/webrtc?v=2"):l("".concat(k,"/api/v2/transpond/webrtc?v=2"),F),{url:H,areaCode:H_(),serviceIds:[rn.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?rn.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?rn.CLOUD_PROXY:rn.CLOUD_PROXY_FALLBACK]}}),V=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:b.map(k=>k.url)}),P=await G_({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:k=>(I.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),k.url),w2(k,e,t,i)),allFailedhandler:k=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:k},V),k[0]},promisesCollector:f});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},V),P},v,S,C;try{({gatewayInfo:v,proxyInfo:S,url:C}=await gm([m(),_()]))}catch(b){throw b[0]}if(f.length&&f.forEach(b=>b.cancel&&typeof b.cancel=="function"&&b.cancel()),!v||!S)throw new se(W.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=C,e.cloudProxyServer!=="disabled"&&Array.isArray(a)&&C){let b=/^https?:\/\/(.+?)(\/.*)?$/.exec(C)[1];ke(a).call(a,b)&&(e.proxyServer=b,I.setProxyServer(b),Ge.setProxyServer(b))}return u={gatewayInfo:v,proxyInfo:await f2(S,v.uid)},u}async function P2(e,t,i,o){let a=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(l=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap"));return await RQ(a,e,t,i,o)}async function NQ(e,t,i){let o=$("UAP_AP").slice(0,$("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),a=o.map(l=>function(u,f,m,_){let v={command:"convergeAllocateEdge",sid:f.sid,appId:f.appId,token:f.token,ts:Date.now(),version:Ps,cname:f.cname,uid:f.uid.toString(),requestId:bR,seq:bR};bR+=1;let S={service_name:"tele_channel",json_body:JSON.stringify(v)};return oc(async()=>{let C=await lc(u,{data:S,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(C.code!==0){let V=new se(W.UNEXPECTED_RESPONSE,"cross channel ap error, code"+C.code,{retry:!0});throw I.error(V.toString()),V}let b=JSON.parse(C.json_body);if(b.code!==200){let V=new se(W.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(b.code,", reason: ").concat(b.reason));throw I.error(V.toString()),V}if(!b.servers||b.servers.length===0){let V=new se(W.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw I.error(V.toString()),V}return{vid:b.vid,workerToken:b.workerToken,addressList:($("CHANNEL_MEDIA_RELAY_SERVERS")||b.servers).map(V=>"wss://".concat(V.address.replace(/\./g,"-"),".").concat($("WORKER_DOMAIN"),":").concat(V.wss))}},void 0,C=>!!(C.code!==W.OPERATION_ABORTED&&C.code!==W.UNEXPECTED_RESPONSE||C.data&&C.data.retry),_)}(l,e,t,i));try{let l=await gm(a);return a.forEach(u=>u.cancel()),l}catch(l){throw l[0]}}async function xQ(e,t,i){let o=null,a=[],l=async u=>{let f=$(u?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(m=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v2/transpond/webrtc?v=2"):"https://".concat(m,"/api/v2/transpond/webrtc?v=2"));return u&&(await Nn(1e3),o!==null)?o:await G_({fragementLength:$("FRAGEMENT_LENGTH"),referenceList:f,asyncMapHandler:m=>(I.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(u?"backup":""," choose_server:"),m),function(_,v,S,C){let[b]=AQ(v,[rn.CHOOSE_SERVER]),V=ji.networkState;return oc(async()=>{V&&ji.networkState===Ur.OFFLINE&&ji.onlineWaiter&&await De.race([ji.onlineWaiter,Nn(C&&C.maxRetryTimeout||nn.maxRetryTimeout)]),V=ji.networkState;let P=await lc(_,{data:b,cancelToken:S,headers:{"Content-Type":"multipart/form-data;"}},!0);return IQ(P,_)},()=>!1,P=>P.code!==W.OPERATION_ABORTED&&(P.code===W.UPDATE_TICKET_FAILED?P.data.retry:(I.warning("[".concat(v.clientId,"] update ticket network error, retry"),P),!0)),C)}(m,e,t,i)),allFailedhandler:m=>{throw m[0]},promisesCollector:a})};try{return o=await gm([l(!1),l(!0)]),a.length&&a.forEach(u=>u.cancel&&typeof u.cancel=="function"&&u.cancel()),o}catch(u){throw u[0]}}function N2(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function x2(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?N2(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):N2(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class DQ extends Ii{get isSuccess(){return!!this.configs}constructor(){super(),U(this,"configs",void 0),U(this,"joinInfo",void 0),U(this,"cancelToken",void 0),U(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),U(this,"interval",void 0),U(this,"mutex",new jn("config-distribute")),U(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,i){this.joinInfo=t,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),$("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},$("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ge.reportApiInvoke(null,{options:void 0,name:ln.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Ui.TRACER}).onSuccess(JSON.stringify(cu))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void I.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,i=await this.mutex.lock();try{t=await PQ(this.joinInfo,this.cancelToken,this.retryConfig),I.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(o){let a=new se(W.NETWORK_RESPONSE_ERROR,o);I.warning("[config-distribute] ".concat(a.toString()))}finally{i()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var i;(i=t)&&i.uplink&&i.id&&i.uplink.max_bitrate!==void 0&&i.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(mR.UPDATE_BITRATE_LIMIT,t):this.emit(mR.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&x2({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var i;let o=v_(i=Object.keys(t).filter(l=>/^webrtc_ng_global_parameter/.test(l))).call(i);for(let l=0;l<o.length;l++)for(let u=o.length-1;u>l;u--){let f=o[u];if(typeof t[f].__priority=="number"){let m=t[f].__priority,_=o[u-1];if(typeof t[_].__priority=="number"){if(!(m>t[_].__priority))continue;{let v=f;o[u]=o[u-1],o[u-1]=v}}else{let v=f;o[u]=o[u-1],o[u-1]=v}}}let a={};o.forEach(l=>{let u=t[l],f=u.__expires;Object.keys(u).forEach(m=>{m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(a,m)||(a[m]=x2({value:u[m]},f&&{expires:f}))})});try{(function(f){try{let m=Date.now();Object.keys(f).forEach(_=>{switch(_){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(vn,_)){let{value:v,expires:S}=f[_];if(S&&S<=m)return;cu[_]=v,vn[_]=v,I.debug("Update global parameters from config distribute",_,v)}}})}catch(m){I.error("Error update config immediately: ".concat(f),m.message)}})(a);let l=JSON.stringify(a),u=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",u),I.debug("Caching global parameters ".concat(l))}catch(l){I.error("Error caching global parameters:",l.message)}}}var ma,kQ=d(ZM),D2=yt,LQ=D,MQ=Je,UQ=p,OR=Zv,jQ=Ht,VQ=Ie,FQ=mr,BQ=gn,_m=Object.assign,k2=Object.defineProperty,WQ=LQ([].concat),zQ=!_m||UQ(function(){if(D2&&_m({b:1},_m(k2({},"a",{enumerable:!0,get:function(){k2(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(a){t[a]=a}),_m({},e)[i]!=7||OR(_m({},t)).join("")!=o})?function(e,t){for(var i=FQ(e),o=arguments.length,a=1,l=jQ.f,u=VQ.f;o>a;)for(var f,m=BQ(arguments[a++]),_=l?WQ(OR(m),l(m)):OR(m),v=_.length,S=0;v>S;)f=_[S++],D2&&!MQ(u,m,f)||(i[f]=m[f]);return i}:_m,HQ=gr,GQ=ux,KQ=ra,qQ=Je,YQ=mr,$Q=function(e,t,i,o){try{return o?t(HQ(i)[0],i[1]):t(i)}catch(a){GQ(e,"throw",a)}},XQ=cx,JQ=dy,ZQ=Jr,L2=wy,QQ=qw,eee=ty,M2=Array,pp=D,PR=2147483647,tee=/[^\0-\u007E]/,U2=/[.\u3002\uFF0E\uFF61]/g,j2="Overflow: input needs wider integers to process",V2=RangeError,iee=pp(U2.exec),Em=Math.floor,NR=String.fromCharCode,F2=pp("".charCodeAt),B2=pp([].join),fu=pp([].push),nee=pp("".replace),ree=pp("".split),oee=pp("".toLowerCase),W2=function(e){return e+22+75*(e<26)},see=function(e,t,i){var o=0;for(e=i?Em(e/700):e>>1,e+=Em(e/t);e>455;)e=Em(e/35),o+=36;return Em(o+36*e/(e+38))},aee=function(e){var t=[];e=function(F){for(var H=[],ie=0,oe=F.length;ie<oe;){var ae=F2(F,ie++);if(ae>=55296&&ae<=56319&&ie<oe){var he=F2(F,ie++);(64512&he)==56320?fu(H,((1023&ae)<<10)+(1023&he)+65536):(fu(H,ae),ie--)}else fu(H,ae)}return H}(e);var i,o,a=e.length,l=128,u=0,f=72;for(i=0;i<e.length;i++)(o=e[i])<128&&fu(t,NR(o));var m=t.length,_=m;for(m&&fu(t,"-");_<a;){var v=PR;for(i=0;i<e.length;i++)(o=e[i])>=l&&o<v&&(v=o);var S=_+1;if(v-l>Em((PR-u)/S))throw V2(j2);for(u+=(v-l)*S,l=v,i=0;i<e.length;i++){if((o=e[i])<l&&++u>PR)throw V2(j2);if(o==l){for(var C=u,b=36;;){var V=b<=f?1:b>=f+26?26:b-f;if(C<V)break;var P=C-V,k=36-V;fu(t,NR(W2(V+P%k))),C=Em(P/k),b+=36}fu(t,NR(W2(C))),f=see(u,S,_==m),u=0,_++}}u++,l++}return B2(t,"")},cee=qt,xR=yt,lee=Sb,DR=J,z2=ra,ga=D,m0=Jd,_a=ly,dee=sC,kR=An,LR=zQ,vm=function(e){var t=YQ(e),i=JQ(this),o=arguments.length,a=o>1?arguments[1]:void 0,l=a!==void 0;l&&(a=KQ(a,o>2?arguments[2]:void 0));var u,f,m,_,v,S,C=eee(t),b=0;if(!C||this===M2&&XQ(C))for(u=ZQ(t),f=i?new this(u):M2(u);u>b;b++)S=l?a(t[b],b):t[b],L2(f,b,S);else for(v=(_=QQ(t,C)).next,f=i?new this:[];!(m=qQ(v,_)).done;b++)S=l?$Q(_,a,[m.value,b],!0):m.value,L2(f,b,S);return f.length=b,f},dc=$C,uee=UC.codeAt,hee=function(e){var t,i,o=[],a=ree(nee(oee(e),U2,"."),".");for(t=0;t<a.length;t++)i=a[t],fu(o,iee(tee,i)?"xn--"+aee(i):i);return B2(o,".")},Xl=_r,pee=Zd,fee=uy,H2=vJ,G2=Zh,mee=G2.set,g0=G2.getterFor("URL"),gee=H2.URLSearchParams,_ee=H2.getState,K_=DR.URL,MR=DR.TypeError,_0=DR.parseInt,Eee=Math.floor,K2=Math.pow,Ea=ga("".charAt),uc=ga(/./.exec),q_=ga([].join),vee=ga(1 .toString),yee=ga([].pop),ym=ga([].push),UR=ga("".replace),See=ga([].shift),Tee=ga("".split),Y_=ga("".slice),E0=ga("".toLowerCase),wee=ga([].unshift),jR="Invalid scheme",$_="Invalid host",q2="Invalid port",Y2=/[a-z]/i,Cee=/[\d+-.a-z]/i,VR=/\d/,bee=/^0x/i,Ree=/^[0-7]+$/,Iee=/^\d+$/,$2=/^[\da-f]+$/i,Aee=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Oee=/[\0\t\n\r #/:<>?@[\\\]^|]/,Pee=/^[\u0000-\u0020]+/,Nee=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,xee=/[\t\n\r]/g,X_=function(e){var t,i,o,a;if(typeof e=="number"){for(t=[],i=0;i<4;i++)wee(t,e%256),e=Eee(e/256);return q_(t,".")}if(typeof e=="object"){for(t="",o=function(l){for(var u=null,f=1,m=null,_=0,v=0;v<8;v++)l[v]!==0?(_>f&&(u=m,f=_),m=null,_=0):(m===null&&(m=v),++_);return _>f&&(u=m,f=_),u}(e),i=0;i<8;i++)a&&e[i]===0||(a&&(a=!1),o===i?(t+=i?":":"::",a=!0):(t+=vee(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},v0={},X2=LR({},v0,{" ":1,'"':1,"<":1,">":1,"`":1}),J2=LR({},X2,{"#":1,"?":1,"{":1,"}":1}),FR=LR({},J2,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),mu=function(e,t){var i=uee(e,0);return i>32&&i<127&&!kR(t,e)?e:encodeURIComponent(e)},y0={ftp:21,file:null,http:80,https:443,ws:80,wss:443},J_=function(e,t){var i;return e.length==2&&uc(Y2,Ea(e,0))&&((i=Ea(e,1))==":"||!t&&i=="|")},Z2=function(e){var t;return e.length>1&&J_(Y_(e,0,2))&&(e.length==2||(t=Ea(e,2))==="/"||t==="\\"||t==="?"||t==="#")},Dee=function(e){return e==="."||E0(e)==="%2e"},BR={},Q2={},WR={},eU={},tU={},zR={},iU={},nU={},S0={},T0={},HR={},GR={},KR={},qR={},rU={},YR={},Sm={},Qc={},oU={},fp={},Jl={},$R=function(e,t,i){var o,a,l,u=Xl(e);if(t){if(a=this.parse(u))throw MR(a);this.searchParams=null}else{if(i!==void 0&&(o=new $R(i,!0)),a=this.parse(u,null,o))throw MR(a);(l=_ee(new gee)).bindURL(this),this.searchParams=l}};$R.prototype={type:"URL",parse:function(e,t,i){var o,a,l,u,f,m=this,_=t||BR,v=0,S="",C=!1,b=!1,V=!1;for(e=Xl(e),t||(m.scheme="",m.username="",m.password="",m.host=null,m.port=null,m.path=[],m.query=null,m.fragment=null,m.cannotBeABaseURL=!1,e=UR(e,Pee,""),e=UR(e,Nee,"$1")),e=UR(e,xee,""),o=vm(e);v<=o.length;){switch(a=o[v],_){case BR:if(!a||!uc(Y2,a)){if(t)return jR;_=WR;continue}S+=E0(a),_=Q2;break;case Q2:if(a&&(uc(Cee,a)||a=="+"||a=="-"||a=="."))S+=E0(a);else{if(a!=":"){if(t)return jR;S="",_=WR,v=0;continue}if(t&&(m.isSpecial()!=kR(y0,S)||S=="file"&&(m.includesCredentials()||m.port!==null)||m.scheme=="file"&&!m.host))return;if(m.scheme=S,t)return void(m.isSpecial()&&y0[m.scheme]==m.port&&(m.port=null));S="",m.scheme=="file"?_=qR:m.isSpecial()&&i&&i.scheme==m.scheme?_=eU:m.isSpecial()?_=nU:o[v+1]=="/"?(_=tU,v++):(m.cannotBeABaseURL=!0,ym(m.path,""),_=oU)}break;case WR:if(!i||i.cannotBeABaseURL&&a!="#")return jR;if(i.cannotBeABaseURL&&a=="#"){m.scheme=i.scheme,m.path=dc(i.path),m.query=i.query,m.fragment="",m.cannotBeABaseURL=!0,_=Jl;break}_=i.scheme=="file"?qR:zR;continue;case eU:if(a!="/"||o[v+1]!="/"){_=zR;continue}_=S0,v++;break;case tU:if(a=="/"){_=T0;break}_=Qc;continue;case zR:if(m.scheme=i.scheme,a==ma)m.username=i.username,m.password=i.password,m.host=i.host,m.port=i.port,m.path=dc(i.path),m.query=i.query;else if(a=="/"||a=="\\"&&m.isSpecial())_=iU;else if(a=="?")m.username=i.username,m.password=i.password,m.host=i.host,m.port=i.port,m.path=dc(i.path),m.query="",_=fp;else{if(a!="#"){m.username=i.username,m.password=i.password,m.host=i.host,m.port=i.port,m.path=dc(i.path),m.path.length--,_=Qc;continue}m.username=i.username,m.password=i.password,m.host=i.host,m.port=i.port,m.path=dc(i.path),m.query=i.query,m.fragment="",_=Jl}break;case iU:if(!m.isSpecial()||a!="/"&&a!="\\"){if(a!="/"){m.username=i.username,m.password=i.password,m.host=i.host,m.port=i.port,_=Qc;continue}_=T0}else _=S0;break;case nU:if(_=S0,a!="/"||Ea(S,v+1)!="/")continue;v++;break;case S0:if(a!="/"&&a!="\\"){_=T0;continue}break;case T0:if(a=="@"){C&&(S="%40"+S),C=!0,l=vm(S);for(var P=0;P<l.length;P++){var k=l[P];if(k!=":"||V){var F=mu(k,FR);V?m.password+=F:m.username+=F}else V=!0}S=""}else if(a==ma||a=="/"||a=="?"||a=="#"||a=="\\"&&m.isSpecial()){if(C&&S=="")return"Invalid authority";v-=vm(S).length+1,S="",_=HR}else S+=a;break;case HR:case GR:if(t&&m.scheme=="file"){_=YR;continue}if(a!=":"||b){if(a==ma||a=="/"||a=="?"||a=="#"||a=="\\"&&m.isSpecial()){if(m.isSpecial()&&S=="")return $_;if(t&&S==""&&(m.includesCredentials()||m.port!==null))return;if(u=m.parseHost(S))return u;if(S="",_=Sm,t)return;continue}a=="["?b=!0:a=="]"&&(b=!1),S+=a}else{if(S=="")return $_;if(u=m.parseHost(S))return u;if(S="",_=KR,t==GR)return}break;case KR:if(!uc(VR,a)){if(a==ma||a=="/"||a=="?"||a=="#"||a=="\\"&&m.isSpecial()||t){if(S!=""){var H=_0(S,10);if(H>65535)return q2;m.port=m.isSpecial()&&H===y0[m.scheme]?null:H,S=""}if(t)return;_=Sm;continue}return q2}S+=a;break;case qR:if(m.scheme="file",a=="/"||a=="\\")_=rU;else{if(!i||i.scheme!="file"){_=Qc;continue}if(a==ma)m.host=i.host,m.path=dc(i.path),m.query=i.query;else if(a=="?")m.host=i.host,m.path=dc(i.path),m.query="",_=fp;else{if(a!="#"){Z2(q_(dc(o,v),""))||(m.host=i.host,m.path=dc(i.path),m.shortenPath()),_=Qc;continue}m.host=i.host,m.path=dc(i.path),m.query=i.query,m.fragment="",_=Jl}}break;case rU:if(a=="/"||a=="\\"){_=YR;break}i&&i.scheme=="file"&&!Z2(q_(dc(o,v),""))&&(J_(i.path[0],!0)?ym(m.path,i.path[0]):m.host=i.host),_=Qc;continue;case YR:if(a==ma||a=="/"||a=="\\"||a=="?"||a=="#"){if(!t&&J_(S))_=Qc;else if(S==""){if(m.host="",t)return;_=Sm}else{if(u=m.parseHost(S))return u;if(m.host=="localhost"&&(m.host=""),t)return;S="",_=Sm}continue}S+=a;break;case Sm:if(m.isSpecial()){if(_=Qc,a!="/"&&a!="\\")continue}else if(t||a!="?")if(t||a!="#"){if(a!=ma&&(_=Qc,a!="/"))continue}else m.fragment="",_=Jl;else m.query="",_=fp;break;case Qc:if(a==ma||a=="/"||a=="\\"&&m.isSpecial()||!t&&(a=="?"||a=="#")){if((f=E0(f=S))===".."||f==="%2e."||f===".%2e"||f==="%2e%2e"?(m.shortenPath(),a=="/"||a=="\\"&&m.isSpecial()||ym(m.path,"")):Dee(S)?a=="/"||a=="\\"&&m.isSpecial()||ym(m.path,""):(m.scheme=="file"&&!m.path.length&&J_(S)&&(m.host&&(m.host=""),S=Ea(S,0)+":"),ym(m.path,S)),S="",m.scheme=="file"&&(a==ma||a=="?"||a=="#"))for(;m.path.length>1&&m.path[0]==="";)See(m.path);a=="?"?(m.query="",_=fp):a=="#"&&(m.fragment="",_=Jl)}else S+=mu(a,J2);break;case oU:a=="?"?(m.query="",_=fp):a=="#"?(m.fragment="",_=Jl):a!=ma&&(m.path[0]+=mu(a,v0));break;case fp:t||a!="#"?a!=ma&&(a=="'"&&m.isSpecial()?m.query+="%27":m.query+=a=="#"?"%23":mu(a,v0)):(m.fragment="",_=Jl);break;case Jl:a!=ma&&(m.fragment+=mu(a,X2))}v++}},parseHost:function(e){var t,i,o;if(Ea(e,0)=="["){if(Ea(e,e.length-1)!="]"||(t=function(a){var l,u,f,m,_,v,S,C=[0,0,0,0,0,0,0,0],b=0,V=null,P=0,k=function(){return Ea(a,P)};if(k()==":"){if(Ea(a,1)!=":")return;P+=2,V=++b}for(;k();){if(b==8)return;if(k()!=":"){for(l=u=0;u<4&&uc($2,k());)l=16*l+_0(k(),16),P++,u++;if(k()=="."){if(u==0||(P-=u,b>6))return;for(f=0;k();){if(m=null,f>0){if(!(k()=="."&&f<4))return;P++}if(!uc(VR,k()))return;for(;uc(VR,k());){if(_=_0(k(),10),m===null)m=_;else{if(m==0)return;m=10*m+_}if(m>255)return;P++}C[b]=256*C[b]+m,++f!=2&&f!=4||b++}if(f!=4)return;break}if(k()==":"){if(P++,!k())return}else if(k())return;C[b++]=l}else{if(V!==null)return;P++,V=++b}}if(V!==null)for(v=b-V,b=7;b!=0&&v>0;)S=C[b],C[b--]=C[V+v-1],C[V+--v]=S;else if(b!=8)return;return C}(Y_(e,1,-1)),!t))return $_;this.host=t}else if(this.isSpecial()){if(e=hee(e),uc(Aee,e)||(t=function(a){var l,u,f,m,_,v,S,C=Tee(a,".");if(C.length&&C[C.length-1]==""&&C.length--,(l=C.length)>4)return a;for(u=[],f=0;f<l;f++){if((m=C[f])=="")return a;if(_=10,m.length>1&&Ea(m,0)=="0"&&(_=uc(bee,m)?16:8,m=Y_(m,_==8?1:2)),m==="")v=0;else{if(!uc(_==10?Iee:_==8?Ree:$2,m))return a;v=_0(m,_)}ym(u,v)}for(f=0;f<l;f++)if(v=u[f],f==l-1){if(v>=K2(256,5-l))return null}else if(v>255)return null;for(S=yee(u),f=0;f<u.length;f++)S+=u[f]*K2(256,3-f);return S}(e),t===null))return $_;this.host=t}else{if(uc(Oee,e))return $_;for(t="",i=vm(e),o=0;o<i.length;o++)t+=mu(i[o],v0);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return kR(y0,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&J_(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,o=e.password,a=e.host,l=e.port,u=e.path,f=e.query,m=e.fragment,_=t+":";return a!==null?(_+="//",e.includesCredentials()&&(_+=i+(o?":"+o:"")+"@"),_+=X_(a),l!==null&&(_+=":"+l)):t=="file"&&(_+="//"),_+=e.cannotBeABaseURL?u[0]:u.length?"/"+q_(u,"/"):"",f!==null&&(_+="?"+f),m!==null&&(_+="#"+m),_},setHref:function(e){var t=this.parse(e);if(t)throw MR(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Tm(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+X_(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Xl(e)+":",BR)},getUsername:function(){return this.username},setUsername:function(e){var t=vm(Xl(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=mu(t[i],FR)}},getPassword:function(){return this.password},setPassword:function(e){var t=vm(Xl(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=mu(t[i],FR)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?X_(e):X_(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,HR)},getHostname:function(){var e=this.host;return e===null?"":X_(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,GR)},getPort:function(){var e=this.port;return e===null?"":Xl(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Xl(e))==""?this.port=null:this.parse(e,KR))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+q_(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Sm))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Xl(e))==""?this.query=null:(Ea(e,0)=="?"&&(e=Y_(e,1)),this.query="",this.parse(e,fp)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Xl(e))!=""?(Ea(e,0)=="#"&&(e=Y_(e,1)),this.fragment="",this.parse(e,Jl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Tm=function(e){var t=dee(this,Fo),i=fee(arguments.length,1)>1?arguments[1]:void 0,o=mee(t,new $R(e,!1,i));xR||(t.href=o.serialize(),t.origin=o.getOrigin(),t.protocol=o.getProtocol(),t.username=o.getUsername(),t.password=o.getPassword(),t.host=o.getHost(),t.hostname=o.getHostname(),t.port=o.getPort(),t.pathname=o.getPathname(),t.search=o.getSearch(),t.searchParams=o.getSearchParams(),t.hash=o.getHash())},Fo=Tm.prototype,va=function(e,t){return{get:function(){return g0(this)[e]()},set:t&&function(i){return g0(this)[t](i)},configurable:!0,enumerable:!0}};if(xR&&(_a(Fo,"href",va("serialize","setHref")),_a(Fo,"origin",va("getOrigin")),_a(Fo,"protocol",va("getProtocol","setProtocol")),_a(Fo,"username",va("getUsername","setUsername")),_a(Fo,"password",va("getPassword","setPassword")),_a(Fo,"host",va("getHost","setHost")),_a(Fo,"hostname",va("getHostname","setHostname")),_a(Fo,"port",va("getPort","setPort")),_a(Fo,"pathname",va("getPathname","setPathname")),_a(Fo,"search",va("getSearch","setSearch")),_a(Fo,"searchParams",va("getSearchParams")),_a(Fo,"hash",va("getHash","setHash"))),m0(Fo,"toJSON",function(){return g0(this).serialize()},{enumerable:!0}),m0(Fo,"toString",function(){return g0(this).serialize()},{enumerable:!0}),K_){var sU=K_.createObjectURL,aU=K_.revokeObjectURL;sU&&m0(Tm,"createObjectURL",z2(sU,K_)),aU&&m0(Tm,"revokeObjectURL",z2(aU,K_))}pee(Tm,"URL"),cee({global:!0,constructor:!0,forced:!lee,sham:!xR},{URL:Tm});var kee=qt,Lee=p,Mee=uy,cU=_r,Uee=Sb,lU=lr("URL");kee({target:"URL",stat:!0,forced:!(Uee&&Lee(function(){lU.canParse()}))},{canParse:function(e){var t=Mee(arguments.length,1),i=cU(e),o=t<2||arguments[1]===void 0?void 0:cU(arguments[1]);try{return!!new lU(i,o)}catch{return!1}}});var dU=d(Zt.URL),jee=B,Vee=jL,uU=RegExp.prototype,Fee=function(e){return e===uU||jee(uU,e)?Vee(e):e.flags},Ar=d(Fee);function wm(e){let t=e.length;for(;--t>=0;)e[t]=0}let XR=256,hU=286,Z_=30,Q_=15,JR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w0=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Bee=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),pU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Zl=new Array(576);wm(Zl);let eE=new Array(60);wm(eE);let tE=new Array(512);wm(tE);let iE=new Array(256);wm(iE);let ZR=new Array(29);wm(ZR);let C0=new Array(Z_);function QR(e,t,i,o,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=o,this.max_length=a,this.has_stree=e&&e.length}let fU,mU,gU;function eI(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}wm(C0);let _U=e=>e<256?tE[e]:tE[256+(e>>>7)],nE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ls=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,nE(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},el=(e,t,i)=>{ls(e,i[2*t],i[2*t+1])},EU=(e,t)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--t>0);return i>>>1},vU=(e,t,i)=>{let o=new Array(16),a,l,u=0;for(a=1;a<=Q_;a++)u=u+i[a-1]<<1,o[a]=u;for(l=0;l<=t;l++){let f=e[2*l+1];f!==0&&(e[2*l]=EU(o[f]++,f))}},yU=e=>{let t;for(t=0;t<hU;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Z_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},SU=e=>{e.bi_valid>8?nE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},TU=(e,t,i,o)=>{let a=2*t,l=2*i;return e[a]<e[l]||e[a]===e[l]&&o[t]<=o[i]},tI=(e,t,i)=>{let o=e.heap[i],a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&TU(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!TU(t,o,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=o},wU=(e,t,i)=>{let o,a,l,u,f=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+f++],o+=(255&e.pending_buf[e.sym_buf+f++])<<8,a=e.pending_buf[e.sym_buf+f++],o===0?el(e,a,t):(l=iE[a],el(e,l+XR+1,t),u=JR[l],u!==0&&(a-=ZR[l],ls(e,a,u)),o--,l=_U(o),el(e,l,i),u=w0[l],u!==0&&(o-=C0[l],ls(e,o,u)));while(f<e.sym_next);el(e,256,t)},iI=(e,t)=>{let i=t.dyn_tree,o=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,u,f,m,_=-1;for(e.heap_len=0,e.heap_max=573,u=0;u<l;u++)i[2*u]!==0?(e.heap[++e.heap_len]=_=u,e.depth[u]=0):i[2*u+1]=0;for(;e.heap_len<2;)m=e.heap[++e.heap_len]=_<2?++_:0,i[2*m]=1,e.depth[m]=0,e.opt_len--,a&&(e.static_len-=o[2*m+1]);for(t.max_code=_,u=e.heap_len>>1;u>=1;u--)tI(e,i,u);m=l;do u=e.heap[1],e.heap[1]=e.heap[e.heap_len--],tI(e,i,1),f=e.heap[1],e.heap[--e.heap_max]=u,e.heap[--e.heap_max]=f,i[2*m]=i[2*u]+i[2*f],e.depth[m]=(e.depth[u]>=e.depth[f]?e.depth[u]:e.depth[f])+1,i[2*u+1]=i[2*f+1]=m,e.heap[1]=m++,tI(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((v,S)=>{let C=S.dyn_tree,b=S.max_code,V=S.stat_desc.static_tree,P=S.stat_desc.has_stree,k=S.stat_desc.extra_bits,F=S.stat_desc.extra_base,H=S.stat_desc.max_length,ie,oe,ae,he,Ee,ye,Ce=0;for(he=0;he<=Q_;he++)v.bl_count[he]=0;for(C[2*v.heap[v.heap_max]+1]=0,ie=v.heap_max+1;ie<573;ie++)oe=v.heap[ie],he=C[2*C[2*oe+1]+1]+1,he>H&&(he=H,Ce++),C[2*oe+1]=he,oe>b||(v.bl_count[he]++,Ee=0,oe>=F&&(Ee=k[oe-F]),ye=C[2*oe],v.opt_len+=ye*(he+Ee),P&&(v.static_len+=ye*(V[2*oe+1]+Ee)));if(Ce!==0){do{for(he=H-1;v.bl_count[he]===0;)he--;v.bl_count[he]--,v.bl_count[he+1]+=2,v.bl_count[H]--,Ce-=2}while(Ce>0);for(he=H;he!==0;he--)for(oe=v.bl_count[he];oe!==0;)ae=v.heap[--ie],ae>b||(C[2*ae+1]!==he&&(v.opt_len+=(he-C[2*ae+1])*C[2*ae],C[2*ae+1]=he),oe--)}})(e,t),vU(i,_,e.bl_count)},CU=(e,t,i)=>{let o,a,l=-1,u=t[1],f=0,m=7,_=4;for(u===0&&(m=138,_=3),t[2*(i+1)+1]=65535,o=0;o<=i;o++)a=u,u=t[2*(o+1)+1],++f<m&&a===u||(f<_?e.bl_tree[2*a]+=f:a!==0?(a!==l&&e.bl_tree[2*a]++,e.bl_tree[32]++):f<=10?e.bl_tree[34]++:e.bl_tree[36]++,f=0,l=a,u===0?(m=138,_=3):a===u?(m=6,_=3):(m=7,_=4))},bU=(e,t,i)=>{let o,a,l=-1,u=t[1],f=0,m=7,_=4;for(u===0&&(m=138,_=3),o=0;o<=i;o++)if(a=u,u=t[2*(o+1)+1],!(++f<m&&a===u)){if(f<_)do el(e,a,e.bl_tree);while(--f!=0);else a!==0?(a!==l&&(el(e,a,e.bl_tree),f--),el(e,16,e.bl_tree),ls(e,f-3,2)):f<=10?(el(e,17,e.bl_tree),ls(e,f-3,3)):(el(e,18,e.bl_tree),ls(e,f-11,7));f=0,l=a,u===0?(m=138,_=3):a===u?(m=6,_=3):(m=7,_=4)}},RU=!1,IU=(e,t,i,o)=>{ls(e,0+(o?1:0),3),SU(e),nE(e,i),nE(e,~i),i&&e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i};var Wee=e=>{RU||((()=>{let t,i,o,a,l,u=new Array(16);for(o=0,a=0;a<28;a++)for(ZR[a]=o,t=0;t<1<<JR[a];t++)iE[o++]=a;for(iE[o-1]=a,l=0,a=0;a<16;a++)for(C0[a]=l,t=0;t<1<<w0[a];t++)tE[l++]=a;for(l>>=7;a<Z_;a++)for(C0[a]=l<<7,t=0;t<1<<w0[a]-7;t++)tE[256+l++]=a;for(i=0;i<=Q_;i++)u[i]=0;for(t=0;t<=143;)Zl[2*t+1]=8,t++,u[8]++;for(;t<=255;)Zl[2*t+1]=9,t++,u[9]++;for(;t<=279;)Zl[2*t+1]=7,t++,u[7]++;for(;t<=287;)Zl[2*t+1]=8,t++,u[8]++;for(vU(Zl,287,u),t=0;t<Z_;t++)eE[2*t+1]=5,eE[2*t]=EU(t,5);fU=new QR(Zl,JR,257,hU,Q_),mU=new QR(eE,w0,0,Z_,Q_),gU=new QR(new Array(0),Bee,0,19,7)})(),RU=!0),e.l_desc=new eI(e.dyn_ltree,fU),e.d_desc=new eI(e.dyn_dtree,mU),e.bl_desc=new eI(e.bl_tree,gU),e.bi_buf=0,e.bi_valid=0,yU(e)},zee=(e,t,i,o)=>{let a,l,u=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(f=>{let m,_=4093624447;for(m=0;m<=31;m++,_>>>=1)if(1&_&&f.dyn_ltree[2*m]!==0)return 0;if(f.dyn_ltree[18]!==0||f.dyn_ltree[20]!==0||f.dyn_ltree[26]!==0)return 1;for(m=32;m<XR;m++)if(f.dyn_ltree[2*m]!==0)return 1;return 0})(e)),iI(e,e.l_desc),iI(e,e.d_desc),u=(f=>{let m;for(CU(f,f.dyn_ltree,f.l_desc.max_code),CU(f,f.dyn_dtree,f.d_desc.max_code),iI(f,f.bl_desc),m=18;m>=3&&f.bl_tree[2*pU[m]+1]===0;m--);return f.opt_len+=3*(m+1)+5+5+4,m})(e),a=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=a&&(a=l)):a=l=i+5,i+4<=a&&t!==-1?IU(e,t,i,o):e.strategy===4||l===a?(ls(e,2+(o?1:0),3),wU(e,Zl,eE)):(ls(e,4+(o?1:0),3),((f,m,_,v)=>{let S;for(ls(f,m-257,5),ls(f,_-1,5),ls(f,v-4,4),S=0;S<v;S++)ls(f,f.bl_tree[2*pU[S]+1],3);bU(f,f.dyn_ltree,m-1),bU(f,f.dyn_dtree,_-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),wU(e,e.dyn_ltree,e.dyn_dtree)),yU(e),o&&SU(e)},Hee=(e,t,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,t===0?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(iE[i]+XR+1)]++,e.dyn_dtree[2*_U(t)]++),e.sym_next===e.sym_end),Gee=e=>{ls(e,2,3),el(e,256,Zl),(t=>{t.bi_valid===16?(nE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},Kee={_tr_init:Wee,_tr_stored_block:IU,_tr_flush_block:zee,_tr_tally:Hee,_tr_align:Gee},rE=(e,t,i,o)=>{let a=65535&e|0,l=e>>>16&65535|0,u=0;for(;i!==0;){u=i>2e3?2e3:i,i-=u;do a=a+t[o++]|0,l=l+a|0;while(--u);a%=65521,l%=65521}return a|l<<16|0};let qee=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());var Br=(e,t,i,o)=>{let a=qee,l=o+i;e^=-1;for(let u=o;u<l;u++)e=e>>>8^a[255&(e^t[u])];return-1^e},mp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Cm={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:Yee,_tr_stored_block:nI,_tr_flush_block:$ee,_tr_tally:gu,_tr_align:Xee}=Kee,{Z_NO_FLUSH:_u,Z_PARTIAL_FLUSH:Jee,Z_FULL_FLUSH:Zee,Z_FINISH:ya,Z_BLOCK:AU,Z_OK:eo,Z_STREAM_END:OU,Z_STREAM_ERROR:tl,Z_DATA_ERROR:Qee,Z_BUF_ERROR:rI,Z_DEFAULT_COMPRESSION:ete,Z_FILTERED:tte,Z_HUFFMAN_ONLY:b0,Z_RLE:ite,Z_FIXED:nte,Z_DEFAULT_STRATEGY:rte,Z_UNKNOWN:ote,Z_DEFLATED:R0}=Cm,oI=286,ste=30,ate=19,cte=2*oI+1,lte=15,gp=258,il=262,bm=42,_p=113,oE=666,Ep=(e,t)=>(e.msg=mp[t],t),PU=e=>2*e-(e>4?9:0),Eu=e=>{let t=e.length;for(;--t>=0;)e[t]=0},dte=e=>{let t,i,o,a=e.w_size;t=e.hash_size,o=t;do i=e.head[--o],e.head[o]=i>=a?i-a:0;while(--t);t=a,o=t;do i=e.prev[--o],e.prev[o]=i>=a?i-a:0;while(--t)},vu=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,Ds=e=>{let t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,t.pending===0&&(t.pending_out=0))},ks=(e,t)=>{$ee(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ds(e.strm)},Hi=(e,t)=>{e.pending_buf[e.pending++]=t},sE=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},sI=(e,t,i,o)=>{let a=e.avail_in;return a>o&&(a=o),a===0?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),e.state.wrap===1?e.adler=rE(e.adler,t,a,i):e.state.wrap===2&&(e.adler=Br(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},NU=(e,t)=>{let i,o,a=e.max_chain_length,l=e.strstart,u=e.prev_length,f=e.nice_match,m=e.strstart>e.w_size-il?e.strstart-(e.w_size-il):0,_=e.window,v=e.w_mask,S=e.prev,C=e.strstart+gp,b=_[l+u-1],V=_[l+u];e.prev_length>=e.good_match&&(a>>=2),f>e.lookahead&&(f=e.lookahead);do if(i=t,_[i+u]===V&&_[i+u-1]===b&&_[i]===_[l]&&_[++i]===_[l+1]){l+=2,i++;do;while(_[++l]===_[++i]&&_[++l]===_[++i]&&_[++l]===_[++i]&&_[++l]===_[++i]&&_[++l]===_[++i]&&_[++l]===_[++i]&&_[++l]===_[++i]&&_[++l]===_[++i]&&l<C);if(o=gp-(C-l),l=C-gp,o>u){if(e.match_start=t,u=o,o>=f)break;b=_[l+u-1],V=_[l+u]}}while((t=S[t&v])>m&&--a!=0);return u<=e.lookahead?u:e.lookahead},Rm=e=>{let t=e.w_size,i,o,a;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-il)&&(e.window.set(e.window.subarray(t,t+t-o),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),dte(e),o+=t),e.strm.avail_in===0)break;if(i=sI(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=vu(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=vu(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<il&&e.strm.avail_in!==0)},xU=(e,t)=>{let i,o,a,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,u=0,f=e.strm.avail_in;do{if(i=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a||(a=e.strm.avail_out-a,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>a&&(i=a),i<l&&(i===0&&t!==ya||t===_u||i!==o+e.strm.avail_in)))break;u=t===ya&&i===o+e.strm.avail_in?1:0,nI(e,0,0,u),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,Ds(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(sI(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(u===0);return f-=e.strm.avail_in,f&&(f>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=f&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-f,e.strm.next_in),e.strstart),e.strstart+=f,e.insert+=f>e.w_size-e.insert?e.w_size-e.insert:f),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),u?4:t!==_u&&t!==ya&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(sI(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,l=a>e.w_size?e.w_size:a,o=e.strstart-e.block_start,(o>=l||(o||t===ya)&&t!==_u&&e.strm.avail_in===0&&o<=a)&&(i=o>a?a:o,u=t===ya&&e.strm.avail_in===0&&i===o?1:0,nI(e,e.block_start,i,u),e.block_start+=i,Ds(e.strm)),u?3:1)},aI=(e,t)=>{let i,o;for(;;){if(e.lookahead<il){if(Rm(e),e.lookahead<il&&t===_u)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=vu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-il&&(e.match_length=NU(e,i)),e.match_length>=3)if(o=gu(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=vu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=vu(e,e.ins_h,e.window[e.strstart+1]);else o=gu(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(ks(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ya?(ks(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(ks(e,!1),e.strm.avail_out===0)?1:2},Im=(e,t)=>{let i,o,a;for(;;){if(e.lookahead<il){if(Rm(e),e.lookahead<il&&t===_u)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=vu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-il&&(e.match_length=NU(e,i),e.match_length<=5&&(e.strategy===tte||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,o=gu(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=a&&(e.ins_h=vu(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(ks(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=gu(e,0,e.window[e.strstart-1]),o&&ks(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=gu(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ya?(ks(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(ks(e,!1),e.strm.avail_out===0)?1:2};function nl(e,t,i,o,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=o,this.func=a}let aE=[new nl(0,0,0,0,xU),new nl(4,4,8,4,aI),new nl(4,5,16,8,aI),new nl(4,6,32,32,aI),new nl(4,4,16,16,Im),new nl(8,16,32,32,Im),new nl(8,16,128,128,Im),new nl(8,32,128,256,Im),new nl(32,128,258,1024,Im),new nl(32,258,258,4096,Im)];function ute(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=R0,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*cte),this.dyn_dtree=new Uint16Array(2*(2*ste+1)),this.bl_tree=new Uint16Array(2*(2*ate+1)),Eu(this.dyn_ltree),Eu(this.dyn_dtree),Eu(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(lte+1),this.heap=new Uint16Array(2*oI+1),Eu(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*oI+1),Eu(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let cE=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==bm&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==_p&&t.status!==oE?1:0},DU=e=>{if(cE(e))return Ep(e,tl);e.total_in=e.total_out=0,e.data_type=ote;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?bm:_p,e.adler=t.wrap===2?0:1,t.last_flush=-2,Yee(t),eo},kU=e=>{let t=DU(e);return t===eo&&(i=>{i.window_size=2*i.w_size,Eu(i.head),i.max_lazy_match=aE[i.level].max_lazy,i.good_match=aE[i.level].good_length,i.nice_match=aE[i.level].nice_length,i.max_chain_length=aE[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),t},LU=(e,t,i,o,a,l)=>{if(!e)return tl;let u=1;if(t===ete&&(t=6),o<0?(u=0,o=-o):o>15&&(u=2,o-=16),a<1||a>9||i!==R0||o<8||o>15||t<0||t>9||l<0||l>nte||o===8&&u!==1)return Ep(e,tl);o===8&&(o=9);let f=new ute;return e.state=f,f.strm=e,f.status=bm,f.wrap=u,f.gzhead=null,f.w_bits=o,f.w_size=1<<f.w_bits,f.w_mask=f.w_size-1,f.hash_bits=a+7,f.hash_size=1<<f.hash_bits,f.hash_mask=f.hash_size-1,f.hash_shift=~~((f.hash_bits+3-1)/3),f.window=new Uint8Array(2*f.w_size),f.head=new Uint16Array(f.hash_size),f.prev=new Uint16Array(f.w_size),f.lit_bufsize=1<<a+6,f.pending_buf_size=4*f.lit_bufsize,f.pending_buf=new Uint8Array(f.pending_buf_size),f.sym_buf=f.lit_bufsize,f.sym_end=3*(f.lit_bufsize-1),f.level=t,f.strategy=l,f.method=i,kU(e)};var hte=(e,t)=>{if(cE(e)||t>AU||t<0)return e?Ep(e,tl):tl;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===oE&&t!==ya)return Ep(e,e.avail_out===0?rI:tl);let o=i.last_flush;if(i.last_flush=t,i.pending!==0){if(Ds(e),e.avail_out===0)return i.last_flush=-1,eo}else if(e.avail_in===0&&PU(t)<=PU(o)&&t!==ya)return Ep(e,rI);if(i.status===oE&&e.avail_in!==0)return Ep(e,rI);if(i.status===bm&&i.wrap===0&&(i.status=_p),i.status===bm){let a=R0+(i.w_bits-8<<4)<<8,l=-1;if(l=i.strategy>=b0||i.level<2?0:i.level<6?1:i.level===6?2:3,a|=l<<6,i.strstart!==0&&(a|=32),a+=31-a%31,sE(i,a),i.strstart!==0&&(sE(i,e.adler>>>16),sE(i,65535&e.adler)),e.adler=1,i.status=_p,Ds(e),i.pending!==0)return i.last_flush=-1,eo}if(i.status===57){if(e.adler=0,Hi(i,31),Hi(i,139),Hi(i,8),i.gzhead)Hi(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Hi(i,255&i.gzhead.time),Hi(i,i.gzhead.time>>8&255),Hi(i,i.gzhead.time>>16&255),Hi(i,i.gzhead.time>>24&255),Hi(i,i.level===9?2:i.strategy>=b0||i.level<2?4:0),Hi(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Hi(i,255&i.gzhead.extra.length),Hi(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=Br(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Hi(i,0),Hi(i,0),Hi(i,0),Hi(i,0),Hi(i,0),Hi(i,i.level===9?2:i.strategy>=b0||i.level<2?4:0),Hi(i,3),i.status=_p,Ds(e),i.pending!==0)return i.last_flush=-1,eo}if(i.status===69){if(i.gzhead.extra){let a=i.pending,l=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+l>i.pending_buf_size;){let f=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+f),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>a&&(e.adler=Br(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex+=f,Ds(e),i.pending!==0)return i.last_flush=-1,eo;a=0,l-=f}let u=new Uint8Array(i.gzhead.extra);i.pending_buf.set(u.subarray(i.gzindex,i.gzindex+l),i.pending),i.pending+=l,i.gzhead.hcrc&&i.pending>a&&(e.adler=Br(e.adler,i.pending_buf,i.pending-a,a)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let a,l=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>l&&(e.adler=Br(e.adler,i.pending_buf,i.pending-l,l)),Ds(e),i.pending!==0)return i.last_flush=-1,eo;l=0}a=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Hi(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>l&&(e.adler=Br(e.adler,i.pending_buf,i.pending-l,l)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let a,l=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>l&&(e.adler=Br(e.adler,i.pending_buf,i.pending-l,l)),Ds(e),i.pending!==0)return i.last_flush=-1,eo;l=0}a=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Hi(i,a)}while(a!==0);i.gzhead.hcrc&&i.pending>l&&(e.adler=Br(e.adler,i.pending_buf,i.pending-l,l))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(Ds(e),i.pending!==0))return i.last_flush=-1,eo;Hi(i,255&e.adler),Hi(i,e.adler>>8&255),e.adler=0}if(i.status=_p,Ds(e),i.pending!==0)return i.last_flush=-1,eo}if(e.avail_in!==0||i.lookahead!==0||t!==_u&&i.status!==oE){let a=i.level===0?xU(i,t):i.strategy===b0?((l,u)=>{let f;for(;;){if(l.lookahead===0&&(Rm(l),l.lookahead===0)){if(u===_u)return 1;break}if(l.match_length=0,f=gu(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,f&&(ks(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===ya?(ks(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(ks(l,!1),l.strm.avail_out===0)?1:2})(i,t):i.strategy===ite?((l,u)=>{let f,m,_,v,S=l.window;for(;;){if(l.lookahead<=gp){if(Rm(l),l.lookahead<=gp&&u===_u)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(_=l.strstart-1,m=S[_],m===S[++_]&&m===S[++_]&&m===S[++_])){v=l.strstart+gp;do;while(m===S[++_]&&m===S[++_]&&m===S[++_]&&m===S[++_]&&m===S[++_]&&m===S[++_]&&m===S[++_]&&m===S[++_]&&_<v);l.match_length=gp-(v-_),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(f=gu(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(f=gu(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),f&&(ks(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,u===ya?(ks(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(ks(l,!1),l.strm.avail_out===0)?1:2})(i,t):aE[i.level].func(i,t);if(a!==3&&a!==4||(i.status=oE),a===1||a===3)return e.avail_out===0&&(i.last_flush=-1),eo;if(a===2&&(t===Jee?Xee(i):t!==AU&&(nI(i,0,0,!1),t===Zee&&(Eu(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),Ds(e),e.avail_out===0))return i.last_flush=-1,eo}return t!==ya?eo:i.wrap<=0?OU:(i.wrap===2?(Hi(i,255&e.adler),Hi(i,e.adler>>8&255),Hi(i,e.adler>>16&255),Hi(i,e.adler>>24&255),Hi(i,255&e.total_in),Hi(i,e.total_in>>8&255),Hi(i,e.total_in>>16&255),Hi(i,e.total_in>>24&255)):(sE(i,e.adler>>>16),sE(i,65535&e.adler)),Ds(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?eo:OU)},pte=(e,t)=>{let i=t.length;if(cE(e))return tl;let o=e.state,a=o.wrap;if(a===2||a===1&&o.status!==bm||o.lookahead)return tl;if(a===1&&(e.adler=rE(e.adler,t,i,0)),o.wrap=0,i>=o.w_size){a===0&&(Eu(o.head),o.strstart=0,o.block_start=0,o.insert=0);let m=new Uint8Array(o.w_size);m.set(t.subarray(i-o.w_size,i),0),t=m,i=o.w_size}let l=e.avail_in,u=e.next_in,f=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Rm(o);o.lookahead>=3;){let m=o.strstart,_=o.lookahead-2;do o.ins_h=vu(o,o.ins_h,o.window[m+3-1]),o.prev[m&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=m,m++;while(--_);o.strstart=m,o.lookahead=2,Rm(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=u,e.input=f,e.avail_in=l,o.wrap=a,eo},lE={deflateInit:(e,t)=>LU(e,t,R0,15,8,rte),deflateInit2:LU,deflateReset:kU,deflateResetKeep:DU,deflateSetHeader:(e,t)=>cE(e)||e.state.wrap!==2?tl:(e.state.gzhead=t,eo),deflate:hte,deflateEnd:e=>{if(cE(e))return tl;let t=e.state.status;return e.state=null,t===_p?Ep(e,Qee):eo},deflateSetDictionary:pte,deflateInfo:"pako deflate (from Nodeca project)"};let fte=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var I0={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let i=t.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let o in i)fte(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let t=0;for(let o=0,a=e.length;o<a;o++)t+=e[o].length;let i=new Uint8Array(t);for(let o=0,a=0,l=e.length;o<l;o++){let u=e[o];i.set(u,a),a+=u.length}return i}};let MU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{MU=!1}let dE=new Uint8Array(256);for(let e=0;e<256;e++)dE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;dE[254]=dE[254]=1;var uE={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,i,o,a,l,u=e.length,f=0;for(a=0;a<u;a++)i=e.charCodeAt(a),(64512&i)==55296&&a+1<u&&(o=e.charCodeAt(a+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),a++)),f+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(f),l=0,a=0;l<f;a++)i=e.charCodeAt(a),(64512&i)==55296&&a+1<u&&(o=e.charCodeAt(a+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),a++)),i<128?t[l++]=i:i<2048?(t[l++]=192|i>>>6,t[l++]=128|63&i):i<65536?(t[l++]=224|i>>>12,t[l++]=128|i>>>6&63,t[l++]=128|63&i):(t[l++]=240|i>>>18,t[l++]=128|i>>>12&63,t[l++]=128|i>>>6&63,t[l++]=128|63&i);return t},buf2string:(e,t)=>{let i=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let o,a,l=new Array(2*i);for(a=0,o=0;o<i;){let u=e[o++];if(u<128){l[a++]=u;continue}let f=dE[u];if(f>4)l[a++]=65533,o+=f-1;else{for(u&=f===2?31:f===3?15:7;f>1&&o<i;)u=u<<6|63&e[o++],f--;f>1?l[a++]=65533:u<65536?l[a++]=u:(u-=65536,l[a++]=55296|u>>10&1023,l[a++]=56320|1023&u)}}return((u,f)=>{if(f<65534&&u.subarray&&MU)return String.fromCharCode.apply(null,u.length===f?u:u.subarray(0,f));let m="";for(let _=0;_<f;_++)m+=String.fromCharCode(u[_]);return m})(l,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?t:i+dE[e[i]]>t?i:t}},UU=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let jU=Object.prototype.toString,{Z_NO_FLUSH:mte,Z_SYNC_FLUSH:gte,Z_FULL_FLUSH:_te,Z_FINISH:Ete,Z_OK:A0,Z_STREAM_END:vte,Z_DEFAULT_COMPRESSION:yte,Z_DEFAULT_STRATEGY:Ste,Z_DEFLATED:Tte}=Cm;function hE(e){this.options=I0.assign({level:yte,method:Tte,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ste},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new UU,this.strm.avail_out=0;let i=lE.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==A0)throw new Error(mp[i]);if(t.header&&lE.deflateSetHeader(this.strm,t.header),t.dictionary){let o;if(o=typeof t.dictionary=="string"?uE.string2buf(t.dictionary):jU.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,i=lE.deflateSetDictionary(this.strm,o),i!==A0)throw new Error(mp[i]);this._dict_set=!0}}function cI(e,t){let i=new hE(t);if(i.push(e,!0),i.err)throw i.msg||mp[i.err];return i.result}hE.prototype.push=function(e,t){let i=this.strm,o=this.options.chunkSize,a,l;if(this.ended)return!1;for(l=t===~~t?t:t===!0?Ete:mte,typeof e=="string"?i.input=uE.string2buf(e):jU.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(l===gte||l===_te)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=lE.deflate(i,l),a===vte)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=lE.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===A0;if(i.avail_out!==0){if(l>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},hE.prototype.onData=function(e){this.chunks.push(e)},hE.prototype.onEnd=function(e){e===A0&&(this.result=I0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var wte={Deflate:hE,deflate:cI,deflateRaw:function(e,t){return(t=t||{}).raw=!0,cI(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,cI(e,t)},constants:Cm};let O0=16209;var Cte=function(e,t){let i,o,a,l,u,f,m,_,v,S,C,b,V,P,k,F,H,ie,oe,ae,he,Ee,ye,Ce,ze=e.state;i=e.next_in,ye=e.input,o=i+(e.avail_in-5),a=e.next_out,Ce=e.output,l=a-(t-e.avail_out),u=a+(e.avail_out-257),f=ze.dmax,m=ze.wsize,_=ze.whave,v=ze.wnext,S=ze.window,C=ze.hold,b=ze.bits,V=ze.lencode,P=ze.distcode,k=(1<<ze.lenbits)-1,F=(1<<ze.distbits)-1;e:do{b<15&&(C+=ye[i++]<<b,b+=8,C+=ye[i++]<<b,b+=8),H=V[C&k];t:for(;;){if(ie=H>>>24,C>>>=ie,b-=ie,ie=H>>>16&255,ie===0)Ce[a++]=65535&H;else{if(!(16&ie)){if(!(64&ie)){H=V[(65535&H)+(C&(1<<ie)-1)];continue t}if(32&ie){ze.mode=16191;break e}e.msg="invalid literal/length code",ze.mode=O0;break e}oe=65535&H,ie&=15,ie&&(b<ie&&(C+=ye[i++]<<b,b+=8),oe+=C&(1<<ie)-1,C>>>=ie,b-=ie),b<15&&(C+=ye[i++]<<b,b+=8,C+=ye[i++]<<b,b+=8),H=P[C&F];i:for(;;){if(ie=H>>>24,C>>>=ie,b-=ie,ie=H>>>16&255,!(16&ie)){if(!(64&ie)){H=P[(65535&H)+(C&(1<<ie)-1)];continue i}e.msg="invalid distance code",ze.mode=O0;break e}if(ae=65535&H,ie&=15,b<ie&&(C+=ye[i++]<<b,b+=8,b<ie&&(C+=ye[i++]<<b,b+=8)),ae+=C&(1<<ie)-1,ae>f){e.msg="invalid distance too far back",ze.mode=O0;break e}if(C>>>=ie,b-=ie,ie=a-l,ae>ie){if(ie=ae-ie,ie>_&&ze.sane){e.msg="invalid distance too far back",ze.mode=O0;break e}if(he=0,Ee=S,v===0){if(he+=m-ie,ie<oe){oe-=ie;do Ce[a++]=S[he++];while(--ie);he=a-ae,Ee=Ce}}else if(v<ie){if(he+=m+v-ie,ie-=v,ie<oe){oe-=ie;do Ce[a++]=S[he++];while(--ie);if(he=0,v<oe){ie=v,oe-=ie;do Ce[a++]=S[he++];while(--ie);he=a-ae,Ee=Ce}}}else if(he+=v-ie,ie<oe){oe-=ie;do Ce[a++]=S[he++];while(--ie);he=a-ae,Ee=Ce}for(;oe>2;)Ce[a++]=Ee[he++],Ce[a++]=Ee[he++],Ce[a++]=Ee[he++],oe-=3;oe&&(Ce[a++]=Ee[he++],oe>1&&(Ce[a++]=Ee[he++]))}else{he=a-ae;do Ce[a++]=Ce[he++],Ce[a++]=Ce[he++],Ce[a++]=Ce[he++],oe-=3;while(oe>2);oe&&(Ce[a++]=Ce[he++],oe>1&&(Ce[a++]=Ce[he++]))}break}}break}}while(i<o&&a<u);oe=b>>3,i-=oe,b-=oe<<3,C&=(1<<b)-1,e.next_in=i,e.next_out=a,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=a<u?u-a+257:257-(a-u),ze.hold=C,ze.bits=b};let P0=15,bte=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Rte=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ite=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ate=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pE=(e,t,i,o,a,l,u,f)=>{let m=f.bits,_,v,S,C,b,V,P=0,k=0,F=0,H=0,ie=0,oe=0,ae=0,he=0,Ee=0,ye=0,Ce=null,ze=new Uint16Array(16),It=new Uint16Array(16),Kt,_i,sn,Li=null;for(P=0;P<=P0;P++)ze[P]=0;for(k=0;k<o;k++)ze[t[i+k]]++;for(ie=m,H=P0;H>=1&&ze[H]===0;H--);if(ie>H&&(ie=H),H===0)return a[l++]=20971520,a[l++]=20971520,f.bits=1,0;for(F=1;F<H&&ze[F]===0;F++);for(ie<F&&(ie=F),he=1,P=1;P<=P0;P++)if(he<<=1,he-=ze[P],he<0)return-1;if(he>0&&(e===0||H!==1))return-1;for(It[1]=0,P=1;P<P0;P++)It[P+1]=It[P]+ze[P];for(k=0;k<o;k++)t[i+k]!==0&&(u[It[t[i+k]]++]=k);if(e===0?(Ce=Li=u,V=20):e===1?(Ce=bte,Li=Rte,V=257):(Ce=Ite,Li=Ate,V=0),ye=0,k=0,P=F,b=l,oe=ie,ae=0,S=-1,Ee=1<<ie,C=Ee-1,e===1&&Ee>852||e===2&&Ee>592)return 1;for(;;){Kt=P-ae,u[k]+1<V?(_i=0,sn=u[k]):u[k]>=V?(_i=Li[u[k]-V],sn=Ce[u[k]-V]):(_i=96,sn=0),_=1<<P-ae,v=1<<oe,F=v;do v-=_,a[b+(ye>>ae)+v]=Kt<<24|_i<<16|sn|0;while(v!==0);for(_=1<<P-1;ye&_;)_>>=1;if(_!==0?(ye&=_-1,ye+=_):ye=0,k++,--ze[P]==0){if(P===H)break;P=t[i+u[k]]}if(P>ie&&(ye&C)!==S){for(ae===0&&(ae=ie),b+=F,oe=P-ae,he=1<<oe;oe+ae<H&&(he-=ze[oe+ae],!(he<=0));)oe++,he<<=1;if(Ee+=1<<oe,e===1&&Ee>852||e===2&&Ee>592)return 1;S=ye&C,a[S]=ie<<24|oe<<16|b-l|0}}return ye!==0&&(a[b+ye]=P-ae<<24|64<<16|0),f.bits=ie,0};let{Z_FINISH:VU,Z_BLOCK:Ote,Z_TREES:N0,Z_OK:vp,Z_STREAM_END:Pte,Z_NEED_DICT:Nte,Z_STREAM_ERROR:Sa,Z_DATA_ERROR:FU,Z_MEM_ERROR:BU,Z_BUF_ERROR:xte,Z_DEFLATED:WU}=Cm,x0=16180,D0=16190,Ql=16191,lI=16192,dI=16194,k0=16199,L0=16200,uI=16206,Wn=16209,zU=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Dte(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let yp=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<x0||t.mode>16211?1:0},HU=e=>{if(yp(e))return Sa;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=x0,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,vp},GU=e=>{if(yp(e))return Sa;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,HU(e)},KU=(e,t)=>{let i;if(yp(e))return Sa;let o=e.state;return t<0?(i=0,t=-t):(i=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Sa:(o.window!==null&&o.wbits!==t&&(o.window=null),o.wrap=i,o.wbits=t,GU(e))},qU=(e,t)=>{if(!e)return Sa;let i=new Dte;e.state=i,i.strm=e,i.window=null,i.mode=x0;let o=KU(e,t);return o!==vp&&(e.state=null),o},hI,pI,YU=!0,kte=e=>{if(YU){hI=new Int32Array(512),pI=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pE(1,e.lens,0,288,hI,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pE(2,e.lens,0,32,pI,0,e.work,{bits:5}),YU=!1}e.lencode=hI,e.lenbits=9,e.distcode=pI,e.distbits=5},$U=(e,t,i,o)=>{let a,l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),o>=l.wsize?(l.window.set(t.subarray(i-l.wsize,i),0),l.wnext=0,l.whave=l.wsize):(a=l.wsize-l.wnext,a>o&&(a=o),l.window.set(t.subarray(i-o,i-o+a),l.wnext),(o-=a)?(l.window.set(t.subarray(i-o,i),0),l.wnext=o,l.whave=l.wsize):(l.wnext+=a,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=a))),0};var Lte=(e,t)=>{let i,o,a,l,u,f,m,_,v,S,C,b,V,P,k,F,H,ie,oe,ae,he,Ee,ye=0,Ce=new Uint8Array(4),ze,It,Kt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yp(e)||!e.output||!e.input&&e.avail_in!==0)return Sa;i=e.state,i.mode===Ql&&(i.mode=lI),u=e.next_out,a=e.output,m=e.avail_out,l=e.next_in,o=e.input,f=e.avail_in,_=i.hold,v=i.bits,S=f,C=m,Ee=vp;e:for(;;)switch(i.mode){case x0:if(i.wrap===0){i.mode=lI;break}for(;v<16;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(2&i.wrap&&_===35615){i.wbits===0&&(i.wbits=15),i.check=0,Ce[0]=255&_,Ce[1]=_>>>8&255,i.check=Br(i.check,Ce,2,0),_=0,v=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){e.msg="incorrect header check",i.mode=Wn;break}if((15&_)!==WU){e.msg="unknown compression method",i.mode=Wn;break}if(_>>>=4,v-=4,he=8+(15&_),i.wbits===0&&(i.wbits=he),he>15||he>i.wbits){e.msg="invalid window size",i.mode=Wn;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&_?16189:Ql,_=0,v=0;break;case 16181:for(;v<16;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(i.flags=_,(255&Ar(i))!==WU){e.msg="unknown compression method",i.mode=Wn;break}if(57344&Ar(i)){e.msg="unknown header flags set",i.mode=Wn;break}i.head&&(i.head.text=_>>8&1),512&Ar(i)&&4&i.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,i.check=Br(i.check,Ce,2,0)),_=0,v=0,i.mode=16182;case 16182:for(;v<32;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}i.head&&(i.head.time=_),512&Ar(i)&&4&i.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,Ce[2]=_>>>16&255,Ce[3]=_>>>24&255,i.check=Br(i.check,Ce,4,0)),_=0,v=0,i.mode=16183;case 16183:for(;v<16;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&Ar(i)&&4&i.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,i.check=Br(i.check,Ce,2,0)),_=0,v=0,i.mode=16184;case 16184:if(1024&Ar(i)){for(;v<16;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}i.length=_,i.head&&(i.head.extra_len=_),512&Ar(i)&&4&i.wrap&&(Ce[0]=255&_,Ce[1]=_>>>8&255,i.check=Br(i.check,Ce,2,0)),_=0,v=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Ar(i)&&(b=i.length,b>f&&(b=f),b&&(i.head&&(he=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(l,l+b),he)),512&Ar(i)&&4&i.wrap&&(i.check=Br(i.check,o,b,l)),f-=b,l+=b,i.length-=b),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Ar(i)){if(f===0)break e;b=0;do he=o[l+b++],i.head&&he&&i.length<65536&&(i.head.name+=String.fromCharCode(he));while(he&&b<f);if(512&Ar(i)&&4&i.wrap&&(i.check=Br(i.check,o,b,l)),f-=b,l+=b,he)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Ar(i)){if(f===0)break e;b=0;do he=o[l+b++],i.head&&he&&i.length<65536&&(i.head.comment+=String.fromCharCode(he));while(he&&b<f);if(512&Ar(i)&&4&i.wrap&&(i.check=Br(i.check,o,b,l)),f-=b,l+=b,he)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Ar(i)){for(;v<16;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(4&i.wrap&&_!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Wn;break}_=0,v=0}i.head&&(i.head.hcrc=Ar(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Ql;break;case 16189:for(;v<32;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}e.adler=i.check=zU(_),_=0,v=0,i.mode=D0;case D0:if(i.havedict===0)return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=f,i.hold=_,i.bits=v,Nte;e.adler=i.check=1,i.mode=Ql;case Ql:if(t===Ote||t===N0)break e;case lI:if(i.last){_>>>=7&v,v-=7&v,i.mode=uI;break}for(;v<3;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}switch(i.last=1&_,_>>>=1,v-=1,3&_){case 0:i.mode=16193;break;case 1:if(kte(i),i.mode=k0,t===N0){_>>>=2,v-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Wn}_>>>=2,v-=2;break;case 16193:for(_>>>=7&v,v-=7&v;v<32;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if((65535&_)!=(_>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Wn;break}if(i.length=65535&_,_=0,v=0,i.mode=dI,t===N0)break e;case dI:i.mode=16195;case 16195:if(b=i.length,b){if(b>f&&(b=f),b>m&&(b=m),b===0)break e;a.set(o.subarray(l,l+b),u),f-=b,l+=b,m-=b,u+=b,i.length-=b;break}i.mode=Ql;break;case 16196:for(;v<14;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(i.nlen=257+(31&_),_>>>=5,v-=5,i.ndist=1+(31&_),_>>>=5,v-=5,i.ncode=4+(15&_),_>>>=4,v-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Wn;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;v<3;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}i.lens[Kt[i.have++]]=7&_,_>>>=3,v-=3}for(;i.have<19;)i.lens[Kt[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,ze={bits:i.lenbits},Ee=pE(0,i.lens,0,19,i.lencode,0,i.work,ze),i.lenbits=ze.bits,Ee){e.msg="invalid code lengths set",i.mode=Wn;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;ye=i.lencode[_&(1<<i.lenbits)-1],k=ye>>>24,F=ye>>>16&255,H=65535&ye,!(k<=v);){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(H<16)_>>>=k,v-=k,i.lens[i.have++]=H;else{if(H===16){for(It=k+2;v<It;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(_>>>=k,v-=k,i.have===0){e.msg="invalid bit length repeat",i.mode=Wn;break}he=i.lens[i.have-1],b=3+(3&_),_>>>=2,v-=2}else if(H===17){for(It=k+3;v<It;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}_>>>=k,v-=k,he=0,b=3+(7&_),_>>>=3,v-=3}else{for(It=k+7;v<It;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}_>>>=k,v-=k,he=0,b=11+(127&_),_>>>=7,v-=7}if(i.have+b>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Wn;break}for(;b--;)i.lens[i.have++]=he}}if(i.mode===Wn)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Wn;break}if(i.lenbits=9,ze={bits:i.lenbits},Ee=pE(1,i.lens,0,i.nlen,i.lencode,0,i.work,ze),i.lenbits=ze.bits,Ee){e.msg="invalid literal/lengths set",i.mode=Wn;break}if(i.distbits=6,i.distcode=i.distdyn,ze={bits:i.distbits},Ee=pE(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,ze),i.distbits=ze.bits,Ee){e.msg="invalid distances set",i.mode=Wn;break}if(i.mode=k0,t===N0)break e;case k0:i.mode=L0;case L0:if(f>=6&&m>=258){e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=f,i.hold=_,i.bits=v,Cte(e,C),u=e.next_out,a=e.output,m=e.avail_out,l=e.next_in,o=e.input,f=e.avail_in,_=i.hold,v=i.bits,i.mode===Ql&&(i.back=-1);break}for(i.back=0;ye=i.lencode[_&(1<<i.lenbits)-1],k=ye>>>24,F=ye>>>16&255,H=65535&ye,!(k<=v);){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(F&&!(240&F)){for(ie=k,oe=F,ae=H;ye=i.lencode[ae+((_&(1<<ie+oe)-1)>>ie)],k=ye>>>24,F=ye>>>16&255,H=65535&ye,!(ie+k<=v);){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}_>>>=ie,v-=ie,i.back+=ie}if(_>>>=k,v-=k,i.back+=k,i.length=H,F===0){i.mode=16205;break}if(32&F){i.back=-1,i.mode=Ql;break}if(64&F){e.msg="invalid literal/length code",i.mode=Wn;break}i.extra=15&F,i.mode=16201;case 16201:if(i.extra){for(It=i.extra;v<It;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,v-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;ye=i.distcode[_&(1<<i.distbits)-1],k=ye>>>24,F=ye>>>16&255,H=65535&ye,!(k<=v);){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(!(240&F)){for(ie=k,oe=F,ae=H;ye=i.distcode[ae+((_&(1<<ie+oe)-1)>>ie)],k=ye>>>24,F=ye>>>16&255,H=65535&ye,!(ie+k<=v);){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}_>>>=ie,v-=ie,i.back+=ie}if(_>>>=k,v-=k,i.back+=k,64&F){e.msg="invalid distance code",i.mode=Wn;break}i.offset=H,i.extra=15&F,i.mode=16203;case 16203:if(i.extra){for(It=i.extra;v<It;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,v-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Wn;break}i.mode=16204;case 16204:if(m===0)break e;if(b=C-m,i.offset>b){if(b=i.offset-b,b>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Wn;break}b>i.wnext?(b-=i.wnext,V=i.wsize-b):V=i.wnext-b,b>i.length&&(b=i.length),P=i.window}else P=a,V=u-i.offset,b=i.length;b>m&&(b=m),m-=b,i.length-=b;do a[u++]=P[V++];while(--b);i.length===0&&(i.mode=L0);break;case 16205:if(m===0)break e;a[u++]=i.length,m--,i.mode=L0;break;case uI:if(i.wrap){for(;v<32;){if(f===0)break e;f--,_|=o[l++]<<v,v+=8}if(C-=m,e.total_out+=C,i.total+=C,4&i.wrap&&C&&(e.adler=i.check=Ar(i)?Br(i.check,a,C,u-C):rE(i.check,a,C,u-C)),C=m,4&i.wrap&&(Ar(i)?_:zU(_))!==i.check){e.msg="incorrect data check",i.mode=Wn;break}_=0,v=0}i.mode=16207;case 16207:if(i.wrap&&Ar(i)){for(;v<32;){if(f===0)break e;f--,_+=o[l++]<<v,v+=8}if(4&i.wrap&&_!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Wn;break}_=0,v=0}i.mode=16208;case 16208:Ee=Pte;break e;case Wn:Ee=FU;break e;case 16210:return BU;default:return Sa}return e.next_out=u,e.avail_out=m,e.next_in=l,e.avail_in=f,i.hold=_,i.bits=v,(i.wsize||C!==e.avail_out&&i.mode<Wn&&(i.mode<uI||t!==VU))&&$U(e,e.output,e.next_out,C-e.avail_out),S-=e.avail_in,C-=e.avail_out,e.total_in+=S,e.total_out+=C,i.total+=C,4&i.wrap&&C&&(e.adler=i.check=Ar(i)?Br(i.check,a,C,e.next_out-C):rE(i.check,a,C,e.next_out-C)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Ql?128:0)+(i.mode===k0||i.mode===dI?256:0),(S===0&&C===0||t===VU)&&Ee===vp&&(Ee=xte),Ee},ed={inflateReset:GU,inflateReset2:KU,inflateResetKeep:HU,inflateInit:e=>qU(e,15),inflateInit2:qU,inflate:Lte,inflateEnd:e=>{if(yp(e))return Sa;let t=e.state;return t.window&&(t.window=null),e.state=null,vp},inflateGetHeader:(e,t)=>{if(yp(e))return Sa;let i=e.state;return 2&i.wrap?(i.head=t,t.done=!1,vp):Sa},inflateSetDictionary:(e,t)=>{let i=t.length,o,a,l;return yp(e)?Sa:(o=e.state,o.wrap!==0&&o.mode!==D0?Sa:o.mode===D0&&(a=1,a=rE(a,t,i,0),a!==o.check)?FU:(l=$U(e,t,i,i),l?(o.mode=16210,BU):(o.havedict=1,vp)))},inflateInfo:"pako inflate (from Nodeca project)"},Mte=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let XU=Object.prototype.toString,{Z_NO_FLUSH:Ute,Z_FINISH:jte,Z_OK:fE,Z_STREAM_END:fI,Z_NEED_DICT:mI,Z_STREAM_ERROR:Vte,Z_DATA_ERROR:JU,Z_MEM_ERROR:Fte}=Cm;function mE(e){this.options=I0.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new UU,this.strm.avail_out=0;let i=ed.inflateInit2(this.strm,t.windowBits);if(i!==fE)throw new Error(mp[i]);if(this.header=new Mte,ed.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=uE.string2buf(t.dictionary):XU.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=ed.inflateSetDictionary(this.strm,t.dictionary),i!==fE)))throw new Error(mp[i])}function gI(e,t){let i=new mE(t);if(i.push(e),i.err)throw i.msg||mp[i.err];return i.result}mE.prototype.push=function(e,t){let i=this.strm,o=this.options.chunkSize,a=this.options.dictionary,l,u,f;if(this.ended)return!1;for(u=t===~~t?t:t===!0?jte:Ute,XU.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),l=ed.inflate(i,u),l===mI&&a&&(l=ed.inflateSetDictionary(i,a),l===fE?l=ed.inflate(i,u):l===JU&&(l=mI));i.avail_in>0&&l===fI&&i.state.wrap>0&&e[i.next_in]!==0;)ed.inflateReset(i),l=ed.inflate(i,u);switch(l){case Vte:case JU:case mI:case Fte:return this.onEnd(l),this.ended=!0,!1}if(f=i.avail_out,i.next_out&&(i.avail_out===0||l===fI))if(this.options.to==="string"){let m=uE.utf8border(i.output,i.next_out),_=i.next_out-m,v=uE.buf2string(i.output,m);i.next_out=_,i.avail_out=o-_,_&&i.output.set(i.output.subarray(m,m+_),0),this.onData(v)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(l!==fE||f!==0){if(l===fI)return l=ed.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},mE.prototype.onData=function(e){this.chunks.push(e)},mE.prototype.onEnd=function(e){e===fE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=I0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Bte={Inflate:mE,inflate:gI,inflateRaw:function(e,t){return(t=t||{}).raw=!0,gI(e,t)},ungzip:gI,constants:Cm};let{Deflate:A_e,deflate:Wte,deflateRaw:O_e,gzip:P_e}=wte,{Inflate:N_e,inflate:zte,inflateRaw:x_e,ungzip:D_e}=Bte;var Hte=Wte,Gte=zte;let or={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function xt(){return or}function ZU(){return"setSinkId"in HTMLAudioElement.prototype&&(!$("RESTRICTION_SET_PLAYBACK_DEVICE")||(ru()||dM())&&!qb())}let Kn=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Am(e,t,i){return{sampleRate:e,stereo:t,bitrate:i}}function kt(e,t,i,o,a){return{width:e,height:t,frameRate:i,bitrateMin:o,bitrateMax:a}}function Ta(e,t,i,o,a){return{width:{max:e},height:{max:t},frameRate:i,bitrateMin:o,bitrateMax:a}}function _I(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let Kte={"90p":kt(160,90),"90p_1":kt(160,90),"120p":kt(160,120,15,30,65),"120p_1":kt(160,120,15,30,65),"120p_3":kt(120,120,15,30,50),"120p_4":kt(212,120),"180p":kt(320,180,15,30,140),"180p_1":kt(320,180,15,30,140),"180p_3":kt(180,180,15,30,100),"180p_4":kt(240,180,15,30,120),"240p":kt(320,240,15,40,200),"240p_1":kt(320,240,15,40,200),"240p_3":kt(240,240,15,40,140),"240p_4":kt(424,240,15,40,220),"360p":kt(640,360,15,80,400),"360p_1":kt(640,360,15,80,400),"360p_3":kt(360,360,15,80,260),"360p_4":kt(640,360,30,80,600),"360p_6":kt(360,360,30,80,400),"360p_7":kt(480,360,15,80,320),"360p_8":kt(480,360,30,80,490),"360p_9":kt(640,360,15,80,800),"360p_10":kt(640,360,24,80,800),"360p_11":kt(640,360,24,80,1e3),"480p":kt(640,480,15,100,500),"480p_1":kt(640,480,15,100,500),"480p_2":kt(640,480,30,100,1e3),"480p_3":kt(480,480,15,100,400),"480p_4":kt(640,480,30,100,750),"480p_6":kt(480,480,30,100,600),"480p_8":kt(848,480,15,100,610),"480p_9":kt(848,480,30,100,930),"480p_10":kt(640,480,10,100,400),"720p":kt(1280,720,15,120,1130),"720p_auto":kt(1280,720,30,900,3e3),"720p_1":kt(1280,720,15,120,1130),"720p_2":kt(1280,720,30,120,2e3),"720p_3":kt(1280,720,30,120,1710),"720p_5":kt(960,720,15,120,910),"720p_6":kt(960,720,30,120,1380),"1080p":kt(1920,1080,15,120,2080),"1080p_1":kt(1920,1080,15,120,2080),"1080p_2":kt(1920,1080,30,120,3e3),"1080p_3":kt(1920,1080,30,120,3150),"1080p_5":kt(1920,1080,60,120,4780),"1440p":kt(2560,1440,30,120,4850),"1440p_1":kt(2560,1440,30,120,4850),"1440p_2":kt(2560,1440,60,120,7350),"4k":kt(3840,2160,30,120,8910),"4k_1":kt(3840,2160,30,120,8910),"4k_3":kt(3840,2160,60,120,13500)},M0=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],qte={"480p":Ta(640,480,5),"480p_1":Ta(640,480,5),"480p_2":Ta(640,480,30),"480p_3":Ta(640,480,15),"720p":Ta(1280,720,5),"720p_auto":kt(1280,720,30,900,3e3),"720p_1":Ta(1280,720,5),"720p_2":Ta(1280,720,30),"720p_3":Ta(1280,720,15),"1080p":Ta(1920,1080,5),"1080p_1":Ta(1920,1080,5),"1080p_2":Ta(1920,1080,30),"1080p_3":Ta(1920,1080,15)},Yte={"1SL1TL":_I(1,1),"3SL3TL":_I(3,3),"2SL3TL":_I(2,3)};function rl(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Kte[e]):e}function EI(e){return typeof e=="string"?Object.assign({},qte[e]):e}function U0(e){return typeof e=="string"?Object.assign({},Yte[e]):e}let $te={speech_low_quality:Am(16e3,!1),speech_standard:Am(32e3,!1,18),music_standard:Am(48e3,!1),standard_stereo:Am(48e3,!0,56),high_quality:Am(48e3,!1,128),high_quality_stereo:Am(48e3,!0,192)};function j0(e){return typeof e=="string"?Object.assign({},$te[e]):e}let Om=[];function QU(e){return Cn(e,"mediaSource",["screen","window","application"]),!0}let Ve=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),gi=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e}({}),Pm=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Xte=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Jte=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}({}),Sp=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Nm=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),xm=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),ds=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let vI={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},yI={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},ej={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Zte={uplinkNetworkQuality:0,downlinkNetworkQuality:0},tj={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Wr=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),us=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),gE=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Tp=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Or=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),ol=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),SI={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},V0=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function ij(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Ai(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ij(Object(i),!0).forEach(function(o){me(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ij(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function me(e,t,i){return(t=function(o){var a=function(l,u){if(typeof l!="object"||l===null)return l;var f=l[Symbol.toPrimitive];if(f!==void 0){var m=f.call(l,"string");if(typeof m!="object")return m;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(o);return typeof a=="symbol"?a:String(a)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Dt(e,t,i,o,a){var l,u,f={};return Object.keys(o).forEach(function(m){f[m]=o[m]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,("value"in f||f.initializer)&&(f.writable=!0),f=fo(l=kQ(u=i.slice()).call(u)).call(l,function(m,_){return _(e,t,m)||m},f),a&&f.initializer!==void 0&&(f.value=f.initializer?f.initializer.call(a):void 0,f.initializer=void 0),f.initializer===void 0&&(Object.defineProperty(e,t,f),f=null),f}class nj extends Ii{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Sp.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,i){super(),me(this,"trackMediaType",void 0),me(this,"_ID",void 0),me(this,"_rtpTransceiver",void 0),me(this,"_lowRtpTransceiver",void 0),me(this,"_hints",[]),me(this,"_isClosed",!1),me(this,"_originMediaStreamTrack",void 0),me(this,"mediaStreamTrack",void 0),me(this,"_external",{}),this._ID=i||di(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(o){ke(Om).call(Om,o)||Om.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||su(()=>{var i;Ge.reportApiInvoke(null,{name:ln.GET_MEDIA_STREAM_TRACK,options:[],tag:Ui.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Pm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let i=Om.indexOf(t);i!==-1&&Om.splice(i,1)}(this),this.emit(Nm.CLOSED),this.removeAllListeners(Sp.SEI_RECEIVED)}_updateRtpTransceiver(t,i){if(i===Pm.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Sp.TRANSCEIVER_UPDATED,t,i)}}class Dm extends nj{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,i){super(t,i),me(this,"_enabled",!0),me(this,"_muted",!1),me(this,"_isExternalTrack",!1),me(this,"_isClosed",!1),me(this,"_enabledMutex",void 0),me(this,"processor",void 0),me(this,"_processorContext",void 0),me(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new jn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,i;return(t=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,I.debug("[".concat(this.getTrackId(),"] close")),this.emit(Ve.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await li(this,Ve.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Nm.TRACK_ENDED)}stateCheck(t,i){if(I.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(i,"]")),Gl(i,t),this._enabled&&this._muted&&t==="enabled"&&i===!1)throw new fe(W.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",I);if(!this._enabled&&!this._muted&&t==="muted"&&i===!0)throw new fe(W.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",I)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():De.resolve([])}}let rj=window.AudioContext||window.webkitAudioContext,hs=null,ni=new class extends Ii{constructor(){super(...arguments),me(this,"prevState",void 0),me(this,"curState",void 0),me(this,"currentTime",void 0),me(this,"currentTimeStuckAt",void 0),me(this,"interruptDetectorTrack",void 0),me(this,"onLocalAudioTrackMute",()=>{I.info("ios15-interruption-start"),this.emit(Kn.IOS_15_16_INTERRUPTION_START)}),me(this,"onLocalAudioTrackUnmute",async()=>{I.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?I.info("ios15-interruption-end-canceled"):(hs&&await hs.suspend(),this.emit(Kn.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){I.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){I.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function km(){if(!hs){if(function(){if(!rj)return void I.error("your browser is not support web audio");I.info("create audio context");let e=Ai({},$("WEBAUDIO_INIT_OPTIONS"));I.debug("audio context init option:",JSON.stringify(e)),hs=new rj(e),ni.curState=hs.state,hs.onstatechange=()=>{ni.prevState=ni.curState,ni.curState=hs?hs.state:void 0;let{prevState:t,curState:i}=ni,o=i==="running",a=i==="interrupted",l=t==="running",u=t==="suspended",f=t==="interrupted",m=Ut().osVersion;(ur()||da())&&l&&a&&(I.info("ios".concat(m,"-interruption-start")),ni.emit(Kn.IOS_INTERRUPTION_START)),(ur()||da())&&(u||f)&&o&&(I.info("ios".concat(m,"-interruption-end")),ni.emit(Kn.IOS_INTERRUPTION_END)),t!==i&&ni.emit(Kn.STATE_CHANGE,i,t)},setInterval(()=>{var t;let i=(t=hs)===null||t===void 0?void 0:t.currentTime;ni.currentTime!==i?(ni.currentTimeStuckAt&&(I.debug("AudioContext current time resume at ".concat(i)),ni.currentTimeStuckAt=void 0),ni.currentTime=i):(i!==ni.currentTimeStuckAt&&(Ge.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Ui.TRACER}).onSuccess(),I.warning("AudioContext current time stuck at ".concat(i))),ni.currentTimeStuckAt=i)},5e3),async function(t){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],o,a=!1,l=!1,u=!1;function f(P){t.state==="running"?m(!1):ur()||da()?t.state==="suspended"&&(m(!0),P&&t.resume().then(_,_)):t.state!=="closed"&&(m(!0),P&&t.resume().then(_,_))}function m(P){if(a!==P){a=P;for(let k=0,F=i;k<F.length;k+=1){let H=F[k];P?window.addEventListener(H,v,{capture:!0,passive:!0}):window.removeEventListener(H,v,{capture:!0,passive:!0})}}}function _(){f(!1)}function v(){f(!0)}function S(P){if(!u)if(o.paused)if(P){let k;C(!1),u=!0;try{k=o.play(),k?k.then(b,b):(o.addEventListener("playing",b),o.addEventListener("abort",b),o.addEventListener("error",b))}catch{b()}}else C(!0);else C(!1)}function C(P){if(l!==P){l=P;for(let k=0,F=i;k<F.length;k++){let H=F[k];P?window.addEventListener(H,V,{capture:!0,passive:!0}):window.removeEventListener(H,V,{capture:!0,passive:!0})}}}function b(){o.removeEventListener("playing",b),o.removeEventListener("abort",b),o.removeEventListener("error",b),u=!1,S(!1)}function V(){S(!0)}if(ur()){let P=t.createMediaStreamDestination(),k=document.createElement("div");k.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=k.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=P.stream,S(!0)}ni.on(Kn.STATE_CHANGE,function(){f(!0)}),f(!1)}(hs)}(),!hs)throw new fe(W.NOT_SUPPORTED,"can not create audio context");return hs}return hs}function wp(e){if(function(){if(TI!==null)return TI;let o=km(),a=o.createBufferSource(),l=o.createGain(),u=o.createGain();a.connect(l),a.connect(u),a.disconnect(l);let f=!1;try{a.disconnect(l)}catch{f=!0}return a.disconnect(),TI=f,f}())return;let t=e.connect,i=e.disconnect;e.connect=(o,a,l)=>{var u;return e._inputNodes||(e._inputNodes=[]),ke(u=e._inputNodes).call(u,o)||(o instanceof AudioNode?(e._inputNodes.push(o),t.call(e,o,a,l)):t.call(e,o,a)),e},e.disconnect=(o,a,l)=>{i.call(e),o?Jy(e._inputNodes,o):e._inputNodes=[];for(let u of e._inputNodes)t.call(e,u)}}let TI=null;function wI(e,t){let i=!1,o=1/t;if($("DISABLE_WEBAUDIO")){let a=window.setInterval(()=>{i?window.clearInterval(a):e(performance.now()/1e3)},1e3*o)}else{let a=km(),l=a.createGain();l.gain.value=0,l.connect(a.destination);let u=()=>{if(i)return void(l=null);let f=a.createOscillator();f.onended=u,f.connect(l),f.start(0),f.stop(a.currentTime+o),e(a.currentTime)};u()}return()=>{i=!0}}class oj{constructor(){me(this,"context",void 0),me(this,"analyserNode",void 0),me(this,"sourceNode",void 0),this.context=km(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||ur()||da()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let a=0;a<t.length;++a)t[a]=o[a]/128-1}let i=fo(t).call(t,(o,a)=>o+a*a,0)/t.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,i;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{I.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class sj extends Ii{get processSourceNode(){return this.sourceNode}set processedNode(t){var i;if(!this.isDestroyed&&this._processedNode!==t){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),me(this,"outputNode",void 0),me(this,"outputTrack",void 0),me(this,"isPlayed",!1),me(this,"sourceNode",void 0),me(this,"context",void 0),me(this,"audioBufferNode",void 0),me(this,"destNode",void 0),me(this,"audioOutputLevel",0),me(this,"volumeLevelAnalyser",void 0),me(this,"_processedNode",void 0),me(this,"playNode",void 0),me(this,"isDestroyed",!1),me(this,"onNoAudioInput",void 0),me(this,"isNoAudioInput",!1),me(this,"_noAudioInputCount",0),this.context=km(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wp(this.outputNode),this.volumeLevelAnalyser=new oj}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(ds.ON_AUDIO_BUFFER,function(o){for(let a=0;a<o.outputBuffer.numberOfChannels;a+=1){let l=o.outputBuffer.getChannelData(a);for(let u=0;u<l.length;u+=1)l[u]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!xt().webAudioMediaStreamDest)throw new fe(W.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Zy(()=>{ni.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;ur()||da()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let i=this.volumeLevelAnalyser.getAnalyserNode(),o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let a=!1;for(let l=0;l<o.length;l++)o[l]!==0&&(a=!0);return a?(this.isNoAudioInput=!1,!0):(await Nn(200),await this.checkHasAudioInput(t?t+1:1)&&a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,i;(t=this.processedNode)===null||t===void 0||t.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class aj extends sj{get isFreeze(){return!1}constructor(t,i,o){var a;if(super(),me(this,"sourceNode",void 0),me(this,"track",void 0),me(this,"clonedTrack",void 0),me(this,"audioElement",void 0),me(this,"isCurrentTrackCloned",!1),me(this,"isRemoteTrack",!1),me(this,"originVolumeLevelAnalyser",void 0),me(this,"rebuildWebAudio",async()=>{if(I.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void I.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>I.info("resume success")),I.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let f=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?f.stop():this.isCurrentTrackCloned=!0;let m=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(m),wp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let _=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(_,this.context.currentTime),wp(this.outputNode),this.emit(ds.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=m,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new fe(W.UNEXPECTED_ERROR);this.track=t;let l=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(l),wp(this.sourceNode),o){let f=o.clone();f.enabled=!0,this.clonedTrack=f,I.debug("create an unmuted track ".concat(f.id," from the original track ").concat(o.id," to get the volume"));let m=this.context.createMediaStreamSource(new MediaStream([f]));wp(m),this.originVolumeLevelAnalyser=new oj,this.originVolumeLevelAnalyser.updateSource(m)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;let u=Ut();i&&u.os===On.IOS&&Number((a=u.osVersion)===null||a===void 0?void 0:a.split(".")[0])<15&&(ni.on(Kn.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(f=>{f||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let i=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(i),wp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ds.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),ni.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let i=t.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),I.debug("create an unmuted track ".concat(i.id," from the original track ").concat(t.id," to get the volume"));let o=this.context.createMediaStreamSource(new MediaStream([i]));wp(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function cj(e,t,i){let o=(l,u)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||u:l:u,a={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(t.height,1080),maxWidth:o(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(a.video.mandatory.maxFrameRate=t.frameRate.max,a.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(a.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(a)}async function Qte(e,t){let i=await lj(e.mediaSource),{sourceId:o,audio:a}=await function(l){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new De((f,m)=>{let _=document.createElement("div");_.innerText="share screen",_.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let v=document.createElement("div");v.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let S=document.createElement("div");S.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",S.setAttribute("style","height: 12%;");let C=document.createElement("div");C.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let b=document.createElement("div");b.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let V=document.createElement("button");V.innerHTML="cancel",V.setAttribute("style","width: 85px;"),V.onclick=()=>{document.body.removeChild(F);let H=new Error("NotAllowedError");H.name="NotAllowedError",m(H)};let P=u,k=document.createElement("div");if(u){let H=document.createElement("input");H.setAttribute("type","checkbox");let ie=document.createElement("span");H.setAttribute("style","margin-right: 6px;"),ie.innerText="Share audio",H.checked=P,H.onchange=()=>{P=H.checked},k.appendChild(H),k.appendChild(ie)}b.appendChild(k),b.appendChild(V),v.appendChild(S),v.appendChild(C),v.appendChild(b);let F=document.createElement("div");F.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),F.appendChild(_),F.appendChild(v),document.body.appendChild(F),l.map(H=>{if(H.id){let ie=document.createElement("div");ie.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let oe=H.thumbnail;try{let{width:ae}=oe.getSize();ae>1920&&(oe=oe.resize({width:1920}))}catch(ae){throw ae&&ae.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ae}ie.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+oe.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+H.name.replace(/[\u00A0-\u9999<>\&]/g,function(ae){return"&#"+ae.charCodeAt(0)+";"})+"</span>",ie.onclick=()=>{document.body.removeChild(F),f({sourceId:H.id,audio:P})},C.appendChild(ie)}})})}(i,t);return await cj(o,e,a)}async function lj(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let i=IM();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new fe(W.ELECTRON_IS_NULL);let o=null;try{var a;o=((a=i.desktopCapturer)===null||a===void 0?void 0:a.getSources({types:t}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{o=null}o&&o.then||(o=new De((l,u)=>{i.desktopCapturer.getSources({types:t},(f,m)=>{f?u(f):l(m)})}));try{return await o}catch(l){throw new fe(W.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}let CI=new jn("safari"),dj=!1,uj=!1;async function ps(e,t){let i=0,o=null;for(;i<2;)try{o=await eie(e,t,i>0);break}catch(a){if(a instanceof fe)throw I.error("[".concat(t,"] ").concat(a.toString())),a;let l=F0(a.name||a.code||a,a.message);if(l.code===W.MEDIA_OPTION_INVALID){I.debug("[".concat(t,"] detect media option invalid, retry")),i+=1,await Nn(500);continue}throw I.error("[".concat(t,"] ").concat(l.toString())),l}if(!o)throw new fe(W.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function eie(e,t,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new fe(W.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let o=xt(),a=new MediaStream;if(e.audioSource&&a.addTrack(e.audioSource),e.videoSource&&a.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return I.debug("Using Video Source/ Audio Source"),a;if(e.screen)if(IM())e.screen.sourceId?Lm(a,await cj(e.screen.sourceId,e.screen,e.screenAudio)):Lm(a,await Qte(e.screen,e.screenAudio));else if(ru()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new fe(W.NOT_SUPPORTED,"This browser does not support screen sharing");I.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let C=await(u=e.screen.extensionId,f=t,new De((b,V)=>{try{chrome.runtime.sendMessage(u,{getStream:!0},P=>{if(!P||!P.streamId)return I.error("[".concat(f,"] No response from Chrome Plugin. Plugin not installed properly"),P),void V(new fe(W.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));b(P.streamId)})}catch(P){I.error("[".concat(f,"] AgoraRTC screensharing plugin is not accessible(").concat(u,")"),P.toString()),V(new fe(W.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=C,Lm(a,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var l;e.screen.mediaSource&&QU(e.screen.mediaSource);let C={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:b,surfaceSwitching:V,systemAudio:P}=e.screen,k={selfBrowserSurface:b,surfaceSwitching:V,systemAudio:P};!b&&delete k.selfBrowserSurface,!V&&delete k.surfaceSwitching,!P&&delete k.systemAudio,I.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:C,audio:!!e.screenAudio,controls:k})),Lm(a,await navigator.mediaDevices.getDisplayMedia(Ai({video:C,audio:!!e.screenAudio},k)))}else{if(!ci())throw I.error("[".concat(t,"] This browser does not support screenSharing")),new fe(W.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&QU(e.screen.mediaSource);let C={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};I.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(C))),Lm(a,await navigator.mediaDevices.getUserMedia(C))}}var u,f;if(!e.video&&!e.audio)return a;let m={video:e.video,audio:e.audio},_=$("MEDIA_DEVICE_CONSTRAINTS");if(_)try{typeof _=="string"&&(_=JSON.parse(_)),m=Zb(m,_)}catch{}I.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(m)),Ut();let v,S=null;(Pn()||ur()||$y())&&(S=await CI.lock());try{v=await navigator.mediaDevices.getUserMedia(m)}catch(C){throw S&&S(),C}return m.audio&&(dj=!0),m.video&&(uj=!0),Lm(a,v),S&&S(),a}function F0(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new fe(W.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new fe(W.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new fe(W.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new fe(W.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new fe(W.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new fe(W.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return I.error("getUserMedia unexpected error",e),new fe(W.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Lm(e,t){let i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],a=t.getVideoTracks()[0],l=t.getAudioTracks()[0];l&&(o&&e.removeTrack(o),e.addTrack(l)),a&&(i&&e.removeTrack(i),e.addTrack(a))}let fs=new class extends Ii{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Tp.STATE_CHANGE,e),this._state=e)}constructor(){super(),me(this,"_state",gE.IDLE),me(this,"isAccessMicrophonePermission",!1),me(this,"isAccessCameraPermission",!1),me(this,"lastAccessMicrophonePermission",!1),me(this,"lastAccessCameraPermission",!1),me(this,"checkdeviceMatched",!1),me(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{($("ENUMERATE_DEVICES_INTERVAL")||(Xy()||Yy()===On.HARMONY_OS)&&ou())&&this.updateDevicesInfo()},$("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>I.error(e.toString()))}async enumerateDevices(e,t){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new fe(W.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let o=await navigator.mediaDevices.enumerateDevices(),a=this.checkMediaDeviceInfoIsOk(o),l=!this.isAccessMicrophonePermission&&e,u=!this.isAccessCameraPermission&&t;a.audio&&(l=!1),a.video&&(u=!1);let f=null,m=null,_=null;if(!i&&(l||u)){if(CI.isLocked&&(I.debug("[device manager] wait GUM lock"),(await CI.lock())(),I.debug("[device manager] GUM unlock")),dj&&(l=!1,this.isAccessMicrophonePermission=!0),uj&&(u=!1,this.isAccessCameraPermission=!0),I.debug("[device manager] check media device permissions",e,t,l,u),l&&u){try{_=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(v){let S=F0(v.name||v.code||v,v.message);if(S.code===W.PERMISSION_DENIED)throw S;I.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{f=await navigator.mediaDevices.getUserMedia({audio:e})}catch(v){let S=F0(v.name||v.code||v,v.message);if(S.code===W.PERMISSION_DENIED)throw S;I.warning("getUserMedia failed in getDevices",S)}this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({video:t})}catch(v){let S=F0(v.name||v.code||v,v.message);if(S.code===W.PERMISSION_DENIED)throw S;I.warning("getUserMedia failed in getDevices",S)}this.isAccessCameraPermission=!0}I.debug("[device manager] mic permission",e,"cam permission",t)}try{let v=await navigator.mediaDevices.enumerateDevices();return f&&f.getTracks().forEach(S=>S.stop()),m&&m.getTracks().forEach(S=>S.stop()),_&&_.getTracks().forEach(S=>S.stop()),f=null,m=null,_=null,v}catch(v){return f&&f.getTracks().forEach(S=>S.stop()),m&&m.getTracks().forEach(S=>S.stop()),_&&_.getTracks().forEach(S=>S.stop()),f=null,m=null,_=null,new fe(W.ENUMERATE_DEVICES_FAILED,v.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(t=i.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!t)throw new fe(W.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=gE.INITING;try{await this.updateDevicesInfo(),this.state=gE.INITEND}catch(e){throw I.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=gE.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new fe(W.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let a=e.find(u=>u.kind==="audioinput"&&u.deviceId==="default"),l=e.find(u=>u.kind==="audiooutput"&&u.deviceId==="default");a&&l?l.groupId===a.groupId?I.debug("[device-check] default input ".concat(a.label," and output ").concat(l.label," is the same group")):I.warning("[device-check] default input ".concat(a.label," and output ").concat(l.label," is not the same group")):I.debug("[device-check] default input or output not found")}let o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(a=>{if(!a.deviceId)return;let l=this.deviceInfoMap.get("".concat(a.kind,"_").concat(a.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){let u={initAt:t,updateAt:t,device:a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(a.kind,"_").concat(a.deviceId),u),i.push(u)}l&&(l.updateAt=t)}),this.deviceInfoMap.forEach((a,l)=>{a.state==="ACTIVE"&&a.updateAt!==t&&(a.state="INACTIVE",i.push(a))}),this.state!==gE.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(a=>{switch(a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Tp.RECORDING_DEVICE_CHANGED,a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Tp.CAMERA_DEVICE_CHANGED,a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Tp.PLAYOUT_DEVICE_CHANGED,a)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(a=>a.kind==="audioinput"),i=e.filter(a=>a.kind==="videoinput"),o={audio:!1,video:!1};for(let a of t)if(a.label&&a.deviceId){o.audio=!0;break}for(let a of i)if(a.label&&a.deviceId){o.video=!0;break}return o}},bI=!1,ms=new class extends Ii{constructor(){super(...arguments),me(this,"onAutoplayFailed",void 0),me(this,"onAudioAutoplayFailed",void 0)}};function hj(){if(Ut(),!bI){let e=t=>{t.preventDefault(),bI=!1,k_()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};bI=!0,k_()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),I.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ms.onAutoplayFailed?ms.onAutoplayFailed():ms.onAudioAutoplayFailed?I.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):I.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ms.emit("autoplay-failed")}}function pj(e,t,i,o){if(!e)return;let a=Ge.getBaseInfoBySessionId(e);if(!a)return;let l=a.info,u=Date.now(),f=Ai(Ai({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:u,elapse:u-a.startTime,cbRegistered:ms.onAutoplayFailed||ms.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:t,trackId:o,extend:void 0});Ge.send({type:Di.AUTOPLAY_FAILED,data:f},!0)}let tie=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],to=new class{constructor(){me(this,"onAutoplayFailed",void 0),me(this,"elementMap",new Map),me(this,"elementStateMap",new Map),me(this,"elementsNeedToResume",[]),me(this,"sinkIdMap",new Map),me(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[i,o]=t,a=this.elementStateMap.get(i),l=o.srcObject.getAudioTracks()[0],u=l&&l.readyState;if(I.debug("resume after interrupted, ele: ".concat(a," audio: ").concat(u," ").concat(e)),u==="live"){if(e)return o.pause(),void o.play();if(ni.curState==="running")return rm()?(o.pause(),void o.play()):void(a&&a==="paused"&&o.play())}})}),me(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,i]=e,o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(I.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),ni.on(Kn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ni.on(Kn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),ni.on(Kn.STATE_CHANGE,()=>{ur()&&ni.prevState==="suspended"&&ni.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),i)try{await i.setSinkId(t)}catch(o){throw new fe(W.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,t,i,o){if(this.elementMap.has(t))return;let a=document.createElement("audio");a.autoplay=!0,a.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,a),this.elementMap.set(t,a),this.elementStateMap.set(t,Or.INIT),this.setVolume(t,i);let l=this.sinkIdMap.get(t);if(l)try{a.setSinkId(l).catch(f=>{I.warning("[".concat(t,"] set sink id failed"),f.toString())})}catch(f){I.warning("[".concat(t,"] set sink id failed"),f.toString())}let u=a.play();u&&u.then&&u.catch(f=>{o&&pj(o,"audio",f.message,t),I.warning("audio element play warning",f.toString()),this.elementMap.has(t)&&f.name==="NotAllowedError"&&(I.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(a),Zy(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),hj()}))})}updateTrack(e,t){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let i=this.elementMap.get(e);i&&(t=Math.max(0,Math.min(100,t)),i.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let i=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(i,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){tie.forEach(i=>{t.addEventListener(i,o=>{let a=this.elementStateMap.get(e),l=o.type==="pause"?"paused":o.type;if(I.debug("[".concat(e,"] audio-element-status change ").concat(a," => ").concat(l)),o.type==="error"){let u=t==null?void 0:t.error;u&&I.error("[".concat(e,"] media error, code: ").concat(u.code,", message: ").concat(u.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(i=>{I.debug("Auto resume audio element success")}).catch(i=>{I.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new De(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{k_()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Xi(){return function(e,t,i){let o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new fe(W.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",I);for(var a=arguments.length,l=new Array(a),u=0;u<a;u++)l[u]=arguments[u];let f=o.apply(this,l);return f instanceof De?new De((m,_)=>{f.then(m).catch(_)}):f}),i}}class fj extends Ii{constructor(t){super(),me(this,"name","VideoProcessorDestination"),me(this,"ID","0"),me(this,"_source",void 0),me(this,"videoContext",void 0),me(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new fe(W.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new fe(W.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(Wr.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Wr.ON_TRACK,void 0)}}class mj extends Ii{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i){super(),me(this,"constraintsMap",new Map),me(this,"statsRegistry",[]),me(this,"usageRegistry",[]),me(this,"trackId",void 0),me(this,"direction",void 0),me(this,"_chained",!1),this.trackId=t,this.direction=i}async getConstraints(){return await dn(this,us.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,i){var o;return I.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),li(this,us.REQUEST_UPDATE_CONSTRAINTS,Array.from(sc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return I.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),li(this,us.REQUEST_UPDATE_CONSTRAINTS,Array.from(sc(i=this.constraintsMap).call(i)))}registerStats(t,i,o){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:o})}unregisterStats(t,i){let o=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:o,type:a,cb:l}of this.statsRegistry)try{let u=l();t.push({processorID:i,processorName:o,type:a,stats:u})}catch(u){I.error(new fe(W.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,i){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let o=i();o instanceof De&&(o=await o),t.push(Ai(Ai({},o),{},{direction:this.direction}))}catch(o){I.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class gj extends Ii{constructor(t){super(),me(this,"name","AudioProcessorDestination"),me(this,"ID","0"),me(this,"inputTrack",void 0),me(this,"inputNode",void 0),me(this,"audioProcessorContext",void 0),me(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new fe(W.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new fe(W.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Wr.ON_TRACK,void 0),this.emit(Wr.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(Wr.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(Wr.ON_NODE,this.inputNode))}}class _j extends Ii{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,i,o){super(),me(this,"constraintsMap",new Map),me(this,"statsRegistry",[]),me(this,"audioContext",void 0),me(this,"trackId",void 0),me(this,"direction",void 0),me(this,"usageRegistry",[]),me(this,"_chained",!1),this.audioContext=t,this.trackId=i,this.direction=o}async getConstraints(){return dn(this,us.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,i){var o;return I.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(i,t),li(this,us.REQUEST_UPDATE_CONSTRAINTS,Array.from(sc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(t){var i;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),li(this,us.REQUEST_UPDATE_CONSTRAINTS,Array.from(sc(i=this.constraintsMap).call(i)))}registerStats(t,i,o){this.statsRegistry.find(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:i,cb:o})}unregisterStats(t,i){let o=this.statsRegistry.findIndex(a=>a.processorID===t.ID&&a.processorName===t.name&&a.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){let t=[];for(let{processorID:i,processorName:o,type:a,cb:l}of this.statsRegistry)try{let u=l();t.push({processorID:i,processorName:o,type:a,stats:u})}catch(u){I.error(new fe(W.UNEXPECTED_ERROR,u.message))}return t}registerUsage(t,i){this.usageRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:i})}unregisterUsage(t){let i=this.usageRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let o=i();o instanceof De&&(o=await o),t.push(Ai(Ai({},o),{},{direction:this.direction}))}catch(o){I.error("gather extension usage error",o)}return t}getDirection(){return this.direction}}class RI extends Ii{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),me(this,"context",void 0),me(this,"processSourceNode",void 0),me(this,"outputTrack",void 0),me(this,"processedNode",void 0),me(this,"clonedTrack",void 0),me(this,"outputNode",void 0),this.outputNode=new iie}setVolume(){}createOutputTrack(){throw new fe(W.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class iie{disconnect(){}connect(){}}function Ej(e){return new De((t,i)=>{let o=!1,a=document.createElement("video");a.setAttribute("autoplay",""),a.setAttribute("muted",""),a.muted=!0,a.autoplay=!0,a.setAttribute("playsinline",""),a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(a);let l=ur()?"canplay":"playing";a.addEventListener(l,()=>{let u=a.videoWidth,f=a.videoHeight;!u&&ci()||(o=!0,a.srcObject=null,a.remove(),t([u,f]))}),a.srcObject=new MediaStream([e]),a.play().catch(Qy),setTimeout(()=>{o||(a.srcObject=null,a.remove(),t([a.videoWidth,a.videoHeight]))},4e3)})}function B0(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let i=rl(e.encoderConfig);return i.width!=null&&(t.width=i.width),i.height!=null&&(t.height=i.height),!yM()&&i.frameRate&&(t.frameRate=i.frameRate),dM()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),ci()&&(t.frameRate={ideal:30,max:30}),t}function vj(e){let t={};if(yM()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ru()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){let i=j0(e.encoderConfig);t.channelCount=i.stereo?2:1,t.sampleRate=i.sampleRate,t.sampleSize=i.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Xy()&&(t.sampleRate=void 0),t}let nie=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:i,width:o,height:a}=e.getMediaStreamTrackSettings(),{frameRate:l=i,width:u=o,height:f=a}=t;if(!l||!u||!f)return;u=Qb(u),f=Qb(f),l=Qb(l);let{max:m,min:_}=function(b,V,P){let k=200*Math.pow(P/15,.6)*Math.pow(b*V/640/360,.75);return{min:Math.floor(k),max:Math.floor(4*k)}}(u,f,l),{bitrateMax:v,bitrateMin:S}=t||{};v||I.debug("calculate bitrate: [w: ".concat(u,", h: ").concat(f,", fps: ").concat(l,"] => [brMax: ").concat(v,", brMin: ").concat(S,"]"));let{maxFramerate:C}=$("ENCODER_CONFIG_LIMIT");return C&&typeof C=="number"&&(l=Math.min(l,C)),{frameRate:l,bitrateMax:v||m,bitrateMin:S||_,scaleResolutionDownBy:1,scale:0}},yj=async(e,t,i)=>await(async(o,a,l)=>{let u=function(_){let v=[];for(let S=0;S<_.length;S+=2)v.push(parseInt(_.slice(S,S+2),16));return Uint8Array.from(v)}(VM(""+a+l)).slice(0,16),f=u.slice(0,12),m=await window.crypto.subtle.importKey("raw",u,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:f},m,o))})(e.buffer,t,i),II=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new De((i,o)=>{t.toBlob(async a=>{if(t.remove(),a){let l=await Sj(a);i({buffer:l,width:t.width,height:t.height})}else o(new fe(W.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},Sj=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var Tj,wj,Cj,bj,Rj,Ij,Aj,Oj,Pj,Nj,xj,Dj,kj,Lj,Mj,Uj,jj,Vj,ki,Fj,Bj,Wj,zj,Hj,Gj,sl,Kj,qj,Yj,$j,Xj,Jj,Zj,Qj,eV,tV,iV,nV,rV,sr;let Bi=(Tj=Ze({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),wj=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Cj=Xi(),bj=am("LocalAudioTrack","_enabledMutex"),Rj=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Ij=Xi(),Aj=am("LocalAudioTrack","_enabledMutex"),Oj=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Pj=Xi(),Nj=Xi(),xj=Xi(),Dj=Ze({argsMap:e=>[e.getTrackId()]}),kj=Xi(),Lj=Ze({argsMap:e=>[e.getTrackId()]}),Mj=Xi(),Uj=Ze({argsMap:e=>[e.getTrackId()]}),jj=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Vj=Ze({argsMap:e=>[e.getTrackId()]}),Dt((ki=class extends Dm{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?to.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,i,o){super(e,i),me(this,"trackMediaType","audio"),me(this,"_encoderConfig",void 0),me(this,"_trackSource",void 0),me(this,"_enabled",!0),me(this,"_volume",100),me(this,"_useAudioElement",!0),me(this,"_bypassWebAudio",!1),me(this,"processor",void 0),me(this,"_processorContext",void 0),me(this,"_processorDestination",void 0),me(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!o,this._trackSource=new RI,$("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),$("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Pn()&&!hs?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){si(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&to.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void I.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,li(this,Ve.NEED_REPLACE_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{I.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!ZU())throw new fe(W.NOT_SUPPORTED,"your browser does not support setting the audio output device");await to.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,i){return this._setEnabled(e,t,i)}async _setEnabled(e,t,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await li(this,Ve.NEED_ENABLE_TRACK,this),I.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await li(this,Ve.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await li(this,Ve.NEED_MUTE_TRACK,this):await li(this,Ve.NEED_UNMUTE_TRACK,this))}getStats(){return su(()=>{I.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Vo(this,Ve.GET_STATS)||Ai({},vI)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ds.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ds.ON_AUDIO_BUFFER),this._source.on(ds.ON_AUDIO_BUFFER,i=>e(i))}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] start audio playback in element")),to.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?to.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&to.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await li(this,Ve.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return De.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new fe(W.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new fe(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(Wr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await li(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await li(this,Ve.NEED_REPLACE_TRACK,this))}),e.on(Wr.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(Wr.ON_TRACK),e.removeAllListeners(Wr.ON_NODE)}bindProcessorContextEvents(e){e.on(us.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(us.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof RI&&(this._trackSource=new aj(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new _j(this._source.context,this.getTrackId(),"local"),t=new gj(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(ds.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(to.stop(this.getTrackId()),this._source.play()),li(this,Ve.NEED_REPLACE_MIXING_TRACK,this).then(()=>{I.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{I.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Tj],Object.getOwnPropertyDescriptor(ki.prototype,"setVolume"),ki.prototype),Dt(ki.prototype,"setPlaybackDevice",[wj,Cj],Object.getOwnPropertyDescriptor(ki.prototype,"setPlaybackDevice"),ki.prototype),Dt(ki.prototype,"setEnabled",[bj,Rj,Ij],Object.getOwnPropertyDescriptor(ki.prototype,"setEnabled"),ki.prototype),Dt(ki.prototype,"setMuted",[Aj,Oj,Pj],Object.getOwnPropertyDescriptor(ki.prototype,"setMuted"),ki.prototype),Dt(ki.prototype,"getStats",[Nj],Object.getOwnPropertyDescriptor(ki.prototype,"getStats"),ki.prototype),Dt(ki.prototype,"setAudioFrameCallback",[xj],Object.getOwnPropertyDescriptor(ki.prototype,"setAudioFrameCallback"),ki.prototype),Dt(ki.prototype,"play",[Dj,kj],Object.getOwnPropertyDescriptor(ki.prototype,"play"),ki.prototype),Dt(ki.prototype,"stop",[Lj,Mj],Object.getOwnPropertyDescriptor(ki.prototype,"stop"),ki.prototype),Dt(ki.prototype,"close",[Uj],Object.getOwnPropertyDescriptor(ki.prototype,"close"),ki.prototype),Dt(ki.prototype,"pipe",[jj],Object.getOwnPropertyDescriptor(ki.prototype,"pipe"),ki.prototype),Dt(ki.prototype,"unpipe",[Vj],Object.getOwnPropertyDescriptor(ki.prototype,"unpipe"),ki.prototype),ki),W0=(Fj=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),Bj=Xi(),Wj=am("MicrophoneAudioTrack","_enabledMutex"),zj=Ze({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),Hj=Xi(),Gj=Ze({argsMap:e=>[e.getTrackId()]}),Dt((sl=class extends Bi{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,i,o){super(e,t.encoderConfig?j0(t.encoderConfig):{},o,$("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),me(this,"_config",void 0),me(this,"_deviceName","default"),me(this,"_constraints",void 0),me(this,"_originalConstraints",void 0),me(this,"_enabled",!0),this._config=t,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(rm()||Kb())&&ni.bindInterruptDetectorTrack(this)}async setDevice(e){if(I.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await fs.getDeviceById(e),i={};i.audio=Ai({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await ps(i,this.getTrackId())}catch(a){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),a.toString()),o=await ps({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await fs.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}I.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,i){if(t)return I.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),e),$("AUTO_RESET_AUDIO_ROUTE")&&(ur()||da())){let u=navigator.audioSession;u&&(e||(u.type="playback"),u.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await li(this,Ve.NEED_DISABLE_TRACK,this)}catch(u){throw I.error("[".concat(this.getTrackId(),"] setEnabled false failed"),u.toString()),u}return}let a=Ai({},this._constraints),l=fs.searchDeviceIdByName(this._deviceName);l&&!a.deviceId&&(a.deviceId=l);try{i||(this._enabled=!0);let u=await ps({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(u.getAudioTracks()[0],!1),await li(this,Ve.NEED_ENABLE_TRACK,this)}catch(u){throw i||(this._enabled=!1),I.error("[".concat(this.getTrackId(),"] setEnabled true failed"),u.toString()),u}I.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(rm()||Kb())&&ni.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((ur()||da())&&this._enabled&&!this._isClosed&&ni.duringInterruption){let e=async()=>{ni.off(Kn.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ni.on(Kn.IOS_INTERRUPTION_END,e)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Nm.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,i=fs.searchDeviceIdByName(this._deviceName);if(i&&!t.deviceId&&(t.deviceId=i),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let o=await ps({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(us.REQUEST_UPDATE_CONSTRAINTS,async(t,i,o)=>{try{let a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){o(a)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(us.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Fj,Bj],Object.getOwnPropertyDescriptor(sl.prototype,"setDevice"),sl.prototype),Dt(sl.prototype,"setEnabled",[Wj,zj,Hj],Object.getOwnPropertyDescriptor(sl.prototype,"setEnabled"),sl.prototype),Dt(sl.prototype,"close",[Gj],Object.getOwnPropertyDescriptor(sl.prototype,"close"),sl.prototype),sl),rie=(Kj=Ze({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),qj=Xi(),Yj=Ze({argsMap:e=>[e.getTrackId()]}),$j=Xi(),Xj=Ze({argsMap:e=>[e.getTrackId()]}),Jj=Xi(),Zj=Ze({argsMap:e=>[e.getTrackId()]}),Qj=Xi(),eV=Ze({argsMap:e=>[e.getTrackId()]}),tV=Xi(),iV=Ze({argsMap:e=>[e.getTrackId()]}),nV=Ze({argsMap:e=>[e.getTrackId()]}),rV=Xi(),Dt((sr=class extends Bi{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,i,o){super(t.createOutputTrack(),i,o),me(this,"source",void 0),me(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(ds.AUDIO_SOURCE_STATE_CHANGE,a=>{this.safeEmit(Nm.SOURCE_STATE_CHANGE,a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){si(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Kj,qj],Object.getOwnPropertyDescriptor(sr.prototype,"startProcessAudioBuffer"),sr.prototype),Dt(sr.prototype,"pauseProcessAudioBuffer",[Yj,$j],Object.getOwnPropertyDescriptor(sr.prototype,"pauseProcessAudioBuffer"),sr.prototype),Dt(sr.prototype,"seekAudioBuffer",[Xj,Jj],Object.getOwnPropertyDescriptor(sr.prototype,"seekAudioBuffer"),sr.prototype),Dt(sr.prototype,"resumeProcessAudioBuffer",[Zj,Qj],Object.getOwnPropertyDescriptor(sr.prototype,"resumeProcessAudioBuffer"),sr.prototype),Dt(sr.prototype,"stopProcessAudioBuffer",[eV,tV],Object.getOwnPropertyDescriptor(sr.prototype,"stopProcessAudioBuffer"),sr.prototype),Dt(sr.prototype,"close",[iV],Object.getOwnPropertyDescriptor(sr.prototype,"close"),sr.prototype),Dt(sr.prototype,"setAudioBufferPlaybackSpeed",[nV,rV],Object.getOwnPropertyDescriptor(sr.prototype,"setAudioBufferPlaybackSpeed"),sr.prototype),sr);class Sn extends Bi{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=km().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,di(8,"track-mix-")),me(this,"trackList",void 0),me(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(I.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):I.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){I.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Jy(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(i=>{i instanceof Sn?i.emit(Sp.TRANSCEIVER_UPDATED,t):i._updateRtpTransceiver(t)}))}}class oie extends sj{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(ds.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),me(this,"audioBuffer",void 0),me(this,"sourceNode",void 0),me(this,"startPlayTime",0),me(this,"startPlayOffset",0),me(this,"pausePlayTime",0),me(this,"options",void 0),me(this,"currentLoopCount",0),me(this,"currentPlaybackSpeed",100),me(this,"_currentState","stopped"),this.audioBuffer=t,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):I.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let oV=new Map;class AI{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let t=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(I.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var i;t!==this._videoState&&(this._videoState=t,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(t){me(this,"trackId",void 0),me(this,"config",void 0),me(this,"onFirstVideoFrameDecoded",void 0),me(this,"onVideoStateChanged",void 0),me(this,"freezeTimeCounterList",[]),me(this,"renderFreezeAccTime",0),me(this,"isKeepLastFrame",!1),me(this,"timeUpdatedCount",0),me(this,"freezeTime",0),me(this,"playbackTime",0),me(this,"lastTimeUpdatedTime",0),me(this,"autoplayFailed",!1),me(this,"videoTrack",void 0),me(this,"videoElement",void 0),me(this,"cacheVideoElement",void 0),me(this,"renderStats",void 0),me(this,"_videoState",ol.VideoStateStopped),me(this,"videoElementCheckInterval",void 0),me(this,"videoElementFreezeTimeout",void 0),me(this,"_videoElementStatus",Or.NONE),me(this,"isGettingVideoDimensions",!1),me(this,"startGetVideoDimensions",()=>{let i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return I.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),me(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&ni.curState==="running"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(lM())),EM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),me(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Or.PLAYING;break;case"loadeddata":if(this.videoState=ol.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Or.CANPLAY;break;case"stalled":this.videoElementStatus=Or.STALLED;break;case"suspend":this.videoElementStatus=Or.SUSPEND;break;case"pause":this.videoElementStatus=Or.PAUSED,ur()||da()||Pn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Or.WAITING;break;case"abort":this.videoElementStatus=Or.ABORT;break;case"ended":this.videoElementStatus=Or.ENDED;break;case"emptied":this.videoElementStatus=Or.EMPTIED;break;case"error":{let o=this.videoElement.error;o?(this.videoElementStatus=Or.ERROR,I.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")"))):I.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{let o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);let a=o-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,td.lastVisibleTime<td.lastHiddenTime||l<td.lastHiddenTime||l<td.lastVisibleTime)return;for(a>$("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=a),this.playbackTime+=a;this.playbackTime>=6e3;){this.playbackTime-=6e3;let u=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(u),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),me(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(I.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(lM())),EM()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),ni.on(Kn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ni.on(Kn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let i=this.videoElement.play();i&&i.catch&&i.catch(a=>{t&&pj(t,"video",a.message,this.trackId),a.name==="NotAllowedError"?(I.warning("detected video element autoplay failed",a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):I.warning("[".concat(this.trackId,"] play warning: "),a)});let o=Ut();if((o.name==="Safari"&&Number(o.version)===15||rm())&&i&&i.then){let a=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(a).catch(a)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let i=t.getContext("2d");if(!i)return I.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,t.width,t.height);let o=i.getImageData(0,0,t.width,t.height);return t.remove(),o}async getCurrentFrameToUint8Array(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;let a=o.getContext("2d");return a?(a.drawImage(this.videoElement,0,0,o.width,o.height),new De((l,u)=>{o.toBlob(async f=>{if(o.remove(),f){let m=await Sj(f);l({buffer:m,width:o.width,height:o.height})}else u(new fe(W.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,i<0?.1:i>1?1:i)})):await II(t)}destroy(){this.renderStats=void 0,ni.off(Kn.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),ni.off(Kn.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=ol.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Or.INIT,!this.videoElementCheckInterval&&(sV.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(l){return l!==document.body&&document.body.contains(l)})(this.videoElement)||(this.videoElementStatus=Or.DESTROYED)},1e3),$("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,i;let l,u=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",u),this.videoElementFreezeTimeout=window.setTimeout(f,$("VIDEO_FREEZE_DURATION")))},f=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===ol.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=ol.VideoStateFrozen:document.addEventListener("visibilitychange",u))},m=(_,v)=>{if(this.videoElementStatus===Or.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=v.mediaTime):this.renderStats={lastTs:v.mediaTime,curTs:v.mediaTime,lastRenderNum:0,renderNum:0},l){let b=v.presentationTime-l.presentationTime;this.videoState===ol.VideoStateStarting&&(this.videoState=ol.VideoStateDecoding),this.videoState===ol.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(f,$("VIDEO_FREEZE_DURATION"))),b<$("VIDEO_FREEZE_DURATION")&&this.videoState===ol.VideoStateFrozen&&(this.videoState=ol.VideoStateDecoding),b>$("VIDEO_FREEZE_DURATION")&&td.lastVisibleTime>=td.lastHiddenTime&&l.timestamp>td.lastVisibleTime&&l.timestamp>td.lastHiddenTime&&(this.renderFreezeAccTime+=b)}l=Ai(Ai({},v),{},{timestamp:_})}var S,C;$("ENABLE_VIDEO_FRAME_CALLBACK")&&((S=(C=this.videoElement).requestVideoFrameCallback)===null||S===void 0||S.call(C,m))};(t=(i=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(i,m)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Xy()&&!$("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let o=Ut();o.name==="Safari"&&Number(o.version)===15||rm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ci()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ci()&&this.videoElement.load());let a=this.videoElement.play();a!==void 0&&a.catch(l=>{I.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){sV.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Or.NONE}handleAutoPlayFailed(){let t=i=>{i.preventDefault(),this.videoElement.play().then(()=>{I.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{I.error(o)}),this.autoplayFailed=!1,k_()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};k_()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),hj()}}let sV=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class aV extends AI{constructor(t){super(t),me(this,"container",void 0),me(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let i=t.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,o):await II(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",$("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var cV,lV,dV,uV,hV,pV,fV,mV,gV,_V,EV,vV,yV,SV,TV,wV,CV,bV,RV,IV,AV,OV,PV,NV,xV,Rt,DV,kV,LV,MV,UV,jV,VV,FV,gs;let ui=(cV=Ze({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),lV=Xi(),dV=Ze({argsMap:e=>[e.getTrackId()]}),uV=am("LocalVideoTrack","_enabledMutex"),hV=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),pV=Xi(),fV=am("LocalVideoTrack","_enabledMutex"),mV=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),gV=Xi(),_V=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),EV=Xi(),vV=Xi(),yV=Ze({argsMap:(e,t,i)=>[e.getTrackId(),t,i]}),SV=Xi(),TV=Xi(),wV=Xi(),CV=Xi(),bV=Xi(),RV=Xi(),IV=Xi(),AV=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),OV=Ze({argsMap:e=>[e.getTrackId()]}),PV=Ze({argsMap:e=>[e.getTrackId()]}),NV=Ze({argsMap:(e,t,i)=>[e.getTrackId(),t.label,i]}),xV=Ze(),Rt=class $G extends Dm{get videoHeight(){if(Pn()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Pn()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Or.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,i,o,a,l,u){if(super(t,l),me(this,"trackMediaType","video"),me(this,"_player",void 0),me(this,"isUseScaleResolutionDownBy",!1),me(this,"_videoVisibleTimer",null),me(this,"_statsTimer",null),me(this,"_previousVideoVisibleStatus",void 0),me(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),me(this,"_encoderConfig",void 0),me(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),me(this,"_optimizationMode",void 0),me(this,"_videoHeight",void 0),me(this,"_videoWidth",void 0),me(this,"_forceBitrateLimit",void 0),me(this,"_enabled",!0),me(this,"_processorDestination",void 0),me(this,"_processorContext",void 0),Pn()){let{width:f,height:m}=t.getSettings();this._videoWidth=f,this._videoHeight=m}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=a,this._hints=u||[],this._hints.indexOf(gi.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(f,m,_){let v=Ut();return!(v.name!==f||!v.osVersion)&&Number(v.version)===m}($t.CHROME,115)&&Yy().indexOf("Windows")!==-1){let f=function(m,_){if("VideoFrame"in window&&"TransformStream"in window&&xt().supportWebRTCInsertableStream){let v=new MediaStreamTrackProcessor(m),S=new MediaStreamTrackGenerator({kind:"video"}),C,b,V=Date.now(),P=()=>{k&&(clearInterval(k),k=void 0),C&&(C.close(),C=void 0),m.stop(),b=void 0,S.removeEventListener("ended",P)},k=window.setInterval(()=>{if(b&&C&&Date.now()-V>1e3)try{S.readyState==="live"?b.enqueue(C.clone()):P()}catch{P()}},1e3),F=new TransformStream({transform:(H,ie)=>{S.readyState==="live"?(b=ie,V=Date.now(),C===void 0?(C=H,ie.enqueue(H.clone())):(ie.enqueue(C),C=H)):H.close()}});return S.addEventListener("ended",P),v.readable.pipeThrough(F).pipeTo(S.writable),S}}(t);f&&(I.info("local screen video track begin to inject frame"),this._mediaStreamTrack=f)}i&&this._hints.indexOf(gi.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new mj(this.getTrackId(),"local"),this._processorDestination=new fj(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let a=document.getElementById(t);a?t=a:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let o=Ai(Ai(Ai({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(o):(t instanceof HTMLVideoElement?this._player=new AI(o):this._player=new aV(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let a=this.getVideoElementVisibleStatus();this.safeEmit(Nm.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await li(this,Ve.NEED_DISABLE_TRACK,this)}catch(o){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await li(this,Ve.NEED_ENABLE_TRACK,this)}catch(o){throw I.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,I.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await li(this,Ve.NEED_MUTE_TRACK,this):await li(this,Ve.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,i){if(!this._enabled)throw new fe(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=rl(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let o=B0({encoderConfig:t});(Pn()||ur()||da())&&(o.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(a){let l=new fe(W.UNEXPECTED_ERROR,a.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=t,this._hints.indexOf(gi.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await li(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(I)}}getStats(){return su(()=>{I.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Vo(this,Ve.GET_STATS)||Ai({},yI)}async setBeautyEffect(t){I.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,i):await II(t)}async setBitrateLimit(t){if(I.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await li(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(I)}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void I.error(W.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=t,await li(this,Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,I.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}I.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return I.error(W.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,I.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Ej(this._originMediaStreamTrack).then(t=>{let[i,o]=t;this._videoHeight=o,this._videoWidth=i}).catch(Qy)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new fe(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");I.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=rl(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(gi.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await li(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(I)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!t||!i||!o)return;let{bitrateMax:a,bitrateMin:l}=this._encoderConfig;if(l==null||a==null){let{max:u,min:f}=function(m,_,v,S,C){let b=$("BITRATE_ADAPTER_TYPE");if(b==="DEFAULT_BITRATE")return{min:S,max:C};if(C===void 0){var V;let k=Math.floor(200*Math.pow(v/15,.6)*Math.pow(m*_/640/360,.75));C=b==="STANDARD_BITRATE"?4*k:2*k,S=(V=S)!==null&&V!==void 0?V:k}else{var P;S=(P=S)!==null&&P!==void 0?P:Math.floor(C/10)}return{min:S,max:C}}(t,i,o,l,a);this._encoderConfig.bitrateMin=f,this._encoderConfig.bitrateMax=u,I.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(u,", brMin: ").concat(f,"]"))}}getVideoElementVisibleStatus(){try{var t,i;let o=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:l,slot:u}=a;if(this.isPlaying&&l instanceof HTMLVideoElement&&u instanceof HTMLElement){let f=bM.checkOneElementVisible(l),m=Object.assign({},f);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;let _=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(o){throw new fe(W.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new fe(W.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Ai(Ai({},o),rl(t))),o=sp(o);let a=di(8,"track-video-cloned-"),l=new $G(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,sp(this._scalabilityMode),this._optimizationMode,a,sp(this._hints));return t&&o&&l.setEncoderConfiguration(o),I.debug("clone video track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(i)),l}async replaceTrack(t,i){if(!(t instanceof MediaStreamTrack))throw new fe(W.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new fe(W.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,i,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!Pn()&&!ur())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,i=M0[t],o=-1,a=Date.now(),l=u=>{u>2||u<0||(a=Date.now(),i=M0[u],this.setSenderConfiguration(i))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{let u=this.getStats(),f=Vo(this,Ve.GET_RTC_STATS);if(u.sendPackets>0&&f){o===-1&&(o=Date.now());let m=Date.now();if(m-o<1e3||m-a<$("PROFILE_SWITCH_INTERVAL"))return;let _=u.sendFrameRate,v=.6*i.frameRate,S=.9*i.frameRate;typeof _=="number"&&_>0&&_<v?t>0&&(t--,l(t),I.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(_,", switchProfile to ").concat(t))):f.OutgoingAvailableBandwidth<i.bitrateMin?t>0&&(t--,l(t),I.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(f.OutgoingAvailableBandwidth,", bitrateMin ").concat(i.bitrateMin,", switchProfile to ").concat(t))):typeof _=="number"&&_>S&&t<M0.length-1&&f.OutgoingAvailableBandwidth>1.2*M0[t+1].bitrateMin&&(t++,l(t),I.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(_,", OutgoingAvailableBandwidth ").concat(f.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}},$("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(t){if(su(()=>{Ge.reportApiInvoke(null,{name:ln.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Ui.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!$("ENABLE_VIDEO_SEI")||!$("ENABLE_ENCODED_TRANSFORM"))return void I.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new fe(W.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void I.warning("Video track is not published, SEI can not be send");let o=i.sender.getParameters();if(o.codecs.length===0)return;let a=o.codecs[0].mimeType.toLocaleLowerCase();a==="video/h264"?this.safeEmit("sei-to-send",t):I.warning("SEI is not supported by ".concat(a))}bindProcessorDestinationEvents(){this.processorDestination.on(Wr.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await li(this,Ve.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await li(this,Ve.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wr.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(us.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(us.REQUEST_CONSTRAINTS)}},Dt(Rt.prototype,"play",[cV,lV],Object.getOwnPropertyDescriptor(Rt.prototype,"play"),Rt.prototype),Dt(Rt.prototype,"stop",[dV],Object.getOwnPropertyDescriptor(Rt.prototype,"stop"),Rt.prototype),Dt(Rt.prototype,"setEnabled",[uV,hV,pV],Object.getOwnPropertyDescriptor(Rt.prototype,"setEnabled"),Rt.prototype),Dt(Rt.prototype,"setMuted",[fV,mV,gV],Object.getOwnPropertyDescriptor(Rt.prototype,"setMuted"),Rt.prototype),Dt(Rt.prototype,"setEncoderConfiguration",[_V,EV],Object.getOwnPropertyDescriptor(Rt.prototype,"setEncoderConfiguration"),Rt.prototype),Dt(Rt.prototype,"getStats",[vV],Object.getOwnPropertyDescriptor(Rt.prototype,"getStats"),Rt.prototype),Dt(Rt.prototype,"setBeautyEffect",[yV,SV],Object.getOwnPropertyDescriptor(Rt.prototype,"setBeautyEffect"),Rt.prototype),Dt(Rt.prototype,"getCurrentFrameData",[TV],Object.getOwnPropertyDescriptor(Rt.prototype,"getCurrentFrameData"),Rt.prototype),Dt(Rt.prototype,"getCurrentFrameImage",[wV],Object.getOwnPropertyDescriptor(Rt.prototype,"getCurrentFrameImage"),Rt.prototype),Dt(Rt.prototype,"setBitrateLimit",[CV],Object.getOwnPropertyDescriptor(Rt.prototype,"setBitrateLimit"),Rt.prototype),Dt(Rt.prototype,"setOptimizationMode",[bV],Object.getOwnPropertyDescriptor(Rt.prototype,"setOptimizationMode"),Rt.prototype),Dt(Rt.prototype,"setScalabiltyMode",[RV],Object.getOwnPropertyDescriptor(Rt.prototype,"setScalabiltyMode"),Rt.prototype),Dt(Rt.prototype,"updateMediaStreamTrackResolution",[IV],Object.getOwnPropertyDescriptor(Rt.prototype,"updateMediaStreamTrackResolution"),Rt.prototype),Dt(Rt.prototype,"pipe",[AV],Object.getOwnPropertyDescriptor(Rt.prototype,"pipe"),Rt.prototype),Dt(Rt.prototype,"unpipe",[OV],Object.getOwnPropertyDescriptor(Rt.prototype,"unpipe"),Rt.prototype),Dt(Rt.prototype,"close",[PV],Object.getOwnPropertyDescriptor(Rt.prototype,"close"),Rt.prototype),Dt(Rt.prototype,"replaceTrack",[NV],Object.getOwnPropertyDescriptor(Rt.prototype,"replaceTrack"),Rt.prototype),Dt(Rt.prototype,"startMonitorStats",[xV],Object.getOwnPropertyDescriptor(Rt.prototype,"startMonitorStats"),Rt.prototype),Rt),OI=(DV=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),kV=Xi(),LV=am("CameraVideoTrack","_enabledMutex"),MV=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),UV=Xi(),jV=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),VV=Xi(),FV=Ze({argsMap:e=>[e.getTrackId()]}),gs=class XG extends ui{get __className__(){return"CameraVideoTrack"}constructor(t,i,o,a,l,u){super(t,rl(i.encoderConfig),a,l,u),me(this,"_config",void 0),me(this,"_originalConstraints",void 0),me(this,"_constraints",void 0),me(this,"_enabled",!0),me(this,"_deviceName","default"),me(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(rm()||Kb())&&!function(){let f=Ut();if(f.os!==On.IOS||!f.osVersion)return!1;let m=f.osVersion.split(".");return Number(m[0])===15&&Number(m[1])>=2}()&&vM()&&this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=t.label,this._encoderConfig=rl(this._config.encoderConfig),ni.on(Kn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ni.on(Kn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(I.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let i=await fs.getDeviceById(t),o={};o.video=Ai({},this._constraints),o.video.deviceId={exact:t},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let a=null;try{a=await ps(o,this.getTrackId())}catch(l){throw I.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),a=await ps({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await fs.getDeviceById(t);this._deviceName=i.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(i){throw I.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}I.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){I.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let i={video:Ai(Ai({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await ps(i,this.getTrackId())}catch(a){throw I.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),a.toString()),o=await ps({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),a}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ai({},i.video),I.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,i){if(!i){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(I.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let o=await ps({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await li(this,Ve.NEED_ENABLE_TRACK,this)}catch(o){throw I.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),I.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await li(this,Ve.NEED_DISABLE_TRACK,this)}catch(o){throw I.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}I.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,i){if(!this._enabled)throw new fe(W.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=rl(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let o=mi(this._config);o.encoderConfig=t;let a=B0(o);(Pn()||ur()||da())&&(a.deviceId=void 0),I.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(l){let u=new fe(W.UNEXPECTED_ERROR,l.toString());throw I.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}this._config=o,this._constraints=a,this._originalConstraints=a,this._encoderConfig=t,this._hints.indexOf(gi.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await li(this,Ve.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(I)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((ur()||da())&&this._enabled&&!this._isClosed&&ni.duringInterruption){let t=async()=>{ni.off(Kn.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(I.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};ni.on(Kn.IOS_INTERRUPTION_END,t)}else I.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Nm.TRACK_ENDED)}async renewMediaStreamTrack(t){let i=t||this._constraints,o=fs.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){let a=await ps({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),ni.off(Kn.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),ni.off(Kn.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;t&&(o=Ai(Ai({},o),rl(t))),o=sp(o);let a=di(8,"track-cam-cloned-"),l=new XG(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,sp(Ai(Ai({},this._config),{},{encoderConfig:o})),sp(this._constraints),sp(this._scalabilityMode),this._optimizationMode,a);return t&&o&&l.setEncoderConfiguration(o),I.debug("clone track from ".concat(this.getTrackId()," to ").concat(a,", clone ").concat(i)),l}bindProcessorContextEvents(){this.processorContext.on(us.REQUEST_UPDATE_CONSTRAINTS,async(t,i,o)=>{try{let a=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(a),i()}catch(a){o(a)}}),this.processorContext.on(us.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},Dt(gs.prototype,"setDevice",[DV,kV],Object.getOwnPropertyDescriptor(gs.prototype,"setDevice"),gs.prototype),Dt(gs.prototype,"setEnabled",[LV,MV,UV],Object.getOwnPropertyDescriptor(gs.prototype,"setEnabled"),gs.prototype),Dt(gs.prototype,"setEncoderConfiguration",[jV,VV],Object.getOwnPropertyDescriptor(gs.prototype,"setEncoderConfiguration"),gs.prototype),Dt(gs.prototype,"close",[FV],Object.getOwnPropertyDescriptor(gs.prototype,"close"),gs.prototype),gs);function PI(e,t,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=Ai(Ai({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(t.contentHint=i.optimizationMode,t.contentHint===i.optimizationMode?I.debug("[".concat(e,"] set content hint to"),i.optimizationMode):I.debug("[".concat(e,"] set content hint failed")))):I.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var BV,WV,zV,HV,Ls,GV,KV,qV,YV,$V,XV,Pr;class JV extends nj{getUserId(){return this._userId}constructor(t,i,o,a){super(t,"track-".concat(t.kind,"-").concat(i,"-").concat(a.clientId,"_").concat(di(5,""))),me(this,"_userId",void 0),me(this,"_uintId",void 0),me(this,"_isDestroyed",!1),me(this,"store",void 0),me(this,"processor",void 0),me(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=a}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,I.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Mm=(BV=Ze({argsMap:(e,t,i)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),WV=Ze({argsMap:e=>[e.getTrackId()]}),zV=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),HV=Ze({argsMap:e=>[e.getTrackId()]}),Dt((Ls=class extends JV{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Or.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,i,o){super(e,t,i,o),me(this,"_videoVisibleTimer",null),me(this,"_previousVideoVisibleStatus",void 0),me(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),me(this,"trackMediaType","video"),me(this,"_videoWidth",void 0),me(this,"_videoHeight",void 0),me(this,"_player",void 0),me(this,"processorDestination",void 0),me(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new mj(this.getTrackId(),"remote"),this.processorDestination=new fj(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return su(()=>{I.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Vo(this,Ve.GET_STATS)||Ai({},tj)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let o=document.getElementById(e);o?e=o:(I.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}I.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let i=Ai(Ai({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new AI(i):this._player=new aV(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(xm.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(xm.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let o=this.getVideoElementVisibleStatus();this.safeEmit(xm.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},$("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,I.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Ej(this._originMediaStreamTrack).then(e=>{let[t,i]=e;this._videoHeight=i,this._videoWidth=t}).catch(Qy)}_updatePlayerSource(){I.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:a,slot:l}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&l instanceof HTMLElement){let u=bM.checkOneElementVisible(a),f=Object.assign({},u);if(f.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=f.visible;let m=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});f.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(f.reason))}return f}return}catch(i){throw new fe(W.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new fe(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Wr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wr.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Sp.SEI_RECEIVED,e)}}).prototype,"play",[BV],Object.getOwnPropertyDescriptor(Ls.prototype,"play"),Ls.prototype),Dt(Ls.prototype,"stop",[WV],Object.getOwnPropertyDescriptor(Ls.prototype,"stop"),Ls.prototype),Dt(Ls.prototype,"pipe",[zV],Object.getOwnPropertyDescriptor(Ls.prototype,"pipe"),Ls.prototype),Dt(Ls.prototype,"unpipe",[HV],Object.getOwnPropertyDescriptor(Ls.prototype,"unpipe"),Ls.prototype),Ls),Um=(GV=Ze({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),KV=Ze({argsMap:(e,t)=>[e.getTrackId(),t]}),qV=Ze({argsMap:e=>[e.getTrackId()]}),YV=Ze({argsMap:e=>[e.getTrackId()]}),$V=Ze({argsMap:(e,t)=>[e.getTrackId(),t.name]}),XV=Ze({argsMap:e=>[e.getTrackId()]}),Dt((Pr=class extends JV{get isPlaying(){return this._useAudioElement?to.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,i,o){super(e,t,i,o),me(this,"trackMediaType","audio"),me(this,"_source",void 0),me(this,"_useAudioElement",!0),me(this,"_volume",100),me(this,"processorContext",void 0),me(this,"processorDestination",void 0),me(this,"_played",!1),me(this,"_bypassWebAudio",!1),$("DISABLE_WEBAUDIO")?(this._source=new RI,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new aj(e,!0),$("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ds.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(xm.FIRST_FRAME_DECODED)}),this.processorContext=new _j(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new gj(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ds.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ds.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(ds.ON_AUDIO_BUFFER),this._source.on(ds.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?to.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!ZU())throw new fe(W.NOT_SUPPORTED,"your browser does not support setting the audio output device");await to.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return su(()=>{I.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Vo(this,Ve.GET_STATS)||Ai({},ej)}play(){I.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(I.debug("[".concat(this.getTrackId(),"] use audio element to play")),to.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){I.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?to.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];I.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&to.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new fe(W.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new fe(W.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new fe(W.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Wr.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Wr.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Wr.ON_TRACK),this.processorDestination.removeAllListeners(Wr.ON_NODE)}}).prototype,"setVolume",[GV],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),Dt(Pr.prototype,"setPlaybackDevice",[KV],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),Dt(Pr.prototype,"play",[qV],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),Dt(Pr.prototype,"stop",[YV],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),Dt(Pr.prototype,"pipe",[$V],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),Dt(Pr.prototype,"unpipe",[XV],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),td=new class extends Ii{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),me(this,"_lastHiddenTime",0),me(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),I.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var ZV=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(ZV||{});class sie{constructor(){me(this,"_sequence",0),me(this,"_startTime",Date.now()),me(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let f=new Uint8Array(4);f.set([1,0,0,0]);let m={id:0,length:4,data:f.buffer},_={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[m]};i.commonPacketHeader.extension=1,i.extension=_,i.payload=this.compress(t),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;$("SHOW_DATASTREAM2_LOG")&&I.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));let o=new ArrayBuffer(i.commonPacketHeader.length),a=new Uint8Array(o),l=new DataView(o),u=0;if(l.setUint16(u,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),u+=2,l.setUint32(u,i.commonPacketHeader.sequence,!0),u+=4,l.setUint16(u,i.commonStreamHeader,!0),u+=2,i.extension){let f=this.serializeExtension(i.extension);a.set(new Uint8Array(f),u),u+=f.byteLength}if(a.set(new Uint8Array(i.payload),u),u+=i.payload.byteLength,u!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let i=new DataView(t),o=0,a=i.getUint16(o,!0);o+=2;let l={length:16383&a,reserved:(16384&a)>>14,extension:(32768&a)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)},u,f;if(o+=4,$("SHOW_DATASTREAM2_LOG")&&I.debug("receive data header: ".concat(JSON.stringify(l))),i.getUint16(o,!0),o+=2,l.extension){f=this.deserializeExtension(t.slice(o)),o+=2+f.length,u=t.slice(o);let m=!1;if(f.datas.length>0){let _=f.datas.find(v=>v.id===0);_&&(m=(1&new DataView(_.data).getUint32(0,!0))==1)}u=m?this.decompress(u):u}else u=t.slice(8);return u}serializeExtension(t){let{profile:i,length:o,datas:a}=t,l=new ArrayBuffer(o+2),u=new Uint8Array(l),f=new DataView(l),m=0;if(f.setUint8(m++,i),f.setUint8(m++,o),a.forEach(_=>{i?(f.setUint8(m++,_.id),f.setUint8(m++,_.length),u.set(new Uint8Array(_.data),m),m+=_.data.byteLength):(f.setUint8(m++,_.id|_.length<<4),u.set(new Uint8Array(_.data),m),m+=_.data.byteLength)}),m!==o+2)throw Error("serialize extension error, is ".concat(m,"!==").concat(o+2));return l}deserializeExtension(t){let i=new DataView(t),o=0,a=i.getUint8(o);o++;let l=i.getUint8(o);o++;let u=a===ZV.TWO_BYTE,f=[],m=new DataView(t,2),_=0;for(;_<l;){let v=0,S=0,C=new ArrayBuffer(0);u?(v=m.getUint8(_),_++,S=m.getUint8(_),_++):(v=15&m.getUint8(_),S=m.getUint8(_)>>4,_++),S>0&&(C=m.buffer.slice(_+2,_+2+S),_+=C.byteLength),f.push({id:v,length:S,data:C})}if(_!==l)throw Error("parse error");return{profile:a,length:l,datas:f}}decompress(t){return Gte(new Uint8Array(t))}compress(t){return Hte(new Uint8Array(t))}}class QV extends Ii{constructor(t,i){super(),me(this,"_version",1),me(this,"_type",3),me(this,"_config",void 0),me(this,"_originDataChannel",void 0),me(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),me(this,"_dataStreamPacketHandler",void 0),me(this,"_datachannelEventMap",new Map),this._config=t,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader(),this._dataStreamPacketHandler=new sie}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return $("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,i;return(t=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new De((t,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let o=setTimeout(()=>{var a;i(new fe(W.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((a=this._originDataChannel)===null||a===void 0?void 0:a.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new fe(W.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new fe(W.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[V0.OPEN,V0.CLOSE,V0.ERROR].forEach(i=>{let o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),t.addEventListener(i,o)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,a]=i;t.removeEventListener(o,a)}),this._datachannelEventMap.clear()}}class aie extends QV{constructor(t){super(t),me(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),a=new DataView(o).getUint8(3);if(a!==this.id)return void($("SHOW_DATASTREAM2_LOG")&&I.debug("invalid datachannel id: ".concat(a," !== ").concat(this.id)));let l=i.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(V0.MESSAGE,l)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class eF extends QV{send(t){if(this._originDataChannel){let i=t;i=this._dataStreamPacketHandler.serialize(t);let o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function z0(){let e=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>dU.revokeObjectURL(e),0),new Worker(dU.createObjectURL(e))}let H0=new Map,G0=new Map,K0=new Map;async function cie(e,t){if(!xt().supportWebRTCEncodedTransform)return void I.warning("browser not support video encoded transform");if(K0.has(e)||!e.track)return;let i={track:e.track};if(ru()){if(!e.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(f){return void I.error("create video-encoded-streams error",f&&f.message)}let l=[];t.on("sei-to-send",f=>{l.push(f)});let u=new TransformStream({transform(f,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(I.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));let _=l.shift();_&&(f.data=function(v,S){let C=function(H){let ie=H.length,oe=[],ae=0;for(;ae<ie;)ae+2<ie&&H[ae]===0&&H[ae+1]===0&&(H[ae+2]===0||H[ae+2]===1||H[ae+2]===2||H[ae+2]===3)?(oe.push(H[ae],H[ae+1],3,H[ae+2]),ae+=3):(oe.push(H[ae]),ae++);return new Uint8Array(oe)}(S),b=C.length,V=Math.floor(b/255),P=b%255,k=new Uint8Array(6+V+1+b+v.byteLength);k[0]=0,k[1]=0,k[2]=0,k[3]=1,k[4]=6,k[5]=101;let F=0;for(;F<V;)k[6+F]=255,F++;return k[6+F]=P,F++,k.set(C,6+F),k.set(new Uint8Array(v),6+F+b),k.buffer}(f.data,_)),m.enqueue(f)}});a.readable.pipeThrough(u).pipeTo(a.writable)}else{if(!Pn())return;{if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let a=z0(),l=new MessageChannel;await new De(f=>a.onmessage=m=>{m.data==="registered"&&f(void 0)});let u=new RTCRtpScriptTransform(a,{name:"tx",port:l.port2},[l.port2]);e.transform=u,await new De(f=>a.onmessage=m=>{m.data==="started"&&f(void 0)}),t.on("sei-to-send",f=>{l.port1.postMessage({sei:f})}),l.port1.onmessage=f=>{var m;f.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==i.track.id&&(I.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=a}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}let a=K0.get(e);if(a){K0.delete(e);try{var l,u;(l=a.controller)===null||l===void 0||l.terminate(),(u=a.worker)===null||u===void 0||u.terminate()}catch(f){I.warning(f&&f.message)}}}K0.set(e,i),e.track.addEventListener("ended",o)}let _E=new Map;async function lie(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!xt().supportWebRTCEncodedTransform)return void I.warning("browser not support video encoded transform");if(!e.track)return;if(_E.has(e)){let a=_E.get(e);return void(a&&(a.onSei=t.onSei))}let i={track:e.track,onSei:t.onSei};if(ru()){if(!e.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let a=null;try{a=e.createEncodedStreams()}catch(u){return void I.error("create video-encoded-streams error",u&&u.message)}let l=new TransformStream({transform(u,f){i.controller||(i.controller=f),e.track&&e.track.id!==i.track.id&&(I.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));let m=function(_){let v=new DataView(_.data);if(v.getUint8(0)===0&&v.getUint8(1)===0&&v.getUint8(2)===0&&v.getUint8(3)===1&&v.getUint8(4)===6){let S=6,C=0,b=0;for(;(b=v.getUint8(S++))===255;)C+=255;C+=b;let V=function(P,k,F){let H=new Uint8Array(P,k,F),ie=[],oe=0;for(;oe<F;)oe+3<F&&H[oe]===0&&H[oe+1]===0&&H[oe+2]===3&&(H[oe+3]===0||H[oe+3]===1||H[oe+3]===2||H[oe+3]===3)?(ie.push(H[oe],H[oe+1],H[oe+3]),oe+=4):(ie.push(H[oe]),oe++);return new Uint8Array(ie)}(_.data,S,C);return new Uint8Array(V)}return null}(u);m&&i.onSei&&i.onSei(m),f.enqueue(u)}});a.readable.pipeThrough(l).pipeTo(a.writable)}else if(Pn()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let a=z0(),l=new MessageChannel;await new De(f=>a.onmessage=m=>{m.data==="registered"&&f(void 0)});let u=new RTCRtpScriptTransform(a,{name:"rx",port:l.port2},[l.port2]);e.transform=u,await new De(f=>a.onmessage=m=>{m.data==="started"&&f(void 0)}),l.port1.onmessage=f=>{var m;f.data.transformed&&e.track&&((m=e.track)===null||m===void 0?void 0:m.id)!==i.track.id?(I.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):f.data.sei&&i.onSei&&i.onSei(f.data.sei)},i.worker=a}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(a){let l=_E.get(a);if(l){_E.delete(a);try{var u,f;(u=l.controller)===null||u===void 0||u.terminate(),(f=l.worker)===null||f===void 0||f.terminate()}catch(m){I.warning(m&&m.message)}}})(e)}_E.set(e,i),e.track.addEventListener("ended",o)}(function(){let e=Ut();or.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),or.getStreamFromExtension=e.name===$t.CHROME&&Number(e.version)>34,or.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,i=!1;try{t.addTransceiver("audio"),i=!0}catch{}return t.close(),i}(),or.supportMinBitrate=e.name===$t.CHROME||e.name===$t.EDGE,or.supportSetRtpSenderParameters=function(){let t=Ut();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ou()||!(!Pn()&&!$y())||t.name===$t.FIREFOX&&Number(t.version)>=64)}(),e.name===$t.SAFARI&&(Number(e.version)>=14?or.supportDualStream=!0:or.supportDualStream=!1),or.webAudioMediaStreamDest=function(){let t=Ut();return!(t.name===$t.SAFARI&&Number(t.version)<12)}(),or.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",or.supportWebGL=typeof WebGLRenderingContext<"u",or.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ou()||(or.webAudioWithAEC=!0),or.supportShareAudio=function(){let t=Ut();return(t.os===On.WIN_10||t.os===On.WIN_81||t.os===On.WIN_7||t.os===On.LINUX||t.os===On.MAC_OS||t.os===On.CHROMIUM_OS)&&t.name===$t.CHROME&&Number(t.version)>=74}(),or.supportDataChannel=!!(Gb(76)||function(t){let i=Ut();return!(i.name!==$t.FIREFOX||!i.osVersion)&&Number(i.version)>=t}(68)||hM(14)),or.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!ci()&&!!t&&t.prototype.setConfiguration instanceof Function}(),or.supportWebRTCEncodedTransform=function(){let t=Ut();return t.name==="Chrome"&&Number(t.version)>=86||t.name==="Safari"&&Number(t.version)>=15}(),or.supportWebRTCInsertableStream=function(){let t=Ut();return(t.name===$t.CHROME||t.name===$t.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),or.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,or.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Zy(()=>{or.supportDualStreamEncoding=function(){let t=Ut();return!!$("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&$("CHROME_DUAL_STREAM_USE_ENCODING"))}(),I.info("browser compatibility",JSON.stringify(or),JSON.stringify(e))})})();class die extends Ii{constructor(){super(...arguments),U(this,"resultStorage",new Map)}setLocalAudioStats(t,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(t,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(o))}setRemoteAudioStats(t,i){let o=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(t,i){let o=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(t,i,o){if($("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let a=this.resultStorage.get(t);if(a&&(a.result.push(o),a.result.length>=5)){var l;let u=ke(l=a.result).call(l,!0);a.isPrevNormal&&!u&&this.emit("exception",tF[t],t,i),!a.isPrevNormal&&u&&this.emit("exception",tF[t]+2e3,t+"_RECOVER",i),a.isPrevNormal=u,a.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,i){return i instanceof Sn&&!i.isActive||!!i.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=_o(i._encoderConfig.frameRate));let a=t.captureFrameRate;return!o||!a||!(o>10&&a<5||o<10&&o>=5&&a<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,i){return!!i.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,i){return i instanceof Sn&&!i.isActive||!!i.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let tF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},pr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(i.length>0){let o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,t){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(i.length>0){let o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function NI(e,t){this.v=e,this.k=t}function mt(e){return new NI(e,0)}var uie=FD,hie=Gc;qt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=hie.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var pie=Gc,fie=Hf;qt({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=pie.f(this),i=fie(e);return(i.error?t.reject:t.resolve)(i.value),t.promise}});var xI=d(uie),iF=$f.f("asyncIterator"),mie=d(iF);function EE(e){var t,i;function o(l,u){try{var f=e[l](u),m=f.value,_=m instanceof NI;xI.resolve(_?m.v:m).then(function(v){if(_){var S=l==="return"?"return":"next";if(!m.k||v.done)return o(S,v);v=e[S](v).value}a(f.done?"return":"normal",v)},function(v){o("throw",v)})}catch(v){a("throw",v)}}function a(l,u){switch(l){case"return":t.resolve({value:u,done:!0});break;case"throw":t.reject(u);break;default:t.resolve({value:u,done:!1})}(t=t.next)?o(t.key,t.arg):i=null}this._invoke=function(l,u){return new xI(function(f,m){var _={key:l,arg:u,resolve:f,reject:m,next:null};i?i=i.next=_:(t=i=_,o(l,u))})},typeof e.return!="function"&&(this.return=void 0)}function Bo(e){return function(){return new EE(e.apply(this,arguments))}}EE.prototype[typeof Zf=="function"&&mie||"@@asyncIterator"]=function(){return this},EE.prototype.next=function(e){return this._invoke("next",e)},EE.prototype.throw=function(e){return this._invoke("throw",e)},EE.prototype.return=function(e){return this._invoke("return",e)};var nF=d(Zt.Object.getOwnPropertySymbols),gie=qt,_ie=Mo.indexOf,Eie=Bl,DI=Qe([].indexOf),rF=!!DI&&1/DI([1],1,-0)<0;gie({target:"Array",proto:!0,forced:rF||!Eie("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return rF?DI(this,e,t)||0:_ie(this,e,t)}});var vie=Zr("Array").indexOf,yie=B,Sie=vie,kI=Array.prototype,Tie=function(e){var t=e.indexOf;return e===kI||yie(kI,e)&&t===kI.indexOf?Sie:t},oF=d(Tie);function wie(e,t){if(e==null)return{};var i,o,a=function(u,f){if(u==null)return{};var m,_,v={},S=XM(u);for(_=0;_<S.length;_++)m=S[_],oF(f).call(f,m)>=0||(v[m]=u[m]);return v}(e,t);if(nF){var l=nF(e);for(o=0;o<l.length;o++)i=l[o],oF(t).call(t,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var sF={exports:{}};(function(e,t){e.exports=(()=>{var i={8:(l,u,f)=>{f.r(u),f.d(u,{Parser:()=>It,Printer:()=>Aa,parse:()=>dt,print:()=>Bt});let m=`
`,_="".concat("\r").concat(m),v=" ",S;function C(Le){return Le>="0"&&Le<="9"}function b(Le){return Le>="!"&&Le<="~"}function V(Le){return b(Le)||Le>=""&&Le<=""}function P(Le){return Le==="!"||Le>="#"&&Le<="'"||Le>="*"&&Le<="+"||Le>="-"&&Le<="."||Le>="0"&&Le<="9"||Le>="A"&&Le<="Z"||Le>="^"&&Le<="~"}function k(Le){return Le>="1"&&Le<="9"}function F(Le){return Le>="A"&&Le<="Z"||Le>="a"&&Le<="z"}function H(Le){return Le==="d"||Le==="h"||Le==="m"||Le==="s"}function ie(Le){return Le>""&&Le<"	"||Le>"\v"&&Le<"\f"||Le>""&&Le<""}function oe(Le){return F(Le)||C(Le)||Le==="+"||Le==="/"}function ae(Le){return C(Le)||F(Le)||Le==="+"||Le==="/"||Le==="-"||Le==="_"}function he(Le){return F(Le)||C(Le)||Le==="+"||Le==="/"}function Ee(Le,M){var X=Object.keys(Le);if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(Le);M&&(ne=ne.filter(function(Re){return Object.getOwnPropertyDescriptor(Le,Re).enumerable})),X.push.apply(X,ne)}return X}function ye(Le){for(var M=1;M<arguments.length;M++){var X=arguments[M]!=null?arguments[M]:{};M%2?Ee(Object(X),!0).forEach(function(ne){Ce(Le,ne,X[ne])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Le,Object.getOwnPropertyDescriptors(X)):Ee(Object(X)).forEach(function(ne){Object.defineProperty(Le,ne,Object.getOwnPropertyDescriptor(X,ne))})}return Le}function Ce(Le,M,X){return M in Le?Object.defineProperty(Le,M,{value:X,enumerable:!0,configurable:!0,writable:!0}):Le[M]=X,Le}(function(Le){Le.VERSION="v",Le.ORIGIN="o",Le.SESSION_NAME="s",Le.INFORMATION="i",Le.URI="u",Le.EMAIL="e",Le.PHONE="p",Le.CONNECTION="c",Le.BANDWIDTH="b",Le.TIME="t",Le.REPEAT="r",Le.ZONE_ADJUSTMENTS="z",Le.KEY="k",Le.ATTRIBUTE="a",Le.MEDIA="m"})(S||(S={}));class ze{consumeText(M,X){let ne=X;for(;ne<M.length;){let Re=M[ne];if(Re==="\0"||Re==="\r"||Re===m)break;ne+=1}if(ne-X==0)throw new Error("Invalid text, at ".concat(M));return ne}consumeUnicastAddress(M,X,ne){return this.consumeTill(M,X,v)}consumeOneOrMore(M,X,ne){let Re=X;for(;ne(M[Re]);)Re++;if(Re-X==0)throw new Error("Invalid rule at ".concat(X,"."));return Re}consumeSpace(M,X){if(M[X]===v)return X+1;throw new Error("Invalid space at ".concat(X,"."))}consumeIP4Address(M,X){let ne=X;for(let Re=0;Re<4;Re++)if(ne=this.consumeDecimalUChar(M,ne),Re!==3){if(M[ne]!==".")throw new Error("Invalid IP4 address.");ne++}return ne}consumeDecimalUChar(M,X){let ne=X;for(let ct=0;ct<3&&C(M[ne]);ct++,ne++);if(ne-X==0)throw new Error("Invalid decimal uchar.");let Re=parseInt(M.slice(X,ne));if(Re>=0&&Re<=255)return ne;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,X){let ne=this.consumeHexpart(M,X);return M[ne]===":"&&(ne+=1,ne=this.consumeIP4Address(M,ne)),ne}consumeHexpart(M,X){let ne=X;if(M[ne]===":"&&M[ne+1]===":"){ne+=2;try{ne=this.consumeHexseq(M,ne)}catch{}return ne}if(ne=this.consumeHexseq(M,ne),M[ne]===":"&&M[ne+1]===":"){ne+=2;try{ne=this.consumeHexseq(M,ne)}catch{}return ne}return ne}consumeHexseq(M,X){let ne=X;for(;ne=this.consumeHex4(M,ne),M[ne]===":"&&M[ne+1]!==":";)ne+=1;return ne}consumeHex4(M,X){let ne=0;for(;ne<4;ne++)if(!((Re=M[X+ne])>="0"&&Re<="9"||Re>="a"&&Re<="f"||Re>="A"&&Re<="F")){if(ne===0)throw new Error("Invalid hex 4");break}var Re;return X+ne}consumeFQDN(M,X){let ne=X;for(;C(M[ne])||F(M[ne])||M[ne]==="-"||M[ne]===".";)ne+=1;if(ne-X<4)throw new Error("Invalid FQDN");return ne}consumeExtnAddr(M,X){return this.consumeOneOrMore(M,X,V)}consumeMulticastAddress(M,X,ne){switch(ne){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,X);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,X);default:try{return this.consumeFQDN(M,X)}catch{return this.consumeExtnAddr(M,X)}}}consumeIP6MulticastAddress(M,X){let ne=this.consumeHexpart(M,X);return M[ne]==="/"?this.consumeInteger(M,ne+1):ne}consumeIP4MulticastAddress(M,X){let ne=X+3,Re=M.slice(X,ne),ct=parseInt(Re);if(ct<224||ct>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let pi=0;pi<3;pi++){if(M[ne]!==".")throw new Error("Invalid IP4 multicast address.");ne+=1,ne=this.consumeDecimalUChar(M,ne)}return M[ne]==="/"&&(ne+=1),ne=this.consumeTTL(M,ne),M[ne]==="/"&&(ne=this.consumeInteger(M,ne)),ne}consumeInteger(M,X){if(!k(M[X]))throw new Error("Invalid integer.");for(X+=1;C(M[X]);)X+=1;return X}consumeTTL(M,X){if(M[X]==="0")return X+1;if(!k(M[X]))throw new Error("Invalid TTL.");X+=1;for(let ne=0;ne<2&&C(M[X]);ne++)X+=1;return X}consumeToken(M,X){return this.consumeOneOrMore(M,X,P)}consumeTime(M,X){let ne=X;if(M[ne]==="0")return ne+1;for(k(M[ne])&&(ne+=1);C(M[ne]);)ne++;if(ne-X<10)throw new Error("Invalid time");return ne}consumeAddress(M,X){return this.consumeTill(M,X,v)}consumeTypedTime(M,X){let ne=X;return ne=this.consumeOneOrMore(M,ne,C),H(M[ne])?ne+1:ne}consumeRepeatInterval(M,X){if(!k(M[X]))throw new Error("Invalid repeat interval");for(X+=1;C(M[X]);)X+=1;return H(M[X])&&(X+=1),X}consumePort(M,X){return this.consumeOneOrMore(M,X,C)}consume(M,X,ne){for(let Re=0;Re<ne.length;Re++){if(X+Re>=M.length)throw new Error("consume exceeding value length");if(M[X+Re]!==ne[Re])throw new Error("consume ".concat(ne," failed at ").concat(Re))}return X+ne.length}consumeTill(M,X,ne){let Re=X;for(;Re<M.length&&(typeof ne!="string"||M[Re]!==ne)&&(typeof ne!="function"||!ne(M[Re]));)Re++;return Re}}class It extends ze{constructor(){super(),Ce(this,"records",[]),Ce(this,"currentLine",0)}parse(M){let X=this.probeEOL(M);this.records=M.split(X).filter(pn=>!!Rr(pn).call(pn)).map(this.parseLine),this.currentLine=0;let ne=this.parseVersion(),Re=this.parseOrigin(),ct=this.parseSessionName(),pi=this.parseInformation(),bn=this.parseUri(),So=this.parseEmail(),rd=this.parsePhone(),gS=this.parseConnection(),_S=this.parseBandWidth(),Vs=this.parseTimeFields(),Pu=this.parseKey(),Km=this.parseSessionAttribute(),Ji=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ne,origin:Re,sessionName:ct,information:pi,uri:bn,emails:So,phones:rd,connection:gS,bandwidths:_S,timeFields:Vs,key:Pu,attributes:Km,mediaDescriptions:Ji}}getCurrentRecord(){let M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let X=0;X<M.length;X++)if(M[X]===m)return M[X-1]==="\r"?_:m;throw new Error("Invalid newline character.")}parseLine(M,X){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let ne=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ne,value:M.slice(2),line:X,cur:0}}parseSessionAttribute(){let M=new _i;for(;this.currentLine<this.records.length;){let X=this.getCurrentRecord();if(X.type!==S.ATTRIBUTE)break;let ne={attField:this.extractOneOrMore(X,Re=>P(Re)&&Re!==":"),_cur:0};X.value[X.cur]===":"&&(X.cur+=1,ne.attValue=this.extractOneOrMore(X,ie)),M.parse(ne),this.currentLine++}return M.digest()}parseMediaAttributes(M){let X=new sn(M);for(;this.currentLine<this.records.length;){let ne=this.getCurrentRecord();if(ne.type!==S.ATTRIBUTE)break;let Re={attField:this.extractOneOrMore(ne,ct=>P(ct)&&ct!==":"),_cur:0};ne.value[ne.cur]===":"&&(ne.cur+=1,Re.attValue=this.extractOneOrMore(ne,ie)),X.parse(Re),this.currentLine++}return X.digest()}parseKey(){let M=this.getCurrentRecord();if(M.type===S.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let M=this.getCurrentRecord();if(M.type===S.ZONE_ADJUSTMENTS){let X=[];for(;;)try{let ne=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let Re=!1;M.value[M.cur]==="-"&&(Re=!0,M.cur+=1);let ct=this.extract(M,this.consumeTypedTime);X.push({time:ne,typedTime:ct,back:Re})}catch{break}if(X.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,X}return[]}parseRepeat(){let M=[];for(;;){let X=this.getCurrentRecord();if(X.type!==S.REPEAT)break;{let ne=this.extract(X,this.consumeRepeatInterval),Re=this.parseTypedTime(X);M.push({repeatInterval:ne,typedTimes:Re}),this.currentLine++}}return M}parseTypedTime(M){let X=[];for(;;)try{this.consumeSpaceForRecord(M),X.push(this.extract(M,this.consumeTypedTime))}catch{break}if(X.length===0)throw new Error("Invalid typed time.");return X}parseTime(){let M=this.getCurrentRecord(),X=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let ne=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:X,stopTime:ne}}parseBandWidth(){let M=[];for(;this.currentLine<this.records.length;){let X=this.getCurrentRecord();if(X.type!==S.BANDWIDTH)break;{let ne=this.extractOneOrMore(X,P);if(X.value[X.cur]!==":")throw new Error("Invalid bandwidth field.");X.cur++;let Re=this.extractOneOrMore(X,C);M.push({bwtype:ne,bandwidth:Re}),this.currentLine++}}return M}parseVersion(){let M=this.getCurrentRecord();if(M.type!==S.VERSION)throw new Error("first sdp record must be version");let X=M.value.slice(0,this.consumeOneOrMore(M.value,0,C));if(X.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,X}parseOrigin(){let M=this.getCurrentRecord();if(M.type!==S.ORIGIN)throw new Error("second line of sdp must be origin");let X=this.extractOneOrMore(M,V);this.consumeSpaceForRecord(M);let ne=this.extractOneOrMore(M,C);this.consumeSpaceForRecord(M);let Re=this.extractOneOrMore(M,C);this.consumeSpaceForRecord(M);let ct=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);let pi=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);let bn=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:X,sessId:ne,sessVersion:Re,nettype:ct,addrtype:pi,unicastAddress:bn}}parseSessionName(){let M=this.getCurrentRecord();if(M.type===S.SESSION_NAME){let X=this.extract(M,this.consumeText);return this.currentLine++,X}}parseInformation(){let M=this.getCurrentRecord();if(M.type!==S.INFORMATION)return;let X=this.extract(M,this.consumeText);return this.currentLine++,X}parseUri(){let M=this.getCurrentRecord();if(M.type===S.URI)return this.currentLine++,M.value}parseEmail(){let M=[];for(;;){let X=this.getCurrentRecord();if(X.type!==S.EMAIL)break;M.push(X.value),this.currentLine++}return M}parsePhone(){let M=[];for(;;){let X=this.getCurrentRecord();if(X.type!==S.PHONE)break;M.push(X.value),this.currentLine++}return M}parseConnection(){let M=this.getCurrentRecord();if(M.type===S.CONNECTION){let X=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);let ne=this.extractOneOrMore(M,P);this.consumeSpaceForRecord(M);let Re=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:X,addrtype:ne,address:Re}}}parseMedia(){let M=this.getCurrentRecord(),X=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let ne=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,ne+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);let Re=[];for(Re.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,Re.push(this.extract(M,this.consumeToken));if(Re.length===0)throw new Error("Invalid proto");let ct=this.parseFmt(M);return this.currentLine++,{mediaType:X,port:ne,protos:Re,fmts:ct}}parseTimeFields(){let M=[];for(;this.getCurrentRecord().type===S.TIME;){let X=this.parseTime(),ne=this.parseRepeat(),Re=this.parseZone();M.push({time:X,repeats:ne,zones:Re})}return M}parseMediaDescription(){let M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===S.MEDIA;){let X=this.parseMedia(),ne=this.parseInformation(),Re=this.parseConnections(),ct=this.parseBandWidth(),pi=this.parseKey(),bn=this.parseMediaAttributes(X);M.push({media:X,information:ne,connections:Re,bandwidths:ct,key:pi,attributes:bn})}return M}parseConnections(){let M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===S.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){let X=[];for(;;)try{this.consumeSpaceForRecord(M),X.push(this.extract(M,this.consumeToken))}catch{break}if(X.length===0)throw new Error("Invalid fmts");return X}extract(M,X){for(var ne=arguments.length,Re=new Array(ne>2?ne-2:0),ct=2;ct<ne;ct++)Re[ct-2]=arguments[ct];let pi=X.call(this,M.value,M.cur,...Re),bn=M.value.slice(M.cur,pi);return M.cur=pi,bn}extractOneOrMore(M,X){let ne=this.consumeOneOrMore(M.value,M.cur,X),Re=M.value.slice(M.cur,ne);return M.cur=ne,Re}consumeSpaceForRecord(M){if(M.value[M.cur]!==v)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class Kt extends ze{constructor(){super(...arguments),Ce(this,"attributes",void 0),Ce(this,"digested",!1)}extractOneOrMore(M,X,ne){let Re=this.consumeOneOrMore(M.attValue,M._cur,X),ct=M.attValue.slice(M._cur,Re),[pi,bn]=ne||[];if(typeof pi=="number"&&ct.length<pi)throw new Error("error in length, should be more or equal than ".concat(pi," characters."));if(typeof bn=="number"&&ct.length>bn)throw new Error("error in length, should be less or equal than ".concat(bn," characters."));return M._cur=Re,ct}consumeAttributeSpace(M){if(M.attValue[M._cur]!==v)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,X){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var ne=arguments.length,Re=new Array(ne>2?ne-2:0),ct=2;ct<ne;ct++)Re[ct-2]=arguments[ct];let pi=X.call(this,M.attValue,M._cur,...Re),bn=M.attValue.slice(M._cur,pi);return M._cur=pi,bn}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,X){if(!M.attValue)throw new Error;for(let ne=0;ne<X.length;ne++)if(X[ne]!==M.attValue[M._cur+ne])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,oe,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,oe,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let X=[];for(;!this.atEnd(M);){X.push(this.extractOneOrMore(M,oe));try{this.consumeAttributeSpace(M)}catch(ne){if(this.atEnd(M))break;throw ne}}this.attributes.iceOptions=X}parseFingerprint(M){let X=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:X,fingerprint:ne})}parseExtmap(M){let X=this.extractOneOrMore(M,C),ne;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),ne=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);let Re=this.extract(M,this.consumeTill,v),ct=ye(ye({entry:parseInt(X,10)},ne&&{direction:ne}),{},{extensionName:Re});this.peekChar(M)===v&&(this.consumeAttributeSpace(M),ct.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(ct)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let X=this.extract(M,this.consumeTill);if(X!=="active"&&X!=="passive"&&X!=="actpass"&&X!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=X}}class _i extends Kt{constructor(){super(...arguments),Ce(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(X){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),X}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){let X=this.extract(M,this.consumeToken),ne=[];for(;!this.atEnd(M)&&this.peekChar(M)===v;)this.consumeAttributeSpace(M),ne.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:X,identificationTag:ne})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,ae)}parseIdentity(M){let X=this.extractOneOrMore(M,he),ne=[];for(;!this.atEnd(M)&&this.peekChar(M)===v;){this.consumeAttributeSpace(M);let Re=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");let ct=this.extractOneOrMore(M,pi=>pi!==v&&ie(pi));ne.push({name:Re,value:ct})}this.attributes.identities.push({assertionValue:X,extensions:ne})}parseMsidSemantic(M){this.peekChar(M)===v&&this.consumeAttributeSpace(M);let X={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),X.applyForAll=!0;break}{let ne=this.extract(M,this.consumeTill,v);X.identifierList.push(ne)}}this.attributes.msidSemantic=X}}class sn extends Kt{constructor(M){super(),Ce(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(X){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),X}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){let X=this.extractOneOrMore(M,oe,[1,32]);this.consumeAttributeSpace(M);let ne=this.extractOneOrMore(M,C,[1,5]);this.consumeAttributeSpace(M);let Re=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);let ct=this.extractOneOrMore(M,C,[1,10]);this.consumeAttributeSpace(M);let pi=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);let bn=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);let So={foundation:X,componentId:ne,transport:Re,priority:ct,connectionAddress:pi,port:bn,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),So.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),So.relPort=this.extract(M,this.consumePort));this.peekChar(M)===v;){this.consumeAttributeSpace(M);let rd=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),So.extension[rd]=this.extractOneOrMore(M,b)}this.attributes.candidates.push(So)}parseRemoteCandidate(M){let X=[];for(;;){let ne=this.extractOneOrMore(M,C,[1,5]);this.consumeAttributeSpace(M);let Re=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);let ct=this.extract(M,this.consumePort);X.push({componentId:ne,connectionAddress:Re,port:ct});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(X)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){let X=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");let Re={encodingName:ne,clockRate:this.extractOneOrMore(M,C)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),Re.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));let ct=this.attributes.payloads.find(pi=>pi.payloadType===parseInt(X,10));ct?ct.rtpMap=Re:this.attributes.payloads.push({payloadType:parseInt(X,10),rtpMap:Re,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){let X=this.extractOneOrMore(M,C);this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeTill,":"),Re;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),Re=this.extract(M,this.consumeTill));let ct=this.attributes.ssrcs.find(pi=>pi.ssrcId===parseInt(X,10));ct?ct.attributes[ne]=Re:this.attributes.ssrcs.push({ssrcId:parseInt(X,10),attributes:{[ne]:Re}})}parseFmtp(M){let X=this.extract(M,this.consumeTill,v);this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeTill),Re={};ne.split(";").forEach(pi=>{let[bn,So]=pi.split("=");bn=Rr(bn).call(bn);let rd=typeof So=="string"?Rr(So).call(So):null;typeof bn=="string"&&bn.length>0&&(Re[bn]=rd)});let ct=this.attributes.payloads.find(pi=>pi.payloadType===parseInt(X,10));ct?ct.fmtp={parameters:Re}:this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[],fmtp:{parameters:Re}})}parseFmtParameters(M){let X={},ne=this.extract(M,this.consumeTill,"=");M._cur++;let Re=this.extract(M,this.consumeTill,";");for(X[ne]=Re;M.attValue[M._cur]===";";){let ct=this.extract(M,this.consumeTill,"=");M._cur++;let pi=this.extract(M,this.consumeTill,";");X[ct]=pi}return X}parseRtcpFb(M){let X="";X=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,v),this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeTill,v),Re;if(ne==="trr-int")Re={type:ne,interval:this.extract(M,this.consumeTill)};else{let ct={type:ne};this.peekChar(M)===v&&(this.consumeAttributeSpace(M),ct.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===v&&(ct.additional=this.extract(M,this.consumeTill))),Re=ct}if(X==="*")this.attributes.rtcpFeedbackWildcards.push(Re);else{let ct=this.attributes.payloads.find(pi=>pi.payloadType===parseInt(X,10));ct?ct.rtcpFeedbacks.push(Re):this.attributes.payloads.push({payloadType:parseInt(X,10),rtcpFeedbacks:[Re]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let X={port:this.extract(M,this.consumePort)};this.peekChar(M)===v&&(this.consumeAttributeSpace(M),X.netType=this.extractOneOrMore(M,P),this.consumeAttributeSpace(M),X.addressType=this.extractOneOrMore(M,P),this.consumeAttributeSpace(M),X.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=X}parseMsid(M){let X={id:this.extractOneOrMore(M,P,[1,64])};this.peekChar(M)===v&&(this.consumeAttributeSpace(M),X.appdata=this.extractOneOrMore(M,P,[1,64])),this.attributes.msids.push(X)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){let X=this.extractOneOrMore(M,Re=>F(Re)||C(Re)||Re==="_"||Re==="-");this.consumeAttributeSpace(M);let ne={id:X,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===v){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");let Re=[];for(;;){let ct=this.extract(M,this.consumeToken);Re.push(ct);try{this.extract(M,this.consume,",")}catch{break}}ne.payloads=Re,this.peekChar(M)===v&&this.extract(M,this.consume,v)}for(;;){let Re=this.extract(M,this.consumeToken);switch(Re){case"depend":{let ct={type:Re,rids:this.extract(M,this.consume,"=").split(",")};ne.params.push(ct);break}default:{let ct={type:Re};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),ct.val=this.extract(M,this.consumeTill,";")),ne.params.push(ct)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(ne)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,C,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,C,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){let X=this.extract(M,this.consumeToken),ne=[];for(;;)try{this.consumeAttributeSpace(M);let Re=this.extract(M,this.consumeInteger);ne.push(parseInt(Re,10))}catch{break}this.attributes.ssrcGroups.push({semantic:X,ssrcIds:ne})}}function Li(Le,M,X){return M in Le?Object.defineProperty(Le,M,{value:X,enumerable:!0,configurable:!0,writable:!0}):Le[M]=X,Le}class Aa{constructor(){Li(this,"eol",_)}print(M,X){let ne="";return X&&(this.eol=X),ne+=this.printVersion(M.version),ne+=this.printOrigin(M.origin),ne+=this.printSessionName(M.sessionName),ne+=this.printInformation(M.information),ne+=this.printUri(M.uri),ne+=this.printEmail(M.emails),ne+=this.printPhone(M.phones),ne+=this.printConnection(M.connection),ne+=this.printBandwidth(M.bandwidths),ne+=this.printTimeFields(M.timeFields),ne+=this.printKey(M.key),ne+=this.printSessionAttributes(M.attributes),ne+=this.printMediaDescription(M.mediaDescriptions),ne}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let X="";for(let ne of M)X+="e=".concat(ne).concat(this.eol);return X}printPhone(M){let X="";for(let ne of M)X+="e=".concat(ne).concat(this.eol);return X}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let X="";for(let ne of M)X+="b=".concat(ne.bwtype,":").concat(ne.bandwidth).concat(this.eol);return X}printTimeFields(M){let X="";for(let ne of M){X+="t=".concat(ne.time.startTime," ").concat(ne.time.startTime).concat(this.eol);for(let Re of ne.repeats)X+="r=".concat(Re.repeatInterval," ").concat(Re.typedTimes.join(" ")).concat(this.eol);ne.zoneAdjustments&&(X+="z=",X+="z=".concat(ne.zoneAdjustments.map(Re=>"".concat(Re.time," ").concat(Re.back?"-":""," ").concat(Re.typedTime)).join(" ")).concat(this.eol),X+=this.eol)}return X}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let X="";for(let ne of M)X+="a=".concat(ne.attField).concat(ne.attValue?":".concat(ne.attValue):"").concat(this.eol);return X}printMediaDescription(M){let X="";for(let ne of M)X+=this.printMedia(ne.media),X+=this.printInformation(ne.information),X+=this.printConnections(ne.connections),X+=this.printBandwidth(ne.bandwidths),X+=this.printKey(ne.key),X+=this.printMediaAttributes(ne);return X}printConnections(M){let X="";for(let ne of M)X+=this.printConnection(ne);return X}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new xe(this.eol).print(M)}printMediaAttributes(M){return new We(this.eol).print(M)}}class _e{constructor(M){Li(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(v)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(X=>"a=fingerprint:".concat(X.hashFunction).concat(v).concat(X.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(X=>"a=extmap:".concat(X.entry).concat(X.direction?"/".concat(X.direction):"").concat(v).concat(X.extensionName).concat(X.extensionAttributes?"".concat(v).concat(X.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(X=>"a=".concat(X.attField).concat(X.attValue?":".concat(X.attValue):"").concat(this.eol)).join("")}}class xe extends _e{print(M){let X="";return X+=this.printGroups(M.groups),X+=this.printMsidSemantic(M.msidSemantic),X+=this.printIceLite(M.iceLite),X+=this.printIceUfrag(M.iceUfrag),X+=this.printIcePwd(M.icePwd),X+=this.printIceOptions(M.iceOptions),X+=this.printFingerprints(M.fingerprints),X+=this.printSetup(M.setup),X+=this.printTlsId(M.tlsId),X+=this.printIdentity(M.identities),X+=this.printExtmap(M.extmaps),X+=this.printUnrecognized(M.unrecognized),X}printGroups(M){let X="";return M.length>0&&(X+=M.map(ne=>"a=group:".concat(ne.semantic).concat(ne.identificationTag.map(Re=>"".concat(v).concat(Re)).join("")).concat(this.eol)).join("")),X}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(X=>"a=identity:".concat(X.assertionValue).concat(X.extensions.map(ne=>"".concat(v).concat(ne.name).concat(ne.value?"=".concat(ne.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let X="a=msid-semantic:".concat(M.semantic);return M.applyForAll?X+="".concat(v,"*"):M.identifierList.length>0&&(X+=M.identifierList.map(ne=>"".concat(v).concat(ne))),X+this.eol}}class We extends _e{print(M){let X=M.attributes,ne="";return ne+=this.printRTCP(X.rtcp),ne+=this.printIceUfrag(X.iceUfrag),ne+=this.printIcePwd(X.icePwd),ne+=this.printIceOptions(X.iceOptions),ne+=this.printCandidates(X.candidates),ne+=this.printRemoteCandidatesList(X.remoteCandidatesList),ne+=this.printEndOfCandidates(X.endOfCandidates),ne+=this.printFingerprints(X.fingerprints),ne+=this.printSetup(X.setup),ne+=this.printMid(X.mid),ne+=this.printExtmap(X.extmaps),ne+=this.printRTPRelated(X),ne+=this.printPtime(X.ptime),ne+=this.printMaxPtime(X.maxPtime),ne+=this.printDirection(X.direction),ne+=this.printSSRCGroups(X.ssrcGroups),ne+=this.printSSRC(X.ssrcs),ne+=this.printRTCPMux(X.rtcpMux),ne+=this.printRTCPMuxOnly(X.rtcpMuxOnly),ne+=this.printRTCPRsize(X.rtcpRsize),ne+=this.printMSId(X.msids),ne+=this.printImageattr(X.imageattr),ne+=this.printRid(X.rids),ne+=this.printSimulcast(X.simulcast),ne+=this.printSCTPPort(X.sctpPort),ne+=this.printMaxMessageSize(X.maxMessageSize),ne+=this.printUnrecognized(X.unrecognized),ne}printCandidates(M){return M.map(X=>"a=candidate:".concat(X.foundation).concat(v).concat(X.componentId).concat(v).concat(X.transport).concat(v).concat(X.priority).concat(v).concat(X.connectionAddress).concat(v).concat(X.port).concat(v,"typ").concat(v).concat(X.type).concat(X.relAddr?"".concat(v,"raddr").concat(v).concat(X.relAddr):"").concat(X.relPort?"".concat(v,"rport").concat(v).concat(X.relPort):"").concat(Object.keys(X.extension).map(ne=>"".concat(v).concat(ne).concat(v).concat(X.extension[ne])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(X=>"a=remote-candidates:".concat(X.join(v)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";let X=M.payloads,ne="";ne+=M.rtcpFeedbackWildcards.map(Re=>this.printRTCPFeedback("*",Re)).join("");for(let Re of X)ne+=this.printRtpMap(Re.payloadType,Re.rtpMap),ne+=this.printFmtp(Re.payloadType,Re.fmtp),ne+=Re.rtcpFeedbacks.map(ct=>this.printRTCPFeedback(Re.payloadType,ct)).join("");return ne}printFmtp(M,X){if(!X)return"";let ne=Object.keys(X.parameters);return ne.length===1&&X.parameters[ne[0]]===null?"a=fmtp:".concat(M).concat(v).concat(ne[0]).concat(this.eol):"a=fmtp:".concat(M).concat(v).concat(Object.keys(X.parameters).map(Re=>"".concat(Re,"=").concat(X.parameters[Re])).join(";")).concat(this.eol)}printRtpMap(M,X){return X?"a=rtpmap:".concat(M).concat(v).concat(X.encodingName,"/").concat(X.clockRate).concat(X.encodingParameters?"/".concat(X.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,X){let ne="a=rtcp-fb:".concat(M).concat(v),Re=X;return Re.type==="trr-int"?ne+="ttr-int".concat(v).concat(Re.interval):(ne+="".concat(Re.type),Re.parameter&&(ne+="".concat(v).concat(Re.parameter),Re.additional&&(ne+="".concat(v).concat(Re.additional)))),ne+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(X=>Object.keys(X.attributes).map(ne=>"a=ssrc:".concat(X.ssrcId.toString(10)).concat(v).concat(ne).concat(X.attributes[ne]?":".concat(X.attributes[ne]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let X="a=rtcp:".concat(M.port);return M.netType&&(X+="".concat(v).concat(M.netType)),M.addressType&&(X+="".concat(v).concat(M.addressType)),M.address&&(X+="".concat(v).concat(M.address)),X+this.eol}printMSId(M){return M.map(X=>"a=msid:".concat(X.id).concat(X.appdata?"".concat(v).concat(X.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(X=>"a=imageattr:".concat(X).concat(this.eol)).join("")}printRid(M){return M.map(X=>{let ne="a=rid:".concat(X.id).concat(v).concat(X.direction);return X.payloads&&(ne+="".concat(v,"pt=").concat(X.payloads.join(","))),X.params.length>0&&(ne+="".concat(v).concat(X.params.map(Re=>Re.type==="depend"?"depend=".concat(Re.rids.join(",")):"".concat(Re.type,"=").concat(Re.val)).join(";"))),ne+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(X=>"a=ssrc-group:".concat(X.semantic).concat(X.ssrcIds.map(ne=>"".concat(v).concat(ne.toString(10))).join("")).concat(this.eol)).join("")}}function dt(Le){return new It().parse(Le)}function Bt(Le,M){return new Aa().print(Le,M)}}},o={};function a(l){if(o[l])return o[l].exports;var u=o[l]={exports:{}};return i[l](u,u.exports,a),u.exports}return a.d=(l,u)=>{for(var f in u)a.o(u,f)&&!a.o(l,f)&&Object.defineProperty(l,f,{enumerable:!0,get:u[f]})},a.o=(l,u)=>Object.prototype.hasOwnProperty.call(l,u),a.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},a(8)})()})(sF);var Oi=sF.exports;function wa(e){if(Array.isArray(e))return e.map(i=>i);if(!aF(e))return e;let t={};for(let i in e){let o=e[i];aF(o)||Array.isArray(o)?t[i]=wa(o):t[i]=o}return t}function aF(e){return!(typeof e!="object"||Array.isArray(e)||!e)}class LI{constructor(t){U(this,"input",[]),U(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}let al={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},vE={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:al,remoteCandidate:al}},cF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},lF={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},dF={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},uF={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function hF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function pF(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?hF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class MI{constructor(t,i){U(this,"onFirstVideoReceived",void 0),U(this,"onFirstVideoDecoded",void 0),U(this,"onFirstAudioReceived",void 0),U(this,"onFirstVideoDecodedTimeout",void 0),U(this,"onFirstAudioDecoded",void 0),U(this,"onSelectedLocalCandidateChanged",void 0),U(this,"onSelectedRemoteCandidateChanged",void 0),U(this,"videoIsReady",!1),U(this,"videoIsReady2",{}),U(this,"pc",void 0),U(this,"options",void 0),U(this,"intervalTimer",void 0),U(this,"stats",wa(vE)),U(this,"isFirstVideoReceived",{}),U(this,"isFirstVideoDecoded",{}),U(this,"isFirstAudioReceived",{}),U(this,"isFirstAudioDecoded",{}),U(this,"isFirstVideoDecodedTimeout",{}),U(this,"lossRateWindowStats",[]),this.pc=t,this.options=i,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new De(t=>{t({local:pF({},al),remote:pF({},al)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,i){this.videoIsReady2[t]=i}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let i=this.lossRateWindowStats.length,o=["videoSend","audioSend","videoRecv","audioRecv"],a=0,l=0,u=0,f=0;for(let m of o)t[m].forEach((_,v)=>{if(!this.lossRateWindowStats[i-1][m][v]||!this.lossRateWindowStats[0][m][v])return;let S=this.lossRateWindowStats[i-1][m][v].packets-this.lossRateWindowStats[0][m][v].packets,C=this.lossRateWindowStats[i-1][m][v].packetsLost-this.lossRateWindowStats[0][m][v].packetsLost;m==="videoSend"||m==="audioSend"?(a+=S,u+=C):(l+=S,f+=C),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||C<=0?0:C/(S+C)});t.sendPacketLossRate=a<=0||u<=0?0:u/(a+u),t.recvPacketLossRate=l<=0||f<=0?0:f/(l+f)}}function fF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Cie(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?fF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class bie extends MI{constructor(){super(...arguments),U(this,"_stats",vE),U(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let t=await this._getStats(),i=this.statsResponsesToObjects(t);this._stats=wa(vE);let o=i.filter(l=>l.type==="ssrc");this.processSSRCStats(o);let a=i.find(l=>l.type==="VideoBwe");a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(i=>{var o;let a=ke(o=i.id).call(o,"send");switch("".concat(i.mediaType,"_").concat(a?"send":"recv")){case"video_send":{let l=wa(lF);l.codec=i.googCodecName,l.adaptionChangeReason="none",i.googCpuLimitedResolution&&(l.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(l.adaptionChangeReason="bandwidth"),l.avgEncodeMs=Number(i.googAvgEncodeMs),l.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},l.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},l.firsCount=Number(i.googFirReceived),l.nacksCount=Number(i.googNacksReceived),l.plisCount=Number(i.googPlisReceived),l.frameCount=Number(i.framesEncoded),l.bytes=Number(i.bytesSent),l.packets=Number(i.packetsSent),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(l),this._stats.rtt=l.rttMs;break}case"video_recv":{let l=wa(cF),u=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(l.codec=i.googCodecName,l.targetDelayMs=Number(i.googTargetDelayMs),l.renderDelayMs=Number(i.googRenderDelayMs),l.currentDelayMs=Number(i.googCurrentDelayMs),l.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),l.decodeMs=Number(i.googDecodeMs),l.maxDecodeMs=Number(i.googMaxDecodeMs),l.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},l.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},l.decodeFrameRate=Number(i.googFrameRateDecoded),l.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},l.jitterBufferMs=Number(i.googJitterBufferMs),l.firsCount=Number(i.googFirsSent),l.nacksCount=Number(i.googNacksSent),l.plisCount=Number(i.googPlisSent),l.framesDecodeCount=Number(i.framesDecoded),l.bytes=Number(i.bytesReceived),l.packets=Number(i.packetsReceived),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.packets>0&&!this.isFirstVideoReceived[l.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(l.ssrc),this.isFirstVideoReceived[l.ssrc]=!0),l.framesDecodeCount>0&&!this.isFirstVideoDecoded[l.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(l.ssrc,l.decodedFrame.width,l.decodedFrame.height),this.isFirstVideoDecoded[l.ssrc]=!0),u){let f=u.stats,m=Date.now()-u.lts;l.framesDecodeFreezeTime=f.framesDecodeFreezeTime,l.framesDecodeInterval=f.framesDecodeInterval,l.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[l.ssrc]?(u.lts=Date.now(),l.framesDecodeInterval=m,l.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?l.framesDecodeFreezeTime+=l.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):l.framesDecodeCount<u.stats.framesDecodeCount&&(l.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(l.ssrc,{stats:Cie({},l),lts:Date.now()}),this._stats.videoRecv.push(l);break}case"audio_recv":{let l=wa(uF);l.codec=i.googCodecName,l.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,l.decodingCNG=Number(i.googDecodingCNG),l.decodingCTN=Number(i.googDecodingCTN),l.decodingCTSG=Number(i.googDecodingCTSG),l.decodingNormal=Number(i.googDecodingNormal),l.decodingPLC=Number(i.googDecodingPLC),l.decodingPLCCNG=Number(i.googDecodingPLCCNG),l.expandRate=Number(i.googExpandRate),l.accelerateRate=Number(i.googAccelerateRate),l.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),l.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),l.speechExpandRate=Number(i.googSpeechExpandRate),l.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),l.jitterBufferMs=Number(i.googJitterBufferMs),l.jitterMs=Number(i.googJitterReceived),l.bytes=Number(i.bytesReceived),l.packets=Number(i.packetsReceived),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),l.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),l.receivedFrames>0&&!this.isFirstAudioReceived[l.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(l.ssrc),this.isFirstAudioReceived[l.ssrc]=!0),l.decodingNormal>0&&!this.isFirstAudioDecoded[l.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(l.ssrc),this.isFirstAudioDecoded[l.ssrc]=!0),this._stats.audioRecv.push(l);break}case"audio_send":{let l=wa(dF);l.codec=i.googCodecName,l.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,l.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),l.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),l.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),l.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),l.bytes=Number(i.bytesSent),l.packets=Number(i.packetsSent),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.rttMs=Number(i.googRtt||0),this._stats.rtt=l.rttMs,this._stats.audioSend.push(l);break}}})}_getStats(){return new De((t,i)=>{this.pc.getStats(t,i)})}statsResponsesToObjects(t){let i=[];return t.result().forEach(o=>{let a={id:o.id,timestamp:o.timestamp.valueOf().toString(),type:o.type};o.names().forEach(l=>{a[l]=o.stat(l)}),i.push(a)}),i}}function mF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Cp(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?mF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):mF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class gF extends MI{constructor(){super(...arguments),U(this,"_stats",vE),U(this,"report",void 0),U(this,"lastDecodeVideoReceiverStats",new Map),U(this,"lastVideoFramesRecv",new Map),U(this,"lastVideoFramesSent",new Map),U(this,"lastVideoFramesDecode",new Map),U(this,"lastVideoFramesOutput",new Map),U(this,"lastVideoJBDelay",new Map),U(this,"lastAudioJBDelay",new Map),U(this,"mediaBytesSent",new Map),U(this,"mediaBytesRetransmit",new Map),U(this,"mediaBytesTargetEncode",new Map),U(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=wa(vE),this.report.forEach(t=>{switch(t.type){case cs.OUTBOUND:case cs.INBOUND:{let i=t.mediaType||t.kind,o=!i&&"frameWidth"in t,a=!i&&!("frameWidth"in t);t.type===cs.OUTBOUND?i==="audio"||a?this.processAudioOutboundStats(t):(i==="video"||o)&&this.processVideoOutboundStats(t):t.type===cs.INBOUND&&(i==="audio"||a?this.processAudioInboundStats(t):(i==="video"||o)&&this.processVideoInboundStats(t));break}case cs.TRANSPORT:{let i=this.report.get(t.selectedCandidatePairId);i&&this.processCandidatePairStats(i);break}case cs.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let t=await this.pc.getStats(),i={local:Cp({},al),remote:Cp({},al)};return t.forEach(o=>{let a;if(o.type===cs.TRANSPORT&&(a=t.get(o.selectedCandidatePairId)),o.type===cs.CANDIDATE_PAIR&&o.selected&&(a=o),a){let l=(u,f)=>{u.type=f.type,u.id=f.id,f.address&&(u.address=f.address),f.candidateType&&(u.candidateType=f.candidateType),f.port&&(u.port=f.port),f.priority&&(u.priority=f.priority),f.protocol&&(u.protocol=f.protocol),f.relayProtocol&&(u.relayProtocol=f.relayProtocol)};if(a.localCandidateId){let u=t.get(a.localCandidateId);u&&l(i.local,u)}if(a.remoteCandidateId){let u=t.get(a.remoteCandidateId);u&&l(i.remote,u)}}}),i}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(i=>{t.currentRoundTripTime&&(i.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{t.currentRoundTripTime&&(i.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){let i=this.report.get(t.localCandidateId);i&&this.processCandidateStats(i)}if(t.remoteCandidateId){let i=this.report.get(t.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(t){let i;t.type===cs.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),t.type===cs.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=t.type,i.id=t.id,t.address&&(i.address=t.address),t.candidateType&&(i.candidateType=t.candidateType),t.port&&(i.port=t.port),t.priority&&(i.priority=t.priority),t.protocol&&(i.protocol=t.protocol),t.relayProtocol&&(i.relayProtocol=t.relayProtocol),t.type===cs.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(Cp({},i),Cp({},this.stats.selectedCandidatePair.localCandidate)),t.type===cs.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(Cp({},i),Cp({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let i=this._stats.audioRecv.find(o=>o.ssrc===t.ssrc);i||(i=wa(uF),this._stats.audioRecv.push(i)),i.ssrc=t.ssrc,i.packets=t.packetsReceived,i.packetsLost=t.packetsLost,i.bytes=t.bytesReceived,i.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,i),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),i.receivedFrames||(i.receivedFrames=t.packetsReceived),i.droppedFrames||(i.droppedFrames=t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),typeof t.concealedSamples=="number"&&(i.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let i=this._stats.videoRecv.find(f=>f.ssrc===t.ssrc);i||(i=wa(cF),this._stats.videoRecv.push(i)),i.ssrc=t.ssrc,i.packets=t.packetsReceived,i.packetsLost=t.packetsLost,i.bytes=t.bytesReceived,i.firsCount=t.firCount,i.nacksCount=t.nackCount,i.plisCount=t.pliCount,i.framesDecodeCount=t.framesDecoded,i.framesDroppedCount=t.framesDropped,i.totalInterFrameDelay=t.totalInterFrameDelay,i.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,i.totalFreezesDuration=t.totalFreezesDuration;let o=this.lastDecodeVideoReceiverStats.get(i.ssrc),a=this.lastVideoFramesDecode.get(i.ssrc),l=this.lastVideoFramesOutput.get(i.ssrc),u=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){let f=i.decodedFrame?i.decodedFrame.width:0,m=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,f,m),this.isFirstVideoDecoded[i.ssrc]=!0}if(o){let f=o.stats,m=u-o.lts;i.framesDecodeFreezeTime=f.framesDecodeFreezeTime,i.framesDecodeInterval=f.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>f.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(o.lts=Date.now(),i.framesDecodeInterval=m,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<f.framesDecodeCount&&(i.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(o.stats.framesDecodeCount>t.framesDecoded?i.qpSumPerFrame=t.qpSum/t.framesDecoded:i.qpSumPerFrame=(t.qpSum-o.qpSum)/(t.framesDecoded-o.stats.framesDecodeCount))}a&&u-a.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-a.count)/((u-a.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:u,rate:i.decodeFrameRate})):a?i.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:u,rate:0}),i.framesDroppedCount&&t.framesReceived&&(l&&u-l.lts>=800?(i.outputFrameRate=Math.round((t.framesReceived-i.framesDroppedCount-l.count)/((u-l.lts)/1e3)),this.lastVideoFramesOutput.set(i.ssrc,{count:t.framesReceived-i.framesDroppedCount,lts:u,rate:Math.max(i.outputFrameRate,0)})):l?i.outputFrameRate=l.rate:this.lastVideoFramesOutput.set(i.ssrc,{count:t.framesReceived-i.framesDroppedCount,lts:u,rate:0})),t.totalDecodeTime&&(i.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,i),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(i.framesRateFirefox=t.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:Cp({},i),lts:o?o.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let i=this._stats.videoSend.find(a=>a.ssrc===t.ssrc);i||(i=wa(lF),this._stats.videoSend.push(i));let o=this.mediaBytesSent.get(t.ssrc);if(o)o.add(t.bytesSent);else{let a=new LI(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){let a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{let l=new LI(10);l.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,l)}}if(t.totalEncodedBytesTarget){let a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{let l=new LI(10);l.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,l)}}if(i.ssrc=t.ssrc,i.bytes=t.bytesSent,i.packets=t.packetsSent,i.firsCount=t.firCount,i.nacksCount=t.nackCount,i.plisCount=t.pliCount,i.frameCount=t.framesEncoded,i.adaptionChangeReason=t.qualityLimitationReason,i.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){let a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)i.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{let l=t.framesEncoded-a.lastFrameCount,u=t.totalEncodeTime-a.lastEncoderTime;i.avgEncodeMs=1e3*u/l}}if(t.framesEncoded&&t.qpSum){let a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?i.qpSumPerFrame=t.qpSum/t.framesEncoded:i.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,i),this.processVideoTrackSenderStats(t,t.trackId,i),t.remoteId)this.processRemoteInboundStats(t.remoteId,i);else{let a=this.findRemoteStatsId(t.ssrc,cs.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,i)}}processAudioOutboundStats(t){let i=this._stats.audioSend.find(o=>o.ssrc===t.ssrc);if(i||(i=wa(dF),this._stats.audioSend.push(i)),i.ssrc=t.ssrc,i.packets=t.packetsSent,i.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,i),t.codecId&&(i.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,i),t.remoteId)this.processRemoteInboundStats(t.remoteId,i);else{let o=this.findRemoteStatsId(t.ssrc,cs.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,i)}}findRemoteStatsId(t,i){var o;let a=Array.from(sc(o=this.report).call(o)).find(l=>l.type===i&&l.ssrc===t);return a?a.id:null}processVideoMediaSource(t,i){let o=this.report.get(t);o&&o.width&&o.height&&o.framesPerSecond&&(i.inputFrame={width:o.width,height:o.height,frameRate:o.framesPerSecond})}processAudioMediaSource(t,i){let o=this.report.get(t);o&&(i.inputLevel=o.audioLevel)}processVideoTrackSenderStats(t,i,o){var a,l,u,f;let m=i?this.report.get(i):void 0,_=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof _!="number")return;let v=(l=m==null?void 0:m.frameWidth)!==null&&l!==void 0?l:t.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:t.frameHeight,C=(f=m==null?void 0:m.framesPerSecond)!==null&&f!==void 0?f:t.framesPerSecond;if(typeof v=="number"&&typeof S=="number"||(v=0,S=0),C==null){let b=Date.now(),V=this.lastVideoFramesSent.get(o.ssrc);V&&b-V.lts>=800?(C=Math.round((_-V.count)/((b-V.lts)/1e3)),this.lastVideoFramesSent.set(o.ssrc,{count:_,lts:b,rate:C})):V?C=V.rate:this.lastVideoFramesSent.set(o.ssrc,{count:_,lts:b,rate:0})}o.sentFrame={width:v,height:S,frameRate:Math.max(0,C)}}processVideoTrackReceiverStats(t,i,o){var a,l,u,f,m;let _=i?this.report.get(i):void 0,v=(a=_==null?void 0:_.framesReceived)!==null&&a!==void 0?a:t.framesReceived,S=(l=_==null?void 0:_.frameWidth)!==null&&l!==void 0?l:t.frameWidth,C=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:t.frameHeight,b=(f=_==null?void 0:_.jitterBufferDelay)!==null&&f!==void 0?f:t.jitterBufferDelay,V=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof v=="number"){let P=this.lastVideoFramesRecv.get(o.ssrc),k=Date.now();o.framesReceivedCount=v;let F=0;P&&k-P.lts>=800?(F=Math.round((v-P.count)/((k-P.lts)/1e3)),this.lastVideoFramesRecv.set(o.ssrc,{count:v,lts:k,rate:F})):P?F=P.rate:this.lastVideoFramesRecv.set(o.ssrc,{count:v,lts:k,rate:0}),o.receivedFrame={width:S||0,height:C||0,frameRate:F||0},o.decodedFrame={width:S||0,height:C||0,frameRate:o.decodeFrameRate||0},o.outputFrame={width:S||0,height:C||0,frameRate:o.outputFrameRate||o.decodeFrameRate||0}}if(b&&V){let P=this.lastVideoJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},k=P.jitterBufferMs,F=V-P.jitterBufferEmittedCount;F>0&&(k=1e3*(b-P.jitterBufferDelay)/F),o.jitterBufferMs=k,o.currentDelayMs=Math.round(k),this.lastVideoJBDelay.set(o.ssrc,{jitterBufferDelay:b,jitterBufferEmittedCount:V,jitterBufferMs:o.currentDelayMs})}}processAudioTrackSenderStats(t,i,o){var a,l,u,f;let m=i?this.report.get(i):void 0,_=(a=(l=m==null?void 0:m.echoReturnLoss)!==null&&l!==void 0?l:t.echoReturnLoss)!==null&&a!==void 0?a:0,v=(u=(f=m==null?void 0:m.echoReturnLossEnhancement)!==null&&f!==void 0?f:t.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;o.aecReturnLoss=_,o.aecReturnLossEnhancement=v}processAudioTrackReceiverStats(t,i,o){var a,l,u,f,m,_,v;let S=i?this.report.get(i):void 0,C=(a=S==null?void 0:S.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,b=(l=S==null?void 0:S.totalSamplesReceived)!==null&&l!==void 0?l:t.totalSamplesReceived,V=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,P=(f=S==null?void 0:S.jitterBufferEmittedCount)!==null&&f!==void 0?f:t.jitterBufferEmittedCount,k=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,F=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:t==null?void 0:t.totalSamplesDuration,H=(v=S==null?void 0:S.concealedSamples)!==null&&v!==void 0?v:t.concealedSamples;if(C&&b&&(o.accelerateRate=C/b),V&&P){let oe=this.lastAudioJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},ae=oe.jitterBufferMs,he=P-oe.jitterBufferEmittedCount;he>0&&(ae=1e3*(V-oe.jitterBufferDelay)/he),o.jitterBufferMs=Math.round(ae),this.lastAudioJBDelay.set(o.ssrc,{jitterBufferDelay:V,jitterBufferEmittedCount:P,jitterBufferMs:o.jitterBufferMs})}o.outputLevel=k;let ie=1920;F&&b&&(ie=b/F/50,o.receivedFrames=Math.round(b/ie)),H&&(o.droppedFrames=Math.round(H/ie))}processRemoteInboundStats(t,i){let o=this.report.get(t);o&&(i.packetsLost=o.packetsLost,o.roundTripTime&&(i.rttMs=1e3*o.roundTripTime),o.jitter&&(i.jitterMs=1e3*o.jitter),o.timestamp&&(i.timestamp=o.timestamp))}getCodecFromCodecStats(t){let i=this.report.get(t);if(!i)return"";let o=i.mimeType.match(/\/(.*)$/);return o&&o[1]?o[1]:""}updateSendBitrate(){let t=0,i=null,o=null;this.mediaBytesSent.forEach(l=>{t+=l.diffMean()}),this.mediaBytesRetransmit.forEach(l=>{i=i===null?l.diffMean():i+l.diffMean()}),this.mediaBytesTargetEncode.forEach(l=>{o=o===null?l.diffMean():o+l.diffMean()});let a=i!==null?t-i:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},i!==null&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),o!==null&&(this._stats.bitrate.targetEncoded=8*o/(this.options.updateInterval/1e3))}}class Rie extends MI{updateStats(){return De.resolve()}}function q0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,l=function(){let u=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return u&&u[0]?Number(u[0].split("/")[1]):null}();return l?l<76?new bie(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:a}):new gF(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:a}):function(u){return!!window.RTCStatsReport&&u.getStats()instanceof De}(e)?new gF(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:a}):new Rie(e,{updateInterval:t,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:a})}function _F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function EF(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?_F(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_F(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function yE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,{filterRTX:a,filterVideoFec:l,filterAudioFec:u,filterAudioCodec:f,filterVideoCodec:m}=t,{useXR:_}=i,v=[],S=[],C=[],b=[],V=!1,P=!1;if(Oi.parse(e).mediaDescriptions.forEach(F=>{o&&o!==F.attributes.direction||(F.media.mediaType!=="video"||V||(S=F.attributes.payloads,b=F.attributes.extmaps,V=!0),F.media.mediaType!=="audio"||P||(v=F.attributes.payloads,C=F.attributes.extmaps,P=!0))}),!b||S.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!C||v.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(S.forEach(F=>{var H;(H=F.rtpMap)!==null&&H!==void 0&&H.clockRate&&(F.rtpMap.clockRate=parseInt(F.rtpMap.clockRate)),_&&F.rtcpFeedbacks.push({type:"rrtr"})}),v.forEach(F=>{var H;(H=F.rtpMap)!==null&&H!==void 0&&H.clockRate&&(F.rtpMap.clockRate=parseInt(F.rtpMap.clockRate)),_&&F.rtcpFeedbacks.push({type:"rrtr"})}),a&&(v=v.filter(F=>{var H;return((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())!=="rtx"}),S=S.filter(F=>{var H;return((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())!=="rtx"})),l&&(S=S.filter(F=>{var H;return!/(red)|(ulpfec)|(flexfec)/i.test(((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName)||"")})),u&&(v=v.filter(F=>{var H;return!/(red)|(ulpfec)|(flexfec)/i.test(((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName)||"")})),f&&(f==null?void 0:f.length)>0&&(v=v.filter(F=>{var H;return ke(f).call(f,((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName.toLowerCase())||"")})),m&&(m==null?void 0:m.length)>0){let F=S.filter(H=>{var ie;return ke(m).call(m,((ie=H.rtpMap)===null||ie===void 0?void 0:ie.encodingName.toLowerCase())||"")});S=F.concat(a?[]:BI(F,S))}let k=$("UNSUPPORTED_VIDEO_CODEC");return k&&k.length>0&&(S=S.filter(F=>!(F.rtpMap&&ke(k).call(k,F.rtpMap.encodingName.toLowerCase())))),{audioCodecs:v,videoCodecs:S,audioExtensions:C,videoExtensions:b}}function hc(e){let t=Oi.parse(e),i,o;for(let a of t.mediaDescriptions){if(!i){let l=a.attributes.iceUfrag,u=a.attributes.icePwd;if(!l||!u)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:l,icePwd:u}}if(!o){let l=a.attributes.fingerprints;l.length>0&&(o={fingerprints:l})}}if(!o&&t.attributes.fingerprints.length>0&&(o={fingerprints:t.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function UI(e,t){let i=[],o=e.attributes.ssrcGroups.filter(u=>u.semantic==="FID"),a=e.attributes.ssrcGroups.find(u=>u.semantic==="SIM"),l=e.attributes.ssrcs;if(a)a.ssrcIds.forEach(u=>{var f;let m=(f=o.find(_=>_.ssrcIds[0]===u))===null||f===void 0?void 0:f.ssrcIds[1];i.push({ssrcId:u,rtx:t?m:void 0})});else if(o.length>0){let u=o[0].ssrcIds[0],f=o[0].ssrcIds[1];i.push({ssrcId:u,rtx:t?f:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:l[0].ssrcId})}return i}function vF(e,t){let{cname:i}=e,o;t&&t.ip&&typeof t.port=="number"?(o=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(o.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):o=e.iceParameters.candidates.map(f=>({foundation:f.foundation,componentId:"1",transport:f.protocol,priority:f.priority.toString(),connectionAddress:f.ip,port:f.port.toString(),type:f.type,extension:{}}));let a={fingerprints:e.dtlsParameters.fingerprints.map(f=>({hashFunction:f.algorithm,fingerprint:f.fingerprint}))},l={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}return{dtlsParameters:a,iceParameters:l,candidates:o,rtpCapabilities:Vm(e.rtpCapabilities),setup:u,cname:i}}function _s(e,t,i){let o=[],a=[];return e.forEach(l=>{let{ssrcId:u,rtx:f}=l,m=di(8,"track-"),_={ssrcId:u,attributes:EF({label:m,mslabel:i=i||di(10,""),msid:"".concat(i," ").concat(m)},t&&{cname:t})};if(o.push(_),f!==void 0){let v={ssrcId:f,attributes:EF({label:m,mslabel:i,msid:"".concat(i," ").concat(m)},t&&{cname:t})};o.push(v),a.push({semantic:"FID",ssrcIds:[u,f]})}}),e.length>1&&a.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:u}=l;return u})}),{ssrcs:o,ssrcGroups:a}}function yu(e,t){t instanceof Bi&&e.attributes.payloads.forEach(i=>{var o;let a=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!a||["opus","pcmu","pcma","g722"].indexOf(a)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let l=t._encoderConfig;l&&a!=="pcmu"&&a!=="pcma"&&a!=="g722"&&(l.bitrate&&!ci()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function Y0(e){let t=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function $0(e,t){var i;if(!(t instanceof ui&&t._encoderConfig&&t._hints.indexOf(gi.SCREEN_TRACK)===-1))return;let o=t._encoderConfig;xt().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(a=>{var l,u;ke(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),xt().supportMinBitrate&&!ke(i=t._hints).call(i,gi.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(a=>{var l,u;ke(l=["h264","h265","vp8","vp9","av1"]).call(l,((u=a.rtpMap)===null||u===void 0?void 0:u.encodingName.toLowerCase())||"")&&(a.fmtp||(a.fmtp={parameters:{}}),a.fmtp.parameters["x-google-start-bitrate"]="".concat($("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function jI(e){if(e.media.mediaType!=="video")return;let t=Ut();if(t.name!==$t.SAFARI&&t.os!==On.IOS)return;let i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function jm(e,t,i){if(!t)return;let o,a;if(e.media.mediaType==="video"?(o=i.videoExtensions,a=i.videoCodecs):(o=i.audioExtensions,a=i.audioCodecs),t.twcc===!0){let l=o.find(u=>u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");l&&(e.attributes.extmaps.find(u=>u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(u,f){return f.filter(m=>!!u.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(v=>v.type==="transport-cc")))}(a,e.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(f=>f.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){let l=e.attributes.extmaps.findIndex(u=>u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{let f=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");f!==-1&&u.rtcpFeedbacks.splice(f,1)})}if(t.remb===!0){let l=o.find(u=>u.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");l&&(e.attributes.extmaps.find(u=>u.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(u,f){return f.filter(m=>!!u.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(v=>v.type==="goog-remb")))}(a,e.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(f=>f.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){let l=e.attributes.extmaps.findIndex(u=>u.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(u=>{let f=u.rtcpFeedbacks.findIndex(m=>m.type==="goog-remb");f!==-1&&u.rtcpFeedbacks.splice(f,1)})}}function VI(e,t,i){if(ci()||e.media.mediaType!=="video"||!(t instanceof ui)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!$("SIMULCAST")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let o=i==="vp8"?2:t._scalabilityMode.numSpatialLayers,a=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(f=>f.semantic==="FID"&&f.ssrcIds[0]===a.ssrcId),u={semantic:"SIM",ssrcIds:[a.ssrcId]};for(let f=1;f<o;f++)e.attributes.ssrcs.push({ssrcId:a.ssrcId+f,attributes:mi(a.attributes)}),u.ssrcIds.push(a.ssrcId+f),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+f,attributes:mi(a.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[a.ssrcId+f,l.ssrcIds[1]+f]}));e.attributes.ssrcGroups.unshift(u)}async function FI(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let o=(await i.createOffer()).sdp,{send:a,recv:l,sendrecv:u}=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0,v=yE(_,f,m,"sendonly"),S=yE(_,f,m,"recvonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ca(v,S,"videoExtensions",C,b,V),Ca(v,S,"videoCodecs",C,b,V),Ca(v,S,"audioExtensions",C,b,V),Ca(v,S,"audioCodecs",C,b,V),$("RAISE_H264_BASELINE_PRIORITY")){let P=V.videoCodecs.findIndex(k=>{var F,H;return((F=k.rtpMap)===null||F===void 0?void 0:F.encodingName.toLocaleLowerCase())==="h264"&&((H=k.fmtp)===null||H===void 0?void 0:H.parameters["profile-level-id"])==="42001f"});if(P!==-1){let k=V.videoCodecs.findIndex(F=>{var H;return((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName.toLocaleLowerCase())==="h264"});if(k<P){I.debug("raising H264 baseline profile priority");let F=V.videoCodecs[P];V.videoCodecs.splice(P,1),V.videoCodecs.splice(k,0,F)}k!==-1&&(b.videoCodecs=b.videoCodecs.filter(F=>{var H,ie;return!(((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName.toLocaleLowerCase())==="h264"&&((ie=F.fmtp)===null||ie===void 0?void 0:ie.parameters["profile-level-id"])!=="42001f")})),k!==-1&&$("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(F=>{var H,ie;return!(((H=F.rtpMap)===null||H===void 0?void 0:H.encodingName.toLocaleLowerCase())==="h264"&&((ie=F.fmtp)===null||ie===void 0?void 0:ie.parameters["profile-level-id"])!=="42001f")}))}}return{send:C,recv:b,sendrecv:V}}(e,t,o);try{i.close()}catch{}return{send:a,recv:l,sendrecv:u}}function yF(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=yE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ca(e,t,"videoExtensions",i,o,a),Ca(e,t,"videoCodecs",i,o,a),Ca(e,t,"audioExtensions",i,o,a),Ca(e,t,"audioCodecs",i,o,a),$("RAISE_H264_BASELINE_PRIORITY")){let l=a.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){let u=a.videoCodecs.findIndex(f=>f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(u<l){I.debug("raising H264 baseline profile priority");let f=a.videoCodecs[l];a.videoCodecs.splice(l,1),a.videoCodecs.splice(u,0,f)}u!==-1&&(o.videoCodecs=o.videoCodecs.filter(f=>!(f.rtpMap&&f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&f.fmtp&&f.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:a}}function Ca(e,t,i,o,a,l){if(i==="videoExtensions"||i==="audioExtensions"){let u=[];return e[i].forEach(f=>{t[i].some((m,_)=>{if(f.entry===m.entry&&f.extensionName===m.extensionName)return u.push(_),!0})?l[i].push(f):o[i].push(f)}),void t[i].forEach((f,m)=>{u.indexOf(m)===-1&&a[i].push(f)})}if(i==="videoCodecs"||i==="audioCodecs"){let u=[];return e[i].forEach(f=>{t[i].some((m,_)=>{if(f.payloadType===m.payloadType&&JSON.stringify(f)===JSON.stringify(m))return u.push(_),!0})?l[i].push(f):o[i].push(f)}),void t[i].forEach((f,m)=>{u.indexOf(m)===-1&&a[i].push(f)})}}function Vm(e){let{send:t,recv:i,sendrecv:o}=e;if(!o){if(!t||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:i}}let a,l;return t?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...t.audioCodecs,...o.audioCodecs],a.videoCodecs=[...t.videoCodecs,...o.videoCodecs],a.audioExtensions=[...t.audioExtensions,...o.audioExtensions],a.videoExtensions=[...t.videoExtensions,...o.videoExtensions]):a=o,i?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...i.audioCodecs,...o.audioCodecs],l.videoCodecs=[...i.videoCodecs,...o.videoCodecs],l.audioExtensions=[...i.audioExtensions,...o.audioExtensions],l.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):l=o,{send:a,recv:l}}function pc(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var i;return((i=t.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function X0(e){e.mediaDescriptions.forEach(t=>{t.media.mediaType!=="video"&&t.media.mediaType!=="audio"||t.attributes.payloads.forEach(i=>{i.rtcpFeedbacks.findIndex(o=>o.type==="rrtr")===-1&&i.rtcpFeedbacks.push({type:"rrtr"})})})}function bp(e,t,i,o){let a=[];if(e===He.VIDEO){if($("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(a=t.videoCodecs.filter(l=>{var u;return ke(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,o)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===$("H264_PROFILE_LEVEL_ID")})),!Array.isArray(a)||a.length===0){let l=[],u=[],f=[],m=[];if(i.videoCodecs.forEach(_=>{let v=_.rtpMap&&_.rtpMap.encodingName.toLowerCase()||"";ke(v).call(v,o)?l.push(_):ke(v).call(v,"vp9")?u.push(_):ke(v).call(v,"vp8")?f.push(_):ke(v).call(v,"h264")&&m.push(_)}),l.length===0){let _="";u.length!==0?(l=u,_="vp9"):f.length!==0?(l=f,_="vp8"):m.length!==0&&(l=m,_="h264"),I.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(_))}l.length!==0&&(a=t.videoCodecs.filter(_=>l.some(v=>v.payloadType===_.payloadType)))}if(a.length===0&&(I.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),a=t.videoCodecs),$("USE_PUB_RTX")||$("USE_SUB_RTX")){let l=BI(a,t.videoCodecs);a=[...a,...l]}}else a=t.audioCodecs.filter(l=>{var u;return ke(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,o)}),a.length===0&&(I.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),a=t.audioCodecs.filter(l=>{var u;return ke(u=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(u,"opus")}));return a}function BI(e,t){let i=e.map(o=>o.payloadType.toString());return t.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ke(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}let SF=class{get localCapabilities(){return mi(this._localCapabilities)}get rtpCapabilities(){return mi(this._rtpCapabilities)}get candidates(){return mi(this._candidates)}get iceParameters(){return mi(this._iceParameters)}get dtlsParameters(){return mi(this._dtlsParameters)}constructor(e){U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_iceParameters",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname","o/i14u9pJrxRKAsu"),U(this,"firefoxSsrcMidMap",new Map),e=mi(e);let{remoteIceParameters:t,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,localCapabilities:l,direction:u,setup:f,videoCodec:m,audioCodec:_}=e,v;this.setup=f,v=u===Vr.RECEIVE_ONLY?Oi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Oi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=a,this._candidates=o,this._iceParameters=t,this._dtlsParameters=i,this._localCapabilities=l;let S=u===Vr.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,C=u===Vr.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,b=u===Vr.RECEIVE_ONLY?a.send.videoCodecs:bp(He.VIDEO,S,C,m),V=u===Vr.RECEIVE_ONLY?a.send.audioCodecs:bp(He.AUDIO,S,C,_);for(let P of v.mediaDescriptions)P.attributes.iceUfrag=t.iceUfrag,P.attributes.icePwd=t.icePwd,P.attributes.fingerprints=i.fingerprints,P.attributes.candidates=o,P.attributes.setup=this.setup,P.media.mediaType==="application"&&(P.attributes.sctpPort="5000"),P.media.mediaType==="video"&&(P.media.fmts=b.map(k=>k.payloadType.toString(10)),P.attributes.payloads=b,P.attributes.extmaps=S.videoExtensions),P.media.mediaType==="audio"&&(P.media.fmts=V.map(k=>k.payloadType.toString(10)),P.attributes.payloads=V,P.attributes.extmaps=S.audioExtensions,pc(P));this.sessionDesc=v,this.currentMidIndex=v.mediaDescriptions.length-1}toString(){return Oi.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,i,o,a){i=i.replace(/ /g,"-");let{ssrcs:l,ssrcGroups:u}=_s(t,this.cname,$("SYNC_GROUP")?i:void 0),f=this.findPreloadMediaDesc(l);if(f){if(ci()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),a&&(a.twcc||a.remb)){let m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,a),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{let m=this.findAvailableMediaIndex(e,l,o),_;return m===-1?(_=this.createOrRecycleSendMedia(e,l,u,"sendonly",o,a),this.updateBundleMids()):(_=mi(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=l,_.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,a)),ci()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,_.attributes.mid),{needExchangeSDP:!0,mid:_.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,i){let o=[];return e.forEach(a=>{let l=a._mediaStreamTrack.kind,u=this.findAvailableRecvMediaIndex(l),f,m=!1;u===-1?(m=!0,f=this.createOrRecycleRecvMedia(a,[],"recvonly",t,i),this.updateBundleMids()):(f=mi(this.sessionDesc.mediaDescriptions[u]),f.attributes.direction="recvonly"),o.push({mid:f.attributes.mid,needCreateTransceiver:m})}),o}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:i,address:o,port:a,type:l,relatedAddress:u,relatedPort:f,priority:m}=new RTCIceCandidate(e),_={foundation:t??"",componentId:"1",transport:i??"",priority:m?m+"":"",connectionAddress:o??"",port:a?a+"":"",type:l?l+"":"",relAddr:u??"",relPort:f?f+"":"",extension:{}};this.candidates.some(v=>v.priority===_.priority&&v.connectionAddress===_.connectionAddress&&v.port===_.port)||(this._candidates.push(_),this.sessionDesc.mediaDescriptions.forEach(v=>{v.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,i,o,a){let l=e._mediaStreamTrack.kind,u=this.rtpCapabilities.recv,f=bp(l,u,this.localCapabilities.send,l===He.AUDIO?a:o),m=l===He.VIDEO?u.videoExtensions:u.audioExtensions,_="".concat(++this.currentMidIndex),v={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungRecvMediaDsec(v,e);let S=this.findFirstClosedMedia(l);if(S){let C=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[C]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>ke(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(i=>ke(e).call(e,i.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{let a=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(ci()){if(a){let l=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(l||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!l||l!==o.attributes.mid)}return!1}return a&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let i=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&i})}predictReceivingMids(e){let t=[];for(let i=0;i<e;i++)t.push((this.currentMidIndex+i+1).toString(10));return t}restartICE(e){e=mi(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,i,o,a,l){let u=this.rtpCapabilities.send,f=e===He.VIDEO?u.videoCodecs:u.audioCodecs,m=e===He.VIDEO?u.videoExtensions:u.audioExtensions;ci()&&(a="".concat(++this.currentMidIndex));let _={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:a}};_=this.mungSendMediaDesc(_,l);let v=this.findFirstClosedMedia(e);if(v){let S=this.sessionDesc.mediaDescriptions.indexOf(v);this.sessionDesc.mediaDescriptions[S]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}mungRecvMediaDsec(e,t,i){let o=mi(e);return Y0(o),yu(o,t),$0(o,t),jI(o),jm(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,t){let i=mi(e);return jm(i,t,this.localCapabilities.recv),pc(i),i}updateRecvMedia(e,t){let i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var i;return((i=t.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>ci()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},Iie=["sdp"];var vi;function TF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Su(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?TF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):TF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let wF=(vi=class Jm extends r2{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,i,o){super(t,i),U(this,"direction",void 0),U(this,"name",void 0),U(this,"store",void 0),U(this,"spec",void 0),U(this,"peerConnection",void 0),U(this,"initialOffer",void 0),U(this,"transport",void 0),U(this,"statsFilter",void 0),U(this,"localCandidateCount",0),U(this,"_isInRestartIce",!1),U(this,"mutex",new jn("P2PConnection-mutex")),U(this,"onLocalCandidate",void 0),U(this,"remoteSDP",void 0),U(this,"pendingCandidates",[]),U(this,"localCapabilities",void 0),U(this,"isReady",!1),U(this,"restartCnt",0),U(this,"curTurnServerIndex",0),this.store=i,this.spec=t,this.peerConnection=new RTCPeerConnection(Jm.resolvePCConfiguration(t,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Vr.SEND_ONLY,this.name=this.direction===Vr.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=q0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let i=await FI();if(this.localCapabilities=Vm(i),t){let{sdp:o}=t,a=wie(t,Iie),l=function(){let v={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},S=yE(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},V={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ca(S,v,"videoExtensions",C,b,V),Ca(S,v,"videoCodecs",C,b,V),Ca(S,v,"audioExtensions",C,b,V),Ca(S,v,"audioCodecs",C,b,V),$("RAISE_H264_BASELINE_PRIORITY")){let P=V.videoCodecs.findIndex(k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]==="42001f");if(P!==-1){let k=V.videoCodecs.findIndex(F=>F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(k<P){I.debug("raising H264 baseline profile priority");let F=V.videoCodecs[P];V.videoCodecs.splice(P,1),V.videoCodecs.splice(k,0,F)}k!==-1&&$("FILTER_SEND_H264_BASELINE")&&(C.videoCodecs=C.videoCodecs.filter(F=>!(F.rtpMap&&F.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&F.fmtp&&F.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:C,recv:b,sendrecv:V}}({},{},o);this.remoteSDP=new SF({remoteIceParameters:a.iceParameters,remoteDtlsParameters:a.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let u=await this.peerConnection.createAnswer();if(!u.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let f=hc(u.sdp);await this.peerConnection.setLocalDescription(u);let m=await yF({},{},u.sdp);this.localCapabilities=Vm(m);let _=this.peerConnection.getTransceivers()[0];return _!=null&&_.receiver&&_.receiver.transport&&this.tryBindTransportEvents(_.receiver.transport),Su(Su({},f),{},{sdp:u.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let a=hc(o.sdp);return this.initialOffer=o,Su(Su({},a),{},{sdp:o.sdp})}}catch(i){throw new fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:o,dtlsParameters:a}=t,l=await yF({},{},i);this.remoteSDP=new SF({remoteIceParameters:o,remoteDtlsParameters:a,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let u=this.peerConnection.getTransceivers()[0];u!=null&&u.sender&&u.sender.transport&&this.tryBindTransportEvents(u.sender.transport)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new fe(W.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(t,i,o){var a=this;return Bo(function*(){let l=yield mt(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let u=[],f=a.remoteSDP.receive(t,i,o);t.forEach((k,F)=>{if(f[F].needCreateTransceiver){let H=a.peerConnection.addTransceiver(k._mediaStreamTrack,{direction:"sendonly"});u.push(H),k._updateRtpTransceiver(H)}else{let H=a.peerConnection.getTransceivers().find(ie=>ie.mid===f[F].mid);if(!H)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(f[F].mid));u.push(H),k._updateRtpTransceiver(H)}}),ci()&&$("SIMULCAST")===!0&&(yield mt(a.applySimulcastForFirefox(u,t)));let m=f.map(k=>k.mid),_=yield mt(a.peerConnection.createOffer()),v=a.mungSendOfferSDP(_.sdp,t,m),S=Oi.parse(v),C=m.map(k=>{let F=S.mediaDescriptions.find(H=>H.attributes.mid===k);if(!F)throw new Error("Cannot extract ssrc from mediaDescription.");return UI(F,$("USE_PUB_RTX"))}),b=u.map((k,F)=>{let H=m[F];return{localSSRC:C[F],id:H}});yield mt(a.peerConnection.setLocalDescription({type:"offer",sdp:v}));try{yield b}catch(k){let F=a.remoteSDP.toString();throw yield mt(a.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield mt(a.peerConnection.setRemoteDescription({type:"answer",sdp:F})),yield mt(a.stopSending(m,!0)),k}yield mt(a.applySimulcastEncodings(u,t)),yield mt(a.applySendEncodings(u,t));let V=a.remoteSDP.toString(),P=a.logSDPExchange(v,"offer","local","send");return P==null||P(V),yield mt(a.setRemoteDescription({type:"answer",sdp:V})),u.map((k,F)=>{let H=m[F];return{localSSRC:C[F],id:H}})}catch(u){throw u instanceof fe?u:new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async stopSending(t,i){let o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length (".concat(a.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));a.map(m=>{var _;m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});let l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);let f=this.remoteSDP.toString();u==null||u(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(a){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{o&&o()}}async receive(t,i,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,i,o,a);if(u){let m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});let v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,l,t);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let f=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!f||f.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,mid:f.mid,transceiver:f}}catch(l){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(t,i,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,i,o,a);if(u){let f=this.remoteSDP.toString(),m=this.logSDPExchange(f,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:f});let _=await this.peerConnection.createAnswer(),v=this.mungReceiveAnswerSDP(_.sdp,l,t);m==null||m(v||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:v}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(l){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===cp.Auto&&(this.store.p2pTransport=cp.SdRtn,xt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Jm.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,xt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Jm.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:o}=hc(i.sdp);return this.store.descriptionStart(),this.direction===Vr.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Vr.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:o}=hc(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let l=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new fe(W.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,i){let o=this.peerConnection.getTransceivers().filter(a=>a.mid===t);o.length===1&&(this.isVP8Simulcast(i)?ci()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let o=this.peerConnection.getTransceivers().find(a=>a.mid===i);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:o,remote:a}=i.getSelectedCandidatePair();return{local:Su(Su({},al),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Su(Su({},al),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,i;ke(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var i;t.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a={iceServers:[]};var l;return t.iceServers?a.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(om(t.turnServer.servers)?a.iceServers=t.turnServer.servers:(a.iceServers&&a.iceServers.push(...Jm.turnServerConfigToIceServers(t.turnServer.servers,i,o)),$("USE_TURN_SERVER_OF_GATEWAY")&&a.iceServers&&t.turnServer.serversFromGateway&&a.iceServers.push(...Jm.turnServerConfigToIceServers(t.turnServer.serversFromGateway,i,o)),ke(l=[cp.Relay,cp.SdRtn]).call(l,i)&&(a.iceTransportPolicy="relay"),$("FORCE_TURN_TCP")?a.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(u=>{u.forceturn&&(a.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&xt().supportWebRTCEncodedTransform&&(a.encodedInsertableStreams=!0),I.debug("P2PConnection p2pTransport is ".concat(i)),a}static turnServerConfigToIceServers(t,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=[],l=t.filter(f=>f.tcpport);I.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(o));let u=l.length>o?l[o]:l[0];switch(i){case cp.SdRtn:let f=t.filter(_=>{var v;return ke(v=_.username).call(v,"glb:")&&_.turnServerURL==_.turnServerURL}),m=f.length>o?f[o]:f[0];m&&(a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turn:".concat(hu(m.turnServerURL),":").concat(m.tcpport,"?transport=udp")}),a.push({username:m.username,credential:m.password,credentialType:"password",urls:"turns:".concat(hu(m.turnServerURL),":").concat(m.tcpport,"?transport=tcp")}));break;case cp.Relay:u&&(a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(hu(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;default:u&&(a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(u.turnServerURL,":").concat(u.tcpport,"?transport=udp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(hu(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}),a.push({username:u.username,credential:u.password,credentialType:"password",urls:"stun:".concat(u.turnServerURL,":").concat(u.tcpport)}))}return a}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var o;t!=null&&t.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,t.state))},t.onerror=o=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in o?o.error:o)};let i=t.iceTransport;i&&(i.onstatechange=()=>{let o=t==null?void 0:t.iceTransport.state;var a;o&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:o,remote:a}=i.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var o;if(i||(i=this.peerConnection.getSenders().find(v=>v.track===t._mediaStreamTrack)),!i)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let a={},l={};switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if(t._encoderConfig){var u;let{bitrateMax:v,frameRate:S,scaleResolutionDownBy:C}=t._encoderConfig;v&&(l.maxBitrate=1e3*v),ke(u=t._hints).call(u,gi.LOW_STREAM)&&(S&&(l.maxFramerate=_o(S)),C&&C>=1&&(l.scaleResolutionDownBy=C))}if($("DSCP_TYPE")&&ou()){var f;let v=$("DSCP_TYPE");ke(f=["very-low","low","medium","high"]).call(f,v)&&(l.networkPriority=v)}let m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];ci()&&!_&&(a.encodings=[l]),_&&Object.assign(_,l),Object.assign(m,a),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(t,i){try{if(!xt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let o=0;o<t.length;o++){let a=t[o],l=i[o];l instanceof ui&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,o){let a=Oi.parse(t);return i.forEach((l,u)=>{let f=o[u],m=a.mediaDescriptions.find(_=>_.attributes.mid===f);m&&(yu(m,l),VI(m,l,this.store.codec))}),Oi.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let m=0;m<t.length;m++){var o,a,l,u,f;let _=t[m],v=i[m];if(v instanceof ui&&!ke(o=v._hints).call(o,gi.LOW_STREAM)&&(a=v._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=v._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=v._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=v._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){let S={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];let b=_.sender.getParameters();await _.sender.setParameters(Object.assign(b,S))}}}async applySimulcastEncodings(t,i){if(!ci()&&t.length===i.length)for(let o=0;o<t.length;o++){let a=i[o];if(a instanceof ui&&this.isVP8Simulcast(a)){let l=t[o],u={},f={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];let m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var i,o,a,l,u;return!!(t instanceof ui&&$("SIMULCAST")&&this.store.codec==="vp8"&&!ke(i=t._hints).call(i,gi.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,i,o,a){if($("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(a,`
`),t),i==="offer"?l=>{this.logSDPExchange(l,"answer",o==="local"?"remote":"local",a)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(u=>{u.direction="inactive"});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);let l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async u=>{u.direction="sendonly"});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);let l=this.remoteSDP.toString();a==null||a(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(t,i){var o,a;if(i=(o=i)!==null&&o!==void 0?o:(a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp){var l;let u=(l=Oi.parse(i).mediaDescriptions.find(f=>f.attributes.mid===t))===null||l===void 0?void 0:l.attributes.ssrcs;return u==null?void 0:u[0].ssrcId}}async setRemoteDescription(t){var i;await this.peerConnection.setRemoteDescription(t),ke(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,i,o){let a=Oi.parse(t),l=a.mediaDescriptions.find(u=>u.attributes.mid===i);return l&&o===He.AUDIO&&l.media.mediaType==="audio"&&pc(l),Oi.print(a)}},Ne(vi.prototype,"establish",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"establish"),vi.prototype),Ne(vi.prototype,"connect",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"connect"),vi.prototype),Ne(vi.prototype,"receive",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"receive"),vi.prototype),Ne(vi.prototype,"mockReceive",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"mockReceive"),vi.prototype),Ne(vi.prototype,"stopReceiving",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"stopReceiving"),vi.prototype),Ne(vi.prototype,"restartICE",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"restartICE"),vi.prototype),Ne(vi.prototype,"close",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"close"),vi.prototype),Ne(vi.prototype,"updateEncoderConfig",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"updateEncoderConfig"),vi.prototype),Ne(vi.prototype,"updateSendParameters",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"updateSendParameters"),vi.prototype),Ne(vi.prototype,"replaceTrack",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"replaceTrack"),vi.prototype),Ne(vi.prototype,"muteLocal",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"muteLocal"),vi.prototype),Ne(vi.prototype,"unmuteLocal",[ba],Object.getOwnPropertyDescriptor(vi.prototype,"unmuteLocal"),vi.prototype),vi);function ba(e,t,i){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,l=await a.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{l()}},i}function WI(e,t){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=_o(t.width),o.height=_o(t.height);let a=_o(t.framerate||15);document.body.append(i),document.body.append(o);let l=e._mediaStreamTrack;i.srcObject=new MediaStream([l]),i.play();let u=o.getContext("2d");if(!u)throw new se(W.UNEXPECTED_ERROR,"can not get canvas context");let f=xt(),m=o.captureStream(f.supportRequestFrame?0:a).getVideoTracks()[0];m.canvas||(m.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let v=i.videoWidth,S=i.videoHeight/v,C=o.width*S;Math.abs(C-o.height)>=2&&(I.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(C)),o.height=C)}u.drawImage(i,0,0,o.width,o.height),m.requestFrame&&m.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,i.srcObject=new MediaStream([l]))},o.stopCapture=wI(()=>o.startCapture&&o.startCapture(),a);let _=m.stop;return m.stop=()=>{_.call(m),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),I.debug("clean low stream renderer")},m}var J0=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(J0||{}),Dn=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(Dn||{}),Rp=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Rp||{}),vr=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(vr||{}),Ip=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(Ip||{}),CF=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(CF||{}),Tu=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(Tu||{}),Ra=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(Ra||{}),bF=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(bF||{}),Ms=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(Ms||{});let id=1e3,Ap=3;function Et(e,t,i){i!=null&&Number.isFinite(i)&&(e[t]=Math.round(Math.max(0,i)))}function RF(e){let t={[Ms.CONN_TYPE]:0,[Ms.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(t[Ms.CONN_TYPE]=1),i==="tcp"&&(t[Ms.CONN_TYPE]=3),i==="tls"&&(t[Ms.CONN_TYPE]=4);break}case"srflx":t[Ms.CONN_TYPE]=2}return t}function IF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class AF extends Ii{constructor(t){super(),U(this,"store",void 0),U(this,"uploadWRTCStatsTimer",void 0),U(this,"uploadOutboundDenoiserStatsTimer",void 0),U(this,"uploadExtStatsTimer",void 0),U(this,"uploadExtUsageStatsTimer",void 0),U(this,"uploadInboundExtStatsTimer",void 0),U(this,"requestStats",void 0),U(this,"requestTransportStats",void 0),U(this,"requestLocalMedia",void 0),U(this,"requestRemoteMedia",void 0),U(this,"requestAllTracks",void 0),U(this,"requestVideoIsReady",void 0),U(this,"requestUploadStats",void 0),U(this,"requestUpload",void 0),U(this,"uploadOutboundStarted",!1),U(this,"uploadInboundStarted",!1),U(this,"uploadTransportStarted",!1),U(this,"uploadExtensionUsageStarted",!1),U(this,"lastRecvStats",void 0),U(this,"lastSendStats",void 0),U(this,"lastFullRecvStats",void 0),U(this,"lastFullSendStats",void 0),U(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let i,o;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),i||o){let a={};if(this.uploadTransportStarted&&i){let l=this.getTransportStats(i,o,t);l&&(a.misc=[l])}if(this.uploadOutboundStarted&&i){let l=this.getOutboundStats(i,t?this.lastSendStats:this.lastFullSendStats,t);l&&(a.outbound=[l])}if(this.uploadInboundStarted&&o){let l=this.getInboundStats(o,t?this.lastRecvStats:this.lastFullRecvStats,t);l&&(a.inbound=l)}this.requestUploadStats(a)}this.lastRecvStats=o,this.lastSendStats=i,t||(this.lastFullRecvStats=o,this.lastFullSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(t!==Ap),++t===Ap+1&&(t=1)},id)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,i,o){if(!this.requestStats)return;if(o)return t.rtt==null?void 0:{addition:{[Ms.RTT]:t.rtt,[Ms.CONN_TYPE]:void 0}};let a=RF(t);if(this.store.useP2P){if(i){let l=RF(i);a[Ms.CONN_TYPE]+=l[Ms.CONN_TYPE]<<3}a[Ms.CONN_TYPE]+=110}else a[Ms.CONN_TYPE]+=100;return{addition:a}}getOutboundStats(t,i,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;let a=this.requestLocalMedia();if(!a||a.length===0)return;let l,u,f;return a.forEach(m=>{let[_,{track:v,ssrcs:S}]=m;switch(_){case Te.LocalVideoLowTrack:case Te.LocalVideoTrack:if(_===Te.LocalVideoTrack){let C=function(P,k,F,H,ie){let oe=k.videoSend.find(ze=>ze.ssrc===P);if(!oe)return;let ae={},{sentFrame:he,inputFrame:Ee}=oe;if(Ee&&he){let ze=Ee.frameRate,It=he.frameRate;ae[Dn.FREEZE]=function(Kt,_i){let sn=!0;return sn=!(Kt<=5)&&(Kt<=10?_i<3:Kt<=20?_i<4:_i<5),sn}(ze,It)?1:0}if(Et(ae,Dn.QP_SUM,oe.qpSumPerFrame),ie)return ae;switch(he&&(Et(ae,Dn.HEIGHT,he.height),Et(ae,Dn.WIDTH,he.width),Et(ae,Dn.FRAME_RATE,he.frameRate)),ae[Dn.DISABLED]=H._originMediaStreamTrack&&!H._originMediaStreamTrack.enabled||H._mediaStreamTrack&&!H._mediaStreamTrack.enabled?1:0,oe.adaptionChangeReason){case"none":ae[Dn.ADAPTATION]=0;break;case"cpu":ae[Dn.ADAPTATION]=1;break;case"bandwidth":ae[Dn.ADAPTATION]=2;break;case"other":ae[Dn.ADAPTATION]=3}let ye=0;oe.adaptionChangeReason&&(ye+=IF(oe.adaptionChangeReason)),k.qualityLimitationReason&&(ye+=IF(k.qualityLimitationReason)<<3),ae[Dn.ADAPTATION]=ye,ae[Dn.PLAYER_STATUS]=SI[H._player?H._player.videoElementStatus:"uninit"],Et(ae,Dn.NACKS,oe.nacksCount),Et(ae,Dn.PLIS,oe.plisCount),Et(ae,Dn.FIRS,oe.firsCount),Et(ae,Dn.AVG_ENCODE,oe.avgEncodeMs);let Ce=F&&F.videoSend.find(ze=>ze.ssrc===P);if(Ce){let ze=ie?id:id*Ap;Ce.timestamp&&oe.timestamp&&(ze=oe.timestamp-Ce.timestamp),Ce.packets!=null&&oe.packets!=null&&Et(ae,Dn.PACKAGE_RATE,1e3*(oe.packets-Ce.packets)/ze),oe.packetsLost!=null&&Ce.packetsLost!=null&&Et(ae,Dn.PACKAGE_LOST,oe.packetsLost-Ce.packetsLost),Ce.bytes!=null&&oe.bytes!=null&&Et(ae,Dn.BITRATE,8*(oe.bytes-Ce.bytes)/ze)}return ae}(S[0].ssrcId,t,i,v,o),b=o?null:function(P,k,F){let H=k.videoSend.find(ye=>ye.ssrc===P);if(!H)return null;let ie={},oe=H.inputFrame,ae=oe&&oe.height||F&&F.videoHeight||0,he=oe&&oe.width||F&&F.videoWidth||0,Ee=oe&&oe.frameRate||0;return Et(ie,J0.HEIGHT,ae),Et(ie,J0.WIDTH,he),Et(ie,J0.FRAME_RATE,Ee),ie}(S[0].ssrcId,t,v),V=o?null:function(P){let k={};return Et(k,Dn.RETRANSMIT,P.bitrate.retransmit),Et(k,Dn.TARGET_ENCODED,P.bitrate.targetEncoded),Et(k,Dn.ACTUAL_ENCODED,P.bitrate.actualEncoded),Et(k,Dn.TRANSMIT,P.bitrate.transmit),Et(k,Dn.BANDWIDTH,P.sendBandwidth),k}(t);u=Object.assign({},C,b,V)}else f=o?void 0:function(C,b,V){let P=b.videoSend.find(H=>H.ssrc===C);if(!P)return;let k={},F=P.sentFrame;if(F&&(Et(k,Rp.HEIGHT,F.height),Et(k,Rp.WIDTH,F.width),Et(k,Rp.FRAME_RATE,F.frameRate)),V){let H=V.videoSend.find(ie=>ie.ssrc===C);if(H){let ie=id*Ap;H.timestamp&&P.timestamp&&(ie=P.timestamp-H.timestamp),H.packets!=null&&P.packets!=null&&Et(k,Rp.PACKAGE_RATE,1e3*(P.packets-H.packets)/ie),P.packetsLost!=null&&H.packetsLost!=null&&Et(k,Rp.PACKAGE_LOST,P.packetsLost-H.packetsLost),H.bytes!=null&&P.bytes!=null&&Et(k,Rp.BITRATE,8*(P.bytes-H.bytes)/ie)}}return k}(S[0].ssrcId,t,i);break;case Te.LocalAudioTrack:l=o?void 0:function(C,b,V,P){let k=b.audioSend.find(ae=>ae.ssrc===C);if(!k)return;let F={};F[Tu.DISABLED]=P._originMediaStreamTrack&&!P._originMediaStreamTrack.enabled||P._mediaStreamTrack&&!P._mediaStreamTrack.enabled?1:0;let H=100*P._source.getAccurateVolumeLevel(),ie=k.inputLevel;if(ie!=null){let ae=Math.ceil(50*Math.log10(100*ie+1));Et(F,Tu.LEVEL,ae)}Et(F,CF.PCM_LEVEL,H),Et(F,Tu.AEC_RETURN_LOSS,k.aecReturnLoss),Et(F,Tu.AEC_RETURN_LOSS_ENH,k.aecReturnLossEnhancement),F[Tu.FREEZE]=0;let oe=V&&V.audioSend.find(ae=>ae.ssrc===C);if(oe){let ae=id*Ap;oe.timestamp&&k.timestamp&&(ae=k.timestamp-oe.timestamp),oe.bytes!=null&&k.bytes!=null&&Et(F,Tu.BITRATE,8*(k.bytes-oe.bytes)/ae),oe.packets!=null&&k.packets!=null&&Et(F,Tu.PACKAGE_RATE,1e3*(k.packets-oe.packets)/ae)}return F}(S[0].ssrcId,t,i,v)}}),{high:u,low:f,audio:l}}getInboundStats(t,i,o){if(!this.requestRemoteMedia)return;let a=this.requestRemoteMedia()||[],l=[];return a.forEach(u=>{let[f,m]=u,_={peer:f.uid};if(m.has(He.VIDEO)&&f.videoTrack){let v=f._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(f._videoSSRC)||!1,S=f.videoTrack?function(C,b,V,P,k,F,H){var ie;let oe=b.videoRecv.find(It=>It.ssrc===C);if(!oe)return;let ae={},{receivedFrame:he,outputFrame:Ee,decodeFrameRate:ye}=oe,Ce=V&&V.videoRecv.find(It=>It.ssrc===C);if(ae[vr.FREEZE]=k&&SE.isRemoteVideoFreeze(P,oe,Ce)?1:0,Et(ae,Ip.FRAME_RATE_DECODE,ye),Et(ae,vr.QP_SUM,oe.qpSumPerFrame),oe.framesRateFirefox&&Et(ae,vr.FRAME_RATE,oe.framesRateFirefox),he&&Et(ae,vr.FRAME_RATE,he.frameRate),Ce){let It=b.timestamp-V.timestamp||(H?id:Ap*id);oe.packetsLost!=null&&Ce.packetsLost!=null&&Et(ae,vr.PACKAGE_LOST,oe.packetsLost-Ce.packetsLost),Ce.bytes!=null&&oe.bytes!=null&&Et(ae,vr.BITRATE,8*(oe.bytes-Ce.bytes)/It),Ce.packets!=null&&oe.packets!=null&&Et(ae,vr.PACKAGE_RATE,1e3*(oe.packets-Ce.packets)/It)}if(H)return ae;he?(Et(ae,vr.HEIGHT,he.height),Et(ae,vr.WIDTH,he.width)):P&&(Et(ae,vr.HEIGHT,P._videoHeight||0),Et(ae,vr.WIDTH,P._videoWidth||0)),Ee&&Et(ae,Ip.FRAME_RATE_OUTPUT,Ee.frameRate);let ze=(ie=P._player)===null||ie===void 0?void 0:ie.rendFrameRate.toFixed(0);if(ze&&Et(ae,Ip.FRAME_RATE_RENDER,+ze),Et(ae,vr.JITTER_BUFFER,oe.jitterBufferMs),Et(ae,vr.CURRENT_DELAY,oe.currentDelayMs),Et(ae,vr.FIRS,oe.firsCount),Et(ae,vr.NACKS,oe.nacksCount),Et(ae,vr.PLIS,oe.plisCount),P){ae[vr.DISABLED]=P._originMediaStreamTrack.enabled&&P._mediaStreamTrack.enabled?0:1;let It=P._player;if(It){let{freezeTimeCounterList:Kt,renderFreezeAccTime:_i,videoElementStatus:sn}=It;if(Kt&&Kt.length>0&&Et(ae,Ip.FREEZE_TIME,Kt.splice(0,1)[0]),F&&td.visibility==="visible"&&sn===Or.PLAYING&&xt().supportRequestVideoFrameCallback){let Li=Math.min(6e3,_i);It.renderFreezeAccTime=Math.max(0,_i-Li),Et(ae,Ip.FREEZE_TIME_RENDER,Li)}if(typeof oe.totalFreezesDuration=="number"){let Li=Ce&&Ce.totalFreezesDuration?oe.totalFreezesDuration-Ce.totalFreezesDuration:oe.totalFreezesDuration;Et(ae,Ip.FREEZE_DURATION,1e3*Li)}}}if(ae[vr.PLAYER_STATUS]=SI[P._player?P._player.videoElementStatus:"uninit"],Ce&&oe.totalInterFrameDelay!==void 0&&oe.totalSquaredInterFrameDelay!==void 0&&Ce.totalInterFrameDelay!==void 0&&Ce.totalSquaredInterFrameDelay!==void 0){let It=oe.totalInterFrameDelay-Ce.totalInterFrameDelay,Kt=oe.totalSquaredInterFrameDelay-Ce.totalSquaredInterFrameDelay,_i=oe.framesDecodeCount-Ce.framesDecodeCount,sn=It/_i*1e3,Li=Math.round(1e3*Math.sqrt((Kt-Math.pow(It,2)/_i)/_i));!isNaN(Li)&&sn+Li>Math.max(3*sn,sn+150)&&(ae[vr.I_FRAME_DELAY]=Li)}return ae}(f._videoSSRC,t,i,f.videoTrack,v===!0,this.needUploadRenderFreezeTime,o):void 0;S&&(_.video=S)}if(m.has(He.AUDIO)&&f.audioTrack){let v=f.audioTrack?function(S,C,b,V,P){let k=C.audioRecv.find(Ce=>Ce.ssrc===S);if(!k)return;let F={},H=b&&b.audioRecv.find(Ce=>Ce.ssrc===S),{receivedFrames:ie,droppedFrames:oe}=k;var ae,he;if(Et(F,Ra.JITTER,k.jitterMs),ie!=null&&oe!=null&&(F[Ra.FREEZE]=(he=oe,(ae=ie)===0||100*he/ae>20?1:0)),H){let Ce=C.timestamp-b.timestamp||(P?id:id*Ap);k.packets!=null&&H.packets!=null&&Et(F,Ra.PACKAGE_RATE,1e3*(k.packets-H.packets)/Ce),H.bytes!=null&&k.bytes!=null&&Et(F,Ra.BITRATE,8*(k.bytes-H.bytes)/Ce),k.packetsLost!=null&&H.packetsLost!=null&&Et(F,Ra.PACKAGE_LOST,k.packetsLost-H.packetsLost)}if(P)return F;let Ee=100*V._source.getAccurateVolumeLevel(),ye=k.outputLevel;if(ye!=null){let Ce=Math.ceil(50*Math.log10(100*ye+1));Et(F,bF.LEVEL,Ce)}if(Et(F,Ra.PCM_LEVEL,Ee),V&&(F[Ra.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1),Et(F,Ra.JITTER_BUFFER,k.jitterBufferMs),Et(F,Ra.CURRENT_DELAY,k.jitterBufferMs),F[Ra.PLAYER_STATUS]=SI[to.getPlayerState(V.getTrackId())],H){let Ce=k.concealedSamples-H.concealedSamples;Ce>0&&Et(F,Ra.CONCEALED_SAMPLES,Ce)}return F}(f._audioSSRC,t,i,f.audioTrack,o):void 0;v&&(_.audio=v)}(_.video||_.audio)&&l.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(i=>i instanceof W0);if(t&&t._external.getDenoiserStats){let i=t._external.getDenoiserStats();i&&this.requestUpload(dp.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[i,o]=t;o.has(He.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)}),o.has(He.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(a=>{this.requestUpload&&this.requestUpload(a.type,a.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let i=Date.now(),o={connectionInterval:$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i},a=[],l=this.requestAllTracks&&this.requestAllTracks()||[];for(let _ of l)!_.muted&&_.enabled&&(a=a.concat(await _.getProcessorUsage()));let u=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[_,v]of u)v.has(He.VIDEO)&&_.videoTrack&&(a=a.concat(await _.videoTrack.getProcessorUsage())),v.has(He.AUDIO)&&_.audioTrack&&(a=a.concat(await _.audioTrack.getProcessorUsage()));if(a.length===0)return;o.details=function(_,v){let S={};for(let{id:P,value:k,level:F,direction:H}of _){var C;let ie=(C=v.get(P))!==null&&C!==void 0?C:0,oe=k===2?ie+$("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ie;var b,V;v.set(P,oe),S[P]?(k===2&&(S[P].value=k),F>S[P].level&&(S[P].level=F),H==="remote"&&(S[P].remoteUidCount+=1),S[P].totalTs=(b=v.get(P))!==null&&b!==void 0?b:0):S[P]={value:k,level:F,remoteUidCount:H==="local"?0:1,totalTs:(V=v.get(P))!==null&&V!==void 0?V:0}}return Object.keys(S).map(P=>{let{level:k,value:F,totalTs:H}=S[P];return{id:P,level:k,value:F,totalTs:H}})}(a,t);let f=Date.now(),m=f>i?f:i+1;this.requestUpload&&this.requestUpload(dp.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:m})},$("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class wu{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,i){U(this,"uid",void 0),U(this,"_uintid",void 0),U(this,"_trust_in_room_",!0),U(this,"_trust_audio_enabled_state_",!0),U(this,"_trust_video_enabled_state_",!0),U(this,"_trust_audio_mute_state_",!0),U(this,"_trust_video_mute_state_",!0),U(this,"_audio_muted_",!1),U(this,"_video_muted_",!1),U(this,"_audio_enabled_",!0),U(this,"_video_enabled_",!0),U(this,"_audio_added_",!1),U(this,"_video_added_",!1),U(this,"_is_pre_created",!1),U(this,"_video_pre_subscribed",!1),U(this,"_audio_pre_subscribed",!1),U(this,"_trust_video_stream_added_state_",!0),U(this,"_trust_audio_stream_added_state_",!0),U(this,"_audioTrack",void 0),U(this,"_videoTrack",void 0),U(this,"_dataChannels",[]),U(this,"_audioSSRC",void 0),U(this,"_videoSSRC",void 0),U(this,"_audioOrtc",void 0),U(this,"_videoOrtc",void 0),U(this,"_cname",void 0),U(this,"_rtxSsrcId",void 0),U(this,"_videoMid",void 0),U(this,"_audioMid",void 0),this.uid=t,this._uintid=i}}let fc=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function Aie(e,t){var i;let o;switch(t){case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoTrack:o=ke(i=e._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalVideoLowTrack:o=Xt.Low}return o}function zI(e){let t=xt();if(e.some(i=>i._bypassWebAudio))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function HI(e,t){zI(e);let i=new Sn;return e.forEach(o=>i.addAudioTrack(o)),i}var OF,PF,NF,xF,DF,kF,LF,MF,UF,jF,VF,Pi;function FF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Z0(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?FF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Wo=(OF=mc(fc.SEND_ONLY),PF=mc(fc.SEND_ONLY),NF=mc(),xF=mc(fc.RECEIVE_ONLY),DF=mc(fc.RECEIVE_ONLY),kF=mc(fc.RECEIVE_ONLY),LF=mc(fc.RECEIVE_ONLY),MF=mc(fc.RECEIVE_ONLY),UF=mc(fc.RECEIVE_ONLY),jF=mc(),VF=mc(fc.RECEIVE_ONLY),Pi=class extends Ii{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(et.StateChange,t,this._state)}constructor(e,t){super(),U(this,"store",void 0),U(this,"statsUploader",void 0),U(this,"sendConnection",void 0),U(this,"recvConnection",void 0),U(this,"localTrackMap",new Map),U(this,"remoteUserMap",new Map),U(this,"localDataChannels",[]),U(this,"pendingLocalTracks",[]),U(this,"pendingRemoteTracks",[]),U(this,"statsCollector",void 0),U(this,"dtlsFailedCount",0),U(this,"sendMutex",new jn("P2PChannel2-send-mutex")),U(this,"recvMutex",new jn("P2PChannel2-recv-mutex")),U(this,"_state",ei.Disconnected),U(this,"_restartStates",["disconnected","failed"]),U(this,"reconnectInterval",void 0),U(this,"uploadUnplinkStarted",!1),U(this,"uploadDownlinkStarted",!1),U(this,"uplinkStateUploadInterval",void 0),U(this,"downlinkStatsUploadInterval",void 0),U(this,"handleMuteLocalTrack",async(i,o,a)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ei.Connected)return void a(new fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let m=this.filterTobeMutedTracks(i);if(m.length===0)return void o();let _=m.find(b=>b[0]==="videoLowTrack");_&&_[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(m.map(b=>{let[,{id:V}]=b;return V}));let v=!1;var u,f;i.trackMediaType==="video"?v=!((u=this.localTrackMap.get(Te.LocalAudioTrack))===null||u===void 0||!u.track._muted):v=((f=this.localTrackMap.get(Te.LocalVideoTrack))===null||f===void 0?void 0:f.id)===void 0;let S=this.createMuteMessage(m);await li(this,et.RequestMuteLocal,S);let C=i.trackMediaType==="video"?uu.MUTE_LOCAL_VIDEO:uu.MUTE_LOCAL_AUDIO;await li(this,et.RequestP2PMuteLocal,{action:C,message:S,isMuteAll:v}),o()}catch(m){a(m)}finally{l()}}),U(this,"handleUnmuteLocalTrack",async(i,o,a)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ei.Connected)return void a(new fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void o();await this.sendConnection.unmuteLocal(u.map(_=>{let[,{id:v}]=_;return v}));let f=this.createUnmuteMessage(u),m=i.trackMediaType==="video"?uu.UNMUTE_LOCAL_VIDEO:uu.UNMUTE_LOCAL_AUDIO;await li(this,et.RequestP2PMuteLocal,{action:m,message:f}),o()}catch(u){a(u)}finally{l()}}),U(this,"handleUpdateVideoEncoder",async(i,o,a)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let u=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==ei.Connected)return void o();let{id:f,track:m}=u;f&&(await this.sendConnection.updateSendParameters(f,m),await this.sendConnection.updateEncoderConfig(f,m),this.emit(et.UpdateVideoEncoder,m)),o()}catch(u){a(u)}finally{l()}}),U(this,"handleUpdateVideoSendParameters",async(i,o,a)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let u=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==i||this.state!==ei.Connected)return void o();let{id:f,track:m}=u;f&&await this.sendConnection.updateSendParameters(f,m),o()}catch(u){a(u)}finally{l()}}),U(this,"handleReplaceTrack",async(i,o,a,l)=>{let u;I.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var f;let _=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:S}]=v;return i===S});if(!this.sendConnection||!_||_[1].id===void 0||this.state!==ei.Connected)return void o();if(await((f=this.sendConnection)===null||f===void 0?void 0:f.replaceTrack(i,_[1].id)),_[0]===Te.LocalVideoTrack&&xt().supportDualStreamEncoding){let v=this.localTrackMap.get(Te.LocalVideoLowTrack);if(v){let S=i._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S,await new De((C,b)=>{this.handleReplaceTrack(v.track,C,b,!0)})}}o()}catch(_){a(_)}finally{var m;(m=u)===null||m===void 0||m()}}),U(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),U(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),U(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),U(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new AF(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},$("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e,t,i,o,a,l){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let i;try{if(t){this.recvConnection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new wF(e,this.store,Vr.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let o=await this.recvConnection.establish(t);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=ei.New,this.sendConnection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new wF(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ei.Connected}async addRemoteCandidate(e,t){if(t===Vr.RECEIVE_ONLY){if(!this.sendConnection)throw new fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,i){var o=this;return Bo(function*(){let a=yield mt(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==ei.Connected){o.throwIfTrackTypeNotMatch(e);let _=e.filter(v=>o.pendingLocalTracks.indexOf(v)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(_))}o.store.pubId=o.store.pubId+1,pr.markPublishStart(o.store.clientId,o.store.pubId);let l=o.filterTobePublishedTracks(e,t,i);if(l.length===0)return void(yield mt(o.tryToUnmuteAudio(e)));l.forEach(_=>{let{track:v,type:S}=_,C=Date.now();o.store.publish(v.getTrackId(),S===Te.LocalAudioTrack?"audio":"video",C)}),o.bindLocalTrackEvents(l);let u=yield mt(o.sendConnection.send(l.map(_=>{let{track:v}=_;return v}),o.store.codec,o.store.audioCodec)),f=(yield mt(u.next())).value,m=o.createGatewayPublishMessage(l,f);try{yield m}catch(_){throw u.throw(_),(_==null?void 0:_.code)===W.WS_ABORT&&l.forEach(v=>{let{track:S}=v;o.pendingLocalTracks.indexOf(S)===-1&&o.pendingLocalTracks.push(S)}),o.unbindLocalTrackEvents(l),_}yield mt(u.next()),l.forEach(_=>{let{type:v}=_;o.statsCollector.addLocalStats(v)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(l,f),l.forEach(_=>{let{track:v,type:S}=_,C=Date.now();o.store.publish(v.getTrackId(),S===Te.LocalAudioTrack?"audio":"video",void 0,C)}),o.startUploadUplinkState()}finally{a()}})()}async unpublish(e){if(!this.sendConnection||this.state!==ei.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(a=>!ke(e).call(e,a)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(a=>a[0]==="videoLowTrack");i&&i[1].track.close();let o=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(a=>{let[,{id:l}]=a;return l})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(a=>{let[l,{track:u}]=a;return{type:l,track:u}})),t.forEach(a=>{let[l]=a;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ei.Connected)return i&&i[1].track.close(),o;e.forEach(a=>{let l=this.pendingLocalTracks.indexOf(a);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[a,{track:l,ssrcs:u}]=o,f={stream_type:Aie(l,a),ssrcs:u};l._muted||!l._enabled?t.push(f):i.push(f)}),t.length>0&&t.forEach(o=>{li(this,et.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{li(this,et.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Bo(function*(){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await dn(this,et.RequestRePublish,this.pendingLocalTracks),this.emit(et.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,i,o){var a;if(!this.recvConnection)throw new fe(W.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let{track:l,mid:u,transceiver:f}=await this.recvConnection.receive(t,[{ssrcId:i}],String(e.uid),o);t===He.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new Um(l,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),f&&e._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new Mm(l,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),f&&e._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(e,e._videoTrack));let m=this.remoteUserMap.get(e);m?m.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let _=this.pendingRemoteTracks.findIndex(v=>{let{user:S,kind:C}=v;return S.uid===e.uid&&t===C});_!==-1&&(this.pendingRemoteTracks.splice(_,1),this.emit(et.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,i,o){if(!this.recvConnection)throw new fe(W.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,t,i){let o=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:f}=l;return t!==void 0?u.uid===e.uid&&t===f:u.uid===e.uid});if(o.forEach(l=>{let u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.recvConnection||i||o.forEach(l=>{let{kind:u}=l;var f;if(u===He.AUDIO)(f=e._audioTrack)===null||f===void 0||f._destroy(),e._audioTrack=void 0;else if(u===He.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let a=this.filterTobeUnSubscribedTracks(e,t);a.length!==0&&(await this.recvConnection.stopReceiving(a.map(l=>{let[,{id:u}]=l;return u})),this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),a.forEach(l=>{let[u,{kind:f}]=l;var m,_;if(f===He.VIDEO&&u._videoSSRC&&((m=this.recvConnection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),f===He.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),i||((_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0);else if(f===He.AUDIO){var v;this.unbindRemoteTrackEvents(u._audioTrack),!i&&((v=u._audioTrack)===null||v===void 0||v._destroy(),u._audioTrack=void 0)}}),a.forEach(l=>{let[,{kind:u}]=l;li(this,et.RequestP2PMuteRemote,u)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,i]=t;[He.VIDEO,He.AUDIO].forEach(o=>{i.has(o)?li(this,et.RequestP2PUnmuteRemote,o):li(this,et.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new fe(W.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let o=t===He.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void I.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||I.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Te.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Sn){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return a!==Te.LocalAudioTrack}).filter(o=>{let[a]=o;return!(e&&a===Te.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Te.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,t,i,o,a){if(e){let u=this.localTrackMap.get(Te.LocalAudioTrack),f=o?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);Ge.publish(this.store.sessionId,{eventElapse:pr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(gi.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;i||(i=[]);let u=i.find(m=>m instanceof Bi),f=o?(l=this.localTrackMap.get(Te.LocalVideoTrack))===null||l===void 0?void 0:l.track:i.find(m=>m instanceof ui);Ge.publish(this.store.sessionId,{eventElapse:pr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(gi.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,o){let a=o===He.VIDEO?i._videoSSRC:i._audioSSRC;a&&Ge.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===He.VIDEO,audio:o===He.AUDIO,peerid:i.uid,subscribeRequestid:o===He.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:pr.measureFromSubscribeStart(this.store.clientId,a)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new jn("P2PChannel2-send-mutex"),this.sendMutex=new jn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Te.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Sn){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ei.Disconnected}getStats(e){var t,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof ui||t&&t.track instanceof Bi?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(ss(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=v_(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ei.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:o}]=e;switch(i){case Te.LocalVideoTrack:ke(t=o._hints).call(t,gi.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Te.LocalAudioTrack:o instanceof Sn?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Te.LocalVideoLowTrack:}}),this.emit(et.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(ss(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(et.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:o,kind:a}=i;if((e instanceof wu?e.uid:e)===o.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let i,o;if(e===Vr.SEND_ONLY){if(!this.sendConnection)throw new fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new fe(W.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(t){let a=await o.restartICE(t);return o.isInRestartIce=!1,a}{let a=await o.restartICE();if(a){let l=await dn(this,et.RequestP2PRestartICE,{direction:Vr.RECEIVE_ONLY,iceParameter:a});await o.restartICE(l),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalAudioTrack),o=e.videoSend.find(b=>{var V;return b.ssrc===(t==null||(V=t.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)}),a=e.audioSend.find(b=>{var V;return b.ssrc===(i==null||(V=i.ssrcs)===null||V===void 0?void 0:V[0].ssrcId)});if(!o||!a)return 1;let l=Vo(this,et.NeedSignalRTT),u=o?o.rttMs:void 0,f=a?a.rttMs:void 0,m=u&&f?(u+f)/2:u||f,_=(m&&l?(m+l)/2:m||l)||0,v=100*e.sendPacketLossRate*.7/50+.3*_/1500,S=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,C=t==null?void 0:t.track;if(C&&C._encoderConfig&&C._hints.indexOf(gi.SCREEN_TRACK)===-1){let b=C._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(b&&V){let P=(1e3*b-V)/(1e3*b);return qM[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i,a=o._audioSSRC,l=o._videoSSRC,u=e.audioRecv.find(V=>V.ssrc===a),f=e.videoRecv.find(V=>V.ssrc===l);if(!u&&!f)return void(t+=1);let m=Vo(this,et.NeedSignalRTT),_=e.rtt,v=(_&&m?(_+m)/2:_||m)||0,S=u?u.jitterMs:void 0,C=e.recvPacketLossRate,b=.7*C*100/50+.3*v/1500;S&&(b=.6*C*100/50+.2*v/1500+.2*S/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new De((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}filterTobePublishedTracks(e,t,i){let o=[],a=xt(),l=this.getAllTracks();e=sm(e=e.filter(m=>l.indexOf(m)===-1));let u=!1,f=!1;for(let m of e){if(m instanceof ui&&(this.localTrackMap.has(Te.LocalVideoTrack)||u?new fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:m,type:Te.LocalVideoTrack}),u=!0),t)){let _=this.getLowVideoTrack(m,i);o.push({track:_,type:Te.LocalVideoLowTrack})}if(m instanceof Bi){let _=this.localTrackMap.get(Te.LocalAudioTrack);if(_){if(!(_.track instanceof Sn))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0)}else if(f){let v=o.find(S=>{let{type:C}=S;return C===Te.LocalAudioTrack});if(!(v.track instanceof Sn))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(m._bypassWebAudio)throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");v.track.addAudioTrack(m)}else{if(!a.webAudioMediaStreamDest||m instanceof Sn||m._bypassWebAudio)o.push({track:m,type:Te.LocalAudioTrack});else{let v=new Sn;v.addAudioTrack(m),o.push({track:v,type:Te.LocalAudioTrack})}f=!0}}}return o}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=sm(e=e.filter(o=>i.indexOf(o)!==-1));for(let o of e){if(o instanceof Bi){let a=this.localTrackMap.get(Te.LocalAudioTrack);if(!a)continue;a.track instanceof Sn?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),a.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,a]),a.track.close())):t.push([Te.LocalAudioTrack,a])}if(o instanceof ui){let a=this.localTrackMap.get(Te.LocalVideoTrack);if(!a)continue;t.push([Te.LocalVideoTrack,a]);let l=this.localTrackMap.get(Te.LocalVideoLowTrack);l&&t.push([Te.LocalVideoLowTrack,l])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:o}=t;switch(o){case Te.LocalVideoTrack:i.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Sn?e.trackList.forEach(i=>{i.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:o}]=t;return{track:o,type:i}})),e.forEach(t=>{let{track:i,type:o}=t;switch(o){case Te.LocalVideoTrack:i.off(Ve.GET_STATS,this.handleGetLocalVideoStats),i.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Sn?e.trackList.forEach(t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Mm&&t.addListener(Ve.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof Um&&t.addListener(Ve.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(He.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(He.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,o)=>{var a;let l,{track:u,type:f}=i;switch(f){case Te.LocalAudioTrack:l=Xt.Audio;break;case Te.LocalVideoTrack:l=ke(a=u._hints).call(a,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalVideoLowTrack:l=Xt.Low}return{kind:f===Te.LocalAudioTrack?He.AUDIO:He.VIDEO,stream_type:l,mid:t[o].id,ssrcs:t[o].localSSRC,isMuted:u.muted||!u.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:f}]=t;switch(a){case Te.LocalVideoTrack:o=ke(i=l._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoLowTrack:o=Xt.Low}return{stream_type:o,ssrcs:u,mid:f}})}assignLocalTracks(e,t){e.forEach((i,o)=>{let{track:a,type:l}=i;this.localTrackMap.set(l,{track:a,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var i;I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(et.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),ke(i=this._restartStates).call(i,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Nn(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ge.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Ui.TRACER}).onSuccess(),this.emit(et.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let o=Array.from(ss(i=this.remoteUserMap).call(i)).find(l=>l._audioSSRC===t);var a;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(a=o.audioTrack)===null||a===void 0||a.emit(xm.FIRST_FRAME_DECODED),Ge.firstRemoteFrame(this.store.sessionId,Vn.FIRST_AUDIO_DECODE,Di.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let o=Array.from(ss(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);o&&Ge.firstRemoteFrame(this.store.sessionId,Vn.FIRST_AUDIO_RECEIVED,Di.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,o)=>{this.reportVideoFirstFrameDecoded(t,i,o)},e.onFirstVideoReceived=t=>{var i;let o=Array.from(ss(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);o&&Ge.firstRemoteFrame(this.store.sessionId,Vn.FIRST_VIDEO_RECEIVED,Di.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let o=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&o===a||this.emit(et.ConnectionTypeChange,o),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(pu(i))," -> ").concat(JSON.stringify(pu(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(pu(i))," -> ").concat(JSON.stringify(pu(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(et.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Vr.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,I.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Vr.SEND_ONLY?this.restartICE(e):dn(this,et.RequestP2PRestartICE,{direction:Vr.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Bi&&(i==null?void 0:i.track)instanceof Sn)return i.track.isActive||t.push([Te.LocalAudioTrack,i]),t;let o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o&&(t.push(o),o[0]===Te.LocalVideoTrack)){let a=this.localTrackMap.get(Te.LocalVideoLowTrack);a&&t.push([Te.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Bi&&(i==null?void 0:i.track)instanceof Sn)return i.track.isActive&&t.push([Te.LocalAudioTrack,i]),t;let o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o)if(o[0]===Te.LocalVideoTrack){t.push(o);let a=this.localTrackMap.get(Te.LocalVideoLowTrack);a&&t.push([Te.LocalVideoLowTrack,a])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:f}]=t;switch(a){case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoTrack:o=ke(i=l._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalVideoLowTrack:o=Xt.Low}return{stream_type:o,ssrcs:u,mid:f}})}createUnmuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:f}]=t;switch(a){case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoTrack:o=ke(i=l._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalVideoLowTrack:o=Xt.Low}return{stream_type:o,ssrcs:u,mid:f}})}filterTobeUnSubscribedTracks(e,t){let i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(t){let a=o.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(o.entries()).forEach(a=>{let[l,u]=a;i.push([e,{kind:l,id:u}])});return i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[o,{kind:a,id:l}]=i;switch(a){case He.VIDEO:return void(o._videoSSRC&&t.push({stream_type:He.VIDEO,ssrcId:o._videoSSRC}));case He.AUDIO:return void(o._audioSSRC&&t.push({stream_type:He.AUDIO,ssrcId:o._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:o}]=t,a=this.remoteUserMap.get(i);a&&(a.delete(o),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Bi){let i=this.filterTobeUnmutedTracks(e[t]);if(i.length===0)continue;let o=this.createUnmuteMessage(i);return void await li(this,et.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(et.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(et.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Nn(t0(this.dtlsFailedCount,nn)),this.emit(et.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ui)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof ui).length>1)throw new fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Bi).length>1&&(e.some(t=>t instanceof Bi&&t._bypassWebAudio)||!xt().webAudioMediaStreamDest))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof ui&&this.pendingLocalTracks.some(i=>i instanceof ui))throw new fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Bi&&this.pendingLocalTracks.some(i=>i instanceof Bi)&&(!xt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Bi&&i._bypassWebAudio)))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&xt().supportDualStreamEncoding,o=Z0(Z0({},{width:160,height:120,framerate:15,bitrate:50}),t),a;a=i?e._mediaStreamTrack.clone():WI(e,o);let l=di(8,"track-low-"),u=new ui(a,Z0(Z0({},i&&{scaleResolutionDownBy:ER(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return u.on(Sp.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,Pm.LOW_STREAM)}),u._hints.push(gi.LOW_STREAM),e.addListener(Ve.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,i,o){var a;let l=Array.from(ss(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===e);if(l){o||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());let u=this.store.keyMetrics,f=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Ge.firstRemoteVideoDecode(this.store.sessionId,Vn.FIRST_VIDEO_DECODE,Di.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:i,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.recvConnection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let a=o.get(t);if(!a)return!1;let l=await this.recvConnection.getRemoteSSRC(a);return l!==void 0&&l!==i}resetConnection(e){I.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(e)),this.state===ei.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(e){throw new fe(W.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new fe(W.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new fe(W.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new fe(W.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new fe(W.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new fe(W.NOT_SUPPORTED)}async preConnect(e,t,i,o,a,l){throw new fe(W.NOT_SUPPORTED)}getEstablishParams(){throw new fe(W.NOT_SUPPORTED)}async reSubscribe(e){throw new fe(W.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new fe(W.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===Te.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Pm.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Ne(Pi.prototype,"p2pConnect",[OF],Object.getOwnPropertyDescriptor(Pi.prototype,"p2pConnect"),Pi.prototype),Ne(Pi.prototype,"unpublish",[PF],Object.getOwnPropertyDescriptor(Pi.prototype,"unpublish"),Pi.prototype),Ne(Pi.prototype,"unpublishLowStream",[NF],Object.getOwnPropertyDescriptor(Pi.prototype,"unpublishLowStream"),Pi.prototype),Ne(Pi.prototype,"subscribe",[xF],Object.getOwnPropertyDescriptor(Pi.prototype,"subscribe"),Pi.prototype),Ne(Pi.prototype,"mockSubscribe",[DF],Object.getOwnPropertyDescriptor(Pi.prototype,"mockSubscribe"),Pi.prototype),Ne(Pi.prototype,"unsubscribe",[kF],Object.getOwnPropertyDescriptor(Pi.prototype,"unsubscribe"),Pi.prototype),Ne(Pi.prototype,"muteRemote",[LF],Object.getOwnPropertyDescriptor(Pi.prototype,"muteRemote"),Pi.prototype),Ne(Pi.prototype,"unmuteRemote",[MF],Object.getOwnPropertyDescriptor(Pi.prototype,"unmuteRemote"),Pi.prototype),Ne(Pi.prototype,"hasRemoteMediaWithLock",[UF],Object.getOwnPropertyDescriptor(Pi.prototype,"hasRemoteMediaWithLock"),Pi.prototype),Ne(Pi.prototype,"disconnectForReconnect",[jF],Object.getOwnPropertyDescriptor(Pi.prototype,"disconnectForReconnect"),Pi.prototype),Ne(Pi.prototype,"remoteMediaSsrcChanged",[VF],Object.getOwnPropertyDescriptor(Pi.prototype,"remoteMediaSsrcChanged"),Pi.prototype),Pi);function mc(e){return function(t,i,o){let a=t[i];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];switch(e){case fc.SEND_ONLY:{let m=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,u)}finally{m()}}case fc.RECEIVE_ONLY:{let m=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,u)}finally{m()}}default:{let m=await this.sendMutex.lock("From P2PChannel2.".concat(i)),_=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await a.apply(this,u)}finally{m(),_()}}}},o}}function BF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Op(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?BF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class SE{constructor(t){U(this,"store",void 0),U(this,"onStatsException",void 0),U(this,"onUploadPublishDuration",void 0),U(this,"onStatsChanged",void 0),U(this,"localStats",new Map),U(this,"remoteStats",new Map),U(this,"updateStatsInterval",void 0),U(this,"trafficStats",void 0),U(this,"trafficStatsPeerList",[]),U(this,"uplinkStats",void 0),U(this,"exceptionMonitor",void 0),U(this,"p2pChannel",void 0),U(this,"scalabilityMode",cQ.L1T1),U(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new die,this.exceptionMonitor.on("exception",(i,o,a)=>{this.onStatsException&&this.onStatsException(i,o,a)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Te.LocalAudioTrack)||Op({},vI)}getLocalVideoTrackStats(){return this.localStats.get(Te.LocalVideoTrack)||Op({},yI)}getRemoteAudioTrackStats(t){let i=(l,u)=>{if(!this.trafficStats)return u;let f=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return f&&(u.publishDuration=f.B_ppad+(Date.now()-this.trafficStats.timestamp)),u},o={};if(t){var a;let l=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.audioStats;l&&(o[t]=i(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{audioStats:f}]=l;f&&(o[u]=i(u,f))});return o}getRemoteNetworkQualityStats(t){let i={};if(t){var o;let a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.networkStats;a&&(i[t]=a)}else Array.from(this.remoteStats.entries()).forEach(a=>{let[l,{networkStats:u}]=a;u&&(i[l]=u)});return i}getRemoteVideoTrackStats(t){let i=(l,u)=>{if(!this.trafficStats)return u;let f=this.trafficStats.peer_delay.find(m=>m.peer_uid===l);return f&&(u.publishDuration=f.B_ppvd+(Date.now()-this.trafficStats.timestamp)),u},o={};if(t){var a;let l=(a=this.remoteStats.get(t))===null||a===void 0?void 0:a.videoStats;l&&(o[t]=i(t,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[u,{videoStats:f}]=l;f&&(o[u]=i(u,f))});return o}getRTCStats(){let t=0,i=0,o=0,a=0,l=this.localStats.get(Te.LocalAudioTrack);l&&(t+=l.sendBytes,i+=l.sendBitrate);let u=this.localStats.get(Te.LocalVideoTrack);u&&(t+=u.sendBytes,i+=u.sendBitrate);let f=this.localStats.get(Te.LocalVideoLowTrack);f&&(t+=f.sendBytes,i+=f.sendBitrate),this.remoteStats.forEach(_=>{let{audioStats:v,videoStats:S}=_;v&&(o+=v.receiveBytes,a+=v.receiveBitrate),S&&(o+=S.receiveBytes,a+=S.receiveBitrate)});let m=1;return this.trafficStats&&(m+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:m,SendBitrate:i,SendBytes:t,RecvBytes:o,RecvBitrate:a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),t.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;let a=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),l=a!=null&&a.videoSSRC?pr.measureFromSubscribeStart(this.store.clientId,a.videoSSRC):0,u=a!=null&&a.audioSSRC?pr.measureFromSubscribeStart(this.store.clientId,a.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,l>u?l:u),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&I.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,i,o){if(!t)return!1;let a=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,l=!o||i.framesDecodeCount>o.framesDecodeCount;return a||!l}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(i=>{let[o,a]=i;switch(o){case Te.LocalVideoTrack:case Te.LocalVideoLowTrack:{let u=a,f=Op({},yI),m=t.getStats(),_=t.getLocalMedia(o);if(m){let v=m.videoSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){let S=t.getLocalVideoSize(),C=t.getEncoderConfig(Te.LocalVideoTrack);v.codec!=="H264"&&v.codec!=="H265"&&v.codec!=="VP8"&&v.codec!=="VP9"&&v.codec!=="AV1X"&&v.codec!=="AV1"||(f.codecType=v.codec),f.sendBytes=v.bytes,f.sendBitrate=u?8*Math.max(0,f.sendBytes-u.sendBytes):0,v.inputFrame?(f.captureFrameRate=v.inputFrame.frameRate,f.captureResolutionHeight=v.inputFrame.height,f.captureResolutionWidth=v.inputFrame.width):S&&(f.captureResolutionWidth=S.width,f.captureResolutionHeight=S.height),v.sentFrame?(f.sendFrameRate=v.sentFrame.frameRate,f.sendResolutionHeight=v.sentFrame.height,f.sendResolutionWidth=v.sentFrame.width):S&&(f.sendResolutionWidth=S.width,f.sendResolutionHeight=S.height),v.avgEncodeMs&&(f.encodeDelay=v.avgEncodeMs),C&&C.bitrateMax&&(f.targetSendBitrate=1e3*C.bitrateMax),f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.totalDuration=u?u.totalDuration+1:1,f.totalFreezeTime=u?u.totalFreezeTime:0,this.isLocalVideoFreeze(v)&&(f.totalFreezeTime+=1),v.scalabilityMode&&this.scalabilityMode!==v.scalabilityMode&&(I.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(v.scalabilityMode)),this.scalabilityMode=v.scalabilityMode)}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(o,f),((u==null?void 0:u.sendResolutionWidth)!==f.sendResolutionWidth||(u==null?void 0:u.sendResolutionHeight)!==f.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:f.sendResolutionWidth,height:f.sendResolutionHeight})),f&&_&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_.track,f);break}case Te.LocalAudioTrack:{let u=a,f=Op({},vI),m=t.getStats(),_=t.getLocalMedia(o);if(m){let v=m.audioSend.find(S=>S.ssrc===(_==null?void 0:_.ssrcs[0].ssrcId));if(v){if(v.codec!=="opus"&&v.codec!=="aac"&&v.codec!=="PCMU"&&v.codec!=="PCMA"&&v.codec!=="G722"||(f.codecType=v.codec),v.inputLevel)f.sendVolumeLevel=Math.round(32767*v.inputLevel);else{let S=t.getLocalAudioVolume();S&&(f.sendVolumeLevel=Math.round(32767*S))}f.sendBytes=v.bytes,f.sendPackets=v.packets,f.sendPacketsLost=v.packetsLost,f.sendJitterMs=v.jitterMs,f.sendRttMs=v.rttMs,f.sendBitrate=u?8*Math.max(0,f.sendBytes-u.sendBytes):0}}this.trafficStats&&(f.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Te.LocalAudioTrack,f),f&&_&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_.track,f);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(i=>{var o,a;let[l,{videoStats:u,audioStats:f,videoPcStats:m}]=i,_=f,v=u,S=m,C=Op({},ej),b=Op({},tj),V=Op({},Zte),{audioTrack:P,videoTrack:k,audioSSRC:F,videoSSRC:H}=t.getRemoteMedia(l),ie;ie=t instanceof Wo?t.getStats(!0):t.getStats();let oe=(o=ie)===null||o===void 0?void 0:o.audioRecv.find(Ee=>Ee.ssrc===F),ae=(a=ie)===null||a===void 0?void 0:a.videoRecv.find(Ee=>Ee.ssrc===H),he=this.trafficStats&&this.trafficStats.peer_delay.find(Ee=>Ee.peer_uid===l);if(oe&&(oe.codec!=="opus"&&oe.codec!=="aac"&&oe.codec!=="PCMU"&&oe.codec!=="PCMA"&&oe.codec!=="G722"||(C.codecType=oe.codec),oe.outputLevel?C.receiveLevel=Math.round(32767*oe.outputLevel):P&&(C.receiveLevel=Math.round(32767*P.getVolumeLevel())),C.receiveBytes=oe.bytes,C.receivePackets=oe.packets,C.receivePacketsLost=oe.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost),C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=_?_.totalFreezeTime:0,C.freezeRate=C.totalFreezeTime/C.totalDuration,C.receiveDelay=oe.jitterBufferMs,C.totalDuration>10&&SE.isRemoteAudioFreeze(P)&&(C.totalFreezeTime+=1)),ae){ae.codec!=="H264"&&ae.codec!=="H265"&&ae.codec!=="VP8"&&ae.codec!=="VP9"&&ae.codec!=="AV1X"&&ae.codec!=="AV1"||(b.codecType=ae.codec),b.receiveBytes=ae.bytes,b.receiveBitrate=v?8*Math.max(0,b.receiveBytes-v.receiveBytes):0,b.decodeFrameRate=ae.decodeFrameRate<0?0:ae.decodeFrameRate,b.renderFrameRate=ae.decodeFrameRate<0?0:ae.decodeFrameRate,ae.outputFrame&&(b.renderFrameRate=ae.outputFrame.frameRate),ae.receivedFrame?(b.receiveFrameRate=ae.receivedFrame.frameRate,b.receiveResolutionHeight=ae.receivedFrame.height,b.receiveResolutionWidth=ae.receivedFrame.width):k&&(b.receiveResolutionHeight=k._videoHeight||0,b.receiveResolutionWidth=k._videoWidth||0),ae.framesRateFirefox!==void 0&&(b.receiveFrameRate=Math.round(ae.framesRateFirefox)),b.receivePackets=ae.packets,b.receivePacketsLost=ae.packetsLost,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.totalDuration=v?v.totalDuration+1:1,b.totalFreezeTime=v?v.totalFreezeTime:0,b.receiveDelay=ae.jitterBufferMs||0;let Ee=!!H&&t.getRemoteVideoIsReady(H);k&&Ee&&SE.isRemoteVideoFreeze(k,ae,S)&&(b.totalFreezeTime+=1),b.freezeRate=b.totalFreezeTime/b.totalDuration}he&&(C.end2EndDelay=he.B_ad,b.end2EndDelay=he.B_vd,C.transportDelay=he.B_ed,b.transportDelay=he.B_ed,C.currentPacketLossRate=he.B_ealr4/100,b.currentPacketLossRate=he.B_evlr4/100,V.uplinkNetworkQuality=he.B_punq?he.B_punq:0,V.downlinkNetworkQuality=he.B_pdnq?he.B_pdnq:0),this.remoteStats.set(l,{audioStats:C,videoStats:b,videoPcStats:ae,networkStats:V}),P&&this.exceptionMonitor.setRemoteAudioStats(P,C),k&&this.exceptionMonitor.setRemoteVideoStats(k,b)})}}function WF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function TE(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?WF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Oie extends Ii{constructor(t,i,o,a){super(),U(this,"spec",void 0),U(this,"token",void 0),U(this,"websocket",void 0),U(this,"pingpongTimer",void 0),U(this,"reconnectMode","retry"),U(this,"serviceMode",void 0),U(this,"reqId",0),U(this,"commandReqId",0),U(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),U(this,"handleWebSocketMessage",l=>{if(!l.data)return;let u=JSON.parse(l.data);u.requestId?this.emit("@".concat(u.requestId,"-").concat(u.sid),u):this.serviceMode===Fn.INJECT?this.emit(Jc.INJECT_STREAM_STATUS,u):(Ge.workerEvent(this.spec.sid,{actionType:"status",serverCode:u.code,workerType:this.serviceMode===Fn.TRANSCODE?1:2}),this.emit(Jc.PUBLISH_STREAM_STATUS,u))}),this.spec=i,this.token=t,this.serviceMode=a,this.websocket=new W_("live-streaming",o),this.websocket.on(rt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(rt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(rt.REQUEST_NEW_URLS,(l,u)=>{dn(this,Jc.REQUEST_NEW_ADDRESS).then(l).catch(u)}),this.websocket.on(rt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,i,o,a){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let l=this.commandReqId,u=this.reqId;if(!u||!this.websocket)throw new se(W.UNEXPECTED_ERROR);let f=TE({command:t,sdkVersion:Ps==="4.21.0"?"0.0.1":Ps,seq:u,requestId:u,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new se(W.WS_DISCONNECT);let m=()=>new De((C,b)=>{this.websocket.once(rt.CLOSED,()=>b(new se(W.WS_ABORT))),this.websocket.once(rt.CONNECTED,C)});this.websocket.state!=="connected"&&await m(),f.clientRequest&&(f.clientRequest.workerToken=this.token);let _=new De((C,b)=>{let V=()=>{b(new se(W.WS_ABORT))};this.websocket.once(rt.RECONNECTING,V),this.websocket.once(rt.CLOSED,V),this.once("@".concat(u,"-").concat(this.spec.sid),P=>{C(P)})});a&&Ge.workerEvent(this.spec.sid,TE(TE({},a),{},{requestId:l,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));let v=Date.now();this.websocket.sendMessage(f);let S=null;try{S=await _}catch(C){if(this.websocket.state==="closed")throw C;return await m(),await this.request(t,i,o)}return a&&Ge.workerEvent(this.spec.sid,TE(TE({},a),{},{requestId:l,actionType:"response",payload:JSON.stringify(S.serverResponse),serverCode:S.code,success:S.code===200,responseTime:Date.now()-v})),S.code!==200&&this.handleResponseError(S),S}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=Ps==="4.21.0"?"0.0.1":Ps;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case yn.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void I.warning("live stream response already exists stream");case yn.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case yn.LIVE_STREAM_RESPONSE_BAD_STREAM:case yn.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new se(W.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case yn.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yn.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new se(W.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case yn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let i=new se(W.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Jc.WARNING,i,t.serverResponse.url)}case yn.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let i=new se(W.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Jc.WARNING,i,t.serverResponse.url)}case yn.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case yn.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new se(W.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case yn.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let i=new se(W.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Jc.WARNING,i,t.serverResponse.url)}case yn.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case yn.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case yn.LIVE_STREAM_RESPONSE_WORKER_LOST:case yn.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yn.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case yn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new se(W.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Qy)},6e3)}}function zF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function io(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Pie extends Ii{constructor(t){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:nn,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:nn;super(),U(this,"onLiveStreamWarning",void 0),U(this,"onLiveStreamError",void 0),U(this,"onInjectStatusChange",void 0),U(this,"spec",void 0),U(this,"retryTimeout",1e4),U(this,"connection",void 0),U(this,"httpRetryConfig",void 0),U(this,"wsRetryConfig",void 0),U(this,"streamingTasks",new Map),U(this,"isStartingStreamingTask",!1),U(this,"taskMutex",new jn("live-streaming")),U(this,"cancelToken",Qr.CancelToken.source()),U(this,"transcodingConfig",void 0),U(this,"injectConfig",io({},uQ)),U(this,"injectLoopTimes",0),U(this,"uapResponse",void 0),U(this,"lastTaskId",1),U(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(t){let i=io(io({},dQ),t);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(I.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(u=>io(io(io({},lQ),u),{},{zOrder:u.zOrder?u.zOrder+1:1}))),function(u){Mi(u.width)||si(u.width,"config.width",0,1e4),Mi(u.height)||si(u.height,"config.height",0,1e4),Mi(u.videoBitrate)||si(u.videoBitrate,"config.videoBitrate",1,1e6),Mi(u.videoFrameRate)||si(u.videoFrameRate,"config.videoFrameRate"),Mi(u.lowLatency)||Gl(u.lowLatency,"config.lowLatency"),Mi(u.audioSampleRate)||Cn(u.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Mi(u.audioBitrate)||si(u.audioBitrate,"config.audioBitrate",1,128),Mi(u.audioChannels)||Cn(u.audioChannels,"config.audioChannels",[1,2,3,4,5]),Mi(u.videoGop)||si(u.videoGop,"config.videoGop"),Mi(u.videoCodecProfile)||Cn(u.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Mi(u.userCount)||si(u.userCount,"config.userCount",0,17),Mi(u.backgroundColor)||si(u.backgroundColor,"config.backgroundColor",0,16777215),Mi(u.userConfigExtraInfo)||Gn(u.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),u.transcodingUsers&&!Mi(u.transcodingUsers)&&(Kl(u.transcodingUsers,"config.transcodingUsers"),u.transcodingUsers.forEach((f,m)=>{a0(f.uid),Mi(f.x)||si(f.x,"transcodingUser[".concat(m,"].x"),0,1e4),Mi(f.y)||si(f.y,"transcodingUser[".concat(m,"].y"),0,1e4),Mi(f.width)||si(f.width,"transcodingUser[".concat(m,"].width"),0,1e4),Mi(f.height)||si(f.height,"transcodingUser[".concat(m,"].height"),0,1e4),Mi(f.zOrder)||si(f.zOrder-1,"transcodingUser[".concat(m,"].zOrder"),0,100),Mi(f.alpha)||si(f.alpha,"transcodingUser[".concat(m,"].alpha"),0,1,!1)})),Mi(u.watermark)||fR(u.watermark,"watermark"),Mi(u.backgroundImage)||fR(u.backgroundImage,"backgroundImage"),u.images&&!Mi(u.images)&&(Kl(u.images,"config.images"),u.images.forEach((f,m)=>{fR(f,"images[".concat(m,"]"))}))}(i);let o=[];i.images&&o.push(...i.images.map(u=>io(io(io({},pR),u),{},{zOrder:255}))),i.backgroundImage&&(o.push(io(io(io({},pR),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(io(io(io({},pR),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(u=>io({},u)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);let a=(i.userConfigs||[]).map(u=>typeof u.uid=="number"?De.resolve(u.uid):I2(u.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await De.all(a)).forEach((u,f)=>{i.userConfigs&&i.userConfigs[f]&&(i.userConfigs[f].uid=u)}),this.transcodingConfig=i,this.connection)try{var l;let u=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(sc(l=this.streamingTasks).call(l)).map(f=>f.taskId).join("#")});I.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(u.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(u){if(!u.data||!u.data.retry)throw u;u.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(f=>{I.warning("[".concat(this.spec.clientId,"] live streaming receive error"),u.toString(),"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,u).then(()=>{I.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(f.url," success"))}).catch(m=>{I.error("[".concat(this.spec.clientId,"] live streaming republish failed"),f.url,m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)})})}}setInjectStreamConfig(t,i){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=i}async startLiveStreamingTask(t,i,o){var a;if(Array.from(sc(a=this.streamingTasks).call(a)).find(m=>m.mode===Fn.INJECT)&&i===Fn.INJECT)return new se(W.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&i===Fn.TRANSCODE)throw new se(W.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let l={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};I.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(i));let u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(t)&&!o)return u(),new se(W.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Fn.TRANSCODE:l.transcodingConfig=io({},this.transcodingConfig);break;case Fn.RAW:break;case Fn.INJECT:l={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(l.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let f=this.lastTaskId++;try{let m=new De((v,S)=>{Nn(this.retryTimeout).then(()=>{if(o)return S(o);let C=this.statusError.get(t);return C?(this.statusError.delete(t),S(C)):void 0})}),_=await De.race([this.connection.request("request",{clientRequest:l},!0,{url:t,command:"PublishStream",workerType:i===Fn.TRANSCODE?1:2,requestByUser:!o,tid:f.toString()}),m]);this.isStartingStreamingTask=!1,I.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(t,{clientRequest:l,mode:i,url:t,taskId:f}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,i,m)):await this.startLiveStreamingTask(t,i,m)}}stopLiveStreamingTask(t){return new De((i,o)=>{let a=this.streamingTasks.get(t);if(!a||!this.connection)return new se(W.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let l=a.mode;a.abortTask=()=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),i()},this.connection.request("request",{clientRequest:{command:l===Fn.INJECT?"UninjectStream":"UnpublishStream",url:a.url}},!1,{url:t,command:"UnPublishStream",workerType:l===Fn.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(u=>{I.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(u.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&l!==Fn.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),i(),l===Fn.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(dm.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(o)})}async controlInjectStream(t,i,o,a){let l=this.streamingTasks.get(t);if(!l||!this.connection||l.mode!==Fn.INJECT)throw new se(W.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:i,audioVolume:o,position:a}})).serverResponse}resetAllTask(){var t;let i=Array.from(sc(t=this.streamingTasks).call(t));this.terminate();for(let o of i)this.startLiveStreamingTask(o.url,o.mode).catch(a=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,a)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Qr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new se(W.UNEXPECTED_ERROR,"live streaming connection has already connected");let i=await dn(this,c0.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=i,this.connection=new Oie(i.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(Jc.WARNING,(o,a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(a,o)),this.connection.on(Jc.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Jc.INJECT_STREAM_STATUS,o=>this.handleInjectStreamServerStatus(o)),this.connection.on(Jc.REQUEST_NEW_ADDRESS,(o,a)=>{if(!this.connection)return a(new se(W.UNEXPECTED_ERROR,"can not get new live streaming address list"));dn(this,c0.REQUEST_WORKER_MANAGER_LIST,t).then(l=>{this.uapResponse=l,o(l.addressList)}).catch(a)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(t){let i=t.serverStatus&&t.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),a=t.reason;switch(t.code){case yn.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case yn.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case yn.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case yn.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let u=new se(W.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(o)return I.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,u);if(!this.isStartingStreamingTask)return;this.statusError.set(i,u)}case yn.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let u=new se(W.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,u)}case yn.LIVE_STREAM_RESPONSE_WORKER_LOST:case yn.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();let u=Array.from(sc(l=this.streamingTasks).call(l));for(let f of u)f.abortTask?f.abortTask():(I.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",f.url),this.startLiveStreamingTask(f.url,f.mode,new se(W.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{I.debug("[".concat(this.spec.clientId,"] republish live stream success"),f.url)}).catch(m=>{I.error(m.toString()),this.onLiveStreamError&&this.onLiveStreamError(f.url,m)}));return}}}handleInjectStreamServerStatus(t){let i=Number(t.uid),o=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(dm.INJECT_STREAM_STATUS_START_SUCCESS,i,o));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(dm.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,i,o),void this.streamingTasks.delete(o);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(dm.INJECT_STREAM_STATUS_START_UNAUTHORIZED,i,o),void this.streamingTasks.delete(o);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(dm.INJECT_STREAM_STATUS_BROKEN,i,o),void this.streamingTasks.delete(o);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(dm.INJECT_STREAM_STATUS_START_TIMEOUT,i,o),void this.streamingTasks.delete(o);default:return void I.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class HF{constructor(){U(this,"destChannelMediaInfos",new Map),U(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){t2(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){t2(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){s0(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function GF(e){if(!(e instanceof HF))return new se(W.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!t)return new se(W.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new se(W.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Nie extends Ii{constructor(t,i,o){super(),U(this,"ws",void 0),U(this,"requestId",1),U(this,"heartBeatTimer",void 0),U(this,"joinInfo",void 0),U(this,"clientId",void 0),U(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),U(this,"onClose",a=>{this.emit("close"),this.dispose()}),U(this,"onMessage",a=>{let l=JSON.parse(a.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=t,this.clientId=i,this.ws=new W_("cross-channel-".concat(this.clientId),o),this.ws.on(rt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(rt.CONNECTED,this.onOpen),this.ws.on(rt.ON_MESSAGE,this.onMessage),this.ws.on(rt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let i=this.requestId++;return t.requestId=i,t.seq=i,this.ws.sendMessage(t),i}waitStatus(t){return new De((i,o)=>{let a=window.setTimeout(()=>{o(new se(W.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,l=>{window.clearTimeout(a),l.state&&l.state!==0?o(new se(W.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(a),o(new se(W.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new se(W.WS_DISCONNECT);let i=()=>new De((u,f)=>{this.ws.once(rt.CLOSED,()=>f(new se(W.WS_ABORT))),this.ws.once(rt.CONNECTED,u)});this.ws.state!=="connected"&&await i();let o=this.sendMessage(t),a=new De((u,f)=>{let m=()=>{f(new se(W.WS_ABORT))};this.ws.once(rt.RECONNECTING,m),this.ws.once(rt.CLOSED,m),this.once("req_".concat(o),u),Nn(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(rt.RECONNECTING,m),this.ws.off(rt.CLOSED,m),f(new se(W.TIMEOUT,"cross channel ws request timeout"))})}),l=await a;if(!l||l.code!==200)throw new se(W.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(t){this.ws.removeAllListeners(rt.REQUEST_NEW_URLS),this.ws.on(rt.REQUEST_NEW_URLS,i=>{i(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let i=this.requestId++;return t.requestId=i,this.ws.sendMessage(t),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class xie extends Ii{set state(t){t!==this._state&&(t!==go.RELAY_STATE_FAILURE&&(this.errorCode=um.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,i,o,a,l){super(),U(this,"joinInfo",void 0),U(this,"sid",void 0),U(this,"clientId",void 0),U(this,"cancelToken",Qr.CancelToken.source()),U(this,"workerToken",void 0),U(this,"requestId",0),U(this,"signal",void 0),U(this,"prevChannelMediaConfig",void 0),U(this,"httpRetryConfig",void 0),U(this,"_resolution",void 0),U(this,"_state",go.RELAY_STATE_IDLE),U(this,"errorCode",um.RELAY_OK),U(this,"onStatus",u=>{I.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(u))),u&&u.command&&(u.command==="onAudioPacketReceived"&&this.emit("event",ql.PACKET_RECEIVED_AUDIO_FROM_SRC),u.command==="onVideoPacketReceived"&&this.emit("event",ql.PACKET_RECEIVED_VIDEO_FROM_SRC),u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=um.SRC_TOKEN_EXPIRED,this.state=go.RELAY_STATE_FAILURE),u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=um.DEST_TOKEN_EXPIRED,this.state=go.RELAY_STATE_FAILURE))}),U(this,"onReconnect",async()=>{I.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ql.NETWORK_DISCONNECTED),this.state=go.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(u=>{this.state!==go.RELAY_STATE_IDLE&&(I.error("auto restart channel media relay failed",u.toString()),this.errorCode=um.SERVER_CONNECTION_LOST,this.state=go.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=i,this.sid=U_(),this.signal=new Nie(this.joinInfo,this.clientId,o),this.httpRetryConfig=a,this._resolution=l}async startChannelMediaRelay(t){if(this.state!==go.RELAY_STATE_IDLE)throw new se(W.INVALID_OPERATION);this.state=go.RELAY_STATE_CONNECTING,await this.connect(),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new se(W.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new se(W.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new se(W.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==go.RELAY_STATE_RUNNING)throw new se(W.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==go.RELAY_STATE_RUNNING)throw new se(W.INVALID_OPERATION);let i=this.genMessage(Fr.SetVideoProfile);await this.signal.request(i),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),I.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=go.RELAY_STATE_IDLE,this.dispose()}dispose(){I.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Qr.CancelToken.source(),this.state=go.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await NQ(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ql.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let i=this.genMessage(Fr.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let o=this.genMessage(Fr.SetSdkProfile,t);await this.signal.request(o),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let a=this.genMessage(Fr.SetSourceChannel,t);await this.signal.request(a),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ql.PACKET_JOINED_SRC_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let l=this.genMessage(Fr.SetSourceUserId,t);await this.signal.request(l),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let u=this.genMessage(Fr.SetDestChannel,t);await this.signal.request(u),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ql.PACKET_JOINED_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let f=this.genMessage(Fr.StartPacketTransfer,t);await this.signal.request(f),this.emit("event",ql.PACKET_SENT_TO_DEST_CHANNEL),this.state=go.RELAY_STATE_RUNNING,I.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let i=this.genMessage(Fr.UpdateDestChannel,t);await this.signal.request(i),this.emit("event",ql.PACKET_UPDATE_DEST_CHANNEL),I.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(Fr.StopPacketTransfer);await this.signal.request(t),I.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,i){let o=[],a=[],l=[];this.requestId+=1;let u={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Ps,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};u.sdkVersion==="4.21.0"&&(u.sdkVersion="0.0.1");let f=null,m=null;switch(t){case Fr.SetSdkProfile:return u.clientRequest={command:"SetSdkProfile",type:"multi_channel"},u;case Fr.SetSourceChannel:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new se(W.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceChannel",uid:"0",channelName:m.channelName,token:m.token||this.joinInfo.appId},u;case Fr.SetSourceUserId:if(m=i&&i.getSrcChannelMediaInfo(),!m)throw new se(W.UNEXPECTED_ERROR,"can not find source config");return u.clientRequest={command:"SetSourceUserId",uid:m.uid+""},u;case Fr.SetDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new se(W.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(_=>{o.push(_.channelName),a.push(_.uid+""),l.push(_.token||this.joinInfo.appId)}),u.clientRequest={command:"SetDestChannel",channelName:o,uid:a,token:l},u;case Fr.StartPacketTransfer:return u.clientRequest={command:"StartPacketTransfer"},u;case Fr.Reconnect:return u.clientRequest={command:"Reconnect"},u;case Fr.StopPacketTransfer:return u.clientRequest={command:"StopPacketTransfer"},u;case Fr.UpdateDestChannel:if(f=i&&i.getDestChannelMediaInfo(),!f)throw new se(W.UNEXPECTED_ERROR,"can not find dest config");return f.forEach(_=>{o.push(_.channelName),a.push(_.uid+""),l.push(_.token||this.joinInfo.appId)}),u.clientRequest={command:"UpdateDestChannel",channelName:o,uid:a,token:l},u;case Fr.SetVideoProfile:u.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return u}}function Q0(e){var t={},i=!1;function o(a,l){return i=!0,{done:!1,value:new NI(l=new xI(function(u){u(e[a](l))}),1)}}return t[Zf!==void 0&&pL||"@@iterator"]=function(){return this},t.next=function(a){return i?(i=!1,a):o("next",a)},typeof e.throw=="function"&&(t.throw=function(a){if(i)throw i=!1,a;return o("throw",a)}),typeof e.return=="function"&&(t.return=function(a){return i?(i=!1,a):o("return",a)}),t}var KF=d(iF);function qF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function YF(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?qF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var hi;function $F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function XF(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?$F(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$F(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Fm=(hi=class $E extends d0{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return ke(i=Object.keys(cm)).call(i,t)}))]}constructor(t,i){super(t,i),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"statsFilter",void 0),U(this,"useRTX",!1),U(this,"localCapabilities",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"establishPromise",void 0),U(this,"mutex",new jn("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection($E.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=q0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=hc(t.sdp),o=yE(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=t,XF(XF({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:t.sdp})}catch(t){throw new fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,i,o,a,l,u){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(m){U(this,"sessionDesc",void 0),U(this,"localCapabilities",void 0),U(this,"rtpCapabilities",void 0),U(this,"candidates",void 0),U(this,"iceParameters",void 0),U(this,"dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),m=mi(m);let{remoteIceParameters:_,remoteDtlsParameters:v,candidates:S,remoteRTPCapabilities:C,remoteSetup:b,localCapabilities:V,sdkCodec:P,cname:k}=m,F=Oi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=C,this.candidates=S,this.iceParameters=_,this.dtlsParameters=v,this.setup=b,this.localCapabilities=V,this.cname=k;for(let H=0;H<F.mediaDescriptions.length;H++){let ie=F.mediaDescriptions[H];if(ie.attributes.iceUfrag=_.iceUfrag,ie.attributes.icePwd=_.icePwd,ie.attributes.fingerprints=v.fingerprints,ie.attributes.candidates=S,ie.attributes.setup=b,ie.media.mediaType==="video"){ie.media.fmts=C.videoCodecs.map(ae=>ae.payloadType.toString(10));let oe=C.videoCodecs.filter(ae=>{var he,Ee;return(he=ae.rtpMap)===null||he===void 0?void 0:ke(Ee=he.encodingName.toLowerCase()).call(Ee,P)});oe.length===0&&(oe=C.videoCodecs),ie.attributes.payloads=oe,ie.attributes.extmaps=C.videoExtensions}ie.media.mediaType==="audio"&&(ie.media.fmts=C.audioCodecs.map(oe=>oe.payloadType.toString(10)),ie.attributes.payloads=C.audioCodecs,ie.attributes.extmaps=C.audioExtensions),F.mediaDescriptions[H]=this.mungMediaDesc(ie)}this.sessionDesc=F,this.currentMidIndex=F.mediaDescriptions.length-1}toString(){return Oi.print(this.sessionDesc)}send(m,_,v){let{ssrcs:S,ssrcGroups:C}=_s(_,this.cname),b=this.sessionDesc.mediaDescriptions.find(k=>m===He.VIDEO?k.media.mediaType==="video":k.media.mediaType==="audio"),V=S[0].attributes.label,P=S[0].attributes.mslabel;return b.attributes.ssrcs=b.attributes.ssrcs.concat(S),b.attributes.ssrcGroups=b.attributes.ssrcGroups.concat(C),{id:V,mslabel:P}}batchSend(m){return m.map(_=>{let{kind:v,ssrcMsg:S}=_;return this.send(v,S,void 0)})}stopSending(m){this.sessionDesc.mediaDescriptions.forEach(_=>{let v=[],S=[],C=[];_.attributes.ssrcs.forEach(b=>{ke(m).call(m,b.attributes.label||"")?C.push(b):v.push(b)}),_.attributes.ssrcGroups.forEach(b=>{var V;ke(V=C.map(P=>P.ssrcId)).call(V,b.ssrcIds[0])||S.push(b)}),_.attributes.ssrcs=v,_.attributes.ssrcGroups=S})}mute(m){let _=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.mute."));_.attributes.direction="inactive"}unmute(m){let _=this.sessionDesc.mediaDescriptions.find(v=>v.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.unmute."));_.attributes.direction="sendonly"}receive(m,_,v){m.forEach((S,C)=>{let b=S._mediaStreamTrack,V=this.sessionDesc.mediaDescriptions.findIndex(k=>k.attributes.mid===b.kind),P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[V],S);this.sessionDesc.mediaDescriptions[V]=P})}stopReceiving(m){}updateCandidates(m){m===Ir.TCP?this.candidates.forEach(_=>{this.candidates.findIndex(v=>v.transport==="tcp"&&v.connectionAddress===_.connectionAddress&&v.port===_.port)===-1&&this.candidates.push(YF(YF({},_),{},{foundation:"tcpcandidate",priority:Number(_.priority)-1+"",transport:"tcp",port:Number(_.port)+90+""}))}):this.candidates=this.candidates.filter(_=>_.transport!=="tcp");for(let _ of this.sessionDesc.mediaDescriptions)_.attributes.candidates=this.candidates}restartICE(m){m=mi(m),this.iceParameters=m,this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.iceUfrag=m.iceUfrag,_.attributes.icePwd=m.icePwd})}predictReceivingMids(m){let _=[];for(let v=0;v<m;v++)_.push((this.currentMidIndex+v+1).toString(10));return _}mungRecvMediaDsec(m,_){let v=mi(m);return yu(v,_),$0(v,_),v}updateRecvMedia(m,_){let v=this.sessionDesc.mediaDescriptions.findIndex(S=>S.attributes.mid===m);if(v!==-1){let S=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[v],_);this.sessionDesc.mediaDescriptions[v]=S}}bumpMid(m){this.currentMidIndex+=m}updateTrackLabel(m,_,v){let S=this.sessionDesc.mediaDescriptions.find(b=>m===He.VIDEO?b.attributes.mid==="video":b.attributes.mid==="audio");if(S){let b=S.attributes.ssrcs.find(V=>V.attributes.label===_);var C;b&&(b.attributes.label=v,(C=b.attributes.msid)===null||C===void 0||C.replace(_,v))}}mungMediaDesc(m){let _=mi(m);return Y0(_),function(v){let S=v.attributes.extmaps.find(C=>C.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");S&&v.attributes.extmaps.splice(v.attributes.extmaps.indexOf(S),1),v.attributes.payloads.forEach(C=>{let b=C.rtcpFeedbacks.findIndex(V=>V.type==="transport-cc");b!==-1&&C.rtcpFeedbacks.splice(b,1)})}(_),_}getSSRC(m){for(let _ of this.sessionDesc.mediaDescriptions)for(let v of _.attributes.ssrcs)if(v.attributes.label===m)return[v]}}({remoteIceParameters:t,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a.send,remoteSetup:l,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:u});let f=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(f){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(f.toString()))}}async updateRemoteRTPCapabilities(t,i){throw new fe(W.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,i){var o=this;return Bo(function*(){let a=yield mt(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=t.map(C=>o.peerConnection.addTrack(C._mediaStreamTrack)),u=yield mt(o.peerConnection.createOffer()),f=Oi.parse(u.sdp),m=t.map(C=>{let b=C._mediaStreamTrack,V=f.mediaDescriptions.find(P=>P.attributes.mid===b.kind);if(!V)throw new Error("Cannot extract ssrc from mediaDescription.");return function(P,k,F){let H=P.attributes.ssrcs.filter(oe=>oe.attributes.label===k),ie=P.attributes.ssrcGroups;if(H.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ie&&H.length>1){let oe=ie.find(ae=>ae.ssrcIds.indexOf(H[0].ssrcId)!==-1);return oe?[{ssrcId:oe.ssrcIds[0],rtx:F?oe.ssrcIds[1]:void 0}]:[{ssrcId:H[0].ssrcId}]}return[{ssrcId:H[0].ssrcId}]}(V,b.id,o.useRTX)}),_;try{_=yield m}catch(C){throw l.forEach(b=>{Pn()&&b.replaceTrack(null),o.peerConnection.removeTrack(b)}),C}let v=o.mungSendOfferSDP(u.sdp,t);o.remoteSDP.receive(t,i,_);let S=o.remoteSDP.toString();return yield mt(o.peerConnection.setLocalDescription({type:"offer",sdp:v})),yield mt(o.applySendEncodings(l,t)),yield mt(o.peerConnection.setRemoteDescription({type:"answer",sdp:S})),t.map((C,b)=>{let V=C._mediaStreamTrack.id;return{localSSRC:m[b],id:V}})}catch(l){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{a()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{Pn()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(t,i,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:l,mslabel:u}=this.remoteSDP.send(t,i,a),f=new De((v,S)=>{let C=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(l)))},1e4),b=V=>{let P=Ut();if((P.name==="Safari"&&Number(P.version)===11||ur())&&V.track.id!==l&&V.streams[0].id===u){var k;let F=V.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(t,l,V.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(C),void v(F)}if(V.track.id===l)return this.peerConnection.removeEventListener("track",b),clearTimeout(C),void v(V.track)};this.peerConnection.addEventListener("track",b)}),m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});let _=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_),{track:await f,id:l}}catch(l){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(o=>{var a;return t.indexOf(((a=o.track)===null||a===void 0?void 0:a.id)||"")!==-1});if(i.length!==t.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(Pn()&&o.track)o.track.enabled=!1;else{let a=o.getParameters();a.encodings.forEach(l=>l.active=!1),o.setParameters(a)}})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(l=>{var u;return t.indexOf(((u=l.track)===null||u===void 0?void 0:u.id)||"")!==-1});if(i.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async l=>{if(Pn()&&l.track)l.track.enabled=!0;else{let u=l.getParameters();u.encodings.forEach(f=>f.active=!0),await l.setParameters(u)}});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);let a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Bo(function*(){let o=yield mt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(xt().supportPCSetConfiguration){let m=i.peerConnection.getConfiguration(),_=t===Ir.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(I.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,i.peerConnection.setConfiguration(m))}else if(t===Ir.RELAY)return;t!==Ir.RELAY&&i.remoteSDP.updateCandidates(t);let a=yield mt(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=hc(a.sdp),{remoteIceParameters:u}=yield l.iceParameters;i.remoteSDP.restartICE(u);let f=i.remoteSDP.toString();yield mt(i.peerConnection.setLocalDescription(a)),yield mt(i.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(a){I.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),a)}finally{o()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new fe(W.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,i){let o=this.peerConnection.getSenders().filter(a=>{var l;return((l=a.track)===null||l===void 0?void 0:l.id)===t});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let o=this.peerConnection.getSenders().find(a=>{var l;return((l=a.track)===null||l===void 0?void 0:l.id)===i});o&&await o.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,i){throw new fe(W.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new fe(W.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(om(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...$E.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...$E.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(t,i){var o;if(i||(i=this.peerConnection.getSenders().find(_=>{var v;return((v=_.track)===null||v===void 0?void 0:v.id)===t._mediaStreamTrack.id})),!i)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!xt().supportSetRtpSenderParameters)return I.warn("Browser not support set rtp-sender parameters");let a={},l={};if(t instanceof ui)switch(t._optimizationMode){case"motion":a.degradationPreference="maintain-framerate";break;case"detail":a.degradationPreference="maintain-resolution";break;default:a.degradationPreference="balanced"}if($("DSCP_TYPE")&&ou()){var u;let _=$("DSCP_TYPE");ke(u=["very-low","low","medium","high"]).call(u,_)&&(l.networkPriority=_)}let f=i.getParameters(),m=(o=f.encodings)===null||o===void 0?void 0:o[0];m&&Object.assign(m,l),Object.assign(f,a),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(f.encodings))),await i.setParameters(f)}async applySendEncodings(t,i){try{if(!xt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let o=0;o<t.length;o++){let a=t[o],l=i[o];a&&l&&await this.updateRtpSenderEncodings(l,a)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i){let o=Oi.parse(t);return i.forEach((a,l)=>{let u=a._mediaStreamTrack,f=o.mediaDescriptions.find(m=>m.attributes.mid===u.kind);f&&yu(f,a)}),Oi.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(t).map((l,u)=>{let{id:f,mslabel:m}=l,{kind:_}=t[u];return new De((v,S)=>{let C=setTimeout(()=>{S(new Error("Cannot receive track, id: ".concat(f)))},1e4),b=V=>{let P=Ut();if(P.name==="Safari"&&Number(P.version)===11&&V.track.id!==f&&V.streams[0].id===m){var k;let F=V.streams[0].getTracks()[0];return(k=this.remoteSDP)===null||k===void 0||k.updateTrackLabel(_,f,V.track.id),this.peerConnection.removeEventListener("track",b),clearTimeout(C),void v({track:F,id:f})}if(V.track.id===f)return this.peerConnection.removeEventListener("track",b),clearTimeout(C),void v({track:V.track,id:f})};this.peerConnection.addEventListener("track",b)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),await De.all(i)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(xt().supportPCSetConfiguration){let i=$E.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},Ne(hi.prototype,"connect",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"connect"),hi.prototype),Ne(hi.prototype,"stopSending",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"stopSending"),hi.prototype),Ne(hi.prototype,"receive",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"receive"),hi.prototype),Ne(hi.prototype,"stopReceiving",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"stopReceiving"),hi.prototype),Ne(hi.prototype,"muteRemote",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"muteRemote"),hi.prototype),Ne(hi.prototype,"unmuteRemote",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"unmuteRemote"),hi.prototype),Ne(hi.prototype,"muteLocal",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"muteLocal"),hi.prototype),Ne(hi.prototype,"unmuteLocal",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"unmuteLocal"),hi.prototype),Ne(hi.prototype,"close",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"close"),hi.prototype),Ne(hi.prototype,"updateEncoderConfig",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"updateEncoderConfig"),hi.prototype),Ne(hi.prototype,"updateSendParameters",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"updateSendParameters"),hi.prototype),Ne(hi.prototype,"replaceTrack",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"replaceTrack"),hi.prototype),Ne(hi.prototype,"getRemoteSSRC",[Us],Object.getOwnPropertyDescriptor(hi.prototype,"getRemoteSSRC"),hi.prototype),hi);function Us(e,t,i){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,l=await a.lock("Locking from P2PConnection.".concat(t));try{for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{l()}},i}function JF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function Cu(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?JF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let wE="9",ZF=4e4;function QF(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function nd(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?QF(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):QF(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let eS=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var Bm=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Bm||{});let tS=new Map;function eB(e,t,i,o){let{scale:a}=e;if(a===0&&o===Bm.UP||a>=t.length-1&&o===Bm.DOWN)return e;let l=nd(nd({},e),{},{scale:o===Bm.DOWN?++a:--a});switch(i){case"maintain-framerate":l=nd(nd({},l),t[a].motion);break;case"maintain-resolution":l=nd(nd({},l),t[a].detail);break;case"balanced":l=nd(nd({},l),t[a].balanced)}return l}function tB(e,t){if(t){let i={overUse:0,underUse:0,adaptationList:iB(t)};tS.set(e,i)}else tS.delete(e)}function iB(e){let t=nd({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:a,bitrateMin:l}=t,{MIN_FRAME_RATE:u,MAX_THRESHOLD_FRAMERATE:f,MAX_SCALE:m,BITRATE_MIN_THRESHOLD:_,BITRATE_MAX_THRESHOLD:v,BWE_SCALE_UP_THRESHOLD:S,BWE_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_UP_THRESHOLD:V,BALANCE_BITRATE_FACTOR:P,BALANCE_FRAMERATE_FACTOR:k,BALANCE_RESOLUTION_FACTOR:F,MOTION_RESOLUTION_FACTOR:H,MOTION_BITRATE_FACTOR:ie,DETAIL_FRAMERATE_FACTOR:oe,DETAIL_BITRATE_FACTOR:ae}=rR,he=Math.min(t.frameRate,f),Ee=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(C,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(b,1)*he),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:l}}];for(let ye=1;ye<=m;ye++){let Ce={bwe_up:Math.round(Math.pow(S,ye)*i),bwe_down:Math.round(Math.pow(C,ye+1)*i),fps_up:Math.round(Math.pow(V,ye)*he),fps_down:Math.round(Math.pow(b,ye+1)*he)},ze={scaleResolutionDownBy:a/Math.pow(F,ye),frameRate:Math.max(Math.round(Math.pow(k,ye)*o),u),bitrateMax:Math.max(Math.round(Math.pow(P,ye)*i),v),bitrateMin:Math.max(Math.round(Math.pow(P,ye)*l),_)},It={scaleResolutionDownBy:a/Math.pow(H,ye),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ie,ye)*i),v),bitrateMin:Math.max(Math.round(Math.pow(ie,ye)*l),_)},Kt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(oe,ye)*o),u),bitrateMax:Math.max(Math.round(Math.pow(ae,ye)*i),v),bitrateMin:Math.max(Math.round(Math.pow(ae,ye)*l),_)};Ee.push({scale:ye,threshold:Ce,balanced:ze,motion:It,detail:Kt})}return Ee}function Die(e,t,i,o,a,l){let u=tS.get(e)||{overUse:0,underUse:0,adaptationList:iB(a)},{adaptationList:f}=u;tS.set(e,u);let{OVERUSE_TIMES_THRESHOLD:m,UNDERUSE_TIMES_THRESHOLD:_}=rR,{scale:v}=o,S,C;return typeof t=="number"&&t>0&&function(b,V,P,k){if(V>=P.length)return!1;let{threshold:{fps_down:F}}=P[V];return $("FORCE_AG_HIGH_FRAMERATE")&&k==="maintain-framerate"&&(F=P[0].threshold.fps_down),b<F}(t,v,f,l)&&(u.overUse++,C=eS.CPU,u.overUse>m)||typeof i=="number"&&i>0&&function(b,V,P){if(V>=P.length)return!1;let{threshold:{bwe_down:k}}=P[V];return b<k}(i,v,f)&&(u.overUse++,C=eS.BANDWIDTH,u.overUse>m)?(u.overUse=0,u.underUse=0,S=eB(o,f,l,Bm.DOWN),[S,C]):(typeof t=="number"&&t>0&&typeof i=="number"&&i>0&&function(b,V,P,k){if(V===0)return;let{threshold:{fps_up:F}}=P[V];return $("FORCE_AG_HIGH_FRAMERATE")&&k==="maintain-framerate"&&(F=P[1].threshold.fps_up),b>F}(t,v,f,l)&&function(b,V,P){if(V===0)return;let{threshold:{bwe_up:k}}=P[V];return b>k}(i,v,f)&&(u.underUse++,u.underUse>_&&(u.overUse=0,u.underUse=0,S=eB(o,f,l,Bm.UP),S.scale===0&&(C=eS.NONE))),[S,C])}function nB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function GI(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function kie(e){var t;return!!$("ENABLE_AG_ADAPTATION")&&!!(e instanceof OI||ke(t=e._hints).call(t,gi.CUSTOM_TRACK))&&(!!$("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){let o=Ut();if(o.os!==On.IOS||!o.osVersion)return!1;let a=o.osVersion.split(".");return Number(a[0])>=i}(14)&&pM(17,4)||hM(14)&&fM(17,4)))}let iS=new Map;function nS(e){let t=iS.get(e);if(t){let{timer:i,adaptationFunc:o,originConfig:a}=t;window.clearTimeout(i),o(a),iS.delete(e)}tB(e)}var jt;function rB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function bu(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?rB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let gc=(jt=class XE extends d0{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,i;return(t=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var i;return ke(i=Object.keys(cm)).call(i,t)}))]}constructor(t,i){super(t,i),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"id",di(5,"connection-")),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"transportEventReceiver",void 0),U(this,"statsFilter",void 0),U(this,"useXR",$("USE_XR")),U(this,"localCapabilities",void 0),U(this,"remoteCodecs",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"dataStreamChannelMap",new Map),U(this,"establishPromise",void 0),U(this,"recoveredDataChannelIds",[]),U(this,"currentDataChannelId",1),U(this,"mutex",new jn("P2PConnection-mutex")),U(this,"qualityLimitationReason",eS.NONE),this.store=i,this.peerConnection=new RTCPeerConnection(XE.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=q0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=hc(t.sdp),o=await FI({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=Vm(o),this.initialOffer=t,bu(bu({},i),{},{rtpCapabilities:o,offerSDP:t.sdp})}catch(t){throw new fe(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,i,o,a,l,u){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return mi(this._localCapabilities)}get rtpCapabilities(){return mi(this._rtpCapabilities)}get candidates(){return mi(this._candidates)}get iceParameters(){return mi(this._iceParameters)}get dtlsParameters(){return mi(this._dtlsParameters)}constructor(b){U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_iceParameters",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),U(this,"firefoxSsrcMidMap",new Map),b=mi(b);let{remoteIceParameters:V,remoteDtlsParameters:P,candidates:k,remoteRTPCapabilities:F,remoteSetup:H,localCapabilities:ie,cname:oe}=b,ae=Oi.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=F,this._candidates=k,this._iceParameters=V,this._dtlsParameters=P,this._localCapabilities=ie,this.setup=H,this.cname=oe;let he=this.rtpCapabilities.send;for(let Ee of ae.mediaDescriptions){if(Ee.attributes.iceUfrag=V.iceUfrag,Ee.attributes.icePwd=V.icePwd,Ee.attributes.fingerprints=P.fingerprints,Ee.attributes.candidates=k,Ee.attributes.setup=H,Ee.media.mediaType==="video"&&(Ee.media.fmts=he.videoCodecs.map(ye=>ye.payloadType.toString(10)),Ee.attributes.payloads=he.videoCodecs,Ee.attributes.extmaps=he.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:ye,ssrcGroups:Ce}=_s([{ssrcId:ZF,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);Ee.attributes.ssrcs=ye,Ee.attributes.ssrcGroups=Ce}if(Ee.media.mediaType==="audio"&&(Ee.media.fmts=he.audioCodecs.map(ye=>ye.payloadType.toString(10)),Ee.attributes.payloads=he.audioCodecs,Ee.attributes.extmaps=he.audioExtensions,pc(Ee),$("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:ye,ssrcGroups:Ce}=_s([{ssrcId:2e4}],this.cname);Ee.attributes.ssrcs=ye,Ee.attributes.ssrcGroups=Ce}}this.sessionDesc=ae,this.currentMidIndex=ae.mediaDescriptions.length-1}preloadRemoteMedia(){let b=$("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;let V=this.candidates,P=this.dtlsParameters,k=this.iceParameters,F=this.rtpCapabilities.send;for(let H=1;H<b;H++){let ie=2*H+2e4,oe=2*H+ZF,{ssrcs:ae,ssrcGroups:he}=_s([{ssrcId:ie}],this.cname),{ssrcs:Ee,ssrcGroups:ye}=_s([{ssrcId:oe,rtx:$("USE_SUB_RTX")?oe+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:wE,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.videoCodecs.map(Ce=>Ce.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:k.iceUfrag,icePwd:k.icePwd,unrecognized:[],candidates:V,extmaps:F.videoExtensions,fingerprints:P.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ee,ssrcGroups:ye,rtcpFeedbackWildcards:[],payloads:F.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*H)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:wE,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.audioCodecs.map(Ce=>Ce.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:k.iceUfrag,icePwd:k.icePwd,unrecognized:[],candidates:V,extmaps:F.audioExtensions,fingerprints:P.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ae,ssrcGroups:he,rtcpFeedbackWildcards:[],payloads:F.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*H+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Oi.print(this.sessionDesc)}send(b,V,P,k){let{ssrcs:F,ssrcGroups:H}=_s(V,this.cname,$("SYNC_GROUP")?P:void 0),ie=this.findPreloadMediaDesc(F);if(ie){if(ci()&&this.firefoxSsrcMidMap.set(F[0].ssrcId,ie.attributes.mid),k&&(k.twcc||k.remb)){let oe=this.sessionDesc.mediaDescriptions.indexOf(ie);return this.sessionDesc.mediaDescriptions[oe]=this.mungSendMediaDesc(ie,k),{mid:ie.attributes.mid,needExchangeSDP:!0}}return{mid:ie.attributes.mid,needExchangeSDP:!1}}{let oe=this.findAvailableMediaIndex(b,F),ae;return oe===-1||oe===1&&(Pn()||gM())||oe===0&&$("USE_SUB_RTX")||_M()?(ae=this.createOrRecycleSendMedia(b,F,H,"sendonly",k),this.updateBundleMids()):(ae=mi(this.sessionDesc.mediaDescriptions[oe]),ae.attributes.direction="sendonly",ae.attributes.ssrcs=F,ae.attributes.ssrcGroups=H,this.sessionDesc.mediaDescriptions[oe]=this.mungSendMediaDesc(ae,k)),ci()&&this.firefoxSsrcMidMap.set(F[0].ssrcId,ae.attributes.mid),{mid:ae.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:b,needExchangeSDP:V}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:b.attributes.mid,needExchangeSDP:V}}batchSend(b){let V=b.map(F=>{let{kind:H,ssrcMsg:ie,mslabel:oe}=F;return this.send(H,ie,oe)}),P=[],k=!1;return V.forEach(F=>{let{mid:H,needExchangeSDP:ie}=F;ie&&(k=!0),P.push(H)}),{mids:P,needExchangeSDP:k}}stopSending(b){let V=this.sessionDesc.mediaDescriptions.filter(P=>P.attributes.mid&&b.indexOf(P.attributes.mid)!==-1);if(V.length!==b.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");V.forEach(P=>{P.attributes.mid==="0"||ci()||_M()?P.attributes.ssrcs=[]:(P.attributes.ssrcs=[],P.attributes.direction="inactive",P.media.port="0")}),this.updateBundleMids()}mute(b){let V=this.sessionDesc.mediaDescriptions.find(P=>P.attributes.mid===b);if(!V)throw new Error("mediaDescription not found with ".concat(b," in remote SDP when calling RemoteSDP.mute."));V.attributes.direction="inactive"}unmute(b){let V=this.sessionDesc.mediaDescriptions.find(P=>P.attributes.mid===b);if(!V)throw new Error("mediaDescription not found with ".concat(b," in remote SDP when calling RemoteSDP.unmute."));V.attributes.direction="sendonly"}muteRemote(b){let V=this.sessionDesc.mediaDescriptions.filter(P=>ke(b).call(b,P.attributes.mid||""));if(V.length!==b.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");V.forEach(P=>{P.attributes.direction="inactive"})}unmuteRemote(b){let V=this.sessionDesc.mediaDescriptions.filter(P=>ke(b).call(b,P.attributes.mid||""));if(V.length!==b.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");V.forEach(P=>{P.attributes.direction="recvonly"})}receive(b,V,P,k){b.forEach((F,H)=>{this.createOrRecycleRecvMedia(F,[],"recvonly",V,P,k[H])}),this.updateBundleMids()}stopReceiving(b){let V=this.sessionDesc.mediaDescriptions.filter(P=>b.indexOf(P.attributes.mid)!==-1);if(V.length!==b.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");V.forEach(P=>{P.media.port="0",P.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(b){let V=this._candidates.filter(P=>P.transport==="udp");if(b===Ir.TCP){if(V.length===0)return;if($("TCP_CANDIDATE_ONLY")){let P=this._candidates.filter(k=>k.transport==="tcp");V.forEach(k=>{P.findIndex(F=>F.connectionAddress===k.connectionAddress)===-1&&P.push(Cu(Cu({},k),{},{foundation:"tcpcandidate",priority:Number(k.priority)-1+"",transport:"tcp",port:Number(k.port)+90+""}))}),this._candidates=P}else{let P=[];V.forEach(k=>{P.push(Cu(Cu({},k),{},{foundation:"tcpcandidate",priority:Number(k.priority)-1+"",transport:"tcp",port:Number(k.port)+90+""}))}),this._candidates=[...V,...P]}}else if(b===Ir.RELAY){if(V.length!==0)return;{let P=this._candidates.filter(k=>k.transport==="tcp");P.forEach(k=>{V.push(Cu(Cu({},k),{},{foundation:"udpcandidate",priority:Number(k.priority)+1+"",transport:"udp",port:Number(k.port)-90+""}))}),this._candidates=[...V,...P]}}else V.length===0?(this._candidates.filter(P=>P.transport==="tcp").forEach(P=>{V.push(Cu(Cu({},P),{},{foundation:"udpcandidate",priority:Number(P.priority)+1+"",transport:"udp",port:Number(P.port)-90+""}))}),this._candidates=V):this._candidates=this._candidates.filter(P=>P.transport!=="tcp");for(let P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}restartICE(b){b=mi(b),this._iceParameters=b,this.sessionDesc.mediaDescriptions.forEach(V=>{V.attributes.iceUfrag=b.iceUfrag,V.attributes.icePwd=b.icePwd})}predictReceivingMids(b){let V=[];for(let P=0;P<b;P++)V.push((this.currentMidIndex+P+1).toString(10));return V}findAvailableMediaIndex(b,V){return this.sessionDesc.mediaDescriptions.findIndex(P=>{let k=P.media.mediaType===b&&P.media.port!=="0"&&(P.attributes.direction==="sendonly"||P.attributes.direction==="sendrecv")&&P.attributes.ssrcs.length===0;if(ci()){if(k){let F=this.firefoxSsrcMidMap.get(V[0].ssrcId);return!(F||P.attributes.mid!=="0"&&P.attributes.mid!=="1")||!(!F||F!==P.attributes.mid)}return!1}return k})}createOrRecycleDataChannel(){for(let P of this.sessionDesc.mediaDescriptions)if(P.media.mediaType==="application")return{mediaDesc:P,needExchangeSDP:!1};this.currentMidIndex+=1;let b="".concat(this.currentMidIndex),V={media:{mediaType:"application",port:wE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(b),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(V),{mediaDesc:V,needExchangeSDP:!0}}createOrRecycleRecvMedia(b,V,P,k,F,H){let ie=b._mediaStreamTrack.kind,oe=this.rtpCapabilities.recv,ae=bp(ie,oe,this.localCapabilities.send,ie===He.VIDEO?k:F),he=ie===He.VIDEO?oe.videoExtensions:oe.audioExtensions;this.currentMidIndex+=1;let Ee="".concat(this.currentMidIndex),ye={media:{mediaType:ie,port:wE,protos:["UDP","TLS","RTP","SAVPF"],fmts:ae.map(ze=>ze.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:he,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:V,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:ae,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Ee)}};ye=this.mungRecvMediaDsec(ye,b,H);let Ce=this.findFirstClosedMedia(ie);if(Ce){let ze=this.sessionDesc.mediaDescriptions.indexOf(Ce);this.sessionDesc.mediaDescriptions[ze]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(b,V,P){let k=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Ce;return ke(Ce=Object.keys(cm)).call(Ce,ye)}))],F=new Set(V);if(k.every(ye=>F.has(ye)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(V)),!1;let H=this._rtpCapabilities.recv.videoCodecs.filter(ye=>V.some(Ce=>{var ze;return ke(ze=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(ze,Ce)}));if(H.length===0)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(k," codecs: ").concat(V)),!1;let ie=[...new Set(H.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))],oe;if(I.debug("updateRemoteCodec, from ".concat(k," to ").concat(ie)),b.length===0)oe=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(oe=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&ke(b).call(b,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),oe.length!==b.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(b,", codecs: ").concat(V)),!1;if($("USE_PUB_RTX")||$("USE_SUB_RTX")){let ye=BI(H,this.rtpCapabilities.recv.videoCodecs);H.push(...ye)}this._rtpCapabilities.recv.videoCodecs=H;let ae=this.localCapabilities.send,he=this.rtpCapabilities.recv,Ee=bp(He.VIDEO,he,ae,P);return oe.forEach(ye=>{let Ce=Ee.map(ze=>ze.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from ").concat(ye.attributes.payloads," to ").concat(Ee)),ye.attributes.payloads=Ee,ye.media.fmts=Ce}),!0}createOrRecycleSendMedia(b,V,P,k,F){let H=this.rtpCapabilities.send,ie=b===He.VIDEO?H.videoCodecs:H.audioCodecs,oe=b===He.VIDEO?H.videoExtensions:H.audioExtensions;this.currentMidIndex+=1;let ae="".concat(this.currentMidIndex),he={media:{mediaType:b,port:wE,protos:["UDP","TLS","RTP","SAVPF"],fmts:ie.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:oe,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:V,ssrcGroups:P,rtcpFeedbackWildcards:[],payloads:ie,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:k,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ae)}};he=this.mungSendMediaDesc(he,F);let Ee=this.findFirstClosedMedia(b);if(Ee){let ye=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[ye]=he}else this.sessionDesc.mediaDescriptions.push(he);return he}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(b=>b.media.port!=="0").map(b=>b.attributes.mid)}mungRecvMediaDsec(b,V,P){let k=mi(b);return Y0(k),yu(k,V),$0(k,V),jI(k),jm(k,P,this.localCapabilities.send),k}mungSendMediaDesc(b,V){let P=mi(b);return jm(P,V,this.localCapabilities.recv),pc(P),P}updateRecvMedia(b,V){let P=this.sessionDesc.mediaDescriptions.findIndex(k=>k.attributes.mid===b);if(P!==-1){let k=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[P],V);this.sessionDesc.mediaDescriptions[P]=k}}bumpMid(b){this.currentMidIndex+=b}findFirstClosedMedia(b){return this.sessionDesc.mediaDescriptions.find(V=>ci()?V.media.port==="0"&&V.media.mediaType===b:V.media.port==="0")}findPreloadMediaDesc(b){return this.sessionDesc.mediaDescriptions.find(V=>{var P;return((P=V.attributes)===null||P===void 0||(P=P.ssrcs[0])===null||P===void 0?void 0:P.ssrcId)===b[0].ssrcId})}getSSRC(b){var V;return(V=this.sessionDesc.mediaDescriptions.find(P=>P.attributes.mid===b))===null||V===void 0?void 0:V.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:l,localCapabilities:this.localCapabilities,cname:u}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let f=this.remoteSDP.toString(),m=Oi.parse(this.initialOffer.sdp),_=m.mediaDescriptions.find(b=>b.media.mediaType==="audio");_&&pc(_),this.useXR&&X0(m);let v=Oi.print(m),S=this.logSDPExchange(v||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:v}),S==null||S(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f});let C=this.peerConnection.getTransceivers()[0];if(C!=null&&C.receiver&&this.tryBindTransportEvents(C.receiver),$("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();let b=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:b});let V=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(V)}}catch(f){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(f.toString()))}}send(t,i,o){var a=this;return Bo(function*(){let l=yield mt(a.mutex.lock("From P2PConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let u=[];t.forEach(P=>{let k=a.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});u.push(k),P._updateRtpTransceiver(k)}),ci()&&$("SIMULCAST")===!0&&(yield mt(a.applySimulcastForFirefox(u,t)));let f=yield mt(a.peerConnection.createOffer()),m=a.remoteSDP.predictReceivingMids(t.length),_=a.mungSendOfferSDP(f.sdp,t,m),v=Oi.parse(_),S=m.map(P=>{let k=v.mediaDescriptions.find(F=>F.attributes.mid===P);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return UI(k,$("USE_PUB_RTX"))}),C;try{C=yield S}catch(P){C=[],a.remoteSDP.receive(t,i,o,C);let k=a.remoteSDP.toString();throw yield mt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield mt(a.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield mt(a.stopSending(m,!0)),P}a.remoteSDP.receive(t,i,o,C);let b=a.remoteSDP.toString(),V=a.logSDPExchange(_,"offer","local","send");return yield mt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield mt(a.applySimulcastEncodings(u,t)),yield mt(a.applySendEncodings(u,t)),V==null||V(b),yield mt(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),u.map((P,k)=>{let F=m[k];return{localSSRC:S[k],id:F,transceiver:P}})}catch(u){throw u instanceof fe?u:new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);if(o&&o.readyState==="open")I.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)}i.forEach(l=>{l._updateOriginDataChannel(o)});let{needExchangeSDP:a}=this.remoteSDP.sendDataChannel();if(a){let l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});let u=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(u),I.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else I.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof fe?o:new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof fe?i:new fe(W.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(t,i){let o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");a.map(m=>{var _;nS(this.id+m.mid),m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});let l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);let f=this.remoteSDP.toString();u==null||u(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(a){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(a.toString()))}finally{o&&o()}}async receive(t,i,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,i,o,a);if(u){let m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});let v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,l,t);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let f=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:l,transceiver:f}}catch(l){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(t);if(o){let a=this.remoteSDP.toString(),l=this.logSDPExchange(a,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let u=await this.peerConnection.createAnswer();l==null||l(u.sdp||""),await this.peerConnection.setLocalDescription(u),I.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else I.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return i.map(a=>{let l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a,transceiver:l}})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(u=>{u.direction="inactive"});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(u,f)=>{u.direction="sendonly"});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new fe(W.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Bo(function*(){let o=yield mt(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(xt().supportPCSetConfiguration){let _=i.peerConnection.getConfiguration(),v=t===Ir.RELAY?"relay":"all";_.iceTransportPolicy!==v&&(I.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_.iceTransportPolicy,"] to [").concat(v,"]")),_.iceTransportPolicy=v,i.peerConnection.setConfiguration(_))}else if(t===Ir.RELAY)return;i.remoteSDP.updateCandidates(t);let a=yield mt(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=hc(a.sdp),{remoteIceParameters:u}=yield l.iceParameters;i.remoteSDP.restartICE(u);let f=i.remoteSDP.toString(),m=i.logSDPExchange(a.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield mt(i.peerConnection.setLocalDescription(a)),m==null||m(f),yield mt(i.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(a){I.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),a)}finally{o()}})()}close(){var t;this.peerConnection.getTransceivers().forEach(i=>{nS(this.id+i.mid)}),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return bu(bu({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let l=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new fe(W.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,i){let o=this.peerConnection.getTransceivers().filter(a=>a.mid===t);o.length===1&&(this.isVP8Simulcast(i)?ci()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let o=this.peerConnection.getTransceivers().find(a=>a.mid===i);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let i=t[0].transport.iceTransport,{local:o,remote:a}=i.getSelectedCandidatePair();return{local:bu(bu({},al),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:bu(bu({},al),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(om(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...XE.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...XE.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),$("ENABLE_ENCODED_TRANSFORM")&&xt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(hu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!$("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(t){let i=t.transport;if(i){this.transportEventReceiver=t,i.onstatechange=()=>{var a;i!=null&&i.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,i.state))},i.onerror=a=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in a?a.error:a)};let o=i.iceTransport;o&&(o.onstatechange=()=>{let a=i==null?void 0:i.iceTransport.state;var l;a&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,a))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){let{local:a,remote:l}=o.getSelectedCandidatePair();I.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,i){var o,a;if(i||(i=this.peerConnection.getSenders().find(P=>P.track===t._mediaStreamTrack)),!i)return I.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return I.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!xt().supportSetRtpSenderParameters)return I.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let l={},u={};switch(t._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}let f=function(P,k){return P.getTransceivers().find(F=>F.sender.track===k||F.receiver.track===k)}(this.peerConnection,t._mediaStreamTrack),m=nie(t);if(kie(t)&&f&&i&&m&&this.getLocalVideoStats&&ke(o=["vp8","vp9"]).call(o,this.store.codec)){var _;let P=l.degradationPreference||(ke(_=t._hints).call(_,gi.CUSTOM_TRACK)?$("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(k,F,H,ie,oe,ae){if(nS(k),ie!=="balanced"&&ie!=="maintain-framerate"&&ie!=="maintain-resolution")return;let he=-1;tB(k,F);let Ee=window.setInterval(()=>{let Ce=iS.get(k);if(!$("ENABLE_AG_ADAPTATION")||!Ce)return void nS(k);let ze=ae();if(ze.sendPackets>0&&ze.OutgoingAvailableBandwidth>0){if(he===-1)return void(he=Date.now());if(Date.now()-he<1e3)return;let It=ze.sendFrameRate,Kt=ze.OutgoingAvailableBandwidth,[_i,sn]=Die(k,It,Kt,Ce.adaptationConfig,F,ie);sn&&(H.qualityLimitationReason=sn),_i&&Ce.adaptationConfig.scale!==_i.scale&&(I.debug("[".concat(k,"] applyAdaptation: ").concat(H.qualityLimitationReason,`
           sendFps `).concat(It,", bwe ").concat(Kt,", switch from ").concat(Ce.adaptationConfig.scale," to ").concat(_i.scale," ")),Ce.adaptationConfig=GI(GI({},Ce.adaptationConfig),_i),oe(_i))}},$("CHECK_LOCAL_STATS_INTERVAL")),ye=GI({},F);iS.set(k,{timer:Ee,adaptationConfig:ye,originConfig:F,adaptationFunc:oe}),I.debug("[".concat(k,"] start adaptation, originConfig: ").concat(JSON.stringify(F),", degradationPreference: ").concat(ie))})(this.id+f.mid,m,this,P,k=>{i&&this.updateAdaptation(i,k)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var v;let{bitrateMax:P,frameRate:k,scaleResolutionDownBy:F}=t._encoderConfig;P&&(u.maxBitrate=1e3*P),(ke(v=t._hints).call(v,gi.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(k&&(u.maxFramerate=_o(k)),F&&F>=1&&(u.scaleResolutionDownBy=F))}let{maxFramerate:S}=$("ENCODER_CONFIG_LIMIT");if(S&&typeof S=="number"&&(u.maxFramerate=u.maxFramerate?Math.min(u.maxFramerate,S):S),$("DSCP_TYPE")&&ou()){var C;let P=$("DSCP_TYPE");ke(C=["very-low","low","medium","high"]).call(C,P)&&(u.networkPriority=P)}let b=i.getParameters(),V=(a=b.encodings)===null||a===void 0?void 0:a[0];ci()&&!V&&(l.encodings=[u]),V&&Object.assign(V,u),Object.assign(b,l),I.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await i.setParameters(b)}async updateAdaptation(t,i){var o,a;if(!t)return I.debug("[updateAdaptation] no rtpSender found");if(!xt().supportSetRtpSenderParameters)return I.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let l={},{bitrateMax:u,frameRate:f,scaleResolutionDownBy:m}=i;u&&(l.maxBitrate=1e3*u),f&&(l.maxFramerate=_o(f)),m&&m>=1&&ke(o=["vp8","vp9"]).call(o,this.store.codec)&&(l.scaleResolutionDownBy=m);let _=t.getParameters(),v=(a=_.encodings)===null||a===void 0?void 0:a[0];v&&Object.assign(v,l),Object.assign(_,{});try{await t.setParameters(_),I.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(_.encodings)))}catch(S){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?I.debug("[updateAdaptation] peerConnection not connected}"):I.debug("[updateAdaptation] updateRtpSenderEncodings failed",S):I.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,i){try{if(!xt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let o=0;o<t.length;o++){let a=t[o],l=i[o];l instanceof ui&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,a.sender)}}catch{I.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,i,o){let a=Oi.parse(t);return i.forEach((l,u)=>{let f=o[u],m=a.mediaDescriptions.find(_=>_.attributes.mid===f);m&&(yu(m,l),VI(m,l,this.store.codec))}),Oi.print(a)}mungReceiveAnswerSDP(t,i,o){let a=Oi.parse(t),l=a.mediaDescriptions.find(u=>u.attributes.mid===i);return l&&(o===He.AUDIO&&l.media.mediaType==="audio"&&pc(l),this.useXR&&X0(a)),Oi.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let m=0;m<t.length;m++){var o,a,l,u,f;let _=t[m],v=i[m];if(v instanceof ui&&!ke(o=v._hints).call(o,gi.LOW_STREAM)&&(a=v._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=v._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=v._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=v._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){let S={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];let b=_.sender.getParameters();await _.sender.setParameters(Object.assign(b,S))}}}async applySimulcastEncodings(t,i){if(!ci()&&t.length===i.length)for(let o=0;o<t.length;o++){let a=i[o];if(a instanceof ui&&this.isVP8Simulcast(a)){let l=t[o],u={},f={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];let m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var i,o,a,l,u;return!!(t instanceof ui&&$("SIMULCAST")&&this.store.codec==="vp8"&&!ke(i=t._hints).call(i,gi.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,i,o,a){if($("SDP_LOGGING"))return I.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(a,`
`),t),i==="offer"?l=>{this.logSDPExchange(l,"answer",o==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(xt().supportPCSetConfiguration){let i=XE.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},Ne(jt.prototype,"updateRemoteRTPCapabilities",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"updateRemoteRTPCapabilities"),jt.prototype),Ne(jt.prototype,"connect",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"connect"),jt.prototype),Ne(jt.prototype,"createDataChannels",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"createDataChannels"),jt.prototype),Ne(jt.prototype,"receive",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"receive"),jt.prototype),Ne(jt.prototype,"batchReceive",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"batchReceive"),jt.prototype),Ne(jt.prototype,"stopReceiving",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"stopReceiving"),jt.prototype),Ne(jt.prototype,"muteRemote",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"muteRemote"),jt.prototype),Ne(jt.prototype,"unmuteRemote",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"unmuteRemote"),jt.prototype),Ne(jt.prototype,"muteLocal",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"muteLocal"),jt.prototype),Ne(jt.prototype,"unmuteLocal",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"unmuteLocal"),jt.prototype),Ne(jt.prototype,"close",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"close"),jt.prototype),Ne(jt.prototype,"updateEncoderConfig",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"updateEncoderConfig"),jt.prototype),Ne(jt.prototype,"updateSendParameters",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"updateSendParameters"),jt.prototype),Ne(jt.prototype,"replaceTrack",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"replaceTrack"),jt.prototype),Ne(jt.prototype,"updateAdaptation",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"updateAdaptation"),jt.prototype),Ne(jt.prototype,"getRemoteSSRC",[Eo],Object.getOwnPropertyDescriptor(jt.prototype,"getRemoteSSRC"),jt.prototype),jt);function Eo(e,t,i){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,l=await a.lock("From P2PConnection.".concat(t));try{for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{l()}},i}function oB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function sB(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?oB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let aB=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,rS="9",KI=2e4,qI=4e4;class Lie{get localCapabilities(){return mi(this._localCapabilities)}get rtpCapabilities(){return mi(this._rtpCapabilities)}get candidates(){return mi(this._candidates)}get iceParameters(){return mi(this._iceParameters)}get dtlsParameters(){return mi(this._dtlsParameters)}constructor(t){U(this,"sessionDesc",void 0),U(this,"_localCapabilities",void 0),U(this,"_rtpCapabilities",void 0),U(this,"_candidates",void 0),U(this,"_iceParameters",void 0),U(this,"_dtlsParameters",void 0),U(this,"setup",void 0),U(this,"currentMidIndex",void 0),U(this,"cname",void 0),U(this,"firefoxSsrcMidMap",new Map),t=mi(t);let{remoteIceParameters:i,remoteDtlsParameters:o,candidates:a,remoteRTPCapabilities:l,remoteSetup:u,localCapabilities:f,cname:m}=t,_=Oi.parse(aB);this._rtpCapabilities=l,this._candidates=a,this._iceParameters=i,this._dtlsParameters=o,this._localCapabilities=f,this.setup=u,this.cname=m;let v=this.rtpCapabilities.send;for(let S of _.mediaDescriptions){if(S.attributes.iceUfrag=i.iceUfrag,S.attributes.icePwd=i.icePwd,S.attributes.fingerprints=o.fingerprints,S.attributes.candidates=a,S.attributes.setup=u,S.media.mediaType==="application"&&(S.attributes.sctpPort="5000"),S.media.mediaType==="video"&&(S.media.fmts=v.videoCodecs.map(C=>C.payloadType.toString(10)),S.attributes.payloads=v.videoCodecs,S.attributes.extmaps=v.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:C,ssrcGroups:b}=_s([{ssrcId:qI,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);S.attributes.ssrcs=C,S.attributes.ssrcGroups=b}if(S.media.mediaType==="audio"&&(S.media.fmts=v.audioCodecs.map(C=>C.payloadType.toString(10)),S.attributes.payloads=v.audioCodecs,S.attributes.extmaps=v.audioExtensions,pc(S),$("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:C,ssrcGroups:b}=_s([{ssrcId:KI}],this.cname);S.attributes.ssrcs=C,S.attributes.ssrcGroups=b}}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){let i=Oi.parse(aB);this._rtpCapabilities=t;let o=this.rtpCapabilities.send;for(let a of i.mediaDescriptions){if(a.attributes.iceUfrag=this._iceParameters.iceUfrag,a.attributes.icePwd=this._iceParameters.icePwd,a.attributes.fingerprints=this._dtlsParameters.fingerprints,a.attributes.candidates=this._candidates,a.attributes.setup=this.setup,a.media.mediaType==="application"&&(a.attributes.sctpPort="5000"),a.media.mediaType==="video"&&(a.media.fmts=o.videoCodecs.map(l=>l.payloadType.toString(10)),a.attributes.payloads=o.videoCodecs,a.attributes.extmaps=o.videoExtensions,$("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:l,ssrcGroups:u}=_s([{ssrcId:qI,rtx:$("USE_SUB_RTX")?40001:void 0}],this.cname);a.attributes.ssrcs=l,a.attributes.ssrcGroups=u}if(a.media.mediaType==="audio"&&(a.media.fmts=o.audioCodecs.map(l=>l.payloadType.toString(10)),a.attributes.payloads=o.audioCodecs,a.attributes.extmaps=o.audioExtensions,$("PRELOAD_MEDIA_COUNT")>0)){let{ssrcs:l,ssrcGroups:u}=_s([{ssrcId:KI}],this.cname);a.attributes.ssrcs=l,a.attributes.ssrcGroups=u}}this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;let i=this.candidates,o=this.dtlsParameters,a=this.iceParameters,l=this.rtpCapabilities.send;for(let u=1;u<t;u++){let f=2*u+KI,m=2*u+qI,{ssrcs:_,ssrcGroups:v}=_s([{ssrcId:f}],this.cname),{ssrcs:S,ssrcGroups:C}=_s([{ssrcId:m,rtx:$("USE_SUB_RTX")?m+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.videoCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:a.iceUfrag,icePwd:a.icePwd,unrecognized:[],candidates:i,extmaps:l.videoExtensions,fingerprints:o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:l.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*u-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.audioCodecs.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:a.iceUfrag,icePwd:a.icePwd,unrecognized:[],candidates:i,extmaps:l.audioExtensions,fingerprints:o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:v,rtcpFeedbackWildcards:[],payloads:l.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*u)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Oi.print(this.sessionDesc)}send(t,i,o,a){let{ssrcs:l,ssrcGroups:u}=_s(i,this.cname,$("SYNC_GROUP")?o:void 0),f=this.findPreloadMediaDesc(l);if(f){if(ci()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),a&&(a.twcc||a.remb)){let m=this.sessionDesc.mediaDescriptions.indexOf(f);return this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(f,a),{mid:f.attributes.mid,needExchangeSDP:!0}}return{mid:f.attributes.mid,needExchangeSDP:!1}}{let m=this.findAvailableMediaIndex(t,l),_;return m===-1||Pn()||ur()||gM()||m===0&&$("USE_SUB_RTX")?(_=this.createOrRecycleSendMedia(t,l,u,"sendonly",a),this.updateBundleMids()):(_=mi(this.sessionDesc.mediaDescriptions[m]),_.attributes.direction="sendonly",_.attributes.ssrcs=l,_.attributes.ssrcGroups=u,this.sessionDesc.mediaDescriptions[m]=this.mungSendMediaDesc(_,a)),ci()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,_.attributes.mid),{mid:_.attributes.mid,needExchangeSDP:!0}}}batchSend(t){let i=t.map(l=>{let{kind:u,ssrcMsg:f,mslabel:m}=l;return this.send(u,f,m)}),o=[],a=!1;return i.forEach(l=>{let{mid:u,needExchangeSDP:f}=l;f&&(a=!0),o.push(u)}),{mids:o,needExchangeSDP:a}}stopSending(t){let i=this.sessionDesc.mediaDescriptions.filter(o=>o.attributes.mid&&t.indexOf(o.attributes.mid)!==-1);if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(o=>{o.attributes.mid==="0"||ci()||Pn()||ur()?o.attributes.ssrcs=[]:(o.attributes.ssrcs=[],o.attributes.direction="inactive",o.media.port="0")}),this.updateBundleMids()}mute(t){let i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(t){let i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t);if(!i)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(t){let i=this.sessionDesc.mediaDescriptions.filter(o=>ke(t).call(t,o.attributes.mid||""));if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(o=>{o.attributes.direction="inactive"})}unmuteRemote(t){let i=this.sessionDesc.mediaDescriptions.filter(o=>ke(t).call(t,o.attributes.mid||""));if(i.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(o=>{o.attributes.direction="recvonly"})}receive(t,i,o,a){t.forEach((l,u)=>{this.createOrRecycleRecvMedia(l,[],"recvonly",i,o,a[u])}),this.updateBundleMids()}stopReceiving(t){let i=this.sessionDesc.mediaDescriptions.filter(o=>t.indexOf(o.attributes.mid)!==-1);if(i.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===Ir.TCP?this._candidates.forEach(i=>{this._candidates.findIndex(o=>o.transport==="tcp"&&o.connectionAddress===i.connectionAddress&&o.port===i.port)===-1&&this._candidates.push(sB(sB({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this._candidates=this._candidates.filter(i=>i.transport!=="tcp");for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(t){t=mi(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=t.iceUfrag,i.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let i=[];for(let o=0;o<t;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}findAvailableMediaIndex(t,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{let a=o.media.mediaType===t&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(ci()){if(a){let l=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(l||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!l||l!==o.attributes.mid)}return!1}return a})}createOrRecycleRecvMedia(t,i,o,a,l,u){let f=t._mediaStreamTrack.kind,m=this.rtpCapabilities.recv,_=bp(f,m,this.localCapabilities.send,f===He.VIDEO?a:l),v=f===He.VIDEO?m.videoExtensions:m.audioExtensions;this.currentMidIndex+=1;let S="".concat(this.currentMidIndex),C={media:{mediaType:f,port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:_.map(V=>V.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:v,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(S)}};C=this.mungRecvMediaDsec(C,t,u);let b=this.findFirstClosedMedia(f);if(b){let V=this.sessionDesc.mediaDescriptions.indexOf(b);this.sessionDesc.mediaDescriptions[V]=C}else this.sessionDesc.mediaDescriptions.push(C);return C}updateRemoteCodec(t,i,o){let a=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(C=>C.rtpMap&&C.rtpMap.encodingName.toLowerCase()||"").filter(C=>{var b;return ke(b=Object.keys(cm)).call(b,C)}))],l=new Set(i);if(a.every(C=>l.has(C)))return I.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(i)),!1;let u=this._rtpCapabilities.recv.videoCodecs.filter(C=>i.some(b=>{var V;return ke(V=C.rtpMap&&C.rtpMap.encodingName.toLowerCase()||"").call(V,b)}));if(u.length===0)return I.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(a," codecs: ").concat(i)),!1;let f=[...new Set(u.map(C=>C.rtpMap&&C.rtpMap.encodingName.toLowerCase()||""))],m;if(I.debug("updateRemoteCodec, from ".concat(a," to ").concat(f)),t.length===0)m=this.sessionDesc.mediaDescriptions.filter(C=>C.media.mediaType==="video"&&C.attributes.direction==="recvonly");else if(m=this.sessionDesc.mediaDescriptions.filter(C=>C.attributes.mid&&ke(t).call(t,C.attributes.mid)&&C.attributes.direction==="recvonly"),m.length!==t.length)return I.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(i)),!1;this._rtpCapabilities.recv.videoCodecs=u;let _=this.localCapabilities.send,v=this.rtpCapabilities.recv,S=bp(He.VIDEO,v,_,o);return m.forEach(C=>{let b=S.map(V=>V.payloadType.toString(10));I.debug("updateRemoteCodec mid: ".concat(C.attributes.mid,", from ").concat(C.attributes.payloads," to ").concat(S)),C.attributes.payloads=S,C.media.fmts=b}),!0}createOrRecycleSendMedia(t,i,o,a,l){let u=this.rtpCapabilities.send,f=t===He.VIDEO?u.videoCodecs:u.audioCodecs,m=t===He.VIDEO?u.videoExtensions:u.audioExtensions;this.currentMidIndex+=1;let _="".concat(this.currentMidIndex),v={media:{mediaType:t,port:rS,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(C=>C.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:m,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:o,rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_)}};v=this.mungSendMediaDesc(v,l);let S=this.findFirstClosedMedia(t);if(S){let C=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[C]=v}else this.sessionDesc.mediaDescriptions.push(v);return v}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,i,o){let a=mi(t);return Y0(a),yu(a,i),$0(a,i),jI(a),jm(a,o,this.localCapabilities.send),a}mungSendMediaDesc(t,i){let o=mi(t);return jm(o,i,this.localCapabilities.recv),pc(o),o}updateRecvMedia(t,i){let o=this.sessionDesc.mediaDescriptions.findIndex(a=>a.attributes.mid===t);if(o!==-1){let a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=a}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(i=>ci()?i.media.port==="0"&&i.media.mediaType===t:i.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(i=>{var o;return((o=i.attributes)===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var i;return(i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===t))===null||i===void 0?void 0:i.attributes.ssrcs}}var Vt;function cB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function oS(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Mie=(Vt=class yT extends d0{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let t;return this.localCapabilities&&(t=Vm(this.localCapabilities)),[...new Set(t&&t.send.videoCodecs.map(i=>i.rtpMap&&i.rtpMap.encodingName.toLowerCase()||"").filter(i=>{var o;return ke(o=Object.keys(cm)).call(o,i)}))]}constructor(t,i,o){super(t,i),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"remoteSDP",void 0),U(this,"initialOffer",void 0),U(this,"transportEventReceiver",void 0),U(this,"statsFilter",void 0),U(this,"useXR",$("USE_XR")),U(this,"localCapabilities",void 0),U(this,"localCandidateCount",0),U(this,"allCandidatesReceived",!1),U(this,"remoteCodecs",void 0),U(this,"dataStreamChannelMap",new Map),U(this,"establishPromise",void 0),U(this,"mutex",new jn("NVExtentionsConnection-mutex")),U(this,"rtcMedia",void 0),this.store=i,this.peerConnection=o,this.statsFilter=q0(this.peerConnection,$("STATS_UPDATE_INTERVAL"),void 0,ci()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{let i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let o=hc(i.sdp),a=await FI({filterRTX:!$("USE_PUB_RTX")&&!$("USE_SUB_RTX"),filterVideoFec:$("FILTER_VIDEO_FEC"),filterAudioFec:$("FILTER_AUDIO_FEC"),filterVideoCodec:$("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=a,this.initialOffer=i,oS(oS({},o),{},{rtpCapabilities:a,offerSDP:i.sdp})}catch(i){throw new se(W.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(t,i,o,a,l,u){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Lie({remoteIceParameters:t,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:a,remoteSetup:l,localCapabilities:Vm(this.localCapabilities),cname:u});let f=this.remoteSDP.toString(),m=Oi.parse(this.initialOffer.sdp),_=m.mediaDescriptions.find(C=>C.media.mediaType==="audio");_&&pc(_),this.useXR&&X0(m);let v=Oi.print(m),S=this.logSDPExchange(v||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:v}),S==null||S(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(f){throw new se(W.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(f.toString()))}}async updateRemoteRTPCapabilities(t,i){if(this.remoteCodecs=i,!this.remoteSDP)return void I.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(t,i,this.store.codec)){let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else I.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(t){var i,o,a,l;(i=this.remoteSDP)===null||i===void 0||i.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((l=this.remoteSDP)===null||l===void 0||l.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(o=this.remoteSDP)===null||o===void 0||o.preloadRemoteMedia(2);let u=(a=this.remoteSDP)===null||a===void 0?void 0:a.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});let f=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(f),I.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,i,o){var a=this;return Bo(function*(){let l=yield mt(a.mutex.lock("From NVExtentionsConnection.send"));try{if(!a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");let u=[];t.forEach(P=>{let k=a.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});u.push(k)}),ci()&&$("SIMULCAST")===!0&&(yield mt(a.applySimulcastForFirefox(u,t)));let f=yield mt(a.peerConnection.createOffer()),m=a.remoteSDP.predictReceivingMids(t.length),_=a.mungSendOfferSDP(f.sdp,t,m),v=Oi.parse(_),S=m.map(P=>{let k=v.mediaDescriptions.find(F=>F.attributes.mid===P);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return UI(k,$("USE_PUB_RTX"))}),C;try{C=yield S}catch(P){C=[],a.remoteSDP.receive(t,i,o,C);let k=a.remoteSDP.toString();throw yield mt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield mt(a.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield mt(a.stopSending(m,!0)),P}a.remoteSDP.receive(t,i,o,C);let b=a.remoteSDP.toString(),V=a.logSDPExchange(_,"offer","local","send");return yield mt(a.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield mt(a.applySimulcastEncodings(u,t)),yield mt(a.applySendEncodings(u,t)),V==null||V(b),yield mt(a.peerConnection.setRemoteDescription({type:"answer",sdp:b})),u.map((P,k)=>{let F=m[k];return{localSSRC:S[k],id:F,transceiver:P}})}catch(u){throw u instanceof se?u:new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(u.toString()))}finally{l()}})()}async stopSending(t,i){let o=i?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");let a=this.peerConnection.getTransceivers().filter(m=>t.indexOf(m.mid)!==-1);if(a.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");a.map(m=>{var _;m.direction="inactive",(_=m.stop)===null||_===void 0||_.call(m)});let l=await this.peerConnection.createOffer(),u=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(t);let f=this.remoteSDP.toString();u==null||u(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(a){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(a.toString()))}finally{o&&o()}}async createDataChannels(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(t);return o&&o.readyState==="open"?I.debug("[P2PConnection] Channels are already available and can be reused directly."):(o=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,o)),void i.forEach(a=>{a._updateOriginDataChannel(o)})}catch(o){throw o instanceof se?o:new se(W.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(t){try{let i=this.dataStreamChannelMap.get(t);return i==null||i.close(),void this.dataStreamChannelMap.delete(t)}catch(i){throw i instanceof se?i:new se(W.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(i.toString()))}}async receive(t,i,o,a){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));let{mid:l,needExchangeSDP:u}=this.remoteSDP.send(t,i,o,a);if(u){let m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});let v=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(v.sdp,l,t);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),I.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else I.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));let f=this.peerConnection.getTransceivers().find(m=>m.mid===l);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:l}}catch(l){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(l.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(t);if(o){let a=this.remoteSDP.toString(),l=this.logSDPExchange(a,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});let u=await this.peerConnection.createAnswer();l==null||l(u.sdp||""),await this.peerConnection.setLocalDescription(u),I.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else I.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return i.map(a=>{let l=this.peerConnection.getTransceivers().find(u=>u.mid===a);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:a}})}catch(i){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let a=await this.peerConnection.createAnswer();o==null||o(a.sdp||""),await this.peerConnection.setLocalDescription(a)}catch(i){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(u=>{u.direction="inactive"});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(t);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(u=>u.mid&&t.indexOf(u.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(u,f)=>{u.direction="sendonly"});let o=await this.peerConnection.createOffer(),a=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(t);let l=this.remoteSDP.toString();a==null||a(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new se(W.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(t){var i=this;return Bo(function*(){let o=yield mt(i.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(xt().supportPCSetConfiguration){let _=i.peerConnection.getConfiguration(),v=t===Ir.RELAY?"relay":"all";_.iceTransportPolicy!==v&&(I.debug("restartICE change iceTransportPolicy from [".concat(_.iceTransportPolicy,"] to [").concat(v,"]")),_.iceTransportPolicy=v,i.peerConnection.setConfiguration(_))}else if(t===Ir.RELAY)return;t!==Ir.RELAY&&i.remoteSDP.updateCandidates(t);let a=yield mt(i.peerConnection.createOffer({iceRestart:!0}));if(!a.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=hc(a.sdp),{remoteIceParameters:u}=yield l.iceParameters;i.remoteSDP.restartICE(u);let f=i.remoteSDP.toString(),m=i.logSDPExchange(a.sdp||"","offer","local","restartICE");yield mt(i.peerConnection.setLocalDescription(a)),m==null||m(f),yield mt(i.peerConnection.setRemoteDescription({type:"answer",sdp:f}))}catch(a){I.warning("restart ICE failed, abort operation",a)}finally{o()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),a=this.mungSendOfferSDP(o.sdp,[i],[t]);this.remoteSDP.updateRecvMedia(t,i);let l=this.remoteSDP.toString(),u=this.logSDPExchange(a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:a}),u==null||u(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new se(W.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(t,i){let o=this.peerConnection.getTransceivers().filter(a=>a.mid===t);o.length===1&&(this.isVP8Simulcast(i)?ci()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(t,i){this.statsFilter.setVideoIsReady2(t,i)}async replaceTrack(t,i){let o=this.peerConnection.getTransceivers().find(a=>a.mid===i);o&&await o.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return oS(oS({},hc(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,I.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},$("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(om(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...yT.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...yT.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(hu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!$("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async applySendEncodings(t,i){try{if(!xt().supportSetRtpSenderParameters||t.length!==i.length)return;for(let S=0;S<t.length;S++){let C=t[S],b=i[S];if(b&&b instanceof ui){var o,a,l;if(this.isVP8Simulcast(b))continue;let V={},P={};switch(b._optimizationMode){case"motion":V.degradationPreference="maintain-framerate";break;case"detail":V.degradationPreference="maintain-resolution";break;default:V.degradationPreference="balanced"}var u,f,m,_;if((o=b._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&(P.maxBitrate=1e3*((u=b._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)),ke(a=b._hints).call(a,gi.LOW_STREAM)&&((f=b._encoderConfig)!==null&&f!==void 0&&f.frameRate&&(P.maxFramerate=_o(b._encoderConfig.frameRate)),(m=b._encoderConfig)!==null&&m!==void 0&&m.scaleResolutionDownBy&&((_=b._encoderConfig)===null||_===void 0?void 0:_.scaleResolutionDownBy)>1&&(P.scaleResolutionDownBy=b._encoderConfig.scaleResolutionDownBy)),$("DSCP_TYPE")&&ou()){var v;let H=$("DSCP_TYPE");ke(v=["very-low","low","medium","high"]).call(v,H)&&(P.networkPriority=H)}let k=C.sender.getParameters(),F=(l=k.encodings)===null||l===void 0?void 0:l[0];ci()&&!F&&(V.encodings=[P]),F&&Object.assign(F,P),Object.assign(k,V),await C.sender.setParameters(k)}}}catch{I.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,i,o){let a=Oi.parse(t);return i.forEach((l,u)=>{let f=o[u],m=a.mediaDescriptions.find(_=>_.attributes.mid===f);m&&(yu(m,l),VI(m,l,this.store.codec))}),Oi.print(a)}mungReceiveAnswerSDP(t,i,o){let a=Oi.parse(t),l=a.mediaDescriptions.find(u=>u.attributes.mid===i);return l&&o===He.AUDIO&&l.media.mediaType==="audio"&&pc(l),this.useXR&&X0(a),Oi.print(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,i,o)=>{var a;(a=this.onFirstVideoDecoded)===null||a===void 0||a.call(this,t,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(t,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,t,i)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,i){if(t.length===i.length)for(let m=0;m<t.length;m++){var o,a,l,u,f;let _=t[m],v=i[m];if(v instanceof ui&&!ke(o=v._hints).call(o,gi.LOW_STREAM)&&(a=v._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((l=v._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(u=v._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((f=v._scalabilityMode)===null||f===void 0?void 0:f.numSpatialLayers)>1&&this.store.codec==="vp8"){let S={},C={high:1e3*(v._encoderConfig.bitrateMax-50),medium:5e4};S.encodings=[{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:C.high}];let b=_.sender.getParameters();await _.sender.setParameters(Object.assign(b,S))}}}async applySimulcastEncodings(t,i){if(!ci()&&t.length===i.length)for(let o=0;o<t.length;o++){let a=i[o];if(a instanceof ui&&this.isVP8Simulcast(a)){let l=t[o],u={},f={high:1e3*(a._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:f.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:f.medium,scaleResolutionDownBy:4}];let m=l.sender.getParameters();await l.sender.setParameters(Object.assign(m,u))}}}isVP8Simulcast(t){var i,o,a,l,u;return!!(t instanceof ui&&$("SIMULCAST")&&this.store.codec==="vp8"&&!ke(i=t._hints).call(i,gi.LOW_STREAM)&&(o=t._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((a=t._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)>200&&(l=t._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=t._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1)}logSDPExchange(t,i,o,a){if($("SDP_LOGGING"))return I.upload("exchanging ".concat(o," ").concat(i," SDP during NVExtentionsConnection.").concat(a,`
`),t),i==="offer"?l=>{this.logSDPExchange(l,"answer",o==="local"?"remote":"local",a)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(t);return i==null?void 0:i[0].ssrcId}setConfiguration(t){if(xt().supportPCSetConfiguration){let i=yT.resolvePCConfiguration(t);this.peerConnection.setConfiguration(i)}}},Ne(Vt.prototype,"connect",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"connect"),Vt.prototype),Ne(Vt.prototype,"updateRemoteRTPCapabilities",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"updateRemoteRTPCapabilities"),Vt.prototype),Ne(Vt.prototype,"updateRemoteConnect",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"updateRemoteConnect"),Vt.prototype),Ne(Vt.prototype,"createDataChannels",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"createDataChannels"),Vt.prototype),Ne(Vt.prototype,"receive",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"receive"),Vt.prototype),Ne(Vt.prototype,"batchReceive",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"batchReceive"),Vt.prototype),Ne(Vt.prototype,"stopReceiving",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"stopReceiving"),Vt.prototype),Ne(Vt.prototype,"muteRemote",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"muteRemote"),Vt.prototype),Ne(Vt.prototype,"unmuteRemote",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteRemote"),Vt.prototype),Ne(Vt.prototype,"muteLocal",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"muteLocal"),Vt.prototype),Ne(Vt.prototype,"unmuteLocal",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"unmuteLocal"),Vt.prototype),Ne(Vt.prototype,"close",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"close"),Vt.prototype),Ne(Vt.prototype,"updateEncoderConfig",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"updateEncoderConfig"),Vt.prototype),Ne(Vt.prototype,"updateSendParameters",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"updateSendParameters"),Vt.prototype),Ne(Vt.prototype,"replaceTrack",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"replaceTrack"),Vt.prototype),Ne(Vt.prototype,"getRemoteSSRC",[vo],Object.getOwnPropertyDescriptor(Vt.prototype,"getRemoteSSRC"),Vt.prototype),Vt);function vo(e,t,i){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,l=await a.lock("From NVExtentionsConnection.".concat(t));try{for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{l()}},i}var ti;function lB(e){var t,i,o,a=2;for(typeof Symbol<"u"&&(i=KF,o=Symbol.iterator);a--;){if(i&&(t=e[i])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new sS(t.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function sS(e){function t(i){if(Object(i)!==i)return De.reject(new TypeError(i+" is not an object."));var o=i.done;return De.resolve(i.value).then(function(a){return{value:a,done:o}})}return sS=function(i){this.s=i,this.n=i.next},sS.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?De.resolve({value:i,done:!0}):t(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?De.reject(i):t(o.apply(this.s,arguments))}},new sS(e)}let Ru=(ti=class ST extends d0{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(t,i){super(t,i),U(this,"store",void 0),U(this,"peerConnection",void 0),U(this,"cname",void 0),U(this,"mutex",new jn("DataChannelConnection-mutex")),U(this,"dataChannel",void 0),U(this,"_p2pConnection",void 0),U(this,"establishPromise",void 0),U(this,"_nvMedia",void 0),this.store=i,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(ST.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new Mie(t,i,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;let i=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(i)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,i,o,a,l,u){return this.cname=u,await this._p2pConnection.connect(t,i,o,a,l,u),await new De((f,m)=>{let _=setTimeout(()=>{this.closeSignal(),m(new se(W.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(o))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(_),void f()},this.dataChannel.onerror=v=>{this.closeSignal(),m(v)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,i){return this._p2pConnection.updateRemoteRTPCapabilities(t,i)}send(t,i,o){var a=this;return Bo(function*(){let l=yield mt(a.mutex.lock("From DataChannelConnection.send"));try{return yield*Q0(lB(a._p2pConnection.send(t,i,o)))}finally{l()}})()}async stopSending(t,i){return this._p2pConnection.stopSending(t,i)}async createDataChannels(t,i){return this._p2pConnection.createDataChannels(t,i)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,i,o,a){return this._nvMedia?(I.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,i,this.cname)):(I.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,i,o,a))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var i=this;return Bo(function*(){return yield*Q0(lB(i._p2pConnection.restartICE(t)))})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var i;(i=this._nvMedia)===null||i===void 0||i.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,i){return await this._p2pConnection.updateEncoderConfig(t,i)}async updateSendParameters(t,i){return await this._p2pConnection.updateSendParameters(t,i)}setStatsRemoteVideoIsReady(t,i){this._p2pConnection.setStatsRemoteVideoIsReady(t,i)}async replaceTrack(t,i){return await this._p2pConnection.replaceTrack(t,i)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,i,o,a){if($("SDP_LOGGING"))return I.upload("exchanging ".concat(o," ").concat(i," SDP during DataChannelConnection.").concat(a,`
`),t),i==="offer"?l=>{this.logSDPExchange(l,"answer",o==="local"?"remote":"local",a)}:void 0}static resolvePCConfiguration(t){let i={iceServers:[]};return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(om(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...ST.turnServerConfigToIceServers(t.turnServer.servers)),$("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...ST.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),$("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(t){let i=[];return t.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(hu(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!$("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var i;return(i=this.onICEConnectionStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var i;return(i=this.onConnectionStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var i;return(i=this.onDTLSTransportStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var i;return(i=this.onDTLSTransportError)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var i;return(i=this.onICETransportStateChange)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var i;return(i=this.onFirstAudioReceived)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var i;return(i=this.onFirstVideoReceived)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var i;return(i=this.onFirstAudioDecoded)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,i,o)=>{var a;return(a=this.onFirstVideoDecoded)===null||a===void 0?void 0:a.call(this,t,i,o)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var i;return(i=this.onFirstVideoDecodedTimeout)===null||i===void 0?void 0:i.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,i)=>{var o;return(o=this.onSelectedLocalCandidateChanged)===null||o===void 0?void 0:o.call(this,t,i)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,i)=>{var o;return(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0?void 0:o.call(this,t,i)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}},Ne(ti.prototype,"connect",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"connect"),ti.prototype),Ne(ti.prototype,"updateRemoteRTPCapabilities",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"updateRemoteRTPCapabilities"),ti.prototype),Ne(ti.prototype,"createDataChannels",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"createDataChannels"),ti.prototype),Ne(ti.prototype,"receive",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"receive"),ti.prototype),Ne(ti.prototype,"stopReceiving",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"stopReceiving"),ti.prototype),Ne(ti.prototype,"muteRemote",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"muteRemote"),ti.prototype),Ne(ti.prototype,"unmuteRemote",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteRemote"),ti.prototype),Ne(ti.prototype,"muteLocal",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"muteLocal"),ti.prototype),Ne(ti.prototype,"unmuteLocal",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteLocal"),ti.prototype),Ne(ti.prototype,"close",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"close"),ti.prototype),Ne(ti.prototype,"updateEncoderConfig",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"updateEncoderConfig"),ti.prototype),Ne(ti.prototype,"updateSendParameters",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"updateSendParameters"),ti.prototype),Ne(ti.prototype,"replaceTrack",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"replaceTrack"),ti.prototype),Ne(ti.prototype,"getRemoteSSRC",[Es],Object.getOwnPropertyDescriptor(ti.prototype,"getRemoteSSRC"),ti.prototype),ti);function Es(e,t,i){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,l=await a.lock("From DataChannelConnection.".concat(t));try{for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{l()}},i}var _t;function dB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function cl(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?dB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function uB(e){var t,i,o,a=2;for(typeof Symbol<"u"&&(i=KF,o=Symbol.iterator);a--;){if(i&&(t=e[i])!=null)return t.call(e);if(o&&(t=e[o])!=null)return new aS(t.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function aS(e){function t(i){if(Object(i)!==i)return De.reject(new TypeError(i+" is not an object."));var o=i.done;return De.resolve(i.value).then(function(a){return{value:a,done:o}})}return aS=function(i){this.s=i,this.n=i.next},aS.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?De.resolve({value:i,done:!0}):t(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?De.reject(i):t(o.apply(this.s,arguments))}},new aS(e)}let cS=(_t=class extends Ii{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(et.StateChange,t,this._state)}constructor(e,t){super(),U(this,"store",void 0),U(this,"statsUploader",void 0),U(this,"connection",void 0),U(this,"localTrackMap",new Map),U(this,"remoteUserMap",new Map),U(this,"localDataChannels",[]),U(this,"remoteDataChannelMap",new Map),U(this,"pendingLocalTracks",[]),U(this,"pendingRemoteTracks",[]),U(this,"pendingLocalDataChannels",[]),U(this,"pendingRemoteDataChannels",[]),U(this,"statsCollector",void 0),U(this,"isPlanB",!1),U(this,"shouldForwardP2PCreation",void 0),U(this,"iceFailedCount",0),U(this,"dtlsFailedCount",0),U(this,"mutex",new jn("P2PChannel-mutex")),U(this,"_state",ei.Disconnected),U(this,"_pcStatsUploadType",$("NEW_ICE_RESTART")?Yl.FIRST_CONNECTION:Yl.OLD_FIRST_CONNECTION),U(this,"_isInRestartIce",!1),U(this,"_isStartRestartIce",!1),U(this,"_restartStates",["disconnected","failed"]),U(this,"_restartTimer",void 0),U(this,"_isFirstConnected",!0),U(this,"handleMuteLocalTrack",async(i,o,a)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ei.Connected)return void a(new fe(W.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let u=this.filterTobeMutedTracks(i);if(u.length===0)return void o();let f=u.find(_=>_[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(u.map(_=>{let[,{id:v}]=_;return v}));let m=this.createMuteMessage(u);await li(this,et.RequestMuteLocal,m),o()}catch(u){a(u)}finally{l()}}),U(this,"handleUnmuteLocalTrack",async(i,o,a)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ei.Connected)return void a(new fe(W.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let u=this.filterTobeUnmutedTracks(i);if(u.length===0)return void o();let f=u.find(_=>_[0]==="videoLowTrack");if(f){let _=f[1];if(_.track._originMediaStreamTrack.stop(),!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&xt().supportDualStreamEncoding){let v=i._mediaStreamTrack.clone();_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v}else{let v=WI(i,op(this,et.RequestLowStreamParameter));_.track._mediaStreamTrack=v,_.track._originMediaStreamTrack=v}await new De((v,S)=>{this.handleReplaceTrack(_.track,v,S,!0)})}await this.connection.unmuteLocal(u.map(_=>{let[,{id:v}]=_;return v}));let m=this.createUnmuteMessage(u);await li(this,et.RequestUnmuteLocal,m),o()}catch(u){a(u)}finally{l()}}),U(this,"handleUpdateVideoEncoder",async(i,o,a)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let u=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==ei.Connected)return void o();let{id:f,track:m}=u;await this.connection.updateSendParameters(f,m),await this.connection.updateEncoderConfig(f,m),this.emit(et.UpdateVideoEncoder,m),o()}catch(u){a(u)}finally{l()}}),U(this,"handleUpdateVideoSendParameters",async(i,o,a)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let u=this.localTrackMap.get(Te.LocalVideoTrack);if(!this.connection||!u||u.track!==i||this.state!==ei.Connected)return void o();let{id:f,track:m}=u;await this.connection.updateSendParameters(f,m),o()}catch(u){a(u)}finally{l()}}),U(this,"handleReplaceMixingTrack",async(i,o,a,l)=>{if(!this.connection||this.state!==ei.Connected)return void o();let u=HI([i]),f;I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(u.getTrackId(),"]")),typeof l=="boolean"&&l||(f=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,u),o()}catch(_){a(_)}finally{var m;(m=f)===null||m===void 0||m()}}),U(this,"handleReplaceTrack",async(i,o,a,l)=>{let u;I.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof l=="boolean"&&l||(u=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var f;let _=Array.from(this.localTrackMap.entries()).find(v=>{let[,{track:S}]=v;return i===S});if(!this.connection||!_||this.state!==ei.Connected)return void o();if(await((f=this.connection)===null||f===void 0?void 0:f.replaceTrack(i,_[1].id)),this.isPlanB){let v=_[1];v.id=i._mediaStreamTrack.id,this.localTrackMap.set(_[0],v)}if(_[0]===Te.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&xt().supportDualStreamEncoding){let v=this.localTrackMap.get(Te.LocalVideoLowTrack);if(v){let S=i._mediaStreamTrack.clone();v.track._originMediaStreamTrack.stop(),v.track._mediaStreamTrack=S,v.track._originMediaStreamTrack=S,await new De((C,b)=>{this.handleReplaceTrack(v.track,C,b,!0)})}}o()}catch(_){a(_)}finally{var m;(m=u)===null||m===void 0||m()}}),U(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),U(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),U(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),U(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),U(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new AF(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!xt().supportUnifiedPlan||$("CHROME_FORCE_PLAN_B")&&ou(),this.shouldForwardP2PCreation=$("FORWARD_P2P_CREATION")&&xt().supportPCSetConfiguration&&qb(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Ru({},this.store):this.isPlanB?new Fm({},this.store):new gc({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var i;this.state=ei.New;let o=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!o||(o&&this.connection&&(I.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new Ru(e,this.store):this.isPlanB?new Fm(e,this.store):new gc(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=$("NEW_ICE_RESTART")?Yl.FIRST_CONNECTION:Yl.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,i,o,a,l){if(!this.connection)throw new fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof Ru?this.connection.updateRemoteConnect(o):(this.store.peerConnectionStart(),await this.connection.connect(e,t,i,o,a,l),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ei.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(a=>{var l;let[u]=a;return ke(l=[Te.LocalVideoLowTrack,Te.LocalVideoTrack]).call(l,u)}),i=t.map(a=>{let[,{id:l}]=a;return l}),o=t.map(a=>{let[l]=a;return l});if(this.connection instanceof gc){if(Ge.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ke(e).call(e,this.store.codec)){let a=["vp9","vp8","h264"].find(l=>ke(e).call(e,l));a&&(this.store.codec=a,I.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(a,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async preConnect(e,t,i,o,a,l){if(!this.connection)throw new fe(W.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();let u=await this.connection.connect(e,t,i,o,a,l);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ei.Connected,u}getEstablishParams(){if(this.connection instanceof Ru)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(e){if(!this.connection||this.state!==ei.Connected){if(this.state===ei.Disconnected)throw new fe(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void e.forEach(i=>{var o;ke(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)})}let t=this.filterTobePublishedDataChannels(e);t.length!==0&&(t.forEach(i=>{let o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(i=>{this.localDataChannels.push(i);let o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}))}publish(e,t,i){var o=this;return Bo(function*(){let a=yield mt(o.mutex.lock("From P2PChannel.publish"));try{if(!o.connection||o.state!==ei.Connected){if(o.state===ei.Disconnected)throw new fe(W.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);let u=e.filter(f=>o.pendingLocalTracks.indexOf(f)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(u))}o.store.pubId=o.store.pubId+1,pr.markPublishStart(o.store.clientId,o.store.pubId);let l=o.filterTobePublishedTracks(e,t,i);if(l.length===0)return void(yield mt(o.tryToUnmuteAudio(e)));yield*Q0(uB(o.doPublish(o.connection,l)))}finally{a()}})()}doPublish(e,t){var i=this;return Bo(function*(){t.forEach(S=>{let{track:C,type:b}=S,V=Date.now();i.store.publish(C.getTrackId(),b===Te.LocalAudioTrack?"audio":"video",V)}),i.bindLocalTrackEvents(t);let o=t.map(S=>{let{track:C}=S;return C}),a=yield mt(e.send(t.map(S=>{let{track:C}=S;return C}),i.store.codec,i.store.audioCodec)),l=(yield mt(a.next())).value,u=i.createGatewayPublishMessage(t,l),f;try{f=yield u}catch(S){throw a.throw(S),(S==null?void 0:S.code)===W.WS_ABORT&&t.forEach(C=>{let{track:b}=C;i.pendingLocalTracks.indexOf(b)===-1&&i.pendingLocalTracks.push(b)}),i.unbindLocalTrackEvents(t),S}let m=i.mapPubResToRemoteConfig(u,f),_=(yield mt(a.next(m))).value,v=$("ENABLE_VIDEO_SEI");o.forEach(async S=>{let C=S.getRTCRtpTransceiver();C&&v&&(S.trackMediaType===He.VIDEO?await cie(C.sender,S):S.trackMediaType===He.AUDIO&&await async function(b){if(!xt().supportWebRTCEncodedTransform)return void I.warning("browser not support audio encoded transform");if(H0.has(b)||!b.track)return;let V={track:b.track};if(ru()){if(!b.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let k=null;try{k=b.createEncodedStreams()}catch(H){return void I.error("create audio-encoded-streams error",H&&H.message)}let F=new TransformStream({transform(H,ie){V.controller||(V.controller=ie),b.track&&b.track.id!==V.track.id&&(I.debug("audio track changed: ".concat(V.track.id," => ").concat(b.track.id)),V.track.removeEventListener("ended",P),V.track=b.track,V.track.addEventListener("ended",P)),ie.enqueue(H)}});k.readable.pipeThrough(F).pipeTo(k.writable)}else if(Pn()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let k=z0(),F=new MessageChannel;await new De(ie=>k.onmessage=oe=>{oe.data==="registered"&&ie(void 0)});let H=new RTCRtpScriptTransform(k,{name:"tx",port:F.port2},[F.port2]);b.transform=H,await new De(ie=>k.onmessage=oe=>{oe.data==="started"&&ie(void 0)}),F.port1.onmessage=ie=>{var oe;ie.data.transformed&&b.track&&((oe=b.track)===null||oe===void 0?void 0:oe.id)!==V.track.id&&(I.debug("audio track changed: ".concat(V.track.id," => ").concat(b.track.id)),V.track.removeEventListener("ended",P),V.track=b.track,V.track.addEventListener("ended",P))},V.worker=k}function P(){if(b.track){if(this.id!==b.track.id)return;b.track.removeEventListener("ended",P)}let k=H0.get(b);if(k){H0.delete(b);try{var F,H;(F=k.controller)===null||F===void 0||F.terminate(),(H=k.worker)===null||H===void 0||H.terminate()}catch(ie){I.warning(ie&&ie.message)}}}H0.set(b,V),b.track.addEventListener("ended",P)}(C.sender))}),t.forEach(S=>{let{type:C}=S;i.statsCollector.addLocalStats(C)}),i.assignLocalTracks(t,_),i.statsUploader.startUploadOutboundStats(),t.forEach(S=>{let{track:C,type:b}=S,V=Date.now();i.store.publish(C.getTrackId(),b===Te.LocalAudioTrack?"audio":"video",void 0,V)})})()}async updateVideoStreamParameter(e,t){let i=this.localTrackMap.get(t);if(!i)return;if(!(i.track instanceof ui))return I.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof gc||this.connection instanceof Fm))return I.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:o}=i,a=function(l,u){let f={};return l.height&&l.width&&(f.scaleResolutionDownBy=ER(l,u)),f.maxFramerate=l.framerate?_o(l.framerate):void 0,f.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,f}(e,o);if(o._encoderConfig||(o._encoderConfig={}),t!==Te.LocalVideoLowTrack||!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&xt().supportDualStreamEncoding)a.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=a.scaleResolutionDownBy);else{let l=o._originMediaStreamTrack;if(!l.canvas)return I.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(u,f){let m=u.canvas;f.width&&(m.width=_o(f.width)),f.height&&(m.height=_o(f.height)),f.framerate&&(m.stopCapture&&m.stopCapture(),m.stopCapture=wI(()=>{!m.startCapture&&m.stopCapture&&m.stopCapture(),m.startCapture&&m.startCapture()},_o(f.framerate)))})(l,e)}a.maxBitrate!=null&&(o._encoderConfig.bitrateMax=a.maxBitrate/1e3),a.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=a.maxFramerate:o._encoderConfig.frameRate={max:a.maxFramerate}),I.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var t=this;return Bo(function*(){if(!t.connection||t.state!==ei.Connected)return;let i=yield mt(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let a=t.localTrackMap.get(Te.LocalVideoTrack);if(!a)throw new fe(W.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Te.LocalVideoLowTrack))throw new fe(W.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let l=[{track:t.getLowVideoTrack(a.track,e),type:Te.LocalVideoLowTrack}];if(yield*Q0(uB(t.doPublish(t.connection,l))),a.track.muted||!a.track.enabled){var o;let u=(o=t.localTrackMap.get(Te.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;u!==void 0&&(yield mt(t.connection.muteLocal([u])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(I.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await dn(this,et.RequestRePublish,this.pendingLocalTracks),this.emit(et.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(I.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await dn(this,et.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:i,kind:o}=this.pendingRemoteTracks[t];(o!==He.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==He.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await dn(this,et.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:i}of this.pendingRemoteTracks)await this.subscribe(t,i,i===He.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:i}=t;this.emit(et.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ei.Connected)return void e.forEach(o=>{let a=this.pendingLocalTracks.indexOf(o);a!==-1&&this.pendingLocalTracks.splice(a,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let i=t.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==ei.Connected)return void e.forEach(i=>{let o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(i=>{let o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ei.Connected)return;let e=this.localTrackMap.get(Te.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Te.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let i=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(o=>{let[,{id:a}]=o;return a})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(o=>{let[a,{track:l}]=o;return{type:a,track:l}})),t.forEach(o=>{let[a]=o;this.statsCollector.removeLocalStats(a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,t){if(!this.connection||this.state!==ei.Connected)throw new fe(W.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=t.filter(o=>{var a;return!((a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var a;this.remoteDataChannelMap.has(e)?(a=this.remoteDataChannelMap.get(e))===null||a===void 0||a.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));let l=this.pendingRemoteDataChannels.findIndex(u=>{let{user:f,id:m}=u;return f.uid===e.uid&&m===o.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),i.map(o=>o.id)}async subscribe(e,t,i,o,a){var l;if(!this.connection||this.state!==ei.Connected)throw new fe(W.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(t))return;let u,f,m;if(a){let S=a.find(b=>{let{stream_type:V}=b;return V===t});if(!S)throw new fe(W.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let C=await this.connection.receive(t,S.ssrcs,String(e._uintid),S.attributes);this.connection instanceof gc&&(m=C.transceiver),u=C.track,f=C.id}else{let S=await this.connection.receive(t,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof gc&&(m=S.transceiver),u=S.track,f=S.id}t===He.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Um(u,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Mm(u,e.uid,e._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack)),$("ENABLE_VIDEO_SEI")&&m&&(t==He.VIDEO?await lie(m.receiver,{onSei:S=>{var C;(C=e._videoTrack)===null||C===void 0||C._onSei(S)}}):t==He.AUDIO&&await async function(S){if(!xt().supportWebRTCEncodedTransform)return void I.warning("browser not support audio encoded transform");if(G0.has(S))return;let C={track:S.track};if(ru()){if(!S.createEncodedStreams)return void I.warning("browser not support createEncodedStreams() API");let V=null;try{V=S.createEncodedStreams()}catch(k){return void I.error("create audio-encoded-streams error",k&&k.message)}let P=new TransformStream({transform(k,F){C.controller||(C.controller=F),S.track&&S.track.id!==C.track.id&&(I.debug("audio track changed: ".concat(C.track.id," => ").concat(S.track.id)),C.track.removeEventListener("ended",b),C.track=S.track,C.track.addEventListener("ended",b)),F.enqueue(k)}});V.readable.pipeThrough(P).pipeTo(V.writable)}else if(Pn()){if(typeof RTCRtpScriptTransform>"u")return void I.warning("browser not support RTCRtpScriptTransform");let V=z0(),P=new MessageChannel;await new De(F=>V.onmessage=H=>{H.data==="registered"&&F(void 0)});let k=new RTCRtpScriptTransform(V,{name:"rx",port:P.port2},[P.port2]);S.transform=k,await new De(F=>V.onmessage=H=>{H.data==="started"&&F(void 0)}),P.port1.onmessage=F=>{var H;F.data.transformed&&S.track&&((H=S.track)===null||H===void 0?void 0:H.id)!==C.track.id&&(I.debug("audio track changed: ".concat(C.track.id," => ").concat(S.track.id)),C.track.removeEventListener("ended",b),C.track=S.track,C.track.addEventListener("ended",b))},C.worker=V}function b(){S.track.removeEventListener("ended",b),function(V){let P=G0.get(V);if(P){G0.delete(V);try{var k,F;(k=P.controller)===null||k===void 0||k.terminate(),(F=P.worker)===null||F===void 0||F.terminate()}catch(H){I.warning(H&&H.message)}}}(S)}G0.set(S,C),S.track.addEventListener("ended",b)}(m.receiver));let _=this.remoteUserMap.get(e);_?_.set(t,f):this.remoteUserMap.set(e,new Map([[t,f]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let v=this.pendingRemoteTracks.findIndex(S=>{let{user:C,kind:b}=S;return C.uid===e.uid&&t===b});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(et.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ei.Connected)throw new fe(W.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var o;let{user:a,mediaType:l}=i;return!((o=this.remoteUserMap.get(a))!==null&&o!==void 0&&o.has(l))});let t=await this.connection.batchReceive(e.map(i=>{let{user:o,mediaType:a,ssrcId:l,rtxSsrcId:u}=i;return{kind:a,ssrcMsg:[{ssrcId:l,rtx:u}],mslabel:String(o._uintid)}}));e.forEach((i,o)=>{let{user:a,mediaType:l}=i,{track:u,id:f,transceiver:m}=t[o];l===He.AUDIO?(a._audioTrack?a._audioTrack._updateOriginMediaStreamTrack(u):(a._audioTrack=new Um(u,a.uid,a._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(a._audioTrack.getTrackId()))),m&&a._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(a,a._audioTrack)):(a._videoTrack?a._videoTrack._updateOriginMediaStreamTrack(u):(a._videoTrack=new Mm(u,a.uid,a._uintid,this.store),I.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(a._videoTrack.getTrackId()))),m&&a._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(a,a._videoTrack));let _=this.remoteUserMap.get(a);_?_.set(l,f):this.remoteUserMap.set(a,new Map([[l,f]])),this.statsCollector.addRemoteStats(a.uid),this.statsUploader.startUploadInboundStats();let v=this.pendingRemoteTracks.findIndex(S=>{let{user:C,kind:b}=S;return C.uid===a.uid&&l===b});v!==-1&&(this.pendingRemoteTracks.splice(v,1),this.emit(et.MediaReconnectEnd,a.uid))})}async unsubscribe(e,t,i){let o=this.pendingRemoteTracks.filter(u=>{let{user:f,kind:m}=u;return t!==void 0?f.uid===e.uid&&t===m:f.uid===e.uid});if(o.forEach(u=>{let f=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(f,1)}),this.connection&&this.state===ei.Connected||i||o.forEach(u=>{let{kind:f}=u;var m;if(f===He.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(f===He.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==ei.Connected)return;let a=this.filterTobeUnSubscribedTracks(e,t);if(a.length===0)return;await this.connection.stopReceiving(a.map(u=>{let[,{id:f}]=u;return f}));let l=this.createUnsubscribeMessage(a);return this.withdrawRemoteTracks(a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),a.forEach(u=>{let[f,{kind:m}]=u;var _,v;if(m===He.VIDEO&&f._videoSSRC&&((_=this.connection)===null||_===void 0||_.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),m===He.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),i||((v=f._videoTrack)===null||v===void 0||v._destroy(),f._videoTrack=void 0);else if(m===He.AUDIO){var S;this.unbindRemoteTrackEvents(f._audioTrack),!i&&((S=f._audioTrack)===null||S===void 0||S._destroy(),f._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,t){if(t.forEach(a=>{let l=this.pendingRemoteDataChannels.findIndex(u=>u.id===a.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,t);if(i.length===0)return;t.forEach(a=>{a._close()});let o=this.remoteDataChannelMap.get(e);return i.forEach(a=>{o&&o.delete(a.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(a=>a.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:a,mediaType:l}of e){let u=this.pendingRemoteTracks.filter(f=>{let{user:m,kind:_}=f;return l!==void 0?m.uid===a.uid&&l===_:m.uid===a.uid});u.forEach(f=>{let m=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(m,1)}),t=t.concat(u)}if(!this.connection||this.state!==ei.Connected)return void t.forEach(a=>{let{user:l,kind:u}=a;var f;if(u===He.AUDIO)(f=l._audioTrack)===null||f===void 0||f._destroy(),l._audioTrack=void 0;else if(u===He.VIDEO){var m;(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0}});let i=fo(e).call(e,(a,l)=>{let{user:u,mediaType:f}=l,m=this.filterTobeUnSubscribedTracks(u,f);return a.concat(m)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(a=>{let[,{id:l}]=a;return l}));let o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(a=>{let[l,{kind:u}]=a;var f,m;if(u===He.VIDEO&&l._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===He.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0;else if(u===He.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),(_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0}}),o}async muteRemote(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(t))return void I.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let o=t===He.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(t)||I.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Te.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Sn){let i=t.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[a]=o;return a!==Te.LocalAudioTrack}).filter(o=>{let[a]=o;return!(e&&a===Te.LocalVideoLowTrack)}).map(o=>{let[,{track:a}]=o;return a}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===Te.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,i,o,a){if(e){let u=this.localTrackMap.get(Te.LocalAudioTrack),f=o?this.localTrackMap.get(Te.LocalVideoLowTrack):this.localTrackMap.get(Te.LocalVideoTrack);Ge.publish(this.store.sessionId,{eventElapse:pr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.track.getTrackLabel(),videoName:f==null?void 0:f.track.getTrackLabel(),screenshare:(f==null?void 0:f.track._hints.indexOf(gi.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}else{var l;i||(i=[]);let u=i.find(m=>m instanceof Bi),f=o?(l=this.localTrackMap.get(Te.LocalVideoTrack))===null||l===void 0?void 0:l.track:i.find(m=>m instanceof ui);Ge.publish(this.store.sessionId,{eventElapse:pr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:u==null?void 0:u.getTrackLabel(),videoName:f==null?void 0:f.getTrackLabel(),screenshare:(f==null?void 0:f._hints.indexOf(gi.SCREEN_TRACK))!==-1,audio:!!u,video:!!f,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:a})}}reportSubscribeEvent(e,t,i,o){let a=o===He.VIDEO?i._videoSSRC:i._audioSSRC;a&&Ge.subscribe(this.store.sessionId,{succ:e,ec:t,video:o===He.VIDEO,audio:o===He.AUDIO,peerid:i.uid,subscribeRequestid:o===He.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:pr.measureFromSubscribeStart(this.store.clientId,a)})}reset(){I.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new jn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Ru({},this.store):this.isPlanB?new Fm({},this.store):new gc({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Te.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Sn){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(i=>{t.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ei.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Te.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Te.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof ui||t&&t.track instanceof Bi?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!t||i.has(t))}getRemoteMedia(e){var t;let i=Array.from(ss(t=this.remoteUserMap).call(t)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Te.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=v_(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(I.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ei.Reconnecting,$("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var i;t._videoTrack&&t._videoTrack._player&&((i=t._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new Ru({},this.store):this.isPlanB?new Fm({},this.store):new gc({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[i,{track:o}]=e;switch(i){case Te.LocalVideoTrack:ke(t=o._hints).call(t,gi.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Te.LocalAudioTrack:o instanceof Sn?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Te.LocalVideoLowTrack:}}),this.emit(et.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;Array.from(ss(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(t,o)}),this.emit(et.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,i]=e;Array.from(ss(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(t,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),I.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let i of this.pendingRemoteDataChannels){let{user:o,id:a}=i;if((e instanceof wu?e.uid:e)===o.uid&&a===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let i of this.pendingRemoteTracks){let{user:o,kind:a}=i;if((e instanceof wu?e.uid:e)===o.uid&&t===a)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return Bo(function*(){if(!t.connection||t.state!==ei.Connected||t.connection instanceof Ru)return;let i=yield mt(t.mutex.lock("From P2PChannel.restartICE")),o;try{o=yield mt(t.connection.restartICE(e));let l=yield mt(o.next());if(l.done)return;let u=l.value,f=yield u;switch(t.reportPCDisconnectedOrFailed(e),e){case Ir.TCP:t._pcStatsUploadType=Yl.TCP_RESTART;break;case Ir.RELAY:t._pcStatsUploadType=Yl.RELAY_RESTART;break;default:t._pcStatsUploadType=Yl.OLD_RESTART}t._isInRestartIce=!0,o.next(f)}catch(l){var a;(a=o)===null||a===void 0||a.throw(l)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalAudioTrack),o=e.videoSend.find(b=>b.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),a=e.audioSend.find(b=>b.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!a)return 1;let l=Vo(this,et.NeedSignalRTT),u=o?o.rttMs:void 0,f=a?a.rttMs:void 0,m=u&&f?(u+f)/2:u||f,_=(m&&l?(m+l)/2:m||l)||0,v=100*e.sendPacketLossRate*.7/50+.3*_/1500,S=v<.17?1:v<.36?2:v<.59?3:v<.1?4:5,C=t==null?void 0:t.track;if(C&&C._encoderConfig&&C._hints.indexOf(gi.SCREEN_TRACK)===-1){let b=C._encoderConfig.bitrateMax,V=e.bitrate.actualEncoded;if(b&&V){let P=(1e3*b-V)/(1e3*b);return qM[P<.15?0:P<.3?1:P<.45?2:P<.6?3:4][S]}}return S}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i,a=o._audioSSRC,l=o._videoSSRC,u=e.audioRecv.find(V=>V.ssrc===a),f=e.videoRecv.find(V=>V.ssrc===l);if(!u&&!f)return void(t+=1);let m=Vo(this,et.NeedSignalRTT),_=e.rtt,v=(_&&m?(_+m)/2:_||m)||0,S=u?u.jitterMs:void 0,C=e.recvPacketLossRate,b=.7*C*100/50+.3*v/1500;S&&(b=.6*C*100/50+.2*v/1500+.2*S/400),t+=b<.1?1:b<.17?2:b<.36?3:b<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new De((t,i)=>{this.handleMuteLocalTrack(e,t,i)})}async replaceTrack(e,t){var i;if(I.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==ei.Connected)return;let o=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return e===u});if(!o)return;let a=o[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:a}]),this.bindLocalTrackEvents([{track:t,type:a}]),o[1].track=t),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(t,o[1].id)),this.isPlanB){let l=o[1];l.id=t._mediaStreamTrack.id,this.localTrackMap.set(a,l)}if(a===Te.LocalVideoTrack&&!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&xt().supportDualStreamEncoding){let l=this.localTrackMap.get(Te.LocalVideoLowTrack);if(l){let u=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new De((f,m)=>{this.handleReplaceTrack(l.track,f,m,!0)})}}}filterTobePublishedTracks(e,t,i){let o=[],a=this.getAllTracks();e=sm(e=e.filter(m=>a.indexOf(m)===-1));let l,u=!1,f=this.localTrackMap.get(Te.LocalAudioTrack);for(let m of e){if(m instanceof ui&&(this.localTrackMap.has(Te.LocalVideoTrack)||u?new fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:m,type:Te.LocalVideoTrack}),u=!0),t)){let _=this.getLowVideoTrack(m,i);o.push({track:_,type:Te.LocalVideoLowTrack})}if(m instanceof Bi)if(f){let _=f.track;if(_ instanceof Sn)zI([m]),_.addAudioTrack(m),this.bindLocalAudioTrackEvents(m,!0);else{let v=HI([_,m]);I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(v.getTrackId(),"]")),this.replaceTrack(_,v)}}else l instanceof Sn?(zI([m]),l.addAudioTrack(m)):l||!m._useAudioElement&&xt().webAudioMediaStreamDest&&!m._bypassWebAudio?l=HI(l?[m,l]:[m]):l=m}return l&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),o.push({track:l,type:Te.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){let t=[],i=this.getAllTracks();e=sm(e=e.filter(o=>i.indexOf(o)!==-1));for(let o of e){if(o instanceof Bi){let a=this.localTrackMap.get(Te.LocalAudioTrack);if(!a)continue;a.track instanceof Sn?(a.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),a.track.trackList.length===0&&(t.push([Te.LocalAudioTrack,a]),a.track.close())):t.push([Te.LocalAudioTrack,a])}if(o instanceof ui){let a=this.localTrackMap.get(Te.LocalVideoTrack);if(!a)continue;t.push([Te.LocalVideoTrack,a]);let l=this.localTrackMap.get(Te.LocalVideoLowTrack);l&&t.push([Te.LocalVideoLowTrack,l])}}return t}filterTobePublishedDataChannels(e){return e=(e=sm(e)).filter(t=>this.localDataChannels.findIndex(i=>i.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=sm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:i,type:o}=t;switch(o){case Te.LocalVideoTrack:i.addListener(Ve.GET_STATS,this.handleGetLocalVideoStats),i.addListener(Ve.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Sn?e.trackList.forEach(i=>{i.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),i.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Ve.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[i,{track:o}]=t;return{track:o,type:i}})),e.forEach(t=>{let{track:i,type:o}=t;switch(o){case Te.LocalVideoTrack:i.off(Ve.GET_STATS,this.handleGetLocalVideoStats),i.off(Ve.GET_RTC_STATS,this.handleGetRTCStats),i.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(Ve.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(Ve.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Te.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case Te.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Sn?e.trackList.forEach(t=>{t.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Ve.GET_STATS,this.handleGetLocalAudioStats),t.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Ve.GET_STATS,this.handleGetLocalAudioStats),e.off(Ve.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Ve.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Ve.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Ve.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Ve.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Mm&&t.addListener(Ve.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),t instanceof Um&&t.addListener(Ve.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Ve.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,i]=e;i.has(He.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),i.has(He.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((i,o)=>{var a;let l,u,{track:f,type:m}=i;switch(m){case Te.LocalAudioTrack:l=Xt.Audio,u={dtx:f instanceof W0&&f._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Te.LocalVideoTrack:l=ke(a=f._hints).call(a,gi.SCREEN_TRACK)?Xt.Screen:Xt.High,u=cl(cl({},h2(f)),{},{codec:this.store.codec});break;case Te.LocalVideoLowTrack:l=Xt.Low,u=cl(cl({},h2(f)),{},{codec:this.store.codec})}return{stream_type:l,attributes:u,ssrcs:t[o]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:f}]=t;switch(a){case Te.LocalVideoTrack:o=ke(i=l._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoLowTrack:o=Xt.Low}return{stream_type:o,ssrcs:u,mid:f}})}assignLocalTracks(e,t){e.forEach((i,o)=>{let{track:a,type:l}=i;this.localTrackMap.set(l,{track:a,id:t[o].id,ssrcs:t[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[i]=t;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(et.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),$("NEW_ICE_RESTART")){var i;if(ke(i=this._restartStates).call(i,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let o=u=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(I.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(u)),Vo(this,et.QueryClientConnectionState)==="CONNECTED"&&this.emit(et.RequestRestartICE,u))},a=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),I.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},l=$("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if($("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&xt().supportPCSetConfiguration)o(Ir.RELAY),this._restartTimer=window.setTimeout(a,l);else if(ci())o(Ir.UDP),this._restartTimer=window.setTimeout(a,4e3);else{if(o(Ir.TCP),xt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{o(Ir.RELAY),this._restartTimer=window.setTimeout(a,l)},l));this._restartTimer=window.setTimeout(a,l)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&$("ICE_RESTART")&&Vo(this,et.QueryClientConnectionState)==="CONNECTED"&&this.emit(et.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(I.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(et.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),Ge.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Ui.TRACER}).onSuccess(),this.emit(et.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var i;let o=Array.from(ss(i=this.remoteUserMap).call(i)).find(l=>l._audioSSRC===t);var a;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(a=o.audioTrack)===null||a===void 0||a.emit(xm.FIRST_FRAME_DECODED),Ge.firstRemoteFrame(this.store.sessionId,Vn.FIRST_AUDIO_DECODE,Di.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var i;let o=Array.from(ss(i=this.remoteUserMap).call(i)).find(a=>a._audioSSRC===t);o&&Ge.firstRemoteFrame(this.store.sessionId,Vn.FIRST_AUDIO_RECEIVED,Di.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,i,o)=>{this.reportVideoFirstFrameDecoded(t,i,o)},e.onFirstVideoReceived=t=>{var i;let o=Array.from(ss(i=this.remoteUserMap).call(i)).find(a=>a._videoSSRC===t);o&&Ge.firstRemoteFrame(this.store.sessionId,Vn.FIRST_VIDEO_RECEIVED,Di.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,i)=>{let o=t.candidateType==="relay",a=i.candidateType==="relay";i.candidateType!=="unknown"&&o===a||this.emit(et.ConnectionTypeChange,o),I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(pu(i))," -> ").concat(JSON.stringify(pu(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,i)=>{I.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(pu(i))," -> ").concat(JSON.stringify(pu(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return cl(cl({},t),i)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let i=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Bi&&(i==null?void 0:i.track)instanceof Sn)return i.track.isActive||t.push([Te.LocalAudioTrack,i]),t;let o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o&&(t.push(o),o[0]===Te.LocalVideoTrack)){let a=this.localTrackMap.get(Te.LocalVideoLowTrack);a&&t.push([Te.LocalVideoLowTrack,a])}return t}filterTobeUnmutedTracks(e){let t=[],i=this.localTrackMap.get(Te.LocalAudioTrack);if(e instanceof Bi&&(i==null?void 0:i.track)instanceof Sn)return i.track.isActive&&t.push([Te.LocalAudioTrack,i]),t;let o=Array.from(this.localTrackMap.entries()).find(a=>{let[,{track:l}]=a;return e===l});if(o)if(o[0]===Te.LocalVideoTrack){t.push(o);let a=this.localTrackMap.get(Te.LocalVideoLowTrack);a&&t.push([Te.LocalVideoLowTrack,a])}else t.push(o);return t}createMuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:f}]=t;switch(a){case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoTrack:o=ke(i=l._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalVideoLowTrack:o=Xt.Low}return{stream_type:o,ssrcs:u,mid:f}})}createUnmuteMessage(e){return e.map(t=>{var i;let o,[a,{track:l,ssrcs:u,id:f}]=t;switch(a){case Te.LocalAudioTrack:o=Xt.Audio;break;case Te.LocalVideoTrack:o=ke(i=l._hints).call(i,gi.SCREEN_TRACK)?Xt.Screen:Xt.High;break;case Te.LocalVideoLowTrack:o=Xt.Low}return{stream_type:o,ssrcs:u,mid:f}})}filterTobeUnSubscribedTracks(e,t){let i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(t){let a=o.get(t);if(!a)return i;i.push([e,{kind:t,id:a}])}else Array.from(o.entries()).forEach(a=>{let[l,u]=a;i.push([e,{kind:l,id:u}])});return i}filterTobeUnSubscribedDataChannels(e,t){let i=[];return t.forEach(o=>{var a;(a=this.remoteDataChannelMap.get(e))!==null&&a!==void 0&&a.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){let t=[];return e.forEach(i=>{let[o,{kind:a,id:l}]=i;switch(a){case He.VIDEO:return void(o._videoSSRC&&t.push({stream_type:He.VIDEO,ssrcId:o._videoSSRC}));case He.AUDIO:return void(o._audioSSRC&&t.push({stream_type:He.AUDIO,ssrcId:o._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(i=>{let[o,{kind:a}]=i;if(t.has(o)){let l=t.get(o);a===He.VIDEO?l|=xn.Video:l|=xn.Audio,t.set(o,l)}else a===He.VIDEO?t.set(o,xn.Video):t.set(o,xn.Audio)}),{users:Array.from(t.entries()).map(i=>{let[o,a]=i;return{stream_id:o.uid,stream_type:a}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[i,{kind:o}]=t,a=this.remoteUserMap.get(i);a&&(a.delete(o),Array.from(a.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Te.LocalVideoTrack),i=this.localTrackMap.get(Te.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((i,o)=>{var a;let{stream_type:l}=i;return(a=t.find(u=>{let{stream_type:f}=u;return l===f}))===null||a===void 0?void 0:a.attributes})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Bi){var t;let o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(o.map(l=>{let[,{id:u}]=l;return u})));let a=this.createUnmuteMessage(o);return void await li(this,et.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(et.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(et.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Nn(t0(this.dtlsFailedCount,nn)),this.emit(et.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await dn(this,et.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(et.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Te.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof ui)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof ui).length>1)throw new fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof Bi).length>1&&(e.some(t=>t instanceof Bi&&t._bypassWebAudio)||!xt().webAudioMediaStreamDest))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof ui&&this.pendingLocalTracks.some(i=>i instanceof ui))throw new fe(W.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Bi&&this.pendingLocalTracks.some(i=>i instanceof Bi)&&(!xt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Bi&&i._bypassWebAudio)))throw new fe(W.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let i=!$("DISABLE_DUAL_STREAM_USE_ENCODING")&&xt().supportDualStreamEncoding,o=cl(cl({},{width:160,height:120,framerate:15,bitrate:50}),t),a;a=i?e._mediaStreamTrack.clone():WI(e,o);let l=di(8,"track-low-"),u=new ui(a,cl(cl({},i&&{scaleResolutionDownBy:ER(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return u.on(Sp.TRANSCEIVER_UPDATED,f=>{e._updateRtpTransceiver(f,Pm.LOW_STREAM)}),u._hints.push(gi.LOW_STREAM),e.on("sei-to-send",f=>{u.emit("sei-to-send",f)}),e.addListener(Ve.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof gc){var a,l,u,f;let m=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_,dtlsTransportState:v,peerConnectionState:S}=this.connection,{local:C,remote:b}=await this.connection.getSelectedCandidatePair();Ge.pcStats(this.store.sessionId,{startTime:m,eventElapse:e-m||0,iceconnectionsate:_,dtlsstate:v,connectionstate:S,intSucc:t?1:2,error:o,selectedLocalCandidateProtocol:(a=C==null?void 0:C.protocol)!==null&&a!==void 0?a:"",selectedLocalCandidateType:(l=C.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(C.address,":").concat(C.port),selectedRemoteCandidateProtocol:(u=b.protocol)!==null&&u!==void 0?u:"",selectedRemoteCandidateType:(f=b.candidateType)!==null&&f!==void 0?f:"",selectedRemoteCandidateAddress:"".concat(b.address,":").concat(b.port),restartCnt:i})}}reportVideoFirstFrameDecoded(e,t,i,o){var a;let l=Array.from(ss(a=this.remoteUserMap).call(a)).find(u=>u._videoSSRC===e);if(l){o||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());let u=this.store.keyMetrics,f=u.subscribe.find(m=>m.userId===l.uid&&m.type==="video");Ge.firstRemoteVideoDecode(this.store.sessionId,Vn.FIRST_VIDEO_DECODE,Di.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:t,videoheight:i,subscribeElapse:pr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:u.requestAPEnd||0,apStart:u.requestAPStart||0,joinGwEnd:u.joinGatewayEnd||0,joinGwStart:u.joinGatewayStart||0,pcEnd:u.peerConnectionEnd||0,pcStart:u.peerConnectionStart||0,subscriberEnd:(f==null?void 0:f.subscribeEnd)||0,subscriberStart:(f==null?void 0:f.subscribeStart)||0,videoAddNotify:(f==null?void 0:f.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,t,i){if(!this.connection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let a=o.get(t);if(!a)return!1;let l=await this.connection.getRemoteSSRC(a);return l!==void 0&&l!==i}resetConnection(e){I.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===ei.Connected?(I.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===i2.datachannel?new Ru({},this.store):this.isPlanB?new Fm({},this.store):new gc({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:i}]=e;t===Te.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Pm.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof gc&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Yl.TCP_RESTART&&e===Ir.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Yl.DISCONNECTED_OR_FAILED)))}},Ne(_t.prototype,"startP2PConnection",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"startP2PConnection"),_t.prototype),Ne(_t.prototype,"connect",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"connect"),_t.prototype),Ne(_t.prototype,"updateRemoteRTPCapabilities",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"updateRemoteRTPCapabilities"),_t.prototype),Ne(_t.prototype,"preConnect",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"preConnect"),_t.prototype),Ne(_t.prototype,"publishDataChannel",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"publishDataChannel"),_t.prototype),Ne(_t.prototype,"unpublish",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"unpublish"),_t.prototype),Ne(_t.prototype,"unpublishDataChannel",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"unpublishDataChannel"),_t.prototype),Ne(_t.prototype,"unpublishLowStream",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"unpublishLowStream"),_t.prototype),Ne(_t.prototype,"subscribeDataChannel",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"subscribeDataChannel"),_t.prototype),Ne(_t.prototype,"subscribe",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"subscribe"),_t.prototype),Ne(_t.prototype,"massSubscribe",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"massSubscribe"),_t.prototype),Ne(_t.prototype,"unsubscribe",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"unsubscribe"),_t.prototype),Ne(_t.prototype,"unsubscribeDataChannel",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"unsubscribeDataChannel"),_t.prototype),Ne(_t.prototype,"massUnsubscribe",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"massUnsubscribe"),_t.prototype),Ne(_t.prototype,"muteRemote",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"muteRemote"),_t.prototype),Ne(_t.prototype,"unmuteRemote",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"unmuteRemote"),_t.prototype),Ne(_t.prototype,"hasRemoteMediaWithLock",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"hasRemoteMediaWithLock"),_t.prototype),Ne(_t.prototype,"disconnectForReconnect",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"disconnectForReconnect"),_t.prototype),Ne(_t.prototype,"updateBitrateLimit",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"updateBitrateLimit"),_t.prototype),Ne(_t.prototype,"remoteMediaSsrcChanged",[yr],Object.getOwnPropertyDescriptor(_t.prototype,"remoteMediaSsrcChanged"),_t.prototype),_t);function yr(e,t,i){let o=e[t];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let a=this.mutex,l=await a.lock("From P2PChannel.".concat(t));try{for(var u=arguments.length,f=new Array(u),m=0;m<u;m++)f[m]=arguments[m];return await o.apply(this,f)}finally{l()}},i}function Uie(e){let t=fB();return function(i,o){let a=i.appId;a!==void 0&&(ii(o,10),ll(o,a));let l=i.cid;l!==void 0&&(ii(o,16),ii(o,l));let u=i.cname;u!==void 0&&(ii(o,26),ll(o,u));let f=i.deviceId;f!==void 0&&(ii(o,34),ll(o,f));let m=i.elapse;m!==void 0&&(ii(o,40),Iu(o,m));let _=i.fileSize;_!==void 0&&(ii(o,48),Iu(o,Wm(_)));let v=i.height;v!==void 0&&(ii(o,56),Iu(o,Wm(v)));let S=i.jpg;S!==void 0&&(ii(o,66),ii(o,S.length),function(Aa,_e){let xe=zm(Aa,_e.length);Aa.bytes.set(_e,xe)}(o,S));let C=i.networkType;C!==void 0&&(ii(o,72),Iu(o,Wm(C)));let b=i.osType;b!==void 0&&(ii(o,80),Iu(o,Wm(b)));let V=i.requestId;V!==void 0&&(ii(o,90),ll(o,V));let P=i.sdkVersion;P!==void 0&&(ii(o,98),ll(o,P));let k=i.sequence;k!==void 0&&(ii(o,104),Iu(o,Wm(k)));let F=i.sid;F!==void 0&&(ii(o,114),ll(o,F));let H=i.timestamp;H!==void 0&&(ii(o,120),Iu(o,H));let ie=i.uid;ie!==void 0&&(ii(o,128),ii(o,ie));let oe=i.vid;oe!==void 0&&(ii(o,136),ii(o,oe));let ae=i.width;ae!==void 0&&(ii(o,144),Iu(o,Wm(ae)));let he=i.service;he!==void 0&&(ii(o,152),ii(o,he));let Ee=i.callbackData;Ee!==void 0&&(ii(o,162),ll(o,Ee));let ye=i.jpgEncryption;ye!==void 0&&(ii(o,168),ii(o,ye));let Ce=i.requestType;Ce!==void 0&&(ii(o,176),ii(o,Ce));let ze=i.scorePorn;ze!==void 0&&(ii(o,185),ZI(o,ze));let It=i.scoreSexy;It!==void 0&&(ii(o,193),ZI(o,It));let Kt=i.scoreNeutral;Kt!==void 0&&(ii(o,201),ZI(o,Kt));let _i=i.scene;_i!==void 0&&(ii(o,208),ii(o,_i));let sn=i.ossFilePrefix;sn!==void 0&&(ii(o,218),ll(o,sn));let Li=i.serviceVendor;if(Li!==void 0)for(let Aa of Li){ii(o,226);let _e=fB();Fie(Aa,_e),ii(o,_e.limit),Hie(o,_e),zie(_e)}}(e,t),function(i){let o=i.bytes,a=i.limit;return o.length===a?o:o.subarray(0,a)}(t)}function jie(e){return function(i){let o={};e:for(;!mB(i);){let a=dl(i);switch(a>>>3){case 0:break e;case 1:o.code=dl(i);break;case 2:o.msg=gB(i,dl(i));break;case 3:{let l=Bie(i);o.data=Vie(i),i.limit=l;break}default:hB(i,7&a)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function Vie(e){let t={};e:for(;!mB(e);){let i=dl(e);switch(i>>>3){case 0:break e;case 1:t.requestId=gB(e,dl(e));break;case 2:t.requestType=dl(e)>>>0;break;case 3:t.scorePorn=JI(e);break;case 4:t.scoreSexy=JI(e);break;case 5:t.scoreNeutral=JI(e);break;case 6:t.requestScene=dl(e)>>>0;break;case 7:t.scene=dl(e)>>>0;break;default:hB(e,7&i)}}return t}function Fie(e,t){let i=e.service;i!==void 0&&(ii(t,8),ii(t,i));let o=e.vendor;o!==void 0&&(ii(t,16),ii(t,o));let a=e.token;a!==void 0&&(ii(t,26),ll(t,a));let l=e.callbackUrl;l!==void 0&&(ii(t,34),ll(t,l))}function Bie(e){let t=dl(e),i=e.limit;return e.limit=e.offset+t,i}function hB(e,t){switch(t){case 0:for(;128&_B(e););break;case 2:$I(e,dl(e));break;case 5:$I(e,4);break;case 1:$I(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let Wie=new Float32Array(1);new Uint8Array(Wie.buffer);let YI=new Float64Array(1),yo=new Uint8Array(YI.buffer);function Wm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let pB=[];function fB(){let e=pB.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function zie(e){pB.push(e)}function $I(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function mB(e){return e.offset>=e.limit}function zm(e,t){let i=e.bytes,o=e.offset,a=e.limit,l=o+t;if(l>i.length){let u=new Uint8Array(2*l);u.set(i),e.bytes=u}return e.offset=l,l>a&&(e.limit=l),o}function XI(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function gB(e,t){let i=XI(e,t),o=String.fromCharCode,a=e.bytes,l="",u="";for(let f=0;f<t;f++){let m,_,v,S,C=a[f+i];128&C?(224&C)==192?f+1>=t?u+=l:(m=a[f+i+1],(192&m)!=128?u+=l:(S=(31&C)<<6|63&m,S<128?u+=l:(u+=o(S),f++))):(240&C)==224?f+2>=t?u+=l:(m=a[f+i+1],_=a[f+i+2],(49344&(m|_<<8))!=32896?u+=l:(S=(15&C)<<12|(63&m)<<6|63&_,S<2048||S>=55296&&S<=57343?u+=l:(u+=o(S),f+=2))):(248&C)==240?f+3>=t?u+=l:(m=a[f+i+1],_=a[f+i+2],v=a[f+i+3],(12632256&(m|_<<8|v<<16))!=8421504?u+=l:(S=(7&C)<<18|(63&m)<<12|(63&_)<<6|63&v,S<65536||S>1114111?u+=l:(S-=65536,u+=o(55296+(S>>10),56320+(1023&S)),f+=3))):u+=l:u+=o(C)}return u}function ll(e,t){let i=t.length,o=0;for(let u=0;u<i;u++){let f=t.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+t.charCodeAt(++u)-56613888),o+=f<128?1:f<2048?2:f<65536?3:4}ii(e,o);let a=zm(e,o),l=e.bytes;for(let u=0;u<i;u++){let f=t.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+t.charCodeAt(++u)-56613888),f<128?l[a++]=f:(f<2048?l[a++]=f>>6&31|192:(f<65536?l[a++]=f>>12&15|224:(l[a++]=f>>18&7|240,l[a++]=f>>12&63|128),l[a++]=f>>6&63|128),l[a++]=63&f|128)}}function Hie(e,t){let i=zm(e,t.limit),o=e.bytes,a=t.bytes;for(let l=0,u=t.limit;l<u;l++)o[l+i]=a[l]}function _B(e){return e.bytes[XI(e,1)]}function EB(e,t){let i=zm(e,1);e.bytes[i]=t}function JI(e){let t=XI(e,8),i=e.bytes;return yo[0]=i[t++],yo[1]=i[t++],yo[2]=i[t++],yo[3]=i[t++],yo[4]=i[t++],yo[5]=i[t++],yo[6]=i[t++],yo[7]=i[t++],YI[0]}function ZI(e,t){let i=zm(e,8),o=e.bytes;YI[0]=t,o[i++]=yo[0],o[i++]=yo[1],o[i++]=yo[2],o[i++]=yo[3],o[i++]=yo[4],o[i++]=yo[5],o[i++]=yo[6],o[i++]=yo[7]}function dl(e){let t,i=0,o=0;do t=_B(e),i<32&&(o|=(127&t)<<i),i+=7;while(128&t);return o}function ii(e,t){for(t>>>=0;t>=128;)EB(e,127&t|128),t>>>=7;EB(e,t)}function Iu(e,t){let i=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,l=a===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:a<128?9:10,u=zm(e,l),f=e.bytes;switch(l){case 10:f[u+9]=a>>>7&1;case 9:f[u+8]=l!==9?128|a:127&a;case 8:f[u+7]=l!==8?o>>>21|128:o>>>21&127;case 7:f[u+6]=l!==7?o>>>14|128:o>>>14&127;case 6:f[u+5]=l!==6?o>>>7|128:o>>>7&127;case 5:f[u+4]=l!==5?128|o:127&o;case 4:f[u+3]=l!==4?i>>>21|128:i>>>21&127;case 3:f[u+2]=l!==3?i>>>14|128:i>>>14&127;case 2:f[u+1]=l!==2?i>>>7|128:i>>>7&127;case 1:f[u]=l!==1?128|i:127&i}}function vB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}let Gie=new Map([["moderation",1],["supervise",2]]);class lS extends Ii{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(Bn.CONNECTION_STATE_CHANGE,i,t)}get inspectType(){return this._inspectType}set inspectType(t){var i;this._inspectMode=fo(i=t.map(o=>Gie.get(o)||0)).call(i,(o,a)=>o+a),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),U(this,"name","AgoraRTCVideoContentInspect"),U(this,"_connectionState",ha.CONNECTING),U(this,"_innerConnectionState",void 0),U(this,"sequence",0),U(this,"inspectStartTime",void 0),U(this,"workerManagerConnection",void 0),U(this,"workerConnection",void 0),U(this,"workerMessageLengthLimit",void 0),U(this,"inspectIntervalMinimum",void 0),U(this,"qualityRatio",void 0),U(this,"_connectInfo",void 0),U(this,"_cancelTokenSource",Qr.CancelToken.source()),U(this,"_retryConfig",void 0),U(this,"wmSequence",0),U(this,"inspectInterval",void 0),U(this,"inspectTimer",null),U(this,"ossFilePrefix",void 0),U(this,"extraInfo",void 0),U(this,"_inspectType",void 0),U(this,"_inspectMode",void 0),U(this,"_quality",1),U(this,"qualityTimer",null),U(this,"_inspectId",void 0),U(this,"_needWorkUrlOnly",!1),U(this,"inspectImage",()=>{if(this.connectionState!==ha.CONNECTED)throw new se(W.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ha.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=di(5,"inspect-"),this.workerMessageLengthLimit=$("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=$("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=$("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new W_("worker-manager-"+this._inspectId,nn),this.on(Bn.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,I.debug("[".concat(this._inspectId,"] Inspect operation :").concat(pa[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new W_("worker-"+this._inspectId,nn),this.handleWorkerEvents()}async init(t,i){this.emit(Bn.STATE_CHANGE,pa.CONNECT_AP),this._connectInfo=t;let o=this._cancelTokenSource.token;return this._retryConfig=i,new De((a,l)=>{this.on(Bn.CONNECTION_STATE_CHANGE,(u,f)=>{f===ha.CONNECTED&&a()}),this.requestAP(t,o,i).then(u=>{this.connectWorkerManager(u)}).catch(u=>{l(u)})})}async requestAP(t,i,o){let a=$("WEBCS_DOMAIN").map(f=>"https://".concat(f,"/api/v1")),l=await function(f,m,_,v){let{appId:S,areaCode:C,cname:b,sid:V,token:P,uid:k}=m;mm++;let F="image_moderation_api",H={service_name:F,json_body:JSON.stringify({appId:S,areaCode:C,cname:b,command:"allocateEdge",requestId:mm,seq:mm,sid:V,token:P,ts:Date.now(),uid:k+""})},ie,oe,ae=f[0];return oc(async()=>{ie=Date.now();let he=await lc(ae,{data:H,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(oe=Date.now()-ie,he.code!==0){let ze=new se(W.UNEXPECTED_RESPONSE,"image inspect ap error, code"+he.code,{retry:!0,responseTime:oe});throw I.error(ze.toString()),ze}let Ee=JSON.parse(he.json_body);if(Ee.code!==200){let ze=new se(W.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ee.code,", reason: ").concat(Ee.reason),{code:Ee.code,responseTime:oe});throw I.error(ze.toString()),ze}if(!Ee.servers||!Array.isArray(Ee.servers)||Ee.servers.length===0){let ze=new se(W.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ee.code,responseTime:oe});throw I.error(ze.toString()),ze}let ye=$("VIDEO_INSPECT_WORKER_MANAGER_HOST"),Ce=$("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ee.servers.map(ze=>{let{address:It,wss:Kt}=ze;if(It&&Kt)return"wss://".concat(It.replace(/\./g,"-"),".").concat(ye,":").concat(Ce||Kt)}).filter(ze=>!!ze),workerToken:Ee.workerToken,vid:Ee.vid,responseTime:oe}},(he,Ee)=>(Ge.apworkerEvent(V,{success:!0,sc:200,serviceName:F,responseDetail:JSON.stringify(he.addressList),firstSuccess:Ee===0,responseTime:oe,serverIp:f[Ee%f.length]}),!1),(he,Ee)=>(Ge.apworkerEvent(V,{success:!1,sc:he.data&&he.data.code||200,serviceName:F,responseTime:oe,serverIp:f[Ee%f.length]}),!!(he.code!==W.OPERATION_ABORTED&&he.code!==W.UNEXPECTED_RESPONSE||he.data&&he.data.retry)&&(ae=f[(Ee+1)%f.length],!0)),v)}(a,t,i,o);this.emit(Bn.STATE_CHANGE,pa.AP_CONNECTED);let{addressList:u}=l;return this.wmSequence++,u}async connectWorkerManager(t){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Bn.STATE_CHANGE,pa.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(rt.CONNECTED,async()=>{this.emit(Bn.STATE_CHANGE,pa.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(rt.CLOSED,()=>{this._innerConnectionState<pa.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(rt.FAILED,()=>{this._innerConnectionState<pa.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(rt.RECONNECTING,()=>{this._innerConnectionState<pa.GET_WORKER_MANAGER_RESPONSE&&I.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(rt.ON_MESSAGE,async t=>{this.emit(Bn.STATE_CHANGE,pa.GET_WORKER_MANAGER_RESPONSE);let i=this.workerManagerConnection.url;this.workerManagerConnection.close();let o=JSON.parse(t.data);if(o.code!==200)throw I.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new se(W.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw I.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new se(W.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{let a=$("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,l=i.replace(/:\d+\/?$/,":".concat(a));this.emit(Bn.STATE_CHANGE,pa.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(Bn.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(rt.WILL_RECONNECT,(t,i,o)=>{o(t)}),this.workerManagerConnection.on(rt.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}handleWorkerEvents(){this.workerConnection.on(rt.CONNECTED,async()=>{this.emit(Bn.STATE_CHANGE,pa.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ha.CONNECTED}),this.workerConnection.on(rt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let o=jie(new Uint8Array(t.data));if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&I.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Bn.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;let a={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},l=fo(i=Object.keys(a)).call(i,(f,m)=>a[f]>a[m]?f:m,"porn"),u=Object.keys(a).find(f=>f===l);this.emit(Bn.INSPECT_RESULT,u)}else this.emit(Bn.INSPECT_RESULT,void 0,new se(W.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Bn.INSPECT_RESULT,void 0,new se(W.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else I.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Bn.INSPECT_RESULT,void 0,new se(W.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(rt.CLOSED,()=>{this.connectionState=ha.CLOSED}),this.workerConnection.on(rt.FAILED,()=>{this.connectionState=ha.CLOSED}),this.workerConnection.on(rt.RECONNECTING,()=>{this.connectionState=this.connectionState===ha.CONNECTED?ha.RECONNECTING:ha.CONNECTING}),this.workerConnection.on(rt.WILL_RECONNECT,(t,i,o)=>{t==="recover"&&o(t),o("tryNext")}),this.workerConnection.on(rt.REQUEST_NEW_URLS,(t,i)=>{this.workerManagerConnection.close(),this.once(Bn.REQUEST_NEW_WORKER_URL,o=>{t([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;let t=Vo(this,Bn.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Bn.INSPECT_RESULT,void 0,new se(W.INVALID_OPERATION,"Only the track being played can be inspected"));let o=await this.generateRequestData(t,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Bn.INSPECT_RESULT,void 0,new se(W.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,i){let{appId:o,cname:a,cid:l,vid:u,sid:f,uid:m}=i,_=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),S=await yj(v,o,a),C=this.sequence+"-"+l+"-"+m+"-"+_+"-"+di(12,""),b={appId:o,cid:l,cname:a,deviceId:"",elapse:lS.intToLong(Number(_-this.inspectStartTime)),fileSize:S.byteLength,jpgEncryption:2,height:v.height,width:v.width,jpg:S,networkType:6,osType:7,requestId:C,sdkVersion:"4.21.0",sequence:this.sequence,sid:f,timestamp:lS.intToLong(_),uid:m,vid:u,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete b.callbackData,this.ossFilePrefix===void 0&&delete b.ossFilePrefix;let V=Uie(b);if(V.byteLength<this.workerMessageLengthLimit){if($("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let P=function(k){for(var F=1;F<arguments.length;F++){var H=arguments[F]!=null?arguments[F]:{};F%2?vB(Object(H),!0).forEach(function(ie){U(k,ie,H[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(H)):vB(Object(H)).forEach(function(ie){Object.defineProperty(k,ie,Object.getOwnPropertyDescriptor(H,ie))})}return k}({},b);delete P.jpg,I.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(P))}return V}{let P=this.quality*this.qualityRatio;return this.quality=P,await this.generateRequestData(t,{appId:o,cname:a,cid:l,vid:u,sid:f,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Qr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ha.CLOSED,this.emit(Bn.STATE_CHANGE,pa.CLOSED)}}function Kie(e){let t=function(){let i=$ie.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let a=i.appId;a!==void 0&&(on(o,10),Au(o,a));let l=i.cid;l!==void 0&&(on(o,16),on(o,l));let u=i.cname;u!==void 0&&(on(o,26),Au(o,u));let f=i.deviceId;f!==void 0&&(on(o,34),Au(o,f));let m=i.elapse;m!==void 0&&(on(o,40),Ou(o,m));let _=i.fileSize;_!==void 0&&(on(o,48),Ou(o,Hm(_)));let v=i.height;v!==void 0&&(on(o,56),Ou(o,Hm(v)));let S=i.jpg;S!==void 0&&(on(o,66),on(o,S.length),SB(o,S));let C=i.networkType;C!==void 0&&(on(o,72),Ou(o,Hm(C)));let b=i.osType;b!==void 0&&(on(o,80),Ou(o,Hm(b)));let V=i.requestId;V!==void 0&&(on(o,90),Au(o,V));let P=i.sdkVersion;P!==void 0&&(on(o,98),Au(o,P));let k=i.sequence;k!==void 0&&(on(o,104),Ou(o,Hm(k)));let F=i.sid;F!==void 0&&(on(o,114),Au(o,F));let H=i.timestamp;H!==void 0&&(on(o,120),Ou(o,H));let ie=i.uid;ie!==void 0&&(on(o,128),on(o,ie));let oe=i.vid;oe!==void 0&&(on(o,136),on(o,oe));let ae=i.width;ae!==void 0&&(on(o,144),Ou(o,Hm(ae)));let he=i.service;he!==void 0&&(on(o,152),on(o,he));let Ee=i.callbackData;Ee!==void 0&&(on(o,162),on(o,Ee.length),SB(o,Ee));let ye=i.ticket;ye!==void 0&&(on(o,170),Au(o,ye));let Ce=i.vendorConfigs;Ce!==void 0&&(on(o,178),Au(o,Ce))}(e,t),function(i){let o=i.bytes,a=i.limit;return o.length===a?o:o.subarray(0,a)}(t)}function qie(e){return function(i){let o={};e:for(;!Xie(i);){let a=CE(i);switch(a>>>3){case 0:break e;case 1:o.code=CE(i);break;case 2:o.msg=TB(i,CE(i));break;case 3:o.requestId=TB(i,CE(i));break;case 4:o.timestamp=Jie(i,!1);break;default:Yie(i,7&a)}}return o}({bytes:t=e,offset:0,limit:t.length});var t}function Yie(e,t){switch(t){case 0:for(;128&Ia(e););break;case 2:QI(e,CE(e));break;case 5:QI(e,4);break;case 1:QI(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function Hm(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let $ie=[];function QI(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Xie(e){return e.offset>=e.limit}function dS(e,t){let i=e.bytes,o=e.offset,a=e.limit,l=o+t;if(l>i.length){let u=new Uint8Array(2*l);u.set(i),e.bytes=u}return e.offset=l,l>a&&(e.limit=l),o}function yB(e,t){let i=e.offset;if(i+t>e.limit)throw new Error("Read past limit");return e.offset+=t,i}function SB(e,t){let i=dS(e,t.length);e.bytes.set(t,i)}function TB(e,t){let i=yB(e,t),o=String.fromCharCode,a=e.bytes,l="",u="";for(let f=0;f<t;f++){let m,_,v,S,C=a[f+i];128&C?(224&C)==192?f+1>=t?u+=l:(m=a[f+i+1],(192&m)!=128?u+=l:(S=(31&C)<<6|63&m,S<128?u+=l:(u+=o(S),f++))):(240&C)==224?f+2>=t?u+=l:(m=a[f+i+1],_=a[f+i+2],(49344&(m|_<<8))!=32896?u+=l:(S=(15&C)<<12|(63&m)<<6|63&_,S<2048||S>=55296&&S<=57343?u+=l:(u+=o(S),f+=2))):(248&C)==240?f+3>=t?u+=l:(m=a[f+i+1],_=a[f+i+2],v=a[f+i+3],(12632256&(m|_<<8|v<<16))!=8421504?u+=l:(S=(7&C)<<18|(63&m)<<12|(63&_)<<6|63&v,S<65536||S>1114111?u+=l:(S-=65536,u+=o(55296+(S>>10),56320+(1023&S)),f+=3))):u+=l:u+=o(C)}return u}function Au(e,t){let i=t.length,o=0;for(let u=0;u<i;u++){let f=t.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+t.charCodeAt(++u)-56613888),o+=f<128?1:f<2048?2:f<65536?3:4}on(e,o);let a=dS(e,o),l=e.bytes;for(let u=0;u<i;u++){let f=t.charCodeAt(u);f>=55296&&f<=56319&&u+1<i&&(f=(f<<10)+t.charCodeAt(++u)-56613888),f<128?l[a++]=f:(f<2048?l[a++]=f>>6&31|192:(f<65536?l[a++]=f>>12&15|224:(l[a++]=f>>18&7|240,l[a++]=f>>12&63|128),l[a++]=f>>6&63|128),l[a++]=63&f|128)}}function Ia(e){return e.bytes[yB(e,1)]}function wB(e,t){let i=dS(e,1);e.bytes[i]=t}function CE(e){let t,i=0,o=0;do t=Ia(e),i<32&&(o|=(127&t)<<i),i+=7;while(128&t);return o}function on(e,t){for(t>>>=0;t>=128;)wB(e,127&t|128),t>>>=7;wB(e,t)}function Jie(e,t){let i,o=0,a=0,l=0;return i=Ia(e),o=127&i,128&i&&(i=Ia(e),o|=(127&i)<<7,128&i&&(i=Ia(e),o|=(127&i)<<14,128&i&&(i=Ia(e),o|=(127&i)<<21,128&i&&(i=Ia(e),a=127&i,128&i&&(i=Ia(e),a|=(127&i)<<7,128&i&&(i=Ia(e),a|=(127&i)<<14,128&i&&(i=Ia(e),a|=(127&i)<<21,128&i&&(i=Ia(e),l=127&i,128&i&&(i=Ia(e),l|=(127&i)<<7))))))))),{low:o|a<<28,high:a>>>4|l<<24,unsigned:t}}function Ou(e,t){let i=t.low>>>0,o=(t.low>>>28|t.high<<4)>>>0,a=t.high>>>24,l=a===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:a<128?9:10,u=dS(e,l),f=e.bytes;switch(l){case 10:f[u+9]=a>>>7&1;case 9:f[u+8]=l!==9?128|a:127&a;case 8:f[u+7]=l!==8?o>>>21|128:o>>>21&127;case 7:f[u+6]=l!==7?o>>>14|128:o>>>14&127;case 6:f[u+5]=l!==6?o>>>7|128:o>>>7&127;case 5:f[u+4]=l!==5?128|o:127&o;case 4:f[u+3]=l!==4?i>>>21|128:i>>>21&127;case 3:f[u+2]=l!==3?i>>>14|128:i>>>14&127;case 2:f[u+1]=l!==2?i>>>7|128:i>>>7&127;case 1:f[u]=l!==1?128|i:127&i}}let CB={},bB={},uS=4294967296,Zie=uS*uS,RB=Zie/2;AB(0,!0);let IB=AB(0),Qie=bE(0,-2147483648,!1),ene=bE(-1,2147483647,!1);function AB(e,t){let i,o,a;return t?(a=0<=(e>>>=0)&&e<256)&&(o=bB[e],o)?o:(i=bE(e,0,!0),a&&(bB[e]=i),i):(a=-128<=(e|=0)&&e<128)&&(o=CB[e],o)?o:(i=bE(e,e<0?-1:0,!1),a&&(CB[e]=i),i)}function bE(e,t,i){return{low:0|e,high:0|t,unsigned:!!i}}function tne(e,t){if(isNaN(e))return IB;{if(e<=-RB)return Qie;if(e+1>=RB)return ene}return e<0?IB:bE(e%uS|0,e/uS|0,t)}function OB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}class eA extends Ii{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let i=this._connectionState;this._connectionState=t,this.emit(ac.CONNECTION_STATE_CHANGE,t,i)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var i;super(),U(this,"name","AgoraRTCImageModeration"),U(this,"_connectionState",xs.CONNECTING),U(this,"_sequence",0),U(this,"_moderationStartTime",void 0),U(this,"_workerConnection",void 0),U(this,"_workerMessageLengthLimit",void 0),U(this,"_qualityRatio",void 0),U(this,"_connectInfo",void 0),U(this,"_cancelTokenSource",Qr.CancelToken.source()),U(this,"_retryConfig",void 0),U(this,"_moderationInterval",void 0),U(this,"_moderationTimer",null),U(this,"_moderationMode",1),U(this,"_quality",1),U(this,"_qualityTimer",null),U(this,"_ticket",void 0),U(this,"_moderationIntervalMinimum",void 0),U(this,"_uploadFailedNum",0),U(this,"_uploadNum",0),U(this,"_uploadTimer",null),U(this,"_extraInfo",void 0),U(this,"_vendor",""),U(this,"_encoder",new TextEncoder),U(this,"_moderationId",void 0),U(this,"inspectImage",()=>{if(this.connectionState!==xs.CONNECTED)throw new se(W.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===xs.CONNECTED?this.requestToInspectImage():I.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=di(5,"image-moderation-"),this._workerMessageLengthLimit=$("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=$("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=$("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new W_("worker-"+this._moderationId,nn),this.on(ac.STATE_CHANGE,(o,a)=>{I.debug("[".concat(this._moderationId,"] Moderation operation :").concat(hm[o]," ").concat(a||""))}),this.handleWorkerEvents()}async init(t,i){this.emit(ac.STATE_CHANGE,hm.CONNECT_AP),this._connectInfo=t;let o=this._cancelTokenSource.token;return this._retryConfig=i,new De((a,l)=>{this.on(ac.CONNECTION_STATE_CHANGE,(u,f)=>{u===xs.CONNECTED&&a()}),this.requestAP(t,o,i).then(u=>{this.connectWorker(u)}).catch(u=>{l(u)})})}updateConfig(t){var i;this._moderationInterval=(i=t.interval)!==null&&i!==void 0?i:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),I.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===xs.CONNECTED&&this.inspectImage()}async requestAP(t,i,o){let a=$("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),l=await function(m,_,v,S){let{appId:C,areaCode:b,cname:V,sid:P,token:k,uid:F}=_;mm++;let H="moderation_plugin",ie={service_name:H,json_body:JSON.stringify({appId:C,areaCode:b,cname:V,command:"allocateEdge",requestId:mm,seq:mm,sid:P,appToken:k,ts:Date.now(),uid:F+""})},oe,ae,he=m[0];return oc(async()=>{oe=Date.now();let Ee=await lc(he,{data:ie,cancelToken:v,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ae=Date.now()-oe,Ee.code!==0){let ze=new se(W.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ee.code,{retry:!0,responseTime:ae});throw I.error(ze.toString()),ze}let ye=JSON.parse(Ee.json_body);if(ye.code!==200){let ze=new se(W.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(ye.code,", reason: ").concat(ye.reason),{code:ye.code,responseTime:ae});throw I.error(ze.toString()),ze}if(!ye.servers||!Array.isArray(ye.servers)||ye.servers.length===0){let ze=new se(W.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:ye.code,responseTime:ae});throw I.error(ze.toString()),ze}if(!ye.servers.some(ze=>!!ze.wss)){let ze=new se(W.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:ye.code,responseTime:ae});throw I.error(ze.toString()),ze}let Ce=$("IMAGE_MODERATION_WORKER_HOST");return{addressList:ye.servers.map(ze=>{let{address:It,wss:Kt}=ze;if(It&&Kt)return"wss://".concat(It.replace(/\./g,"-"),".").concat(Ce,":").concat(Kt,"/moderation")}).filter(ze=>!!ze),workerToken:ye.workerToken,vid:ye.vid,ticket:ye.appTicket,responseTime:ae}},(Ee,ye)=>(Ge.apworkerEvent(P,{success:!0,sc:200,serviceName:H,responseDetail:JSON.stringify(Ee.addressList),firstSuccess:ye===0,responseTime:ae,serverIp:m[ye%m.length]}),!1),(Ee,ye)=>(Ge.apworkerEvent(P,{success:!1,sc:Ee.data&&Ee.data.code||200,serviceName:H,responseTime:ae,serverIp:m[ye%m.length]}),!!(Ee.code!==W.OPERATION_ABORTED&&Ee.code!==W.UNEXPECTED_RESPONSE||Ee.data&&Ee.data.retry)&&(he=m[(ye+1)%m.length],!0)),S)}(a,t,i,o);this.emit(ac.STATE_CHANGE,hm.AP_CONNECTED);let{addressList:u,ticket:f}=l;return this._ticket=f,u}async connectWorker(t){this.emit(ac.STATE_CHANGE,hm.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(rt.CONNECTED,async()=>{this.emit(ac.STATE_CHANGE,hm.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=xs.CONNECTED}),this._workerConnection.on(rt.CLOSED,()=>{this.connectionState=xs.CLOSED}),this._workerConnection.on(rt.FAILED,()=>{this.connectionState=xs.CLOSED}),this._workerConnection.on(rt.RECONNECTING,()=>{this.connectionState=this.connectionState===xs.CONNECTED?xs.RECONNECTING:xs.CONNECTING}),this._workerConnection.on(rt.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let i=qie(new Uint8Array(t.data));$("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,I.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ge.reportApiInvoke(this._connectInfo.sid||null,{name:ln.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Ui.TRACER}).onError(new se(W.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},$("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else I.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(rt.WILL_RECONNECT,(t,i,o)=>{t==="recover"&&o(t),o("tryNext")}),this._workerConnection.on(rt.REQUEST_NEW_URLS,(t,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(i)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Vo(this,ac.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being played can be inspected"));this._sequence++;let o=await this.generateRequestData(t,i);this._workerConnection.sendMessage(o,!0,!0)}else $("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&I.debug("Only the track being published can be inspected")}async generateRequestData(t,i){let{appId:o,cname:a,cid:l,vid:u,sid:f,uid:m}=i,_=Date.now(),v=await t.getCurrentFrameImage("image/jpeg",this.quality),S=await yj(v,o,a),C=this._sequence+"-"+l+"-"+m+"-"+_+"-"+di(12,""),b={appId:o,cid:l,cname:a,deviceId:"",elapse:eA.intToLong(Number(_-this._moderationStartTime)),fileSize:v.buffer.byteLength,height:v.height,width:v.width,jpg:S,networkType:6,osType:7,requestId:C,sdkVersion:"4.21.0",sequence:this._sequence,sid:f,timestamp:tne(_),uid:m,vid:u,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete b.callbackData;let V=Kie(b);if(V.byteLength<this._workerMessageLengthLimit){if($("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let P=function(k){for(var F=1;F<arguments.length;F++){var H=arguments[F]!=null?arguments[F]:{};F%2?OB(Object(H),!0).forEach(function(ie){U(k,ie,H[ie])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(H)):OB(Object(H)).forEach(function(ie){Object.defineProperty(k,ie,Object.getOwnPropertyDescriptor(H,ie))})}return k}({},b);delete P.jpg,I.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(P))}return V}{let P=this.quality*this._qualityRatio;return this.quality=P,await this.generateRequestData(t,{appId:o,cname:a,cid:l,vid:u,sid:f,uid:m})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Qr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=xs.CLOSED,this.emit(ac.STATE_CHANGE,hm.CLOSED)}}function PB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function NB(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?PB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):PB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let ine=Date.now(),nne=20,tA=new Map,hS=new Map;async function xB(e){let t=tA.get(e),i=Array.isArray(t)&&t[t.length-1],o=hS.get(e);if(!i)return void(o.isSyncing=!1);let a={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);let l=i.sendTs-o.firstSendTs,u=l-(Date.now()-o.firstRecvTs);u>0&&(o.firstRecvTs=Date.now()-l);let f=i.mediaDelay+u;f<=0?(t.pop(),DB(i.context,a),f=0):f=Math.min(f,nne),setTimeout(()=>t.length&&xB(e),f)}function DB(e,t){e.safeEmit(bt.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function rne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return DB(i,{uid:e.uid,payload:e.payload});let o="".concat(i.id,"-").concat(e.uid),a=tA.get(o)||[],l=a.findIndex(_=>e.sendTs>=_.sendTs),u=NB(NB({},e),{},{context:i,mediaDelay:t,recvTs:Date.now()});l===-1?a.push(u):a.splice(l,0,u),tA.set(o,a);let f=!1;var m;hS.has(o)?f=!((m=hS.get(o))===null||m===void 0||!m.isSyncing):hS.set(o,{isSyncing:f,firstRecvTs:0,firstSendTs:0}),f||xB(o)}let one=Ut().name;function kB(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function LB(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?kB(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):kB(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Gm="websdk_ng_cache_parameter",sne=$("MAX_PRELOAD_ASYNC_LENGTH"),ane=1e4,Pp=new Map,Np=[],iA=null,nA=0,rA=0,pS=new Map,cne=function(e,t){let i=[],o=0,a=async()=>{let l=i.shift();l&&await l(),i.length>0&&o<t?a():o--};return async function(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];return new De(async(m,_)=>{i.push(async()=>{try{let v=await e(...u);m(v)}catch(v){_(v)}}),o<t&&(o++,a())})}}(MB,sne),oA=Qr.CancelToken.source();async function MB(e,t,i,o,a){try{if(!$("ENABLE_PRELOAD"))return;if(!xt().supportWebCrypto)return void su(()=>{I.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new fe(W.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Gn(i,"token",1,2047),Gn(e,"appid",1,2047),s0(t),o&&a0(o);let l=U_();I.debug("preload channel ".concat(t,", uid is ").concat(o));let u={appId:e,cname:t,token:i||e,uid:typeof o!="string"?o:null,sid:l,proxyServer:a},f,m;typeof o=="string"?(u.stringUid=o,[m,f]=await De.all([OQ(o,{sid:l,appId:e},oA.token),A2(LB(LB({},u),{},{token:i||e,uid:0}),oA.token)]),u.uid=m.uid,f.gatewayInfo.uid=u.uid,f.gatewayInfo.res.uid=u.uid):f=await A2(u,oA.token);let _={sid:l,appId:e,cname:t,token:i||e,uid:u.stringUid||o,intUid:u.uid||f.gatewayInfo.uid,stringUid:u.stringUid,ts:Date.now(),sua:m,ap:f};await async function(v){let S;try{v.uid&&jB({appId:v.appId,cname:v.cname,token:v.token,uid:v.uid,stringUid:v.stringUid});let C=WB(v),b=await async function(P,k){try{let F=await window.crypto.subtle.importKey("raw",xM(k),"AES-GCM",!1,["encrypt"]),H=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},F,ap(window.btoa(JSON.stringify(P))));return au(new Uint8Array(H))}catch{return}}(v,v.token||v.appId);if(!b)return;S=BB(Gm);let V=S?JSON.parse(S):[];V.push({[C]:b}),V.length>$("AP_CACHE_NUM")&&V.shift(),fS(Gm,JSON.stringify(V))}catch(C){I.warn("Error caching server parameters:",C.message),fS(Gm,"")}}(_),nA++}catch(l){throw rA++,function(u){iA||(iA=window.setTimeout(()=>{let m="";pS.forEach((_,v)=>{m+="".concat(v,": ").concat(_," ;")}),Ge.reportApiInvoke(null,{name:ln.PRELOAD,options:{success:nA,failed:rA,err:m}}).onError(u),nA=0,rA=0,pS.clear(),iA=null},ane));let f=pS.get(u.code)||0;pS.set(u.code,f+1)}(l),l}}async function UB(e){try{let t=jB(e);if(!t||e.cloudProxyServer!=="disabled")return;let i=await async function(o,a){try{let l=await window.crypto.subtle.importKey("raw",xM(a),"AES-GCM",!1,["decrypt"]),u=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},l,ap(o));return JSON.parse(window.atob(au(new Uint8Array(u))))}catch{return}}(t,e.token||e.appId);if(!i||!function(o,a){return o.cname===a.cname&&o.appId===a.appId&&o.token===a.token?a.stringUid?o.stringUid===a.stringUid:typeof a.uid=="number"?o.uid===a.uid:o.uid==a.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<$("AP_CACHE_LIFETIME"))return i}catch(t){I.warn("Error get preloadInfo",t.message)}}function jB(e){let t;try{if(t=BB(Gm),!t)return;let i=JSON.parse(t),o=WB(e),a=function(u,f){for(let m=u.length-1;m>=0;m--)if(f(u[m]))return m;return-1}(i,u=>o in u);if(a===-1)return;let l=i.splice(a,1)[0];return fS(Gm,JSON.stringify(i)),l[o]}catch(i){I.warn("Error delete preload info: ".concat(t),i.message),fS(Gm,"")}}function sA(e){if(e){let t=Pp.get(e);t&&(window.clearTimeout(t),t=null,Pp.delete(e)),ke(Np).call(Np,e)||e.cloudProxyServer!=="disabled"||Np.push(e)}if(Pp.size<$("AP_CACHE_NUM")&&Np.length>0){let t=Np.shift();Pp.set(t,window.setTimeout(async()=>{let{appId:i,cname:o,token:a,uid:l,proxyServer:u}=t;try{await cne(i,o,a,l,u),Pp.has(t)&&sA(t)}catch(f){I.warn("update preload failed",f.message),VB(t)}},$("AP_UPDATE_INTERVAL")))}}function VB(e){let t=Np.indexOf(e);t!==-1&&Np.splice(t,1);let i=Pp.get(e);i&&(window.clearTimeout(i),i=null,Pp.delete(e),sA())}function FB(e,t){let i=e.sua,o=e.ap;t&&i&&Ge.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:t,uid:e.intUid,errorCode:null,extend:i.req}),Ge.reportResourceTiming(e.ap.url,e.sid),Ge.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(a=>a.ip).join(","),eventType:"disabled",unilbsServerIds:[rn.CHOOSE_SERVER,rn.CLOUD_PROXY_FALLBACK].toString()}),Ge.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(a=>a.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[rn.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function BB(e){return window.atob(window.localStorage.getItem(e)||"")}function fS(e,t){window.localStorage.setItem(e,window.btoa(t))}function WB(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),VM(t)}var zB,HB,GB,KB,qB,YB,$B,XB,JB,ZB,QB,e5,t5,i5,n5,r5,o5,s5,a5,c5,l5,d5,u5,h5,p5,f5,m5,g5,_5,E5,v5,y5,S5,T5,w5,C5,b5,R5,I5,A5,O5,P5,Me;function N5(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function js(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?N5(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):N5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}jn.setLogger(I);let lne=(zB=Ze(),HB=Ze({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof Dm))return[t];t=[t]}return t.map(i=>i?Object(i).toString():"null")}}),GB=Ze({argsMap:(e,t)=>(t||(t=[]),t instanceof eF?[t.getChannelId()]:(Array.isArray(t)||(t=[t]),t.map(i=>i.getTrackId())))}),KB=Ze({argsMap:(e,t,i,o)=>[typeof t=="object"?t.uid:t,i,o]}),qB=Ze({argsMap:(e,t,i)=>[t,i]}),YB=Ze({argsMap:(e,t)=>t.map(i=>{let{user:o,mediaType:a}=i;return[o==null?void 0:o.uid,a]})}),$B=Ze({argsMap:(e,t,i,o)=>[typeof t=="object"?t.uid:t,i,o]}),XB=Ze({argsMap:(e,t)=>t.map(i=>{let{user:o,mediaType:a}=i;return{uid:o==null?void 0:o.uid,mediaType:a}})}),JB=Ze(),ZB=Ze(),QB=Ze(),e5=Ze(),t5=Ze(),i5=Ze(),n5=Ze(),r5=Ze(),o5=Ze(),s5=Ze(),a5=Ze(),c5=Ze(),l5=Ze(),d5=Ze(),u5=Ze({argsMap:(e,t)=>[t]}),h5=Ze(),p5=Ze(),f5=Ze(),m5=Ze(),g5=Ze(),_5=Ze(),E5=Ze(),v5=Ze(),y5=Ze(),S5=Ze(),T5=Ze({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),w5=Ze(),C5=Ze(),b5=Ze(),R5=Ze(),I5=Ze(),A5=Ze(),O5=Ze({reportResult:!0}),P5=Ze(),Me=class extends Ii{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),U(this,"store",void 0),U(this,"_uid",void 0),U(this,"_channelName",void 0),U(this,"_uintUid",void 0),U(this,"_users",[]),U(this,"_config",void 0),U(this,"_clientId",void 0),U(this,"_appId",void 0),U(this,"_sessionId",null),U(this,"_key",void 0),U(this,"_rtmConfig",{}),U(this,"_joinInfo",void 0),U(this,"_gateway",void 0),U(this,"_statsCollector",void 0),U(this,"_configDistribute",void 0),U(this,"_leaveMutex",new jn("client-leave")),U(this,"_publishMutex",new jn("client-publish")),U(this,"_renewTokenMutex",new jn("client-renewtoken")),U(this,"_subscribeMutex",new jn("client-subscribe")),U(this,"_encryptionMode","none"),U(this,"_encryptionSecret",null),U(this,"_encryptionSalt",null),U(this,"_encryptDataStream",!1),U(this,"_encryptDataStreamKey",null),U(this,"_encryptDataStreamIv",null),U(this,"_proxyServer",void 0),U(this,"_turnServer",{servers:[],mode:"auto"}),U(this,"_cloudProxyServerMode","disabled"),U(this,"_isDualStreamEnabled",!1),U(this,"_defaultStreamFallbackType",void 0),U(this,"_lowStreamParameter",void 0),U(this,"_streamFallbackTypeCacheMap",new Map),U(this,"_remoteStreamTypeCacheMap",new Map),U(this,"_axiosCancelSource",Qr.CancelToken.source()),U(this,"_audioVolumeIndicationInterval",void 0),U(this,"_networkQualityInterval",void 0),U(this,"_userOfflineTimeout",void 0),U(this,"_streamRemovedTimeout",void 0),U(this,"_injectStreamingClient",void 0),U(this,"_liveTranscodeStreamingClient",void 0),U(this,"_liveRawStreamingClient",void 0),U(this,"_channelMediaRelayClient",void 0),U(this,"_networkQualitySensitivity","normal"),U(this,"_p2pChannel",void 0),U(this,"_useLocalAccessPoint",!1),U(this,"_setLocalAPVersion",void 0),U(this,"_joinAndNotLeaveYet",!1),U(this,"_numberOfJoinCount",0),U(this,"_remoteDefaultVideoStreamType",void 0),U(this,"_inspect",void 0),U(this,"_moderation",void 0),U(this,"_license",void 0),U(this,"_pendingPublishedUsers",[]),U(this,"ntpAlignErrorCount",0),U(this,"remoteInboundOffset",0),U(this,"_handleLocalTrackEnable",(i,o,a)=>{this.publish(i,!1).then(o).catch(a)}),U(this,"_handleLocalTrackDisable",(i,o,a)=>{this.unpublish(i).then(o).catch(a)}),U(this,"_handleUserOnline",i=>{if($("BLOCK_LOCAL_CLIENT")&&lp(i.uid,this.channelName))return void I.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&I.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let o=this._users.find(a=>a.uid===i.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(bt.USER_JOINED,o));else{let a=new wu(i.uid,i.uint_id||i.uid);this._users.push(a),I.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(bt.USER_JOINED,a)}}),U(this,"_handleUserOffline",i=>{if($("BLOCK_LOCAL_CLIENT")&&lp(i.uid,this.channelName))return;let o=this._users.find(a=>a.uid===i.uid);o&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:Jy(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),I.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(bt.USER_LEAVED,o,i.reason))}),U(this,"_handleAddAudioOrVideoStream",(i,o,a,l,u,f,m)=>{if($("BLOCK_LOCAL_CLIENT")&&lp(o,this.channelName))return;let _=this._users.find(S=>S.uid===o);if(!_)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(_.uid,i,void 0,void 0,void 0,Date.now());let v=i==="audio"?_.hasAudio:_.hasVideo;_._uintid||(_._uintid=u||o),i==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,i==="audio"?(_._audio_added_=!0,a!==void 0&&(_._audioSSRC=a),l!==void 0&&(_._cname=l),f&&(_._audioOrtc=f)):(_._video_added_=!0,a!==void 0&&(_._videoSSRC=a),l!==void 0&&(_._cname=l),m!==void 0&&(_._rtxSsrcId=m),f&&(_._videoOrtc=f)),(i==="audio"?_.hasAudio:_.hasVideo)&&!v&&(I.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(i)),this.safeEmit(bt.USER_PUBLISHED,_,i)),i==="video"?Ge.onGatewayStream(this._sessionId,Vn.ON_ADD_VIDEO_STREAM,Di.ON_ADD_VIDEO_STREAM,{peer:u||o,ssrc:_._videoSSRC}):Ge.onGatewayStream(this._sessionId,Vn.ON_ADD_AUDIO_STREAM,Di.ON_ADD_AUDIO_STREAM,{peer:u||o,ssrc:_._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_,i,a).then(S=>{if(S&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof cS))return this._p2pChannel.unsubscribe(_,i,!0).then(()=>this._subscribe(_,i,!0).catch(C=>{I.error("[".concat(this._clientId,"] resubscribe error"),C.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_,i)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,i,!0).catch(S=>{I.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),U(this,"_handleRemoveStream",i=>{if($("BLOCK_LOCAL_CLIENT")&&lp(i.uid,this.channelName))return;let o=this._users.find(l=>l.uid===i.uid);if(!o)return void I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));I.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let a=()=>{};o.hasAudio&&o.hasVideo?a=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(bt.USER_UNPUBLISHED,o,"audio"),I.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(bt.USER_UNPUBLISHED,o,"video")}:o.hasVideo?a=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(bt.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(a=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(bt.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof cS&&this._p2pChannel.unsubscribe(o).then(l=>{if(l)return this._gateway.unsubscribe(l,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),Ge.onGatewayStream(this._sessionId,Vn.ON_REMOVE_STREAM,Di.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),a()}),U(this,"_handleSetStreamLocalEnable",(i,o,a)=>{if($("BLOCK_LOCAL_CLIENT")&&lp(o,this.channelName))return;let l=this._users.find(m=>m.uid===o);if(!l)return void I.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));I.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(a?"enabled":"disabled"," with uid ").concat(o));let u=i==="audio"?l.hasAudio:l.hasVideo;if(i==="audio"){l._trust_audio_enabled_state_=!0;let m=l._audio_enabled_;if(l._audio_enabled_=a,l._audio_enabled_===m)return;{let _=l._audio_enabled_?"enable-local-audio":"disable-local-audio";I.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(_)),this.safeEmit(bt.USER_INFO_UPDATED,o,_)}}else{l._trust_video_enabled_state_=!0;let m=l._video_enabled_;if(l._video_enabled_=a,l._video_enabled_===m)return;{let _=l._video_enabled_?"enable-local-video":"disable-local-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(_)),this.safeEmit(bt.USER_INFO_UPDATED,o,_)}}let f=i==="audio"?l.hasAudio:l.hasVideo;return u!==f?!u&&f?(I.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(i)),void this.safeEmit(bt.USER_PUBLISHED,l,i)):(i==="video"&&l._videoTrack&&l._videoTrack._destroy(),i==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,i),I.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(i)),void this.safeEmit(bt.USER_UNPUBLISHED,l,i)):void 0}),U(this,"_handleMuteStream",(i,o,a)=>{if($("BLOCK_LOCAL_CLIENT")&&lp(i,this.channelName))return;I.debug("[".concat(this._clientId,"] receive mute message"),i,o,a);let l=this._users.find(m=>m.uid===i);if(!l)return void I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let u=o==="audio"?l.hasAudio:l.hasVideo;if(o==="audio"){l._trust_audio_mute_state_=!0;let m=l._audio_muted_;if(l._audio_muted_=a,l._audio_muted_===m)return;{let _=l._audio_muted_?"mute-audio":"unmute-audio";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(_)),this.safeEmit(bt.USER_INFO_UPDATED,i,_)}}else{l._trust_video_mute_state_=!0;let m=l._video_muted_;if(l._video_muted_=a,l._video_muted_===m)return;{let _=l._video_muted_?"mute-video":"unmute-video";I.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(_)),this.safeEmit(bt.USER_INFO_UPDATED,i,_)}}let f=o==="audio"?l.hasAudio:l.hasVideo;if(u!==f){if(!u&&f)return(o==="audio"?l._audioSSRC:l._videoSSRC)?(I.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(o)),void this.safeEmit(bt.USER_PUBLISHED,l,o)):void I.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),o==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,o),I.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(o)),this.safeEmit(bt.USER_UNPUBLISHED,l,o)}}),U(this,"_handleP2PLost",async i=>{I.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():I.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),U(this,"_handleTokenWillExpire",()=>{I.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(bt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),U(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),I.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),U(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(bt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(bt.NETWORK_QUALITY,i)}),U(this,"_handleP2PAddAudioOrVideoStream",(i,o,a,l)=>{let u=this._users.find(m=>m.uid===o);if(!u)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));I.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(u.uid,i,void 0,void 0,void 0,Date.now());let f=i==="audio"?u.hasAudio:u.hasVideo;i==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,i==="audio"?(u._audio_added_=!0,a!==void 0&&(u._audioSSRC=a),l!==void 0&&(u._audioMid=l)):(u._video_added_=!0,a!==void 0&&(u._videoSSRC=a),l!==void 0&&(u._videoMid=l)),(i==="audio"?u.hasAudio:u.hasVideo)&&!f&&(I.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(i)),this.safeEmit(bt.USER_PUBLISHED,u,i)),this._p2pChannel.hasPendingRemoteMedia(u,i)&&(I.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,i,!0).catch(m=>{I.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._config=e,this._clientId=di(5,"client-"),this.store=new pZ(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),I.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Ps," build: ").concat(oR,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{PM(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(i){I.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new SE(this.store),this._statsCollector.onStatsException=(i,o,a)=>{I.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(o,", uid: ").concat(a)),this.safeEmit(bt.EXCEPTION,{code:i,msg:o,uid:a})},this._statsCollector.onUploadPublishDuration=(i,o,a,l)=>{let u=this._users.find(f=>f.uid===i);u&&Ge.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:o,videoPublishDuration:a,peer:u._uintid})},this.store.useDataChannel=xt().supportDataChannel&&$("SIGNAL_CHANNEL"),this.store.useP2P=e.mode==="p2p",this._gateway=new wQ(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||nn,httpRetryConfig:e.httpRetryConfig||nn,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new DQ,this.store.useP2P?(this._p2pChannel=new Wo(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new cS(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,i,o,a){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],u=arguments.length>6&&arguments[6]!==void 0&&arguments[6];ai("JOIN_GATEWAY_USE_443PORT_ONLY",l),ai("JOIN_GATEWAY_USE_DUAL_DOMAIN",u);let f=this._gateway.signal.websocket;return f instanceof B_&&(f.use443PortOnly=l,f.tryDoubleDomain=u),async function(m,_,v){Ky.get(m)||Ky.set(m,[]),qy.get(m)||qy.set(m,_),$c.get(m)||$c.set(m,0);let S=Ky.get(m),C=qy.get(m);if(!S||!C)throw new Error("concurrent: deferQueue or maxConcurrency is null");if($c.get(m)===C){let F=D_();S.push(F),await F.promise}$c.set(m,$c.get(m)+1);for(var b=arguments.length,V=new Array(b>3?b-3:0),P=3;P<b;P++)V[P-3]=arguments[P];let k=await v(...V);return $c.set(m,$c.get(m)-1),$c.get(m)===C-1&&S.length>0&&(S[0].resolve(),S.shift()),$c.get(m)===0&&(Ky.set(m,[]),qy.set(m,0),$c.set(m,0)),k}("client.join",$("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,i,o,a)}async join(e,t,i,o,a){let l=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);let u=(i0||i0||(i0=(window.location.protocol.split(":")[0]||"").toUpperCase(),i0))==="HTTPS",f=FM()?window.isSecureContext:"Browser Not Support";(!FM()&&!u||!window.isSecureContext)&&I.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),I.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Ge.setAppId(e);try{if(!i&&i!==null)throw new se(W.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Gn(i,"token",1,2047),Gn(e,"appid",1,2047),s0(t),o&&a0(o),a&&Gn(a,"optionalInfo",1,2047)}catch(P){throw Ge.reportApiInvoke(U_(),{name:ln.JOIN,options:[e,t,i,o],states:{isHttps:u,isSecureContext:f},tag:Ui.TRACER}).onError(P),P}let m=await UB({appId:e,cname:t,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode}),_=(m==null?void 0:m.sid)||U_(),v=Ge.reportApiInvoke(_,{name:ln.JOIN,options:[e,t,i,o],states:{isHttps:u,isSecureContext:f},tag:Ui.TRACER});if(I.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(l)),this._leaveMutex.isLocked&&(I.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),I.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let P=new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw v.onError(P),P}this._sessionId||(this._sessionId=_,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";let S=js(js({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!m},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(S.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(S.stringUid=o,this._uintUid?(S.uid=this._uintUid,this._uintUid=void 0):S.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(S.aesmode=this._encryptionMode,S.aespassword=await(async P=>{let k=function(oe){let ae=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),he=new Uint8Array(new ArrayBuffer(ae.length));for(let Ee=0;Ee<ae.length;Ee+=1)he[Ee]=ae.charCodeAt(Ee);return he}(),F=await window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),H=Xb(P),ie=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},F,H);return function(oe){let ae="";for(let he=0;he<oe.length;he+=1)ae+=String.fromCharCode(oe[he]);return window.btoa(ae)}(new Uint8Array(ie))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(S.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let P=new TextEncoder,k=$("USE_PURE_ENCRYPTION_MASTER_KEY")?P.encode(S.appId+this._encryptionSecret+this._encryptionSecret):P.encode(S.appId+S.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(F,H,ie){let oe=await window.crypto.subtle.importKey("raw",H,"PBKDF2",!1,["deriveBits","deriveKey"]),ae=F==="aes-128-gcm2"?128:256,he=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:WM,hash:"SHA-256",salt:ie},oe,ae+fZ);return new Uint8Array(he).subarray(ae/8)}(this._encryptionMode,k,ap(this._encryptionSalt)),this._encryptDataStreamKey=await async function(F,H,ie){let oe=await window.crypto.subtle.importKey("raw",H,"PBKDF2",!1,["deriveBits","deriveKey"]),ae=F==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:WM,hash:"SHA-256",salt:ie},oe,{name:"AES-GCM",length:ae},!0,["encrypt","decrypt"])}(this._encryptionMode,k,ap(this._encryptionSalt))}else f?I.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):I.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,I.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:S.stringUid,preload:S.preload});let C=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&C===this._sessionId&&Ge.joinChannelTimeout(this._sessionId,5)},5e3);try{var b;let P,k=S.cloudProxyServer;if(ke(b=["proxy3","proxy4","proxy5"]).call(b,k)){let ae=$("PROXY_SERVER_TYPE3");Array.isArray(ae)?S.proxyServer=ae[0]:S.proxyServer=ae}if(Ge.setProxyServer(S.proxyServer),I.setProxyServer(S.proxyServer),this.store.requestAPStart(),m){if(I.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(S.stringUid?", ".concat(S.stringUid," => ").concat(m.intUid):""," ")),S.stringUid&&!S.uid&&(S.uid=m.intUid),P={gatewayInfo:m.ap.gatewayInfo},$("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&S.turnServer.mode==="auto")if(m.ap.proxyInfo.addresses.length===0)I.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let ae=(await f2(m.ap.proxyInfo,m.ap.gatewayInfo.uid)).map(he=>({turnServerURL:he.address,tcpport:he.tcpport||rr.tcpport,udpport:he.udpport||rr.udpport,username:he.username||rr.username,password:he.password||rr.password,forceturn:!1,security:!0}));S.turnServer={mode:"manual",servers:ae}}FB(m,S.stringUid)}else{if(S.stringUid&&!S.uid){let ae;[ae,P]=await De.all([I2(S.stringUid,S,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store),R2(S,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,!0,this.store)]),I.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(S.stringUid," => ").concat(ae)),S.uid=ae,P.gatewayInfo.uid=ae,P.gatewayInfo.res.uid=ae}else P=await R2(S,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,!0,this.store);if(!this._joinAndNotLeaveYet)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(S,this._axiosCancelSource.token),this._configDistribute.on(mR.UPDATE_BITRATE_LIMIT,ae=>{this._p2pChannel.updateBitrateLimit(ae)})},0),this._key=i||e;let F=P.gatewayInfo,H=S.uid?S.uid:F.uid;this._joinInfo=js(js({},S),{},{cid:F.cid,uid:H,vid:F.vid,apResponse:F.res,uni_lbs_ip:F.uni_lbs_ip,gatewayAddrs:F.gatewayAddrs}),this.store.intUid=H;let ie=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));v.onSuccess(ie),this._appId=e,this._channelName=S.cname,this._uid=ie,this.store.uid=ie,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Pn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let oe=S.stringUid?"string uid: ".concat(S.stringUid,",uid: ").concat(S.uid):"uid: ".concat(this._uid);return I.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(oe)),setTimeout(()=>{I.startUpload()},5e3),this.store.joinEnd(),V=this,ke(lu).call(lu,V)||lu.push(V),this._cloudProxyServerMode==="disabled"&&xt().supportWebCrypto&&$("ENABLE_PRELOAD")&&sA(this._joinInfo),ie}catch(P){let k=Array.isArray(P)?P[0]:P;throw k&&k.code===W.OPERATION_ABORTED?I.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),k):I.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),k),k.code!==W.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),v.onError(k),k}var V}_joinGateway(){if(!this._joinInfo||!this._key)throw new se(W.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!$("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===W.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Ct.FALLBACK),e;if(e.code===W.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Ct.FALLBACK),e;throw e}).then(e=>{if(e instanceof se){if(e.code===W.INIT_WEBSOCKET_TIMEOUT){if(I.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new se(W.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";let t=$("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){let o=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),a=o.slice(o.length-2).join(".");t.forEach(l=>{this._joinInfo&&ke(l).call(l,a)&&(this._joinInfo.proxyServer=l)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;let i=$("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return i&&i[1]&&i[1]!=="443"&&I.setProxyServer(this._joinInfo.proxyServer),$("STATS_COLLECTOR_PORT").toString()!=="443"&&Ge.setProxyServer(this._joinInfo.proxyServer),Ge.reportApiInvoke(this._sessionId,{name:ln.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Ui.TRACER}).onSuccess(),this.safeEmit(bt.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),$("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(o=>{"forceturn"in o&&(o.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(I.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new se(W.INVALID_OPERATION);return Ge.reportApiInvoke(this._sessionId,{name:ln.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Ui.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){I.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Pn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let i=lu.indexOf(t);i!==-1&&lu.splice(i,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return I.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),I.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Dm))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new se(W.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new se(W.INVALID_OPERATION,"audience can not publish stream");for(let a of i){if(!(a instanceof Dm))throw new se(W.INVALID_PARAMS,"parameter is not local track");if(!a._enabled&&t)throw new se(W.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(a.getTrackId()))}I.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))));let o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&i.forEach(a=>{let l=this._configDistribute.getBitrateLimit();a instanceof ui&&l&&a.setBitrateLimit(l.uplink)});try{await this._publishHighStream(i),I.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(a=>"".concat(a.getTrackId()," "))))}catch(a){throw I.error("[".concat(this._clientId,"] publish error"),a.toString()),a}finally{o()}}async _publishDataChannel(e){si(e.id,"id",0,65535,!0),Gl(e.ordered,"ordered"),Gn(e.metadata,"metadata",0,512),I.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(o=>o.id===e.id)!==-1)throw new se(W.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new se(W.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new se(W.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=new eF(e);if(await this._p2pChannel.publishDataChannel([i]),!this._p2pChannel.isP2PDisconnected()){if(typeof i._originDataChannelId!="number")throw I.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new se(W.CREATE_DATACHANNEL_ERROR);try{let o={streamId:e.id,ordered:e.ordered,maxRetransmits:$("DATASTREAM_MAX_RETRANSMITS"),metadata:e.metadata,channelId:i._originDataChannelId};await this._gateway.publishDataChannel(this._uid,o,!0),await i._waitTillOpen()}catch(o){if(o.code!==W.DISCONNECT_P2P)throw o}}return I.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw I.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new se(W.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof Dm))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);I.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(o=>"".concat(o.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Wo){let o=await this._p2pChannel.unpublish(t);o&&await this._gateway.sendExtensionMessage($i.UNPUBLISH,{unpubMsg:o},!0)}else{let o=await this._p2pChannel.unpublish(t);o&&await this._gateway.unpublish(o,this._uid),I.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(a=>"".concat(a.getTrackId()))))}}catch(o){throw I.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),I.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let t=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),I.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw I.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{t&&t()}}async subscribe(e,t,i){if(!(e instanceof wu)){let o=this.remoteUsers.find(a=>a.uid===e);if(!o)throw new se(W.INVALID_REMOTE_USER,"user is not in the channel");e=o}return t==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,t)}async presubscribe(e,t){if(Cn(t,"mediaType",["audio","video"]),this._p2pChannel instanceof Wo)throw new se(W.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new se(W.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=t===He.AUDIO,o=t===He.VIDEO,a=await this._subscribeMutex.lock();try{let{ssrcId:l,ortc:u,rtxSsrcId:f,cname:m,uint_id:_}=await this._gateway.presubscribe(e,t,!0);if(l==null)throw new se(W.UNEXPECTED_RESPONSE,"no ssrc id");let v=this._users.find(C=>C.uid===e);v||(v=new wu(e,_||e),v._is_pre_created=!0,this._users.push(v)),m&&(v._cname=m),v._uintid||(v._uintid=_||e),i&&(v._audioSSRC=l,v._audio_pre_subscribed=!0,u&&(v._audioOrtc=u)),o&&(v._videoSSRC=l,v._video_pre_subscribed=!0,u&&(v._videoOrtc=u),f!=null&&(v._rtxSsrcId=f)),I.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(v,t,l,f,u);let S=i?v._audioTrack:v._videoTrack;if(!S)throw new se(W.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(v._trust_audio_stream_added_state_=!0,v._audio_added_=!0),o&&(v._trust_video_stream_added_state_=!0,v._video_added_=!0),S}catch(l){throw I.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{a()}}async _subscribeDataChannel(e,t){var i;if(si(t,"channelId",0,65535,!0),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e))throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new se(W.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new se(W.INVALID_REMOTE_USER,"user is not published");let o=(i=e._dataChannels)===null||i===void 0?void 0:i.find(u=>u.id===t);if(!o)throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new se(W.REMOTE_USER_IS_NOT_PUBLISHED);let a=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let u=await this._p2pChannel.subscribeDataChannel(e,[o]);if(u&&ke(u).call(u,o.id))try{var l;if(typeof o._originDataChannelId!="number")throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new se(W.CREATE_DATACHANNEL_ERROR);let f={id:o.id,datachannelId:o._originDataChannelId,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:(l=o.metadata)!==null&&l!==void 0?l:""};await this._gateway.subscribeDataChannel(e.uid,f,!0),await o._waitTillOpen()}catch(f){if((f==null?void 0:f.code)!==W.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[o]),f;await this._p2pChannel.unsubscribeDataChannel(e,[o]),this._p2pChannel.setPendingRemoteDataChannel(e,o.id)}return I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),o}finally{a()}}async _p2pSubscribe(e,t,i){if(Cn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===e)){let a=new se(W.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),a}if(!e.hasAudio&&!e.hasVideo){let a=new se(W.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),a}if(!i&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let a=new se(W.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),a}let o=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let l=t==="audio"?e._audioSSRC:e._videoSSRC,u=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof Wo&&await this._p2pChannel.subscribe(e,t,l,u)}catch(l){throw l}I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(l=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});let a=t==="audio"?e._audioTrack:e._videoTrack;if(!a)throw new se(W.UNEXPECTED_ERROR,"can not find remote track in user object");return a}catch(a){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),a),a}finally{o()}}async _subscribe(e,t,i){if(this._p2pChannel instanceof Wo)return this._p2pSubscribe(e,t);if(Cn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e)){let m=new se(W.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),m}if(!e.hasAudio&&!e.hasVideo){let m=new se(W.INVALID_REMOTE_USER,"user is not published");throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),m}if(!(i||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let m=new se(W.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),m}let o=t==="audio"?e._audioSSRC:e._videoSSRC,a=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?He.AUDIO:He.VIDEO,ssrcId:o},f=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let _=t==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==o&&(o=_,a=t==="audio"?e._audioOrtc:e._videoOrtc,l=t==="video"?e._rtxSsrcId:void 0,u={stream_type:t==="audio"?He.AUDIO:He.VIDEO,ssrcId:o}),pr.markSubscribeStart(this.store.clientId,o),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,o,l,a);try{await this._gateway.subscribe(e.uid,u,!0)}catch(v){if((v==null?void 0:v.code)!==W.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),v;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_==null?void 0:_.code,e,t),_}I.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{I.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});let m=t==="audio"?e._audioTrack:e._videoTrack;if(!m)throw new se(W.UNEXPECTED_ERROR,"can not find remote track in user object");return m}catch(m){throw I.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),m),m}finally{f()}}async massSubscribe(e){if(Kl(e,"subscribeList"),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),i=new Map,o=await this._subscribeMutex.lock();I.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(f=>{let{user:m,mediaType:_}=f;return"user: ".concat(m==null?void 0:m.uid,", mediaType: ").concat(_)}).join("; ")));let a=(e=[...e]).map(f=>{let{user:m,mediaType:_}=f;return{user:m,mediaType:_}}),l=await this._p2pChannel.globalLock();try{var u;for(let m=e.length-1;m>=0;m--){let _=e[m],{user:v,mediaType:S}=_;if(Cn(S,"mediaType",["audio","video"]),!v){let V=new se(W.INVALID_PARAMS,"user property does not exist in subscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),V}if(!this._users.find(V=>V===v)){let V=new se(W.INVALID_REMOTE_USER,"user is not in the channel");I.error("[".concat(this._clientId,"] can not massSubscribe ").concat(v.uid,", this user is not in the channel")),a[m].error=V,e.splice(m,1);continue}if(S==="audio"&&(!v.hasAudio||v._audioSSRC===void 0)||S==="video"&&(!v.hasVideo||v._videoSSRC===void 0)){let V=new se(W.REMOTE_USER_IS_NOT_PUBLISHED);I.error("[".concat(this._clientId,"] can not subscribe ").concat(v.uid," with mediaType ").concat(S,", remote user is not published")),a[m].error=V,e.splice(m,1);continue}let C=xn.Video|xn.LwoVideo,b=i.get(v);if(b){if(S==="video"?b&C:b&xn.Audio){e.splice(m,1),I.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(v.uid,", mediaType:").concat(S," twice"));continue}i.set(v,b|(S==="video"?C:xn.Audio))}else i.set(v,S==="video"?C:xn.Audio)}for(let m=e.length-1;m>=0;m--){let _=e[m],{user:v,mediaType:S}=_,C=xn.Video|xn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(v,S)){await this._p2pChannel.unmuteRemoteNoLock(v,S);let b=i.get(v);i.set(v,S==="video"?b^C:b^xn.Audio),e.splice(m,1)}}this.store.massSubscribe(e.map(m=>({userId:m.user.uid,type:m.mediaType})),t);let f=fo(u=Array.from(i.entries())).call(u,(m,_)=>{let[v,S]=_;if(S===0)return m;let C={stream_id:v.uid,stream_type:S};return S&xn.Audio&&(C.audio_ssrc=v._audioSSRC),S&xn.Video&&(C.video_ssrc=v._videoSSRC),m.push(C),m},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(_=>{let{user:v,mediaType:S}=_;return{user:v,mediaType:S,ssrcId:S===He.VIDEO?v._videoSSRC:v._audioSSRC,rtxSsrcId:S===He.VIDEO?v._rtxSsrcId:void 0}}));let m=new Map;if(f.length>0){let _=await this._gateway.subscribeAll(f,!0);((_==null?void 0:_.users)||[]).forEach(v=>{let{stream_id:S,video_error_code:C,audio_error_code:b,error_code:V}=v;(C||b||V)&&m.set(S,{video_error_code:C,audio_error_code:b,error_code:V})})}if(Array.from(m.entries()).length>0){let _=[];Array.from(m.entries()).forEach(v=>{let[S,C]=v,b=this.remoteUsers.find(V=>V.uid===S);if(b){let V;C.error_code||C.video_error_code&&C.audio_error_code?V=void 0:C.video_error_code?V=He.VIDEO:C.audio_error_code&&(V=He.AUDIO),_.push({user:b,mediaType:V})}}),_.length>0&&await this._p2pChannel.massUnsubscribeNoLock(_)}for(let _ of a){let v=m.get(_.user.uid);if(v){let S=v.error_code||_.mediaType==="audio"&&v.audio_error_code||_.mediaType==="video"&&v.video_error_code;if(S){let C=up(S);I.error("user:".concat(_.user.uid," mediaType:").concat(_.mediaType," has massSubscribe error ").concat(C.desc)),_.error=new se(W.SUBSCRIBE_FAILED,"code ".concat(S,": ").concat(C.desc))}}_.error||(_.mediaType==="video"?_.track=_.user.videoTrack:_.track=_.user.audioTrack)}return this.store.massSubscribe(a.filter(_=>!_.error).map(_=>({userId:_.user.uid,type:_.mediaType})),void 0,Date.now()),a.forEach(_=>{var v;Ge.subscribe(this.store.sessionId,{succ:!!_.error,ec:((v=_.error)===null||v===void 0?void 0:v.code)||null,video:_.mediaType===He.VIDEO,audio:_.mediaType===He.AUDIO,peerid:_.user.uid,subscribeRequestid:_.mediaType===He.VIDEO?_.user._videoSSRC:_.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),I.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(_=>{let{user:v,mediaType:S}=_;return"user: ".concat(v==null?void 0:v.uid,", mediaType: ").concat(S)}).join("; "))),a}catch(m){throw await this._p2pChannel.massUnsubscribeNoLock(e),m}}finally{l(),o()}}async unsubscribe(e,t,i){if(!(e instanceof wu)){let a=this.remoteUsers.find(l=>l.uid===e);if(!a)throw new se(W.INVALID_REMOTE_USER,"user is not in the channel");e=a}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(t&&Cn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(a=>a===e)){let a=new se(W.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),a}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let o=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Wo)await this._p2pChannel.unsubscribe(e,t);else{let a=await this._p2pChannel.unsubscribe(e,t);a&&await this._gateway.unsubscribe(a,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Jy(this._users,e),I.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(a){if(a.code===W.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),a.toString()),a}finally{o()}}async _unsubscribeDataChannel(e,t){if(t&&si(t,"id",0,65535,!0),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(o=>o===e)){let o=new se(W.INVALID_REMOTE_USER,"user is not in the channel");throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}let i;if(typeof t=="number"){let o=e._dataChannels.find(a=>a.id===t);o&&(i=[o])}else i=e._dataChannels;if(i===void 0){let o=new se(W.REMOTE_USER_IS_NOT_PUBLISHED);throw I.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),o}I.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map(o=>o.id)));try{let o=await this._p2pChannel.unsubscribeDataChannel(e,i);o&&await this._gateway.unsubscribeDataChannel(o,e.uid),I.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o))}catch(o){if(o.code===W.DISCONNECT_P2P)return void I.warning("disconnecting p2p, abort unsubscribe request.");throw I.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}}async massUnsubscribe(e){if(Kl(e,"unsubscribeList"),!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");I.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:a}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join())),e=[...e];let t=new Map;for(let i=e.length-1;i>=0;i--){let{user:o,mediaType:a}=e[i];if(!o){let u=new se(W.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw I.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),u}if(Cn(a,"mediaType",["video","audio",void 0]),!this._users.find(u=>u===o)){I.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}let l=xn.Video|xn.LwoVideo;if(t.has(o)){let u=t.get(o),f;switch(a){case"video":f=u&l;break;case"audio":f=u&xn.Audio;break;default:f=u&(xn.Audio|l)}if(f){I.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(a," twice.")),e.splice(i,1);continue}a?a==="audio"?t.set(o,u|xn.Audio):a==="video"&&t.set(o,u|l):t.set(o,u|xn.Audio|l)}else a?a==="audio"?t.set(o,xn.Audio):a==="video"&&t.set(o,l):t.set(o,xn.Audio|l)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),I.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:a,mediaType:l}=o;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(l,";")}).join()))}catch(i){if(i.code===W.DISCONNECT_P2P)return void I.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw I.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new fe(W.INVALID_PARAMS);Mi(i.width)||Yb(i.width,"streamParameter.width"),Mi(i.height)||Yb(i.height,"streamParameter.height"),Mi(i.framerate)||Yb(i.framerate,"streamParameter.framerate"),Mi(i.bitrate)||si(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&I.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),I.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Te.LocalVideoLowTrack)}async enableDualStream(){if(!xt().supportDualStream)throw Ge.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new se(W.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new se(W.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Ge.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Ge.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),I.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new se(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Te.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Ge.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Ge.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),I.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(i){Cn(i,"role",["audience","host"])}(e),t&&PM(t),this.mode==="rtc"||this.mode==="p2p")throw I.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new se(W.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new se(W.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new se(W.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,I.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let i=t.timestamp-Date.now();return Math.abs(i)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(Gn(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new se(W.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(W.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Ge.setProxyServer(this._proxyServer),I.setProxyServer(this._proxyServer),I.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new se(W.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new se(W.INVALID_OPERATION,"You have already set the proxy")}if(om(e))return this._turnServer={servers:e,mode:"original-manual"},void I.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>OM(i)),this._turnServer={servers:e,mode:"manual"},I.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new se(W.INVALID_OPERATION,"you should set license before join channel");if(Gn(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new se(W.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,I.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new se(W.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new se(W.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new se(W.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new se(W.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new se(W.INVALID_OPERATION,"Stop proxy server after leave channel");Ge.setProxyServer(),I.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",I.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new se(W.INVALID_PARAMS,"accessPoints is required.");Kl(e.accessPoints.serverList,"accessPoints.serverList"),Gn(e.accessPoints.domain,"accessPoints.domain");let t=(C,b)=>{si(C,b,0,65535,!0)},i=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(W.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");$("CLOSE_AFB_FOR_LOCAL_AP")&&(ai("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),ai("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,a=e.accessPoints.domain,l=e.accessPoints.serverList.map(C=>o.test(C)?"".concat(C.replace(/\./g,"-"),".").concat(a):C),u=l.map(C=>"".concat(C,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,ai("WEBCS_DOMAIN",u),ai("WEBCS_DOMAIN_BACKUP_LIST",u),ai("GATEWAY_DOMAINS",[a]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Kl(e.report.hostname,"report.hostname"),ai("EVENT_REPORT_DOMAIN",e.report.hostname[0]),ai("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(ai("EVENT_REPORT_DOMAIN",l[0]),ai("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let f=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),f=e.report.port),ai("STATS_COLLECTOR_PORT",f),e.report?ai("ENABLE_EVENT_REPORT",!0):ai("ENABLE_EVENT_REPORT",!1);let m="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Kl(e.log.hostname,"log.hostname"),m=e.log.hostname[0]):m=l[0];let _=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),_=e.log.port),ai("LOG_UPLOAD_SERVER","".concat(m,":").concat(_));let v=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Kl(e.cds.hostname,"cds.hostname"),v=e.cds.hostname):v=l;let S=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),S=e.cds.port),ai("CDS_AP",v.map(C=>"".concat(C,":").concat(S))),e.cds?ai("ENABLE_CONFIG_DISTRIBUTE",!0):ai("ENABLE_CONFIG_DISTRIBUTE",!1),I.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Kl(e,"serverList"),Gn(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new se(W.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(t):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,ai("WEBCS_DOMAIN",e),ai("WEBCS_DOMAIN_BACKUP_LIST",e),ai("GATEWAY_DOMAINS",[t]),ai("EVENT_REPORT_DOMAIN",e[0]),ai("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),ai("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),I.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Cn(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw I.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else I.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Cn(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw I.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}I.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Cn(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(i){throw I.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}I.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,i,o){(function(l){Cn(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Gn(t,"secret");let a=["aes-128-gcm2","aes-256-gcm2"];if(ke(a).call(a,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new se(W.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new se(W.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Gl(o,"encryptDataStream"),!ke(a).call(a,e))throw new se(W.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||I.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,i&&(this._encryptionSalt=au(i))}async renewToken(e){if(Gn(e,"token",1,2047),!this._key||!this._joinInfo)throw new se(W.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if($("USE_NEW_TOKEN")){I.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let o=await xQ(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn);I.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else I.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});I.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=t,this._joinInfo.token=t,I.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?I.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(bt.VOLUME_INDICATOR,e)},$("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new se(W.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new se(W.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new se(W.LIVE_STREAMING_TASK_CONFLICT);let i=t?Fn.TRANSCODE:Fn.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Fn.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!t.length)throw new se(W.INVALID_PARAMS,"can not find live streaming url to stop");await De.all(t.map(i=>i&&i.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new se(W.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let i=this._createLiveStreamingClient(Fn.INJECT);i.setInjectStreamConfig(t,0),await i.startLiveStreamingTask(e,Fn.INJECT)}async removeInjectStreamUrl(){var e;let t=this._createLiveStreamingClient(Fn.INJECT),i=Array.from(sc(e=t.streamingTasks).call(e)).find(o=>o.mode===Fn.INJECT);if(!this._joinInfo||!i)throw new se(W.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(i.url)}async startChannelMediaRelay(e){GF(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){GF(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new se(W.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let a=new TextEncoder;e.payload=a.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(o=!0,e.payload=await async function(a,l,u){var f;let m=fo(f=Array.from(u)).call(f,(P,k)=>P+k,0),_={serverTs:0,seq:mZ++,length:u.length,checkSum:m},v=new Uint8Array(jM(m,2)),S=new ArrayBuffer(lm),C=new DataView(S);C.setUint32(0,_.serverTs),C.setUint16(4,_.seq),C.setUint16(6,_.length),C.setUint16(8,_.checkSum);let b=16-u.length%16;u=DM(u,new Uint8Array(b));let V=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a,tagLength:BM,additionalData:v},l,u);return DM(new Uint8Array(S),new Uint8Array(V))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new se(W.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Ye.DATA_STREAM,{payload:au(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-ine},!i)}sendMetadata(e){if(!this._joinInfo)throw new se(W.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new se(W.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:au(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(_Z),!this._joinInfo)throw new se(W.INVALID_OPERATION,"can not send custom report, not joined");await Ge.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){Cn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Cn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(i){throw I.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:i}=e;if(Gl(t,"apRTM"),si(i,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=i,I.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(I.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Qr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&VB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new jn("client-publish"),this._subscribeMutex=new jn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var i;let o=e||U_();e?I.debug("[".concat(this._clientId,"] new Session ").concat(o)):I.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));let a=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o;let l={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(t==null?void 0:t.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:a,clientRole:this.role==="audience"?2:1};t?Ge.sessionInit(this._sessionId,js({cname:t.channel,appid:t.appId,preload:t.preload},l)):this._joinInfo?Ge.sessionInit(this._sessionId,js({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},l)):this._gateway.joinInfo&&Ge.sessionInit(this._sessionId,js({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},l)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new se(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&$("FORCE_TURN")&&!$("TURN_ENABLE_TCP")&&!$("TURN_ENABLE_UDP"))throw new se(W.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");I.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Wo){let o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage($i.PUBLISH,o,!0)}catch(a){throw i.throw(a),a}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let o=(await i.next()).value;if(o){var t;let a;try{a=await this._gateway.publish(this._uid,o,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw i.throw(l),l}await i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let a of e)a instanceof ui&&a._encoderConfig&&this._gateway.setVideoProfile(a._encoderConfig),!a.muted&&a.enabled||await this._p2pChannel.muteLocalTrack(a)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===W.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new se(W.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new se(W.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));I.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var t;let a;try{a=await this._gateway.publish(this._uid,o,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw i.throw(l),l}i.next(((t=a)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===W.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new se(W.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=()=>new Pie(this._joinInfo,this._config.websocketRetryConfig||nn,this._config.httpRetryConfig||nn),i=o=>{o.onLiveStreamError=(a,l)=>{Ge.reportApiInvoke(this._sessionId,{name:ln.ON_LIVE_STREAM_ERROR,options:[a,l],tag:Ui.TRACER}).onSuccess(),this.safeEmit(bt.LIVE_STREAMING_ERROR,a,l)},o.onLiveStreamWarning=(a,l)=>{Ge.reportApiInvoke(this._sessionId,{name:ln.ON_LIVE_STREAM_WARNING,options:[a,l],tag:Ui.TRACER}).onSuccess(),this.safeEmit(bt.LIVE_STREAMING_WARNING,a,l)},o.on(c0.REQUEST_WORKER_MANAGER_LIST,(a,l,u)=>{if(!this._joinInfo)return u(new se(W.INVALID_OPERATION,"can not find join info to get worker manager"));P2(a,this._joinInfo,this._axiosCancelSource.token,nn).then(l).catch(u)})};switch(e){case Fn.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),i(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Fn.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),i(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Fn.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(c0.REQUEST_WORKER_MANAGER_LIST,(o,a,l)=>{if(!this._joinInfo)return l(new se(W.INVALID_OPERATION,"can not find join info to get worker manager"));P2(o,this._joinInfo,this._axiosCancelSource.token,nn).then(a).catch(l)}),this._injectStreamingClient.onInjectStatusChange=(o,a,l)=>{this.safeEmit(bt.INJECT_STREAM_STATUS,o,a,l)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new se(W.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),i={width:e,height:t};this._channelMediaRelayClient=new xie(this._joinInfo,this._clientId,this._config.websocketRetryConfig||nn,this._config.httpRetryConfig||nn,i),this._channelMediaRelayClient.on("state",o=>{o===go.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(bt.CHANNEL_MEDIA_RELAY_STATE,o)}),this._channelMediaRelayClient.on("event",o=>{this.safeEmit(bt.CHANNEL_MEDIA_RELAY_EVENT,o)}),this._statsCollector.onStatsChanged=(o,a)=>{var l;o==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(a))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:i,deleted:o}=e,a=[];Array.isArray(i)&&i.length>0&&i.forEach(l=>{let{uid:u,stream_id:f,ordered:m,max_retrans_times:_,metadata:v}=l,S=this._users.find(C=>C._uintid===u);if(!S)return void I.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(I.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(u)),ke(a).call(a,S)||a.push(S),S._uintid||(S._uintid=u),S._dataChannels.findIndex(C=>C.id===l.stream_id)===-1){let C={id:f,ordered:!!m,maxRetransmits:_,metadata:v},b=new aie(C);S._dataChannels.push(b),I.info("[".concat(this._clientId,"] remote user ").concat(S.uid," published datachannel")),t||this.safeEmit(bt.USER_PUBLISHED,S,"datachannel",C)}this._p2pChannel.hasPendingRemoteDataChannel(S,l.stream_id)&&(I.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(S.uid," after reconnect.")),this._subscribeDataChannel(S,l.stream_id).catch(C=>{I.error("[".concat(this._clientId,"] resubscribe datachannel error"),C.toString())}))}),t&&(this.safeEmit(bt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(l=>{let{uid:u,stream_id:f}=l,m=this._users.find(v=>v._uintid===u);if(!m)return void I.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let _=m._dataChannels.find(v=>v.id===l.stream_id);_&&(I.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(u)),this._p2pChannel.unsubscribeDataChannel(m,[_]).then(v=>{if(m._dataChannels=m._dataChannels.filter(S=>S!==_),v)return this._gateway.unsubscribeDataChannel(v,m.uid)}),I.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished datachannel ,id:").concat(_.id)),this.safeEmit(bt.USER_UNPUBLISHED,m,"datachannel",_._config))})}_handleRemoveDataChannels(e){let t=this._users.find(i=>i.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){I.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{I.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(o=>{this.safeEmit(bt.USER_UNPUBLISHED,t,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,t.uid)}),i()}}else I.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Yi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Yi.CONNECTION_STATE_CHANGE,(e,t,i)=>{var o;if(i===Ct.FALLBACK)return;let a=()=>{this.safeEmit(bt.CONNECTION_STATE_CHANGE,e,t,i)};if(Ge.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:ln.CONNECTION_STATE_CHANGE,options:[e,t,i],tag:Ui.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:i})),I.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void a();if(e==="RECONNECTING")this._users.forEach(u=>{u._trust_in_room_=!1,u._trust_audio_enabled_state_=!1,u._trust_video_enabled_state_=!1,u._trust_audio_mute_state_=!1,u._trust_video_mute_state_=!1,u._trust_audio_stream_added_state_=!1,u._trust_video_stream_added_state_=!1,u._is_pre_created||(u._audio_pre_subscribed||(u._audioSSRC=void 0,u._audioOrtc=void 0),u._video_pre_subscribed||(u._videoSSRC=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),u._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((u,f)=>{this._gateway.setStreamFallbackOption(f,u).catch(m=>{I.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),m)})}),this._remoteStreamTypeCacheMap.forEach((u,f)=>{this._gateway.setRemoteVideoStreamType(f,u).catch(m=>{I.warning("[".concat(this._clientId,"] auto set remote stream type failed"),m)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{I.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(u=>{I.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(u))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(u=>!u._trust_in_room_).forEach(u=>{I.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(u.uid)),this._handleUserOffline({uid:u.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(u=>{u._trust_audio_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,He.AUDIO,!1)),u._trust_video_mute_state_||(I.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(u.uid)),this._handleMuteStream(u.uid,He.VIDEO,!1)),u._trust_audio_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(u.uid)),this._handleSetStreamLocalEnable("audio",u.uid,!0)),u._trust_video_enabled_state_||(I.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(u.uid)),this._handleSetStreamLocalEnable("video",u.uid,!0)),u._trust_video_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(u.uid)),this._handleResetAddStream(u,"video")),u._trust_audio_stream_added_state_||(I.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(u.uid)),this._handleResetAddStream(u,"audio")),u._video_added_||u._audio_added_||(I.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(u.uid)),this._handleRemoveStream({uid:u.uid,uint_id:u._uintid}))}))},1e3))}a()}),this._gateway.on(Yi.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new se(W.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;this._joinInfo.recoverPreloadCache?(i=this._joinInfo.recoverPreloadCache.ap,FB(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):i=await AR(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||nn,this.store),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let o=[];i.gatewayInfo.gatewayAddrs.forEach(a=>{let{address:l}=a,[u,f]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?o.push({proxy:this._joinInfo.proxyServer,host:u,port:f}):o.push({host:u,port:f})}),e(o)}catch(i){t(i)}}),this._gateway.on(Yi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(bt.NETWORK_QUALITY,e)}),this._gateway.on(Yi.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(bt.STREAM_TYPE_CHANGED,e,t),Ge.reportApiInvoke(this._sessionId,{name:ln.STREAM_TYPE_CHANGE,options:[e,t],tag:Ui.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Yi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Yi.NEED_RENEW_SESSION,async e=>{if(e==="recover"&&this._joinInfo){let t=await UB(js(js({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=t,this._startSession(t==null?void 0:t.sid)}else this._startSession()}),this._gateway.on(Yi.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,i)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(o){i(o)}}),this._gateway.on(Yi.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let{dtlsParameters:i,iceParameters:o,candidates:a,rtpCapabilities:l,setup:u,cname:f}=vF(e.ortc,t);this._p2pChannel.connect(o,i,a,l,u,f)}),this._gateway.on(Yi.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Yi.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(Yi.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Yi.DATACHANNEL_PRECONNECT,async(e,t,i,o)=>{var a,l,u,f,m,_;await this._p2pChannel.startP2PConnection({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},!0);let v=function(S,C){let b;return C&&C.ip&&typeof C.port=="number"?(b=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:C.ip,port:C.port.toString(),type:"host",extension:{}}],I.debug("Using remote candidate from AP ".concat(C.ip,":").concat(C.port)),C.ip6&&(b.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:C.ip6,port:C.port.toString(),type:"host",extension:{}}),I.debug("Using IPV6 remote candidate from AP ".concat(C.ip6,":").concat(C.port)))):b=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:S.ip,port:S.port.toString(),type:"host",extension:{}}],b}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((l=this._joinInfo)===null||l===void 0?void 0:l.apResponse.cid,"_").concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cert),icePwd:"".concat((f=this._joinInfo)===null||f===void 0?void 0:f.apResponse.cid,"_").concat((m=this._joinInfo)===null||m===void 0?void 0:m.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(_=$("FINGERPRINT"))!==null&&_!==void 0?_:e.fingerprint}]},v,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(i).catch(o)})}_handleGatewaySignalEvents(){this._gateway.signal.on(at.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(at.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(at.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(at.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(at.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(at.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams,deleted:[]},!0)}),this._gateway.signal.on(at.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(at.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(at.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,He.AUDIO,!0)),this._gateway.signal.on(at.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,He.AUDIO,!1)),this._gateway.signal.on(at.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,He.VIDEO,!0)),this._gateway.signal.on(at.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,He.VIDEO,!1)),this._gateway.signal.on(at.RECEIVE_METADATA,e=>{let t=ap(e.metadata);this.safeEmit(bt.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(at.ON_DATA_STREAM,async e=>{var t;if(!e)return;let i=ap(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ke(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<lm)throw new se(W.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(lm));i=await async function(a,l,u){let f=u.subarray(0,lm),m=f.slice(8,lm),_=(m[0]<<8)+m[1],v=(f[6]<<8)+f[7],S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a,tagLength:BM,additionalData:new Uint8Array(jM(_,2))},l,u.subarray(lm));return new Uint8Array(S).subarray(0,v)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){let a=this._p2pChannel.getStats(),l=this.remoteUsers.find(f=>f.uid===e.uid),u=a==null?void 0:a.audioRecv.find(f=>f.ssrc===(l==null?void 0:l._audioSSRC));o=u==null?void 0:u.jitterBufferMs}o==null&&(o=0),rne(js(js({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(at.ON_CRYPT_ERROR,()=>{su(()=>{I.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(bt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(at.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(at.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{I.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ct.TOKEN_EXPIRE),this.safeEmit(bt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(at.ON_STREAM_FALLBACK_UPDATE,e=>{I.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(bt.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(at.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),I.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(at.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(at.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Fe.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Ye.PUBLISH:{if(!t)return;let a=t.ortc;if(a){var i,o;let l=a.some(m=>{let{stream_type:_}=m;return _===Xt.Audio}),u=a.some(m=>{let{stream_type:_}=m;return _!==Xt.Audio}),f=a.some(m=>{let{stream_type:_}=m;return _===Xt.Screen||_===Xt.ScreenLow});t.state==="offer"&&Ge.publish(this._joinInfo.sid,{eventElapse:pr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:W.TIMEOUT,audio:l,video:u,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:f,audioName:l?(i=a.find(m=>{let{stream_type:_}=m;return _===Xt.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:u?(o=a.find(m=>{let{stream_type:_}=m;return _!==Xt.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Ye.SUBSCRIBE:t&&Ge.subscribe(this._joinInfo.sid,{succ:!1,ec:W.TIMEOUT,audio:t.stream_type===He.AUDIO,video:t.stream_type===He.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:pr.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(at.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(at.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;$("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!lp(o.string_id||o.stream_id,this.channelName)));let t=[],i=[];for(let o of e.users){let a=this._users.find(v=>v._uintid===o.stream_id);a?a._trust_in_room_=!0:(a=new wu(o.string_id||o.stream_id,o.stream_id),this._users.push(a),this.getListeners(bt.PUBLISHED_USER_LIST).length===0&&(I.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(bt.USER_JOINED,a)));let l=xn.Audio&o.stream_type,u=(xn.Video|xn.LwoVideo)&o.stream_type,f=(65280&o.stream_type)!=0,m=l&&a.hasAudio,_=u&&a.hasVideo;u&&(a._trust_video_stream_added_state_=!0,a._video_added_=!0,a._videoSSRC=o.video_ssrc,a._rtxSsrcId=o.video_rtx),l&&(a._trust_audio_stream_added_state_=!0,a._audio_added_=!0,a._audioSSRC=o.audio_ssrc),l&&!m&&this.getListeners(bt.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published audio")),this.safeEmit(bt.USER_PUBLISHED,a,"audio")),u&&!_&&this.getListeners(bt.PUBLISHED_USER_LIST).length===0&&(I.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published video")),this.safeEmit(bt.USER_PUBLISHED,a,"video")),(l&&!m||u&&!_||f)&&t.push(a),u&&this._p2pChannel.hasPendingRemoteMedia(a,"video")&&i.push({user:a,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(a,"audio")&&i.push({user:a,mediaType:"audio"})}i.length>0&&(I.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{I.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(bt.PUBLISHED_USER_LIST).length>0?$("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(I.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(o=>o.uid).join(", "))),this.safeEmit(bt.PUBLISHED_USER_LIST,t)):I.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(at.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof cS&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(i=>i.toLowerCase()).filter(i=>{var o;return ke(o=Object.keys(cm)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(at.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on($i.PUBLISH,(e,t,i)=>{let{uid:o}=e;e.forEach(a=>{let{kind:l,ssrcs:u,mid:f,isMuted:m}=a;this._handleP2PAddAudioOrVideoStream(l,o,u[0].ssrcId,f);let _=this._users.find(v=>v.uid===o);return _&&this._p2pChannel instanceof Wo?this._p2pChannel.mockSubscribe(_,l,u[0].ssrcId,f).then(()=>{t()}).catch(i):t(),this._handleMuteStream(o,l,!!m)})}),this._gateway.signal.on($i.CALL,async(e,t,i)=>{if(this._p2pChannel instanceof Wo)try{var o;t(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(a){i(a)}}),this._gateway.signal.on(Fe.P2P_CONNECTION,async e=>{this._p2pChannel instanceof Wo&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on($i.UNPUBLISH,async(e,t,i)=>{if(this._p2pChannel instanceof Wo){let{unpubMsg:o,uid:a}=e,l=this._users.find(u=>u.uid===a);if(!l)return I.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(a)),void t();try{o.forEach(async u=>{let{stream_type:f}=u,m=f===Xt.Audio?He.AUDIO:He.VIDEO;await this._p2pChannel.unsubscribe(l,m),this._handleMuteStream(a,m,!0)}),t()}catch(u){i(u)}}}),this._gateway.signal.on($i.CONTROL,async(e,t)=>{let{action:i}=e;switch(i){case uu.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,He.VIDEO,!0);break;case uu.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,He.AUDIO,!0);break;case uu.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,He.VIDEO,!1);break;case uu.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,He.AUDIO,!1)}}),this._gateway.signal.on($i.RESTART_ICE,async(e,t,i)=>{if(this._p2pChannel instanceof Wo)try{let{direction:o,iceParameter:a}=e;o!==Vr.SEND_ONLY||a?t(await this._p2pChannel.restartICE(o,a)):(this._p2pChannel.handleDisconnect(o),t())}catch(o){i(o)}}),this._gateway.signal.on($i.CANDIDATE,e=>{if(this._p2pChannel instanceof Wo){let{candidate:t,direction:i}=e;this._p2pChannel.addRemoteCandidate(t,i)}}),this._p2pChannel.on(et.RequestP2PRestartICE,async(e,t,i)=>{try{let{direction:o}=e;t(await this._gateway.sendExtensionMessage($i.RESTART_ICE,e,o===Vr.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(et.LocalCandidate,e=>{this._gateway.sendExtensionMessage($i.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(et.RequestP2PMuteLocal,async(e,t,i)=>{try{await this._gateway.sendExtensionMessage($i.CONTROL,e,!0),t()}catch(o){i(o)}}),this._p2pChannel.on(et.RequestP2PUnmuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===W.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(et.RequestP2PMuteRemote,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===W.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(et.StateChange,(e,t)=>{t===ei.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(et.RequestMuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===W.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(et.RequestUnmuteLocal,async(e,t,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(o){o.code===W.DISCONNECT_P2P?t():i(o)}else t()}),this._p2pChannel.on(et.RequestRePublish,(e,t,i)=>{this.publish(e,!1).then(t).catch(i)}),this._p2pChannel.on(et.RequestRePublishDataChannel,(e,t,i)=>{De.all(e.map(async o=>{await this._p2pChannel.publishDataChannel([o]);let a={streamId:o.id,ordered:o.ordered,maxRetransmits:o.maxRetransmits,metadata:o.metadata,channelId:o._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,a,!0)}catch(l){if(l.code!==W.DISCONNECT_P2P)throw l}})).then(t).catch(i)}),this._p2pChannel.on(et.RequestReSubscribe,async(e,t,i)=>{try{for(let{user:o,kind:a}of e)a===He.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");t()}catch(o){i(o)}}),this._p2pChannel.on(et.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(et.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(et.MediaReconnectStart,e=>{this.safeEmit(bt.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(et.MediaReconnectEnd,e=>{this.safeEmit(bt.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(et.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(et.RequestRestartICE,async e=>{if(this._p2pChannel instanceof Wo)return;let t=await this._p2pChannel.restartICE(e),i=await t.next();if(i.done)return;let o=i.value,a;try{a=await this._gateway.restartICE({iceParameters:o})}catch(u){return void t.throw(u)}let{iceParameters:l}=function(u){let f=u.iceParameters;return{iceParameters:{iceUfrag:f.iceUfrag,icePwd:f.icePwd}}}(a);await t.next({remoteIceParameters:l})}),this._p2pChannel.on(et.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(et.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:a,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:i,rtpCapabilities:o}),{dtlsParameters:u,iceParameters:f,candidates:m,rtpCapabilities:_,setup:v,cname:S}=vF(a,l);await this._p2pChannel.connect(f,u,m,_,v,S),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(et.RequestUnpublishForReconnectPC,async(e,t,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):i()}),this._p2pChannel.on(et.P2PLost,()=>{this.safeEmit(bt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(et.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(et.ConnectionTypeChange,e=>{this.safeEmit(bt.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(et.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(et.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{let t=[...new Set(e.inspectType)];t.forEach(i=>{var o;if(!ke(o=["supervise","moderation"]).call(o,i))throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(i," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{let t=new lS(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},nn)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Gl(e,"enabled"),e){if(!t)throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(si(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(t&&t.vendor&&t.vendor.length>1024)throw new se(W.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);let i=new eA(t);this._moderation=i,this.handleImageModerationEvents(this._moderation),await i.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},nn)}catch(i){throw Array.isArray(i)?i[0]:i}}else{if(!this._moderation)throw new se(W.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}setP2PTransport(e){if(function(t){Cn(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new se(W.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,I.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}handleImageModerationEvents(e){e.on(ac.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(bt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,i),t===xs.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new se(W.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(ac.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Bn.CONNECTION_STATE_CHANGE,(t,i)=>{if(this.safeEmit(bt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,i),i===ha.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(bt.CONTENT_INSPECT_ERROR,new se(W.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Bn.INSPECT_RESULT,(t,i)=>{var o;if((i==null?void 0:i.code)===W.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return I.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(bt.CONTENT_INSPECT_RESULT,t,i)}),e.on(Bn.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return I.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Gl(e,"enabled"),ai("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Ne(Me.prototype,"leave",[zB],Object.getOwnPropertyDescriptor(Me.prototype,"leave"),Me.prototype),Ne(Me.prototype,"publish",[HB],Object.getOwnPropertyDescriptor(Me.prototype,"publish"),Me.prototype),Ne(Me.prototype,"unpublish",[GB],Object.getOwnPropertyDescriptor(Me.prototype,"unpublish"),Me.prototype),Ne(Me.prototype,"subscribe",[KB],Object.getOwnPropertyDescriptor(Me.prototype,"subscribe"),Me.prototype),Ne(Me.prototype,"presubscribe",[qB],Object.getOwnPropertyDescriptor(Me.prototype,"presubscribe"),Me.prototype),Ne(Me.prototype,"massSubscribe",[YB],Object.getOwnPropertyDescriptor(Me.prototype,"massSubscribe"),Me.prototype),Ne(Me.prototype,"unsubscribe",[$B],Object.getOwnPropertyDescriptor(Me.prototype,"unsubscribe"),Me.prototype),Ne(Me.prototype,"massUnsubscribe",[XB],Object.getOwnPropertyDescriptor(Me.prototype,"massUnsubscribe"),Me.prototype),Ne(Me.prototype,"setLowStreamParameter",[JB],Object.getOwnPropertyDescriptor(Me.prototype,"setLowStreamParameter"),Me.prototype),Ne(Me.prototype,"enableDualStream",[ZB],Object.getOwnPropertyDescriptor(Me.prototype,"enableDualStream"),Me.prototype),Ne(Me.prototype,"disableDualStream",[QB],Object.getOwnPropertyDescriptor(Me.prototype,"disableDualStream"),Me.prototype),Ne(Me.prototype,"setClientRole",[e5],Object.getOwnPropertyDescriptor(Me.prototype,"setClientRole"),Me.prototype),Ne(Me.prototype,"setProxyServer",[t5],Object.getOwnPropertyDescriptor(Me.prototype,"setProxyServer"),Me.prototype),Ne(Me.prototype,"setTurnServer",[i5],Object.getOwnPropertyDescriptor(Me.prototype,"setTurnServer"),Me.prototype),Ne(Me.prototype,"setLicense",[n5],Object.getOwnPropertyDescriptor(Me.prototype,"setLicense"),Me.prototype),Ne(Me.prototype,"startProxyServer",[r5],Object.getOwnPropertyDescriptor(Me.prototype,"startProxyServer"),Me.prototype),Ne(Me.prototype,"stopProxyServer",[o5],Object.getOwnPropertyDescriptor(Me.prototype,"stopProxyServer"),Me.prototype),Ne(Me.prototype,"setLocalAccessPointsV2",[s5],Object.getOwnPropertyDescriptor(Me.prototype,"setLocalAccessPointsV2"),Me.prototype),Ne(Me.prototype,"setLocalAccessPoints",[a5],Object.getOwnPropertyDescriptor(Me.prototype,"setLocalAccessPoints"),Me.prototype),Ne(Me.prototype,"setRemoteDefaultVideoStreamType",[c5],Object.getOwnPropertyDescriptor(Me.prototype,"setRemoteDefaultVideoStreamType"),Me.prototype),Ne(Me.prototype,"setRemoteVideoStreamType",[l5],Object.getOwnPropertyDescriptor(Me.prototype,"setRemoteVideoStreamType"),Me.prototype),Ne(Me.prototype,"setStreamFallbackOption",[d5],Object.getOwnPropertyDescriptor(Me.prototype,"setStreamFallbackOption"),Me.prototype),Ne(Me.prototype,"setEncryptionConfig",[u5],Object.getOwnPropertyDescriptor(Me.prototype,"setEncryptionConfig"),Me.prototype),Ne(Me.prototype,"renewToken",[h5],Object.getOwnPropertyDescriptor(Me.prototype,"renewToken"),Me.prototype),Ne(Me.prototype,"enableAudioVolumeIndicator",[p5],Object.getOwnPropertyDescriptor(Me.prototype,"enableAudioVolumeIndicator"),Me.prototype),Ne(Me.prototype,"startLiveStreaming",[f5],Object.getOwnPropertyDescriptor(Me.prototype,"startLiveStreaming"),Me.prototype),Ne(Me.prototype,"setLiveTranscoding",[m5],Object.getOwnPropertyDescriptor(Me.prototype,"setLiveTranscoding"),Me.prototype),Ne(Me.prototype,"stopLiveStreaming",[g5],Object.getOwnPropertyDescriptor(Me.prototype,"stopLiveStreaming"),Me.prototype),Ne(Me.prototype,"addInjectStreamUrl",[_5],Object.getOwnPropertyDescriptor(Me.prototype,"addInjectStreamUrl"),Me.prototype),Ne(Me.prototype,"removeInjectStreamUrl",[E5],Object.getOwnPropertyDescriptor(Me.prototype,"removeInjectStreamUrl"),Me.prototype),Ne(Me.prototype,"startChannelMediaRelay",[v5],Object.getOwnPropertyDescriptor(Me.prototype,"startChannelMediaRelay"),Me.prototype),Ne(Me.prototype,"updateChannelMediaRelay",[y5],Object.getOwnPropertyDescriptor(Me.prototype,"updateChannelMediaRelay"),Me.prototype),Ne(Me.prototype,"stopChannelMediaRelay",[S5],Object.getOwnPropertyDescriptor(Me.prototype,"stopChannelMediaRelay"),Me.prototype),Ne(Me.prototype,"sendCustomReportMessage",[T5],Object.getOwnPropertyDescriptor(Me.prototype,"sendCustomReportMessage"),Me.prototype),Ne(Me.prototype,"pickSVCLayer",[w5],Object.getOwnPropertyDescriptor(Me.prototype,"pickSVCLayer"),Me.prototype),Ne(Me.prototype,"setRTMConfig",[C5],Object.getOwnPropertyDescriptor(Me.prototype,"setRTMConfig"),Me.prototype),Ne(Me.prototype,"enableContentInspect",[b5],Object.getOwnPropertyDescriptor(Me.prototype,"enableContentInspect"),Me.prototype),Ne(Me.prototype,"disableContentInspect",[R5],Object.getOwnPropertyDescriptor(Me.prototype,"disableContentInspect"),Me.prototype),Ne(Me.prototype,"setImageModeration",[I5],Object.getOwnPropertyDescriptor(Me.prototype,"setImageModeration"),Me.prototype),Ne(Me.prototype,"setP2PTransport",[A5],Object.getOwnPropertyDescriptor(Me.prototype,"setP2PTransport"),Me.prototype),Ne(Me.prototype,"getJoinChannelServiceRecords",[O5],Object.getOwnPropertyDescriptor(Me.prototype,"getJoinChannelServiceRecords"),Me.prototype),Ne(Me.prototype,"setPublishAudioFilterEnabled",[P5],Object.getOwnPropertyDescriptor(Me.prototype,"setPublishAudioFilterEnabled"),Me.prototype),Me);class RE{constructor(t,i){U(this,"id",0),U(this,"element",void 0),U(this,"peerPair",void 0),U(this,"context",void 0),U(this,"audioPlayerElement",void 0),U(this,"audioTrack",void 0),RE.count+=1,this.id=RE.count,this.element=t,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let i=document.createElement("audio");i.srcObject=new MediaStream([t.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let t=async(o,a)=>{let l=a==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(l),o.iceGatheringState==="complete"?o.localDescription:new De(u=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&u(o.localDescription)}})},i=async(o,a)=>await o.setRemoteDescription(a);try{let o=await t(this.peerPair[0],"offer");await i(this.peerPair[1],o);let a=await t(this.peerPair[1],"answer");await i(this.peerPair[0],a)}catch(o){throw new se(W.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let i;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(i)}catch(a){throw new se(W.LOCAL_AEC_ERROR,a.toString()).print()}if(!i)throw new se(W.LOCAL_AEC_ERROR,"no dest node when local aec").print();let o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,i=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){I.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var x5,mS;U(RE,"count",0);let dne=window.AudioContext||window.webkitAudioContext,une=new(x5=Ze({report:Ge}),Ne((mS=class{constructor(){U(this,"units",[]),U(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return I.debug("the system does not need to process local aec"),-1;this.context||(this.context=new dne);let t=this.units.find(i=>i&&i.getElement()===e);return t||(t=new RE(e,this.context),this.units.push(t)),t.startEchoCancellation(),I.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Ut().name!==$t.SAFARI}}).prototype,"processExternalMediaAEC",[x5],Object.getOwnPropertyDescriptor(mS.prototype,"processExternalMediaAEC"),mS.prototype),mS);function D5(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),i.push.apply(i,o)}return i}function k5(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?D5(Object(i),!0).forEach(function(o){U(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D5(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let aA=window||document;function L5(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!aA)return;let i=hn._cspEventHandlerPointer;if(i&&t)return void console.error(i,t);let o=a=>{if(!(a&&a.blockedURI&&(hn.onSecurityPolicyViolation||hn.getListeners(Zc.SECURITY_POLICY_VIOLATION).length>0)))return;let l=a.blockedURI;$("CSP_DETECTED_HOSTNAME_LIST").some(u=>ke(l).call(l,u))&&(hn.onSecurityPolicyViolation&&typeof hn.onSecurityPolicyViolation=="function"&&hn.onSecurityPolicyViolation(a),hn.getListeners(Zc.SECURITY_POLICY_VIOLATION).length>0&&hn.safeEmit(Zc.SECURITY_POLICY_VIOLATION,a))};i&&aA.removeEventListener("securitypolicyviolation",i),(t||e&&typeof e=="function"||hn.getListeners(Zc.SECURITY_POLICY_VIOLATION).length>0)&&aA.addEventListener("securitypolicyviolation",o),hn._cspEventHandlerPointer=o}ai("PROCESS_ID","process-".concat(di(8,""),"-").concat(di(4,""),"-").concat(di(4,""),"-").concat(di(4,""),"-").concat(di(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void I.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),i=Date.now();I.debug("Loading global parameters from cache",t),Object.keys(t).forEach(o=>{if(Object.prototype.hasOwnProperty.call(vn,o)){let{value:a,expires:l}=t[o];if(l&&l<=i)return;cu[o]=a,vn[o]=a}})}catch(t){I.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(cu.AREAS)&&cu.AREAS.length>0&&TR(cu.AREAS,!0);let M5=(e,t,i)=>{I.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),ai(e,t,i)},hn=function(e){let t=new Ii,i=e,o={getListeners:t.getListeners.bind(t),on:(a,l)=>(function(u,f){u===Zc.SECURITY_POLICY_VIOLATION&&L5(f,!0)}(a,l),t.on.bind(t)(a,l)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return k5(k5({},i),o)}({__TRACK_LIST__:Om,VERSION:Ps,BUILD:oR,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:M5,getParameter:$,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,i=await async function(o){let a;return xt().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),a=(await o.createOffer()).sdp):a=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,a}(t);if(!i)return e;t.close(),t=null,e=function(o){let a={video:[],audio:[]};return o.match(/ VP8/i)&&a.video.push("VP8"),o.match(/ VP9/i)&&a.video.push("VP9"),o.match(/ AV1/i)&&a.video.push("AV1"),o.match(/ H264/i)&&a.video.push("H264"),o.match(/ H265/i)&&a.video.push("H265"),o.match(/ opus/i)&&a.audio.push("OPUS"),o.match(/ PCMU/i)&&a.audio.push("PCMU"),o.match(/ PCMA/i)&&a.audio.push("PCMA"),o.match(/ G722/i)&&a.audio.push("G722"),a}(i)}catch(t){throw new se(W.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=Ge.reportApiInvoke(null,{name:ln.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Ui.TRACER}),t=!1;try{let l=window.RTCPeerConnection,u=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,f=window.WebSocket;t=!!(l&&u&&f),t&&qb()&&function(m){let _=Ut();return!(_.name!==$t.CHROME||!_.osVersion)&&Number(_.version)<m}(75)&&new l().close()}catch(l){return I.error("check system requirement failed: ",l),!1}let i=!1,o=Ut();o.name===$t.CHROME&&Number(o.version)>=58&&(rc.engine.name!=="WebKit"||function(){let l=Ut();if($y()){if(l.os===On.MAC_OS)return!0;if(l.os===On.IOS){let u=rc.os.version&&rc.os.version.split(".");if(u&&Number(u[0])===14&&u[1]&&Number(u[1])>=3||u&&Number(u[0])>14)return!0}}return!1}())&&(i=!0),(o.name===$t.FIREFOX&&Number(o.version)>=56||o.name===$t.OPERA&&Number(o.version)>=45||o.name===$t.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(ur()||da())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||vM()||Ut().name===$t.QQ)&&(i=!0),I.debug("checkSystemRequirements, api:",t,"browser",i);let a=t&&i;return e.onSuccess(a),a},getDevices:function(e){return fs.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return fs.getRecordingDevices(e)},getCameras:function(e){return fs.getCamerasDevices(e)},getElectronScreenSources:lj,getPlaybackDevices:function(e){return fs.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=Ge.reportApiInvoke(null,{name:ln.CREATE_CLIENT,options:[t],tag:Ui.TRACER});try{(function(o){Cn(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Cn(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&Cn(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&Gn(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&OM(o.turnServer),o.httpRetryConfig!==void 0&&AM(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&AM(o.websocketRetryConfig)})(t)}catch(o){throw i.onError(o),o}return(pM(16,0)||fM(16,0))&&(t.codec==="vp9"&&(t.codec="vp8",I.debug("browser not support vp9, force use vp8")),ai("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new lne(js(js({forceWaitGatewayResponse:!0},t),{},{role:ke(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=$("CAMERA_CAPTURE_CONFIG"),i=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_CAM_VIDEO_TRACK,options:[Ai({},e),t]});t&&(e.encoderConfig=t);let o=B0(e),a=di(8,"track-cam-"),l=null,u=e.encoderConfig==="720p_auto";I.info("start create camera video track with config",JSON.stringify(e),"trackId",a);try{l=(await ps({video:o},a)).getVideoTracks()[0]||null}catch(m){throw i.onError(m),m}if(!l){let m=new fe(W.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(m),m.throw(I)}e.optimizationMode&&PI(a,l,e,rl(e.encoderConfig));let f=new OI(l,e,o,e.scalabiltyMode?U0(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a);return u&&f.startMonitorStats(),i.onSuccess(f.getTrackId()),I.info("create camera video success, trackId:",a),f},createCustomVideoTrack:function(e){let t=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new ui(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?U0(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,di(8,"track-cus-"),[gi.CUSTOM_TRACK]);return t.onSuccess(i.getTrackId()),I.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_SCREEN_VIDEO_TRACK,options:[Ai({},e),t]}),o=e.encoderConfig==="720p_auto";e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let a=function(S){let C={};S.screenSourceType&&(C.mediaSource=S.screenSourceType),S.extensionId&&ru()&&(C.extensionId=S.extensionId);let{displaySurface:b,selfBrowserSurface:V,surfaceSwitching:P,systemAudio:k}=S;(Gb(107)||uM(107)||mM(93))&&(b&&(Cn(b,"displaySurface",["browser","window","monitor"]),C.displaySurface=b),V?(Cn(V,"selfBrowserSurface",["exclude","include"]),C.selfBrowserSurface=V):C.selfBrowserSurface="include",P&&(Cn(P,"surfaceSwitching",["exclude","include"]),C.surfaceSwitching=P)),(Gb(105)||uM(105)||mM(91))&&k&&(Cn(k,"systemAudio",["exclude","include"]),C.systemAudio=k),S.electronScreenSourceId&&(C.sourceId=S.electronScreenSourceId);let F=S.encoderConfig?EI(S.encoderConfig):null;return C.mandatory={chromeMediaSource:"desktop",maxWidth:F?F.width:void 0,maxHeight:F?F.height:void 0},F&&(F.frameRate&&(typeof F.frameRate=="number"?(C.mandatory.maxFrameRate=F.frameRate,C.mandatory.minFrameRate=F.frameRate):(C.mandatory.maxFrameRate=F.frameRate.max||F.frameRate.ideal||F.frameRate.exact||void 0,C.mandatory.minFrameRate=F.frameRate.min||F.frameRate.ideal||F.frameRate.exact||void 0),C.frameRate=F.frameRate),F.width&&(C.width=F.width),F.height&&(C.height=F.height)),C}(e),l=di(8,"track-scr-v-"),u=null,f=null,m=xt();if(!m.supportShareAudio&&t==="enable"){let S=new fe(W.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(S),S.throw(I)}I.info("start create screen video track with config",e,"withAudio",t,"trackId",l);try{let S=await ps({screen:a,screenAudio:t==="auto"?m.supportShareAudio:t==="enable"},l);u=S.getVideoTracks()[0]||null,f=S.getAudioTracks()[0]||null}catch(S){throw i.onError(S),S}if(!u){let S=new fe(W.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(S),S.throw(I)}if(!f&&t==="enable"){u&&u.stop();let S=new fe(W.SHARE_AUDIO_NOT_ALLOWED);return i.onError(S),S.throw(I)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(PI(l,u,e,e.encoderConfig&&EI(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let _=new ui(u,e.encoderConfig?EI(e.encoderConfig):{},e.scalabiltyMode?U0(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,l,[gi.SCREEN_TRACK]);if(o&&_.startMonitorStats(),!f)return i.onSuccess(_.getTrackId()),I.info("create screen video track success","video:",_.getTrackId()),_;let v=new Bi(f,void 0,di(8,"track-scr-a-"),!1);return i.onSuccess([_.getTrackId(),v.getTrackId()]),I.info("create screen video track success","video:",_.getTrackId(),"audio:",v.getTrackId()),[_,v]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=$("CAMERA_CAPTURE_CONFIG"),o=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,i]});i&&(t.encoderConfig=i);let a=t.encoderConfig==="720p_auto",l=B0(t),u=vj(e),f=di(8,"track-mic-"),m=di(8,"track-cam-"),_=null,v=null;I.info("start create camera video track(".concat(m,") and microphone audio track(").concat(f,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let b=await ps({audio:u,video:l},"".concat(f,"-").concat(m));_=b.getAudioTracks()[0],v=b.getVideoTracks()[0]}catch(b){throw o.onError(b),b}if(!_||!v){let b=new fe(W.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(b),b.throw(I)}t.optimizationMode&&PI(m,v,t,rl(t.encoderConfig));let S=new W0(_,e,u,f),C=new OI(v,t,l,t.scalabiltyMode?U0(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,m);return a&&C.startMonitorStats(),o.onSuccess([S.getTrackId(),C.getTrackId()]),I.info("create camera video track(".concat(m,") and microphone audio track(").concat(f,") success")),[S,C]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=vj(e),o=di(8,"track-mic-"),a=null;I.info("start create microphone audio track with config",JSON.stringify(e),"trackId",o);try{a=(await ps({audio:i},o)).getAudioTracks()[0]||null}catch(u){throw t.onError(u),u}if(!a){let u=new fe(W.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(u),u.throw(I)}let l=new W0(a,e,i,o);return t.onSuccess(l.getTrackId()),I.info("create microphone audio track success, trackId:",o),l},createCustomAudioTrack:function(e){let t=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Bi(e.mediaStreamTrack,e.encoderConfig?j0(e.encoderConfig):{},di(8,"track-cus-"),!1);return I.info("create custom audio track success with config",e,"trackId",i.getTrackId()),t.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:i,encoderConfig:o}=e,{source:a}=e,l={source:a instanceof AudioBuffer?"AudioBuffer":a instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":a,cacheOnlineFile:i,encoderConfig:o},u=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if($("DISABLE_WEBAUDIO"))throw new fe(W.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let f=di(8,"track-buf-");I.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",f);let m=a;if(!(a instanceof AudioBuffer))try{a=await async function(S,C){let b=null;if(typeof S=="string"){let P=oV.get(S);if(P)return I.debug("use cached audio resource: ",S),P;try{b=(await oc(()=>Qr.get(S,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(k){throw new fe(W.FETCH_AUDIO_FILE_FAILED,k.toString())}}else b=await new De((P,k)=>{let F=new FileReader;F.onload=H=>{H.target?P(H.target.result):k(new fe(W.READ_LOCAL_AUDIO_FILE_ERROR))},F.onerror=()=>{k(new fe(W.READ_LOCAL_AUDIO_FILE_ERROR))},F.readAsArrayBuffer(S)});let V=await function(P){let k=km();return new De((F,H)=>{k.decodeAudioData(P,ie=>{F(ie)},ie=>{H(new fe(W.DECODE_AUDIO_FILE_FAILED,ie.toString()))})})}(b);return typeof S=="string"&&C&&oV.set(S,V),V}(a,i)}catch(S){return u.onError(S),S.throw(I)}let _=new oie(a),v=new rie(m,_,o?j0(o):{},f);return I.info("create buffer source audio track success, trackId:",f),u.onSuccess(v.getTrackId()),v},setAppType:function(e){if(I.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw I.debug("Invalid appType"),new se(W.INVALID_PARAMS,"invalid app type",e);ai("APP_TYPE",Math.floor(e))},setLogLevel:function(e){I.setLogLevel(e)},enableLogUpload:function(){$("USE_NEW_LOG")?ai("UPLOAD_LOG",!0):I.enableLogUpload()},disableLogUpload:function(){$("USE_NEW_LOG")?ai("UPLOAD_LOG",!1):I.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new HF},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Bi||e instanceof Um)){let m=new se(W.INVALID_TRACK,"the parameter is not a audio track");return i.onError(m),m.throw()}t&&t<1e3&&(t=1e3);let o=e instanceof Bi?e.getTrackLabel():"remote_track",a=e.getVolumeLevel(),l=a,u=a,f=Date.now();return new De(m=>{let _=setInterval(()=>{let v=e.getVolumeLevel();l=v>l?v:l,u=v<u?v:u;let S=l-u>1e-4,C=Date.now()-f;if(S||C>t){clearInterval(_);let b=S,V={duration:C,deviceLabel:o,maxVolumeLevel:l,result:b};I.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(V))),i.onSuccess(V),m(b)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=Ge.reportApiInvoke(null,{tag:Ui.TRACER,name:ln.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ui||e instanceof Mm)){let S=new se(W.INVALID_TRACK,"the parameter is not a video track");return i.onError(S),S.throw()}t&&t<1e3&&(t=1e3);let o=e instanceof ui?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(Pn()||$y())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([a]),l.play();let u=document.createElement("canvas");u.width=160,u.height=120;let f=0,m=0;try{let S=Date.now();f=await function(C,b,V,P){let k,F=0,H=null;return new De((ie,oe)=>{function ae(){F>P&&k&&(k(),ie(F));let he=V.getContext("2d");if(!he){let Ce=new se(W.UNEXPECTED_ERROR,"can not get canvas 2d context.");return I.error(Ce.toString()),void oe(Ce)}he.drawImage(C,0,0,160,120);let Ee=he.getImageData(0,0,V.width,V.height),ye=Math.floor(Ee.data.length/3);if(H){for(let Ce=0;Ce<ye;Ce+=3)if(Ee.data[Ce]!==H[Ce])return F+=1,void(H=Ee.data);H=Ee.data}else H=Ee.data}setTimeout(()=>{k&&(k(),ie(F))},b),k=wI(()=>{ae()},30)})}(l,t,u,4),m=Date.now()-S}catch(S){throw i.onError(S),S}one===$t.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;let _=f>4,v={duration:m,changedPicNum:f,deviceLabel:o,result:_};return I.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(v))),i.onSuccess(v),_},setArea:TR,audioElementPlayCenter:to,resumeAudioContext:function(){to.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){une.processExternalMediaAEC(e)},registerExtensions:function(e){let t=$("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!ke(t).call(t,i.name)&&t.push(i.name);let o=i;o.__registered__=!0,o.logger.hookLog=I.extLog,o.reporter.hookApiInvoke=Ge.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(a=>{o.parameters[a]=$(a)})}),M5("PLUGIN_INFO",t)},ChannelMediaRelayError:um,ChannelMediaRelayEvent:ql,ChannelMediaRelayState:go,RemoteStreamFallbackType:Jte,RemoteStreamType:Xte,ConnectionDisconnectedReason:Ct,AudienceLatencyLevelType:lZ,AREAS:Ft,preload:async function(e,t,i,o){return MB(e,t,i,o)}});return Object.defineProperties(hn,{onAudioAutoplayFailed:{get:()=>ms.onAudioAutoplayFailed,set:e=>{ms.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ms.onAutoplayFailed,set:e=>{ms.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>hn._onSecurityPolicyViolation,set(e){hn._onSecurityPolicyViolation=e,L5(e)}},__CLIENT_LIST__:{get:()=>$("SHOW_GLOBAL_CLIENT_LIST")?lu:[]}}),fs.on(Tp.CAMERA_DEVICE_CHANGED,e=>{I.info("camera device changed",JSON.stringify(e)),hn.onCameraChanged&&hn.onCameraChanged(e),hn.safeEmit(Zc.CAMERA_CHANGED,e)}),fs.on(Tp.RECORDING_DEVICE_CHANGED,e=>{I.info("microphone device changed",JSON.stringify(e)),hn.onMicrophoneChanged&&hn.onMicrophoneChanged(e),hn.safeEmit(Zc.MICROPHONE_CHANGED,e)}),fs.on(Tp.PLAYOUT_DEVICE_CHANGED,e=>{I.debug("playout device changed",JSON.stringify(e)),hn.onPlaybackDeviceChanged&&hn.onPlaybackDeviceChanged(e),hn.safeEmit(Zc.PLAYBACK_DEVICE_CHANGED,e)}),to.onAutoplayFailed=()=>{I.info("detect audio element autoplay failed"),ms.onAudioAutoplayFailed&&ms.onAudioAutoplayFailed()},ni.on("autoplay-failed",()=>{I.info("detect webaudio autoplay failed"),ms.onAudioAutoplayFailed&&ms.onAudioAutoplayFailed(),hn.safeEmit(Zc.AUTOPLAY_FAILED)}),ni.on(Kn.STATE_CHANGE,(e,t)=>{I.info("audio context state changed: ".concat(t," => ").concat(e)),hn.onAudioContextStateChanged&&hn.onAudioContextStateChanged(e,t),hn.safeEmit(Zc.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),ji.on(rp.NETWORK_STATE_CHANGE,(e,t)=>{I.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=hn),hn})}),JG={};kge(JG,{AgoraRTCProvider:()=>e8,AgoraRTCReactError:()=>Ko,AgoraRTCScreenShareProvider:()=>Gge,LocalAudioTrack:()=>c8,LocalUser:()=>a_e,LocalVideoTrack:()=>ZN,RemoteAudioTrack:()=>h8,RemoteUser:()=>gP,RemoteVideoTrack:()=>p8,TrackBoundary:()=>r_e,VERSION:()=>d_e,default:()=>f8,useAutoPlayAudioTrack:()=>XN,useAutoPlayVideoTrack:()=>$N,useClientEvent:()=>Wge,useConnectionState:()=>qge,useCurrentUID:()=>Yge,useIsConnected:()=>wd,useJoin:()=>i8,useLocalCameraTrack:()=>o8,useLocalMicrophoneTrack:()=>r8,useLocalScreenTrack:()=>i_e,useNetworkQuality:()=>$ge,usePublish:()=>n8,useRTCClient:()=>ja,useRTCScreenShareClient:()=>Kge,useRemoteAudioTracks:()=>s8,useRemoteUserTrack:()=>mP,useRemoteUsers:()=>a8,useRemoteVideoTracks:()=>e_e,useTrackEvent:()=>zge,useVolumeLevel:()=>Jge});var Mge=cf(lf());function Ao(n,r,s){return n.on(r,s),()=>n.off(r,s)}function Uge(n){try{return n()}catch(r){console.error(r)}}function df(n){return()=>n.forEach(Uge)}function jge(n,r){let s=setInterval(n,r);return()=>clearInterval(s)}function Fw(n,r){let s=setTimeout(n,r);return()=>clearTimeout(s)}function qN(){let n,r,s;function c(){if(r){let R=r;r=void 0,R()}}async function d(){if(s){let R=s;s=void 0;try{await R()}catch(N){console.error(N)}}}async function p(R){n=!0,await d();try{s=await R()}catch(N){console.error(N)}n=!1,c()}async function g(){n=!0,await d(),n=!1,c()}function y(R){n?r=()=>p(R):p(R)}function T(){n?r=g:g()}return{run:y,dispose:T}}var Bw=typeof document<"u"?le.useLayoutEffect:le.useEffect;function Vge(n){return n!=null&&typeof n.then=="function"}function hh(){let n=le.useRef(!1);return le.useEffect(()=>(n.current=!1,()=>{n.current=!0}),[]),n}function Fge(){let n=hh();function r(s,c){return new Promise(async(d,p)=>{try{let g=await s;n.current||d(g)}catch(g){n.current?c&&c(g):p(g)}})}return le.useCallback(r,[n])}function ZG(n){let r=Fge(),[s,c]=le.useState();return Bw(()=>{Vge(n)?r(n).then(c):c(n)},[n,r]),s}function uf(n,r){let s=le.useRef();le.useEffect(()=>{let{run:c,dispose:d}=s.current||(s.current=qN());return c(n),d},r)}function Bge(n,r){let s=n.split("."),c=r.split("."),d=Math.max(s.length,c.length);for(let p=0;p<d;p++){let g=parseInt(s[p]||"0"),y=parseInt(c[p]||"0");if(g>y)return 1;if(g<y)return-1}return 0}function Wge(n,r,s){let c=le.useRef(s);Bw(()=>{c.current=s},[s]),le.useEffect(()=>{if(n)return Ao(n,r,(...d)=>{c.current&&c.current(...d)})},[r,n])}function zge(n,r,s){let c=le.useRef(s);Bw(()=>{c.current=s},[s]),le.useEffect(()=>{if(n)return Ao(n,r,(...d)=>{c.current&&c.current(...d)})},[r,n])}var QG=le.createContext(null);function e8({client:n,children:r}){return O.jsx(QG.Provider,{value:n,children:r})}function Hge(n){let r=le.useContext(QG);return n||r}function ja(n){let r=Hge(n);if(!r)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return r}var t8=le.createContext(null);function Gge({client:n,children:r}){return O.jsx(t8.Provider,{value:n,children:r})}function Kge(n){let r=le.useContext(t8);return n||r}function qge(n){let r=ja(n),[s,c]=le.useState(r?r.connectionState:"DISCONNECTED");return le.useEffect(()=>{if(r){c(r.connectionState);let d;return df([Ao(r,"connection-state-change",p=>{d==null||d(),p==="CONNECTED"?d=Fw(()=>c(p),0):c(p)}),()=>d==null?void 0:d()])}else c("DISCONNECTED")},[r]),s}function wd(n){let r=ja(n),[s,c]=le.useState(r?r.connectionState==="CONNECTED":!1);return le.useEffect(()=>{if(r){c(r.connectionState==="CONNECTED");let d;return df([Ao(r,"connection-state-change",p=>{d==null||d(),d=Fw(()=>c(p==="CONNECTED"),0)}),()=>d==null?void 0:d()])}else c(!1)},[r]),s}function Yge(n){let r=ja(n),[s,c]=le.useState(r==null?void 0:r.uid);return le.useEffect(()=>{if(r)return Ao(r,"connection-state-change",d=>{if(d==="CONNECTED")return Fw(()=>c(r.uid),0);d==="DISCONNECTED"&&c(void 0)})},[r]),s}var Ko=class extends Error{constructor(r,s){var n=(...args)=>{super(...args);ri(this,"rtcMethod");ri(this,"rtcError");ri(this,"name","AgoraRTCReactException")};n(typeof s=="string"?s:s.message),this.rtcMethod=r,this.rtcError=s}log(r){console[r](this)}};function i8(n,r=!0,s){let c=ja(s),d=wd(s),p=le.useRef(),[g,y]=le.useState(!1),[T,R]=le.useState(0),[N,D]=le.useState(null),B=hh();return uf(async()=>{if(B.current||(D(null),R(0),y(!1)),r&&c){try{B.current||y(!0);let{appid:J,channel:Y,token:te,uid:Z}=typeof n=="function"?await n():n,ee=await c.join(J,Y,te,Z);B.current||R(ee)}catch(J){console.error(J),B.current||D(new Ko("IAgoraRTCClient.join",J))}B.current||y(!1);let q=p.current||(p.current=qN());return df([()=>{q.dispose()},()=>{q.run(()=>c.unpublish(c.localTracks))},()=>{for(let J of c.localTracks)J.isPlaying&&J.stop(),J.close();q.run(()=>c.leave())}])}},[r,s]),{data:T,isLoading:g,isConnected:d,error:N}}var WW=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function $ge(n){let r=ja(n),[s,c]=le.useState(WW);return le.useEffect(()=>{if(r)return Ao(r,"network-quality",d=>c({uplinkNetworkQuality:d.uplinkNetworkQuality,downlinkNetworkQuality:d.downlinkNetworkQuality,delay:r.getRTCStats().RTT??0}));c(WW())},[r]),s}var Xge=cf(lf());function n8(n,r=!0,s){let c=ja(s),d=wd(s),p=le.useRef([]),[g,y]=le.useState(!1),[T,R]=le.useState(null),N=hh();return uf(async()=>{if(N.current||(y(!1),R(null)),!c||!d||!r)return;let D=n.filter(Boolean),B=Y=>{let te=Bge(Xge.default.VERSION,"4.18.2")>=0;return te||new Ko("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),te?c.mode!=="live"||c.role!=="audience":!0},q=Y=>p.current.some(te=>te&&te.getTrackId()===Y.getTrackId()),J=Y=>B()&&Y.enabled&&r&&!q(Y);for(let Y=0;Y<D.length;Y++){let te=D[Y];if(te&&J(te)){await c.unpublish(p.current.filter(Z=>(Z==null?void 0:Z.trackMediaType)===te.trackMediaType));try{N.current||y(!0),await c.publish(te)}catch(Z){console.error(Z),N.current||R(new Ko("IAgoraRTCClient.publish",Z))}N.current||y(!1)}}p.current=D},[d,r,c,n]),{isLoading:g,error:T}}function Jge(n){let[r,s]=le.useState(0);return le.useEffect(()=>{if(n)return jge(()=>{s(n.getVolumeLevel())},1e3)},[n]),r}var Zge=cf(lf());function r8(n=!0,r={ANS:!0,AEC:!0},s){let c=wd(s),[d,p]=le.useState(null),[g,y]=le.useState(!1),[T,R]=le.useState(null),N=hh();return uf(async()=>{if(N.current||(y(!1),R(null)),c&&n&&!d){try{N.current||y(!0);let D=await Zge.default.createMicrophoneAudioTrack(r);N.current||p(D)}catch(D){console.error(D),N.current||R(new Ko("IAgoraRTC.createMicrophoneAudioTrack",D))}N.current||y(!1)}!c&&!N.current&&p(null)},[c,n]),{localMicrophoneTrack:d,isLoading:g,error:T}}var Qge=cf(lf());function o8(n=!0,r,s){let c=wd(s),[d,p]=le.useState(null),[g,y]=le.useState(!1),[T,R]=le.useState(null),N=hh();return uf(async()=>{if(N.current||(y(!1),R(null)),c&&n&&!d){try{N.current||y(!0);let D=await Qge.default.createCameraVideoTrack(r);N.current||p(D)}catch(D){console.error(D),N.current||R(new Ko("IAgoraRTC.createCameraVideoTrack",D))}N.current||y(!1)}!c&&!N.current&&p(null)},[c,n]),{localCameraTrack:d,isLoading:g,error:T}}function s8(n,r){let s=ja(r),[c,d]=le.useState([]),p=wd(),g=le.useRef([]),[y,T]=le.useState(!1),[R,N]=le.useState(null),D=hh();return uf(async()=>{if(D.current||N(null),!Array.isArray(n)||!p)return;let B=async Y=>{if(!Y.audioTrack&&n.some(({uid:te})=>Y.uid===te)){try{D.current||T(!0),await s.subscribe(Y,"audio")}catch(te){console.error(te),D.current||N(new Ko("IAgoraRTCClient.subscribe",te))}Y.audioTrack&&!g.current.some(te=>te.getUserId()===Y.uid)&&g.current.push(Y.audioTrack),g.current=g.current.map(te=>Y.audioTrack&&te.getUserId()===Y.uid&&te.getTrackId()!==Y.audioTrack.getTrackId()?Y.audioTrack:te),D.current||(d([...g.current]),T(!1))}},q=async Y=>{if(n.some(({uid:te})=>Y.uid===te)){D.current||(g.current=g.current.filter(te=>te.getUserId()!==Y.uid),d([...g.current]));try{D.current||T(!0),await s.unsubscribe(Y,"audio")}catch(te){console.error(te),D.current||N(new Ko("IAgoraRTCClient.unsubscribe",te))}D.current||T(!1)}};n.map(Y=>{!Y.audioTrack&&Y.hasAudio&&B(Y)});let J=[];for(let Y=0;Y<g.current.length;Y++){let te=g.current[Y];if(!n.some(Z=>Z.uid===te.getUserId())){let Z=s.remoteUsers.find(ee=>ee.uid===te.getUserId());Z&&J.push({user:Z,mediaType:"audio"}),g.current.splice(Y,1),Y--}}if(J.length>0){try{D.current||T(!0),await s.massUnsubscribe(J)}catch(Y){console.error(Y),D.current||N(new Ko("IAgoraRTCClient.massUnsubscribe",Y))}D.current||(d(g.current.slice()),T(!1))}return df([Ao(s,"user-published",(Y,te)=>{n.find(Z=>Z.uid===Y.uid)&&te==="audio"&&B(Y)}),Ao(s,"user-unpublished",(Y,te)=>{n.find(Z=>Z.uid===Y.uid)&&te==="audio"&&q(Y)})])},[p,s,n]),{audioTracks:c,isLoading:y,error:R}}function e_e(n,r){let s=ja(r),[c,d]=le.useState([]),p=wd(),g=le.useRef([]),[y,T]=le.useState(!1),[R,N]=le.useState(null),D=hh();return uf(async()=>{if(D.current||N(null),!Array.isArray(n)||!p)return;let B=async Y=>{if(!Y.videoTrack&&n.some(({uid:te})=>Y.uid===te)){try{D.current||T(!0),await s.subscribe(Y,"video")}catch(te){console.error(te),D.current||N(new Ko("IAgoraRTCClient.subscribe",te))}Y.videoTrack&&!g.current.some(te=>te.getUserId()===Y.uid)&&g.current.push(Y.videoTrack),g.current=g.current.map(te=>Y.videoTrack&&te.getUserId()===Y.uid&&te.getTrackId()!==Y.videoTrack.getTrackId()?Y.videoTrack:te),D.current||(d([...g.current]),T(!1))}},q=async Y=>{if(n.some(({uid:te})=>Y.uid===te)){D.current||(g.current=g.current.filter(te=>te.getUserId()!==Y.uid),d([...g.current]));try{D.current||T(!0),await s.unsubscribe(Y,"video")}catch(te){console.error(te),D.current||N(new Ko("IAgoraRTCClient.unsubscribe",te))}D.current||T(!1)}};n.map(Y=>{!Y.videoTrack&&Y.hasVideo&&B(Y)});let J=[];for(let Y=0;Y<g.current.length;Y++){let te=g.current[Y];if(!n.some(Z=>Z.uid===te.getUserId())){let Z=s.remoteUsers.find(ee=>ee.uid===te.getUserId());Z&&J.push({user:Z,mediaType:"video"}),g.current.splice(Y,1),Y--}}if(J.length>0){try{D.current||T(!0),await s.massUnsubscribe(J)}catch(Y){console.error(Y),D.current||N(new Ko("IAgoraRTCClient.massUnsubscribe",Y))}D.current||(d(g.current.slice()),T(!1))}return df([Ao(s,"user-published",(Y,te)=>{n.find(Z=>Z.uid===Y.uid)&&te==="video"&&B(Y)}),Ao(s,"user-unpublished",(Y,te)=>{n.find(Z=>Z.uid===Y.uid)&&te==="video"&&q(Y)})])},[p,s,n]),{videoTracks:c,isLoading:y,error:R}}function mP(n,r,s){let c=ja(s),d=r==="audio"?"audioTrack":"videoTrack",[p,g]=le.useState(n&&n[d]),y=wd(),T=le.useRef(),[R,N]=le.useState(!1),[D,B]=le.useState(null);return le.useEffect(()=>{if(!n||!y)return;let q=!1;q||B(null);let J=r==="audio"?"hasAudio":"hasVideo",Y=n.uid,te=async(re,pe)=>{if(re[d]&&c.remoteUsers.some(({uid:ve})=>re.uid===ve))try{q||N(!0),await c.unsubscribe(re,pe)}catch(ve){q||B(new Ko("IAgoraRTCClient.unsubscribe",ve)),console.error(ve)}q||(g(void 0),N(!1))},Z=async(re,pe)=>{try{!re[d]&&c.remoteUsers.some(({uid:ve})=>re.uid===ve)&&(q||N(!0),await c.subscribe(re,pe)),q||g(re[d])}catch(ve){q||B(new Ko("IAgoraRTCClient.subscribe",ve)),console.error(ve)}q||N(!1)},ee=T.current||(T.current=qN());return!n[d]&&n[J]?ee.run(()=>Z(n,r)):g(n[d]),df([()=>{q=!0,ee.dispose()},Ao(c,"user-published",(re,pe)=>{re.uid===Y&&pe===r&&ee.run(()=>Z(re,r))}),Ao(c,"user-unpublished",(re,pe)=>{re.uid===Y&&pe===r&&ee.run(()=>te(re,r))})])},[y,c,n,r,d]),{track:p,isLoading:R,error:D}}function a8(n){let r=ja(n),[s,c]=le.useState(r?r.remoteUsers:[]);return le.useEffect(()=>{if(r){let d=()=>c(r.remoteUsers.slice());return df([Ao(r,"user-joined",d),Ao(r,"user-left",d),Ao(r,"user-published",d),Ao(r,"user-unpublished",d)])}},[r]),s}var t_e=cf(lf());function i_e(n=!0,r,s,c){let d=wd(c),[p,g]=le.useState(null),[y,T]=le.useState(!1),[R,N]=le.useState(null),D=hh();return uf(async()=>{if(D.current||(T(!1),N(null)),d&&n&&!p){try{D.current||T(!0);let B=await t_e.default.createScreenVideoTrack(r,s);D.current||g(B)}catch(B){console.error(B),D.current||N(new Ko("IAgoraRTC.createScreenVideoTrack",B))}D.current||T(!1)}(!d||!n)&&!D.current&&g(null)},[d,n]),{screenTrack:p,isLoading:y,error:R}}function n_e(){let n=new Map,r=1500;return{onMount:s=>{let c=n.get(s);c&&(c(),n.delete(s))},onUnmount:s=>{let c=n.get(s);c&&c(),n.set(s,Fw(()=>{s.isPlaying&&s.stop(),n.delete(s)},r))},dispose:()=>{for(let[s,c]of n)s.isPlaying&&s.stop(),c&&c();n.clear()}}}var YN=le.createContext(void 0);function r_e({children:n}){let[r]=le.useState(n_e);return le.useEffect(()=>r.dispose,[r]),O.jsx(YN.Provider,{value:r,children:n})}function $N(n,r,s,c){let d=le.useContext(YN);le.useEffect(()=>{if(n)return c&&r?n.play(c,s||void 0):n.stop(),d?(d.onMount(n),()=>d.onUnmount(n)):()=>{n.isPlaying&&n.stop()}},[n,c,r,d,s])}function XN(n,r){let s=le.useContext(YN);Bw(()=>{if(n)return r?n.play():n.stop(),s?(s.onMount(n),()=>s.onUnmount(n)):()=>{n.isPlaying&&n.stop()}},[n,r,s])}function c8({track:n,play:r=!1,volume:s,disabled:c,muted:d,children:p}){let g=ZG(n);return XN(g,r),le.useEffect(()=>{g&&s!=null&&g.setVolume(s)},[g,s]),le.useEffect(()=>{g&&c!=null&&g.setEnabled(!c).catch(console.warn)},[c,g]),le.useEffect(()=>{g&&d!=null&&g.setMuted(d).catch(console.warn)},[d,g]),p?O.jsx(O.Fragment,{children:p}):null}var l8={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},d8={width:"100%",height:"100%"},JN={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},Ww=(n,r)=>le.useMemo(()=>({...n,...r}),[n,r]);function ZN({track:n,play:r,disabled:s,muted:c,style:d,videoPlayerConfig:p,...g}){let y=Ww(d8,d),[T,R]=le.useState(null),N=ZG(n);return $N(N,r,p,T),le.useEffect(()=>{N&&s!=null&&N.setEnabled(!s).catch(console.warn)},[s,N]),le.useEffect(()=>{N&&c!=null&&N.setMuted(c).catch(console.warn)},[c,N]),O.jsx("div",{...g,ref:R,style:y})}var o_e={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},s_e={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function u8({cover:n}){return O.jsx("div",{style:JN,children:typeof n=="string"?O.jsxs(O.Fragment,{children:[O.jsx("div",{style:{...o_e,backgroundImage:`url(${n})`}}),O.jsx("img",{src:n,style:s_e})]}):n()})}function a_e({micOn:n,cameraOn:r,audioTrack:s,videoTrack:c,playAudio:d,playVideo:p,volume:g,cover:y,children:T,style:R,...N}){let D=Ww(l8,R);return p=p??!!r,d=d??!!n,O.jsxs("div",{...N,style:D,children:[O.jsx(ZN,{disabled:!r,play:p,track:c}),O.jsx(c8,{disabled:!n,play:d,track:s,volume:g}),y&&!r&&O.jsx(u8,{cover:y}),O.jsx("div",{style:JN,children:T})]})}function h8({track:n,play:r=!1,playbackDeviceId:s,volume:c,children:d}){return XN(n,r),le.useEffect(()=>{n&&s!=null&&n.setPlaybackDevice(s).catch(console.warn)},[n,s]),le.useEffect(()=>{n&&c!=null&&n.setVolume(c)},[n,c]),d?O.jsx(O.Fragment,{children:d}):null}function p8({track:n,play:r,style:s,videoPlayerConfig:c,...d}){let p=Ww(d8,s),[g,y]=le.useState(null);return $N(n,r,c,g),O.jsx("div",{...d,ref:y,style:p})}function gP({user:n,playVideo:r,playAudio:s,playbackDeviceId:c,volume:d,cover:p,style:g,children:y,videoPlayerConfig:T,...R}){let N=Ww(l8,g),{track:D}=mP(n,"video"),{track:B}=mP(n,"audio");return r=r??(n==null?void 0:n.hasVideo),s=s??(n==null?void 0:n.hasAudio),O.jsxs("div",{...R,style:N,children:[O.jsx(p8,{play:r,track:D,videoPlayerConfig:T}),O.jsx(h8,{play:s,playbackDeviceId:c,track:B,volume:d}),p&&!r&&O.jsx(u8,{cover:p}),O.jsx("div",{style:JN,children:y})]})}var c_e=cf(lf()),l_e=class{constructor(){ri(this,"appType",1001);c_e.default.setAppType(this.appType)}};new l_e;var d_e="2.2.0";Lge(JG,cf(lf()));var f8=Mge.default;/*! Bundled license information:

agora-rtc-sdk-ng/AgoraRTC_N-production.js:
  (*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> *)
*/const _P=({border:n,children:r,label:s})=>O.jsxs(u_e,{border:n,children:[r,s&&O.jsx(h_e,{children:s})]}),u_e=be.div`
  width: 100%;
  height: 100%;
  position: relative;
  border: ${n=>n.border+"px solid "+de.primary500};
  overflow: hidden;
`,h_e=be.p`
  position: absolute;
  background-color: ${de.primary500};
  color: ${de.white};
  padding: 7px 15px;
  top: 12px;
  left: 15px;
  font-size: 12px;
  transition: all 1s;
  pointer-events: none;

  @media screen and (max-width: 500px) {
    font-size: .8rem;
  }
`,zW=({localCameraTrack:n})=>O.jsx(_P,{border:4,label:"Yo",children:O.jsx(ZN,{track:n,play:!0,style:{width:"100%",height:"100%"}})}),p_e=({close:n,remoteUsers:r,iAmAnfitrion:s,uidAnfitrion:c})=>{const{isLoading:d,localMicrophoneTrack:p}=r8(),{isLoading:g,localCameraTrack:y}=o8(),{audioTracks:T}=s8(r),[R,N]=le.useState(!0),[D,B]=le.useState(!0),q=()=>{p.setMuted(!p.muted),N(p.muted)},J=()=>{y.setMuted(!y.muted),B(y.muted)};return n8([p,y]),T.map(te=>te.play()),d||g?O.jsx(HW,{children:O.jsx("small",{children:"Cargando dispositivos..."})}):O.jsx(HW,{children:O.jsxs(f_e,{children:[O.jsxs(m_e,{children:[O.jsx(g_e,{children:s?O.jsx(zW,{localCameraTrack:y}):O.jsx(_P,{border:4,label:"Anfitrin",children:O.jsx(gP,{user:r.find(te=>te.uid===c)})})}),O.jsx(__e,{children:r.length===0?O.jsx(E_e,{children:O.jsx("p",{children:"Ningn usuario en lnea"})}):O.jsxs(O.Fragment,{children:[!s&&O.jsx(zW,{localCameraTrack:y}),r.filter(te=>te.uid!==c).map(te=>!!te._cname&&O.jsx(_P,{border:4,children:O.jsx(gP,{user:te})}))]})})]}),O.jsxs(v_e,{children:[O.jsx(ZA,{onClick:q,type:"secondary",children:R?O.jsx("i",{className:"fa-solid fa-microphone"}):O.jsx("i",{className:"fa-solid fa-microphone-slash"})}),O.jsx(ZA,{onClick:J,type:"secondary",children:D?O.jsx("i",{className:"fa-solid fa-video"}):O.jsx("i",{className:"fa-solid fa-video-slash"})}),O.jsx(ZA,{onClick:n,tint:de.tertiary600,type:"secondary",children:O.jsx("i",{className:"fa-solid fa-phone-slash"})})]})]})})},HW=be.div`
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
`,f_e=be.div`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: 20px;
`,m_e=be.div`
  height: 90%;
  display: flex;
  flex-direction: column;
`,g_e=be.div`
  height: 60%;
`,__e=be.div`
  height: 40%;
  display: flex;
  overflow-x: auto;
  & > div {
    width: 33.33%;
  }
`,E_e=be.section`
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
`,v_e=be.div`
  display: flex;
  align-self: center;
  gap: 20px;
`,ZA=be.button`
  width: 50px;
  height: 50px;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: transparent;
  border: 2.5px solid ${n=>n.tint||de.tertiary400};
  color: ${n=>n.tint||de.tertiary400};
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.3s;
  &:hover {
    opacity: 0.8;
  }
  &.button {
    cursor: pointer;
    transition: opacity 0.3s;
    &:hover {
      opacity: 0.7;
    }
  }
  & > img {
    width: 100%;
    height: 100%;
  }
`,y_e=({close:n})=>{const r="ac372a34a79b4649a5d77b69672e7292",s=a8(),[c,d]=le.useState(!1),{user:p}=$s(),g=p.rol.includes("v"),y=1;i8({appid:r,channel:"callcenter",token:null,uid:g?y:void 0});const T=s.find(R=>R.uid===y);return le.useEffect(()=>{T||d(!1)},[s]),c&&T||g?O.jsx(p_e,{close:n,remoteUsers:s,iAmAnfitrion:g,uidAnfitrion:y}):O.jsx(S_e,{children:T?O.jsxs(O.Fragment,{children:[O.jsx("p",{children:"El anfitrin est en lnea para ayudarte!"}),O.jsx(Gi,{type:"secondary",onClick:()=>d(!0),children:"Unirse a la llamada"})]}):O.jsx("p",{children:"El anfitrin no se encuentra en lnea ahora mismo, por favor vuelva ms tarde..."})})},S_e=be.div`
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
`,T_e=({close:n})=>{const r=ja(f8.createClient({mode:"rtc",codec:"vp8"}));return O.jsx(w_e,{children:O.jsx(e8,{client:r,children:O.jsx(y_e,{close:n})})})},w_e=be.div`
  width: 800px;
  height: 620px;
  background-color: ${de.primary300};
  padding: 24px 24px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  align-items: center;
  position: relative;
`,C_e=()=>{const[n,r]=le.useState(!1);return O.jsxs(O.Fragment,{children:[O.jsx(b_e,{onClick:()=>r(!0),children:O.jsx("i",{className:"fa-solid fa-video"})}),n&&O.jsx(Kv,{close:()=>r(!1),children:O.jsx(T_e,{close:()=>r(!1)})})]})},b_e=be.button`
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  position: fixed;
  bottom: 48px;
  right: 4vw;
  z-index: 1000;
  border-radius: 8px;
  color: ${de.white};
  background-color: ${de.tertiary400};
  border: 4px solid ${de.primary400};
  cursor: pointer;
  transition: opacity 0.3s;
  &:hover {
    opacity: 0.8;
  }
`;function R_e(){const{data:n}=of("myip"),{setActualCity:r,setActualCoords:s,user:c}=$s(),{setPublicidadGeneral:d,setPublicidadEspecifica:p}=Lw();return le.useEffect(()=>{var g,y,T,R;n&&(d((g=n.data)==null?void 0:g.general),p((y=n.data)==null?void 0:y.especifica),r((T=n.data)==null?void 0:T.ciudad),s((R=n.data)==null?void 0:R.coords))},[n]),O.jsxs(Mse,{children:[O.jsx(zce,{}),O.jsx(I_e,{children:O.jsxs(Ase,{children:[O.jsx(Sr,{path:"/",element:O.jsx(ale,{})}),O.jsx(Sr,{path:"analizar",element:O.jsx(sd,{rol:"a",children:O.jsx(dde,{})})}),O.jsx(Sr,{path:"mapa",element:O.jsx(sd,{rol:"m",children:O.jsx($fe,{})})}),O.jsx(Sr,{path:"cart",element:O.jsx(sd,{rol:"",children:O.jsx(hge,{})})}),O.jsx(Sr,{path:"objetivo",element:O.jsx(gle,{})}),O.jsx(Sr,{path:"credito",element:O.jsx(ble,{})}),O.jsx(Sr,{path:"contacto",element:O.jsx(Ple,{})}),O.jsx(Sr,{path:"login",element:O.jsx(fme,{})}),O.jsx(Sr,{path:"register",element:O.jsx(Gme,{})}),O.jsx(Sr,{path:"crud/publicidad",element:O.jsx(sd,{rol:"x",children:O.jsx(Xme,{})})}),O.jsx(Sr,{path:"crud/publicidad/agregar",element:O.jsx(sd,{rol:"x",children:O.jsx(VW,{})})}),O.jsx(Sr,{path:"crud/publicidad/editar/:id",element:O.jsx(sd,{rol:"x",children:O.jsx(VW,{})})}),O.jsx(Sr,{path:"crud/usuario",element:O.jsx(sd,{rol:"x",children:O.jsx(nge,{})})}),O.jsx(Sr,{path:"crud/usuario/agregar",element:O.jsx(sd,{rol:"x",children:O.jsx(FW,{})})}),O.jsx(Sr,{path:"crud/usuario/editar/:id",element:O.jsx(sd,{rol:"x",children:O.jsx(FW,{})})}),O.jsxs(Sr,{path:"blog/",children:[O.jsx(Sr,{path:"",element:O.jsx(gge,{})}),O.jsx(Sr,{path:"instrucciones",element:O.jsx(dme,{})}),O.jsx(Sr,{path:"1",element:O.jsx(Ige,{})})]})]})}),O.jsx(ime,{}),c&&O.jsx(C_e,{}),O.jsx(Mce,{})]})}const I_e=be.div`
  min-height: 100dvh;
`;QA.createRoot(document.getElementById("root")).render(O.jsx(oo.StrictMode,{children:O.jsx(R_e,{})}));
